[
  
  {
    "title": "Movimiento de datos",
    "url": "/posts/movimiento_datos/",
    "categories": "Base de Datos",
    "tags": "",
    "date": "2025-02-28 21:33:00 +0100",
    





    
    "snippet": "Ejercicio 1Realiza una exportación del esquema de SCOTT usando Oracle Data Pump con las siguientes condiciones:  Exporta tanto la estructura de las tablas como los datos de las mismas.  Excluye la ...",
    "content": "Ejercicio 1Realiza una exportación del esquema de SCOTT usando Oracle Data Pump con las siguientes condiciones:  Exporta tanto la estructura de las tablas como los datos de las mismas.  Excluye la tabla BONUS y los departamentos con menos de dos empleados.  Realiza una estimación previa del tamaño necesario para el fichero de exportación.  Programa la operación para dentro de 2 minutos.  Genera un archivo de log en el directorio raíz.Lo primero que hacemos es preparar el entorno para la exportación. Creamos un directorio en el sistema de archivos donde se almacenarán los archivos generados por Data Pump:sudo mkdir /opt/oracle/exportLuego, asignamos los permisos para que el usuario oracle tenga acceso:sudo chown oracle:oinstall /opt/oracle/exportUna vez configurado el sistema de archivos, accedemos a Oracle y definimos un directorio lógico que Data Pump utilizará para almacenar los archivos de exportación. Además, concedemos los permisos necesarios al usuario SCOTT:CREATE DIRECTORY EXPORT_BD AS '/opt/oracle/export/';GRANT READ, WRITE ON DIRECTORY EXPORT_BD TO SCOTT;También es necesario otorgar permisos de exportación completos para que pueda realizar la operación:GRANT DATAPUMP_EXP_FULL_DATABASE TO SCOTT;Para realizar la exportación, utilizamos el comando expdp, incluyendo las condiciones establecidas:  Exportamos la estructura y los datos de todas las tablas del esquema SCOTT.  Excluimos la tabla BONUS.  Filtramos los departamentos que tienen menos de dos empleados.  Especificamos el directorio creado previamente para almacenar el archivo de exportación.El comando que utilizamos es el siguiente:expdp scott/tiger DIRECTORY=EXPORT_BD SCHEMAS=scott EXCLUDE=TABLE:\\\"=\\'BONUS\\'\\\" QUERY=dept:'\"WHERE deptno IN \\(SELECT deptno FROM EMP GROUP BY deptno HAVING COUNT\\(*\\)&gt;2\\)\"'Para ejecutar la exportación dentro de 2 minutos, podemos utilizar el comando at, pero en este caso optamos por un script que se encargará de la espera y la ejecución automática del comando. Creamos el archivo exportacion.sh:#!/bin/bashecho \"Preparando la exportación del esquema SCOTT...\"sleep 70echo \"Falta menos de un minuto para iniciar el proceso.\"sleep 20echo \"Últimos 10 segundos...\"sleep 7echo \"Exportación en 3... 2... 1... ¡Comenzando!\"sleep 3expdp scott/tiger \\  DIRECTORY=EXPORT_BD \\  SCHEMAS=scott \\  EXCLUDE=TABLE:\\\"=\\'BONUS\\'\\\" \\  QUERY=dept:'\"WHERE deptno IN \\(SELECT deptno FROM EMP GROUP BY deptno HAVING COUNT\\(*\\)&gt;2\\)\"' \\  LOGFILE=export_scott.logLe damos permisos de ejecución:sudo chmod +x exportacion.shFinalmente, ejecutamos el script y verificamos que la exportación se realiza correctamente después del tiempo indicado:./exportacion.shDe este modo, garantizamos que la exportación del esquema SCOTT se realiza según las condiciones establecidas, almacenando el log de la operación en el directorio raíz para su posterior revisión.Ejecutamos el script:Una vez terminada la ejecución podemos ver como se han generado dos archivos nuevos:oracle@oracle19c:~$ ls -lh /opt/oracle/export/total 516K-rw-r----- 1 oracle oinstall 504K feb 28 12:57 expdat.dmp-rw-r--r-- 1 oracle oinstall  471 feb 28 12:54 export.log-rw-r--r-- 1 oracle oinstall 2,3K feb 28 12:57 export_scott.logEste es el contenido de export_scott.log:Y este es el contenido de expdat.dmp:Ejercicio 2Importa el fichero obtenido anteriormente usando Oracle Data Pump pero en un usuario distinto de la misma base de datos.Para realizar la importación, utilizaré un usuario previamente creado. Antes de proceder, es necesario otorgarle los permisos de lectura y escritura sobre el directorio donde se encuentran los archivos de importación, ya que será el destino de la base de datos importada.Además, es fundamental concederle los privilegios necesarios para llevar a cabo la operación de importación correctamente:GRANT READ, WRITE ON DIRECTORY EXPORT_BD TO PABLOLINK;GRANT IMP_FULL_DATABASE TO PABLOLINK;Para importar la base de datos en el usuario PABLOLINK, utilizo la herramienta Oracle Data Pump con el siguiente comando:impdp pablolink/password \\  DIRECTORY=EXPORT_BD \\  DUMPFILE=expdat.dmp \\  REMAP_SCHEMA=scott:pablolink \\  TABLE_EXISTS_ACTION=REPLACE \\  LOGFILE=import_pablolink.log  DIRECTORY=EXPORT_BD: Indica el directorio lógico donde se encuentra el archivo de volcado (expdat.dmp).  DUMPFILE=expdat.dmp: Especifica el archivo de volcado de datos que contiene la exportación previa.  REMAP_SCHEMA=scott:pablolink: Transforma el esquema original (SCOTT) en el nuevo usuario (PABLOLINK), asegurando que los objetos se importen bajo esta nueva cuenta.  TABLE_EXISTS_ACTION=REPLACE: Si las tablas ya existen, este parámetro las elimina y las vuelve a crear antes de importar los datos.  LOGFILE=import_pablolink.log: Especifica un archivo de registro donde se almacenará el resultado del proceso de importación.Una vez finalizada la importación, accedo con el usuario PABLOLINK para verificar el contenido de la base de datos y comprobar si la tabla BONUS existe o no.Ejercicio 3Realiza una exportación de la estructura de todas las tablas de la base de datos usando el comando expdp de Oracle Data Pump probando al menos cinco de las posibles opciones que ofrece dicho comando y documentándolas adecuadamente.Para exportar solo la estructura de todas las tablas de la base de datos con Oracle Data Pump, usamos el comando expdp. Vamos a probar cinco opciones diferentes y explicar su función.Ejecutamos el siguiente comando:expdp pablolink/password \\  DIRECTORY=EXPORT_BD \\  DUMPFILE=exp_estructura.dmp \\  LOGFILE=exp_estructura.log \\  SCHEMAS=pablolink \\  CONTENT=METADATA_ONLY \\  COMPRESSION=ALL \\  EXCLUDE=STATISTICS \\  PARALLEL=2  DIRECTORY=EXPORT_BD: Especifica la carpeta en la que se guardará el archivo de exportación. Esta carpeta debe estar creada en Oracle y tener permisos adecuados.  DUMPFILE=exp_estructura.dmp: Es el nombre del archivo donde se guardará la exportación.  LOGFILE=exp_estructura.log: Guarda un registro con los detalles del proceso, por si necesitamos revisarlo más tarde.  SCHEMAS=pablolink: Exporta solo las tablas del usuario PABLOLINK, sin afectar a otros esquemas de la base de datos.  CONTENT=METADATA_ONLY: Exporta solo la estructura de las tablas, sin incluir los datos.  COMPRESSION=ALL: Comprime la exportación para que ocupe menos espacio en disco.  EXCLUDE=STATISTICS: No exporta las estadísticas de la base de datos, lo que reduce el tamaño del archivo de exportación.  PARALLEL=2: Usa dos procesos en paralelo para hacer la exportación más rápida.Con este comando, conseguimos una copia de seguridad de la estructura de las tablas sin guardar los datos, lo que es útil si queremos recrear el esquema en otro lugar sin transferir grandes volúmenes de información.Podemos ver que se han generado dos archivos:oracle@oracle19c:~$ ls -lh /opt/oracle/export/ | grep '19:26'-rw-r----- 1 oracle oinstall 124K feb 28 19:26 exp_estructura.dmp-rw-r--r-- 1 oracle oinstall 1,9K feb 28 19:26 exp_estructura.logEjercicio 4Intenta realizar operaciones similares de importación y exportación con las herramientas proporcionadas con MySQL desde línea de comandos, documentando el proceso.Cuando exportamos una base de datos en MySQL, lo que hacemos es generar un archivo con todas las instrucciones SQL necesarias para reconstruir la base de datos en otro lugar. Este archivo incluirá la estructura de las tablas y, si lo deseamos, también los datos almacenados en ellas.Para ello, utilizamos mysqldump, una herramienta que nos permite volcar toda la información en un archivo .sql. Antes de comenzar, debemos asegurarnos de que tenemos permisos suficientes para ejecutar la exportación y de que tenemos acceso a la base de datos empresa.Para la realización de este apartado, estaré utilizando las siguientes tablas:Exportación e Importación Completa (Estructura + Datos)Si queremos hacer una copia completa de la base de datos empresa, utilizamos mysqldump para generar un archivo que contiene tanto la estructura de las tablas como los datos almacenados en ellas.Ejecutamos el siguiente comando en la terminal:mysqldump -u usuario -p empresa &gt; empresa_completa.sqlEste archivo empresa_completa.sql contiene todas las instrucciones necesarias para reconstruir la base de datos con su estructura y datos.Supongamos que queremos importar esta base de datos en un usuario y base de datos diferentes. Primero, en MySQL, creamos una nueva base de datos empresa_copia y un usuario usuario_copia:CREATE DATABASE empresa_copia;CREATE USER 'usuario_copia'@'localhost' IDENTIFIED BY 'password';GRANT ALL PRIVILEGES ON empresa_copia.* TO 'usuario_copia'@'localhost';FLUSH PRIVILEGES;Luego, importamos el backup en la nueva base de datos:mysql -u usuario_copia -p empresa_copia &lt; empresa_completa.sqlSi accedemos a MySQL con el usuario usuario_copia y consultamos la base de datos, veremos que la estructura y los datos de empresa han sido replicados en empresa_copia.Exportación e Importación Solo de la EstructuraSi queremos transferir solo la estructura de la base de datos sin los datos, usamos la opción –no-data:mysqldump -u usuario -p --no-data empresa &gt; empresa_estructura.sqlEste archivo empresa_estructura.sql contiene únicamente las sentencias CREATE TABLE, sin los registros de las tablas.Creamos una base de datos empresa_vacia y un usuario usuario_vacio:CREATE DATABASE empresa_vacia;CREATE USER 'usuario_vacio'@'localhost' IDENTIFIED BY 'password';GRANT ALL PRIVILEGES ON empresa_vacia.* TO 'usuario_vacio'@'localhost';FLUSH PRIVILEGES;Luego, importamos el archivo con la estructura:mysql -u usuario_vacio -p empresa_vacia &lt; empresa_estructura.sqlAl acceder a empresa_vacia, veremos que las tablas están creadas, pero no contienen datos.Exportación e Importación Solo de los DatosSi ya tenemos la estructura en otro servidor y queremos trasladar solo los datos sin modificar las tablas, utilizamos la opción --no-create-info:mysqldump -u usuario -p --no-create-info empresa &gt; empresa_datos.sqlEste archivo empresa_datos.sql solo contiene las sentencias INSERT INTO con los registros.Supongamos que ya tenemos una base de datos empresa_estructura con las mismas tablas creadas previamente. Creamos un nuevo usuario para este entorno:CREATE USER 'usuario_datos'@'localhost' IDENTIFIED BY 'password';GRANT ALL PRIVILEGES ON empresa_datos.* TO 'usuario_datos'@'localhost';FLUSH PRIVILEGES;Luego, importamos solo los datos:mysql -u usuario_datos -p empresa_datos &lt; empresa_datos.sqlSi consultamos las tablas en empresa_datos, veremos que ahora contienen datos sin haber modificado su estructura.Exportación e Importación con CompresiónSi la base de datos es grande, podemos comprimirla antes de almacenarla o transferirla:mysqldump -u usuario -p empresa | gzip &gt; empresa_comprimida.sql.gzEsto reduce significativamente el tamaño del archivo.Antes de importar, primero descomprimimos el archivo:gunzip &lt; empresa_comprimida.sql.gz | mysql -u usuario_copia -p empresa_copiaEsto ejecutará el contenido del archivo en empresa_copia, restaurando toda la base de datos.Ejercicio 5Intenta realizar operaciones similares de importación y exportación con las herramientas proporcionadas con Postgres desde línea de comandos, documentando el proceso.Para realizar la exportación e importación de datos de una base de datos en PostgreSQL, se puede utilizar la herramienta pg_dump, que permite crear copias de seguridad de bases de datos completas o de objetos específicos (como tablas o esquemas). A continuación, vamos a simular un escenario donde creamos una base de datos, exportamos e importamos datos, utilizando un usuario llamado pablouser y una base de datos llamada pablobd.Creación del Usuario y la Base de DatosPrimero, necesitamos crear un nuevo usuario en PostgreSQL que tendrá privilegios sobre la base de datos que vamos a manejar. Para hacerlo, nos conectamos a la consola de PostgreSQL con el usuario postgres (que es el administrador por defecto de PostgreSQL):pablo@servidor-postgre1:~$ sudo -u postgres psqlUna vez dentro de PostgreSQL, podemos crear un nuevo usuario:postgres=# CREATE USER pablouser WITH PASSWORD 'password';Luego, creamos una base de datos llamada pablobd y le asignamos la propiedad al usuario recién creado:postgres=# CREATE DATABASE pablobd WITH OWNER = pablouser;Creación de Tablas y Población con DatosAntes de exportar los datos, necesitamos algunas tablas con datos para que podamos exportarlas. Supongamos que queremos crear dos tablas: clientes y pedidos.Tabla de Clientespablouser=# CREATE TABLE clientes (    id SERIAL PRIMARY KEY,    nombre VARCHAR(100),    email VARCHAR(100),    direccion VARCHAR(255));Tabla de Pedidospablouser=# CREATE TABLE pedidos (    id SERIAL PRIMARY KEY,    cliente_id INTEGER REFERENCES clientes(id),    producto VARCHAR(100),    cantidad INTEGER,    precio DECIMAL);A continuación, vamos a insertar algunos datos en estas tablas.pablouser=# INSERT INTO clientes (nombre, email, direccion)VALUES('Juan Pérez', 'juan.perez@email.com', 'Calle Falsa 123'),('Ana Gómez', 'ana.gomez@email.com', 'Avenida Siempre Viva 456'),('Luis Martínez', 'luis.martinez@email.com', 'Plaza Mayor 789');pablouser=# INSERT INTO pedidos (cliente_id, producto, cantidad, precio)VALUES(1, 'Laptop', 1, 1200.00),(2, 'Smartphone', 2, 800.00),(3, 'Teclado', 3, 150.00),(1, 'Monitor', 1, 300.00);Exportación de la Base de DatosUna vez que tenemos datos en nuestras tablas, podemos exportar la base de datos, ya sea completamente o exportando solo ciertas tablas.Para exportar toda la base de datos pablobd, utilizamos el comando pg_dump:pablo@servidor-postgre1:~$ pg_dump -U pablouser -h localhost pablobd &gt; pablobd_completa.sqlEste comando creará un archivo llamado pablobd_completa.sql que contendrá toda la estructura de la base de datos (tablas, índices, funciones, etc.) y los datos. Es importante mencionar que se utilizará la contraseña del usuario pablouser durante la ejecución.Si solo deseamos exportar la estructura de las tablas (sin los datos), podemos usar la opción -s de pg_dump:pablo@servidor-postgre1:~$ pg_dump -U pablouser -h localhost -s pablobd &gt; pablobd_estructura.sqlEste comando generará un archivo que solo contendrá la definición de las tablas, sin los datos de las filas.Si solo queremos exportar una tabla específica (por ejemplo, la tabla clientes), utilizamos la opción -t de pg_dump:pablo@servidor-postgre1:~$ pg_dump -U pablouser -h localhost -t clientes pablobd &gt; clientes.sqlEste comando exportará solo la tabla clientes y sus datos a un archivo llamado clientes.sql.Para importar los datos exportados, primero necesitamos crear una nueva base de datos en PostgreSQL donde importaremos los datos. Supongamos que queremos importar los datos exportados a una nueva base de datos llamada nuevobd:postgres=# CREATE DATABASE nuevobd WITH OWNER = pablouser;Ahora, la base de datos nuevobd está lista para recibir los datos.Importación de los DatosLa importación se realiza utilizando el comando psql. Para importar el archivo completo de la base de datos, podemos usar el siguiente comando:pablo@servidor-postgre1:~$ psql -U pablouser -d nuevobd -h localhost &lt; pablobd_completa.sqlContraseña para usuario pablouser:Esto restaurará tanto la estructura como los datos de la base de datos original pablobd en la nueva base de datos nuevobd.Si solo queremos importar la estructura de las tablas, utilizamos el archivo pablobd_estructura.sql de esta manera:pablo@servidor-postgre1:~$ psql -U pablouser -d nuevobd -h localhost &lt; pablobd_estructura.sqlEsto creará las tablas sin los datos.Si solo deseamos importar la tabla clientes, usamos el siguiente comando con el archivo clientes.sql:pablo@servidor-postgre1:~$ psql -U pablouser -d nuevobd -h localhost &lt; clientes.sqlUna vez realizada la importación, nos conectamos a la base de datos nuevobd como el usuario pablouser para verificar que los datos y la estructura se han importado correctamente:pablo@servidor-postgre1:~$ psql -U pablouser -d nuevobd -h localhostContraseña para usuario pablouser:Luego, podemos listar las tablas de la base de datos para verificar que las tablas se han creado correctamente:pablouser=&gt; \\d Esquema | Nombre   | Tipo  | Propietario---------+----------+-------+------------- public  | clientes | tabla | pablouser public  | pedidos  | tabla | pablouser(2 filas)Y verificar que los datos también se han importado correctamente:pablouser=&gt; SELECT * FROM clientes;Esto debería mostrar los datos que insertamos previamente en la tabla clientes: id |      nombre      |         email         |          direccion----+------------------+-----------------------+------------------------------  1 | Juan Pérez       | juan.perez@email.com   | Calle Falsa 123  2 | Ana Gómez        | ana.gomez@email.com    | Avenida Siempre Viva 456  3 | Luis Martínez    | luis.martinez@email.com| Plaza Mayor 789(3 filas)Ejercicio 6Exporta los documentos de una colección de MongoDB que cumplan una determinada condición e impórtalos en otra base de datos.Supongamos que tenemos una base de datos llamada tienda y una colección llamada productos.Queremos exportar todos los documentos de la colección productos cuyo campo precio sea mayor a 100.Accedemos al servidor de MongoDB, podemos hacerlo de forma remota o local, dependiendo de nuestra configuración.Utilizamos la herramienta mongoexport para exportar los documentos que cumplan con una condición específica. En este caso, queremos exportar todos los productos cuyo precio sea mayor a 100. Para ello, usaremos el siguiente comando:mongoexport --uri=\"mongodb://localhost:27017\" -u pavlo -p pavlo --authenticationDatabase admin --db=tienda --collection=productos --query='{ \"precio\": { \"$gt\": 100 } }' --jsonArray --out=productos_exportados.jsonDonde:  --uri=\"mongodb://localhost:27017\": Especificamos la URI de conexión a nuestro servidor de MongoDB. En este caso, estamos trabajando con una instancia local.  --db=tienda: Indicamos la base de datos desde la cual vamos a exportar los datos.  --collection=productos: Especificamos la colección productos de la cual vamos a exportar los documentos.  --query='{ \"precio\": { \"$gt\": 100 } }': Definimos una consulta que filtre los productos cuyo campo precio sea mayor que 100 ($gt es el operador de “mayor que”).  --out=productos_exportados.json: Especificamos el archivo de salida donde se guardarán los documentos exportados, en formato JSON.Esto generará un archivo llamado productos_exportados.json que contendrá todos los productos cuyo precio sea mayor a 100.Una vez que hemos exportado los documentos que cumplen con la condición, el siguiente paso es importarlos en otra base de datos de MongoDB. Supongamos que queremos importar estos documentos en una nueva base de datos llamada nueva_tienda.Para ello, usamos el siguiente comando:mongoimport --uri=\"mongodb://localhost:27017\" -u pavlo -p pavlo --authenticationDatabase admin --db=nueva_tienda --collection=productos --file=productos_exportados.json --jsonArrayUna vez realizado el proceso de importación, podemos verificar que los documentos se han importado correctamente accediendo a la base de datos nueva_tienda. Para verificarlo, utilizamos el siguiente comando:Y tal y como podemos observar, solo se han importado solo los documentos cuyo precio es superior a 100.Ejercicio 7SQLLoader es una herramienta que sirve para cargar grandes volúmenes de datos en una instancia de ORACLE. Exportad los datos de una base de datos completa desde MariaDB a texto plano con delimitadores y emplead SQLLoader para realizar el proceso de carga de dichos datos a una instancia ORACLE. Debéis documentar todo el proceso, explicando los distintos ficheros de configuración y de log que tiene SQL*Loader.Primero, necesitamos exportar los datos de la base de datos MariaDB a un formato de texto plano con delimitadores, como CSV. Para ello, seleccionamos las dos tablas que queremos exportar: departamentos y empleados.MariaDB [empresa]&gt; SHOW TABLES;+-------------------+| Tables_in_empresa |+-------------------+| departamentos     || empleados         |+-------------------+2 rows in set (0,000 sec)MariaDB [empresa]&gt; SELECT * FROM departamentos;+----+------------------+-----------+| id | nombre           | ubicacion |+----+------------------+-----------+|  1 | Recursos Humanos | Madrid    ||  2 | Finanzas         | Barcelona ||  3 | Desarrollo       | Sevilla   ||  4 | Ventas           | Valencia  |+----+------------------+-----------+4 rows in set (0,000 sec)MariaDB [empresa]&gt; SELECT * FROM empleados;+----+--------+------------+------------------------------+---------+-----------------+| id | nombre | apellido   | email                        | salario | departamento_id |+----+--------+------------+------------------------------+---------+-----------------+|  1 | Juan   | Pérez      | juan.perez@empresa.com       | 3000.00 |               1 ||  2 | María  | López      | maria.lopez@empresa.com      | 3500.00 |               2 ||  3 | Carlos | Fernández  | carlos.fernandez@empresa.com | 4000.00 |               3 ||  4 | Ana    | Gómez      | ana.gomez@empresa.com        | 3200.00 |               4 |+----+--------+------------+------------------------------+---------+-----------------+4 rows in set (0,000 sec)Antes de esto, debemos crear una carpeta en la ruta /var/lib/mysql, la cual tendrá permisos adecuados para que el servicio de MariaDB pueda escribir los archivos.pablo@servidor-mariadb:~$ cd /var/lib/mysql/pablo@servidor-mariadb:/var/lib/mysql$ sudo mkdir datoscsvpablo@servidor-mariadb:/var/lib/mysql$ sudo chown -R mysql:mysql datoscsv/Ahora, para exportar las tablas a archivos CSV, ejecutamos el siguiente comando para cada una de las tablas:MariaDB [empresa]&gt; SELECT * FROM departamentos    -&gt; INTO OUTFILE '/var/lib/mysql/datoscsv/departamentos.csv'    -&gt; FIELDS TERMINATED BY ','     -&gt; ENCLOSED BY '\"'    -&gt; LINES TERMINATED BY '\\n';Query OK, 4 rows affected, 1 warning (0,001 sec)MariaDB [empresa]&gt; SELECT * FROM empleados    -&gt; INTO OUTFILE '/var/lib/mysql/datoscsv/empleados.csv'    -&gt; FIELDS TERMINATED BY ','     -&gt; ENCLOSED BY '\"'    -&gt; LINES TERMINATED BY '\\n';Query OK, 4 rows affected, 1 warning (0,001 sec)Ambos archivos se guardan en la carpeta /var/lib/mysql/datoscsv anteriormente creada:pablo@servidor-mariadb:~$ ls -lh /var/lib/mysql/datoscsv/total 8,0K-rw-r--r-- 1 mysql mysql 110 mar  2 17:18 departamentos.csv-rw-r--r-- 1 mysql mysql 249 mar  2 17:18 empleados.csvUna vez que tenemos los archivos CSV listos, debemos configurar SQLLoader para cargar estos datos en la base de datos Oracle. Para ello, debemos crear un archivo de control (.ctl), que es un archivo de configuración que le indica a SQLLoader cómo debe procesar los archivos de datos y cómo deben mapearse a las tablas de destino en Oracle.Pero antes, debemos transferir los archivos a la máquina donde tenemos Oracle, pues son máquinas distintas:pablo@servidor-mariadb:~$ scp /var/lib/mysql/datoscsv/* oracle@192.168.122.195:/home/oracleoracle@192.168.122.195's password: departamentos.csv                                                                                                                          100%  110   286.3KB/s   00:00    empleados.csv                                                                                                                              100%  249   790.8KB/s   00:00 Una vez tenemos los ficheros aquí, tendremos que crear el archivo de control departamentos.ctl, el cual se utilizará para cargar los datos de la tabla departamentos en la base de datos Oracle.oracle@oracle19c:~/datoscsv$ ls -lhtotal 12K-rw-r--r-- 1 oracle dba  110 mar  2 17:23 departamentos.csv-rw-r--r-- 1 root   root 175 mar  2 17:26 departamentos.ctl-rw-r--r-- 1 oracle dba  249 mar  2 17:23 empleados.csvoracle@oracle19c:~/datoscsv$ cat departamentos.ctl LOAD DATAINFILE '/home/oracle/datoscsv/departamentos.csv'INTO TABLE departamentosFIELDS TERMINATED BY ',' TRAILING NULLCOLS(  id,  nombre,  ubicacion)Donde:  LOAD DATA: Inicia el proceso de carga de datos.  INFILE: Especifica la ruta del archivo CSV con los datos.  INTO TABLE: Especifica la tabla de destino en Oracle, en este caso, departamentos.  FIELDS TERMINATED BY: Indica que los campos están separados por comas.  ENCLOSED BY: Especifica que los campos están rodeados por comillas dobles.  LINES TERMINATED BY: Indica que cada línea está terminada por un salto de línea.  (id, nombre, ubicacion): Especifica el orden de los campos en el archivo CSV y su correspondencia con las columnas de la tabla Oracle.De manera similar, creamos el archivo de control empleados.ctl para la tabla empleados:oracle@oracle19c:~/datoscsv$ cat empleados.ctl LOAD DATAINFILE '/home/oracle/datoscsv/empleados.csv'INTO TABLE empleadosFIELDS TERMINATED BY ',' TRAILING NULLCOLS(  id,   nombre,   apellido,   email,   salario   \"TO_NUMBER(:salario, '9999.99')\",  departamento_id)Este archivo de control sigue la misma estructura, pero con los campos correspondientes para la tabla empleados en Oracle.Antes de cargar los datos en la base de datos Oracle, tendremos que crear las tablas en Oracle con la misma estructura que las tablas de MariaDB, pero sin datos.oracle@oracle19c:~$ sqlplus loaderpavlo/passwordSQL*Plus: Release 19.0.0.0.0 - Production on Sun Mar 2 17:32:56 2025Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Hora de Ultima Conexion Correcta: Dom Mar 02 2025 16:56:58 +01:00Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0SQL&gt; CREATE TABLE departamentos (  2      id NUMBER PRIMARY KEY,  3      nombre VARCHAR2(50),  4      ubicacion VARCHAR2(50)  5  );Tabla creada.SQL&gt; SQL&gt; CREATE TABLE empleados (  2      id NUMBER PRIMARY KEY,  3      nombre VARCHAR2(50),  4      apellido VARCHAR2(50),  5      email VARCHAR2(100),  6      salario NUMBER(10,2),  7      departamento_id NUMBER,  8      CONSTRAINT fk_departamento FOREIGN KEY (departamento_id)  9          REFERENCES departamentos(id) 10  );Tabla creada.Una vez que tenemos los archivos de control, podemos utilizar SQL*Loader para cargar los datos en Oracle:oracle@oracle19c:~/datoscsv$ sqlldr userid=loaderpavlo/password control=departamentos.ctl log=departamentos.logSQL*Loader: Release 19.0.0.0.0 - Production on Sun Mar 2 17:45:13 2025Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.Path used:      ConventionalCommit point reached - logical record count 4Table DEPARTAMENTOS:  4 Rows successfully loaded.Check the log file:  departamentos.logfor more information about the load.Como podemos observar, el mensaje indica que las 4 filas del archivo CSV fueron cargadas correctamente. No hubo filas rechazadas ni errores durante la carga.También podemos ver el archivo de log que se ha generado, donde nos muestra información adicional de la transacción:oracle@oracle19c:~/datoscsv$ ls -lhtotal 20K-rw-r--r-- 1 oracle dba   86 mar  2 17:45 departamentos.csv-rw-r--r-- 1 oracle dba  160 mar  2 17:38 departamentos.ctl-rw-r--r-- 1 oracle dba 1,7K mar  2 17:45 departamentos.log-rw-r--r-- 1 oracle dba  249 mar  2 17:23 empleados.csv-rw-r--r-- 1 oracle dba  199 mar  2 17:29 empleados.ctloracle@oracle19c:~/datoscsv$ cat departamentos.log SQL*Loader: Release 19.0.0.0.0 - Production on Sun Mar 2 17:45:13 2025Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.Control File:   departamentos.ctlData File:      /home/oracle/datoscsv/departamentos.csv  Bad File:     departamentos.bad  Discard File:  none specified  (Allow all discards)Number to load: ALLNumber to skip: 0Errors allowed: 50Bind array:     250 rows, maximum of 1048576 bytesContinuation:    none specifiedPath used:      ConventionalTable DEPARTAMENTOS, loaded from every logical record.Insert option in effect for this table: INSERTTRAILING NULLCOLS option in effect   Column Name                  Position   Len  Term Encl Datatype------------------------------ ---------- ----- ---- ---- ---------------------ID                                  FIRST     *   ,       CHARACTER            NOMBRE                               NEXT     *   ,       CHARACTER            UBICACION                            NEXT     *   ,       CHARACTER            Table DEPARTAMENTOS:  4 Rows successfully loaded.  0 Rows not loaded due to data errors.  0 Rows not loaded because all WHEN clauses were failed.  0 Rows not loaded because all fields were null.Space allocated for bind array:                 193500 bytes(250 rows)Read   buffer bytes: 1048576Total logical records skipped:          0Total logical records read:             4Total logical records rejected:         0Total logical records discarded:        0Run began on Sun Mar 02 17:45:13 2025Run ended on Sun Mar 02 17:45:13 2025Elapsed time was:     00:00:00.10CPU time was:         00:00:00.03Tras ejecutar el comando de carga, accedemos a la base de datos para consultar que se hayan importado correctamente los datos:oracle@oracle19c:~/datoscsv$ sqlplus loaderpavlo/passwordSQL*Plus: Release 19.0.0.0.0 - Production on Sun Mar 2 17:46:49 2025Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Hora de Ultima Conexion Correcta: Dom Mar 02 2025 17:45:13 +01:00Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0SQL&gt; SELECT * FROM departamentos;\tID----------NOMBRE--------------------------------------------------------------------------------UBICACION--------------------------------------------------------------------------------\t 1Recursos HumanosMadrid\t 2FinanzasBarcelona\tID----------NOMBRE--------------------------------------------------------------------------------UBICACION--------------------------------------------------------------------------------\t 3DesarrolloSevilla\t 4Ventas\tID----------NOMBRE--------------------------------------------------------------------------------UBICACION--------------------------------------------------------------------------------ValenciaY como podemos ver, se han añadido correctamente los datos.Ahora realizamos el mismo proceso pero con la tabla empleados:SQL&gt; SELECT * FROM empleados;ninguna fila seleccionadaSQL&gt; exitDesconectado de Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0oracle@oracle19c:~/datoscsv$ sqlldr userid=loaderpavlo/password control=empleados.ctl log=empleados.logSQL*Loader: Release 19.0.0.0.0 - Production on Sun Mar 2 17:59:40 2025Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.Path used:      ConventionalCommit point reached - logical record count 4Table EMPLEADOS:  4 Rows successfully loaded.Check the log file:  empleados.logfor more information about the load.oracle@oracle19c:~/datoscsv$ ls -lhtotal 24K-rw-r--r-- 1 oracle dba   86 mar  2 17:45 departamentos.csv-rw-r--r-- 1 oracle dba  160 mar  2 17:38 departamentos.ctl-rw-r--r-- 1 oracle dba 1,7K mar  2 17:45 departamentos.log-rw-r--r-- 1 oracle dba  201 mar  2 17:57 empleados.csv-rw-r--r-- 1 oracle dba  229 mar  2 17:59 empleados.ctl-rw-r--r-- 1 oracle dba 2,0K mar  2 17:59 empleados.logoracle@oracle19c:~/datoscsv$ cat empleados.log SQL*Loader: Release 19.0.0.0.0 - Production on Sun Mar 2 17:59:40 2025Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.Control File:   empleados.ctlData File:      /home/oracle/datoscsv/empleados.csv  Bad File:     empleados.bad  Discard File:  none specified  (Allow all discards)Number to load: ALLNumber to skip: 0Errors allowed: 50Bind array:     250 rows, maximum of 1048576 bytesContinuation:    none specifiedPath used:      ConventionalTable EMPLEADOS, loaded from every logical record.Insert option in effect for this table: INSERTTRAILING NULLCOLS option in effect   Column Name                  Position   Len  Term Encl Datatype------------------------------ ---------- ----- ---- ---- ---------------------ID                                  FIRST     *   ,       CHARACTER            NOMBRE                               NEXT     *   ,       CHARACTER            APELLIDO                             NEXT     *   ,       CHARACTER            EMAIL                                NEXT     *   ,       CHARACTER            SALARIO                              NEXT     *   ,       CHARACTER                SQL string for column : \"TO_NUMBER(:salario, '9999.99')\"DEPARTAMENTO_ID                      NEXT     *   ,       CHARACTER            Table EMPLEADOS:  4 Rows successfully loaded.  0 Rows not loaded due to data errors.  0 Rows not loaded because all WHEN clauses were failed.  0 Rows not loaded because all fields were null.Space allocated for bind array:                 387000 bytes(250 rows)Read   buffer bytes: 1048576Total logical records skipped:          0Total logical records read:             4Total logical records rejected:         0Total logical records discarded:        0Run began on Sun Mar 02 17:59:40 2025Run ended on Sun Mar 02 17:59:40 2025Elapsed time was:     00:00:00.10CPU time was:         00:00:00.03oracle@oracle19c:~/datoscsv$ sqlplus loaderpavlo/passwordSQL*Plus: Release 19.0.0.0.0 - Production on Sun Mar 2 18:00:53 2025Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Hora de Ultima Conexion Correcta: Dom Mar 02 2025 17:59:40 +01:00Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0SQL&gt; SELECT * FROM empleados;\tID----------NOMBRE--------------------------------------------------------------------------------APELLIDO--------------------------------------------------------------------------------EMAIL--------------------------------------------------------------------------------   SALARIO DEPARTAMENTO_ID---------- ---------------\t 1JuanP??rez\tID----------NOMBRE--------------------------------------------------------------------------------APELLIDO--------------------------------------------------------------------------------EMAIL--------------------------------------------------------------------------------   SALARIO DEPARTAMENTO_ID---------- ---------------juan.perez@empresa.com      3000\t\t 1\tID----------NOMBRE--------------------------------------------------------------------------------APELLIDO--------------------------------------------------------------------------------EMAIL--------------------------------------------------------------------------------   SALARIO DEPARTAMENTO_ID---------- ---------------\t 2Mar??aL??pez\tID----------NOMBRE--------------------------------------------------------------------------------APELLIDO--------------------------------------------------------------------------------EMAIL--------------------------------------------------------------------------------   SALARIO DEPARTAMENTO_ID---------- ---------------maria.lopez@empresa.com      3500\t\t 2\tID----------NOMBRE--------------------------------------------------------------------------------APELLIDO--------------------------------------------------------------------------------EMAIL--------------------------------------------------------------------------------   SALARIO DEPARTAMENTO_ID---------- ---------------\t 3CarlosFern??ndez\tID----------NOMBRE--------------------------------------------------------------------------------APELLIDO--------------------------------------------------------------------------------EMAIL--------------------------------------------------------------------------------   SALARIO DEPARTAMENTO_ID---------- ---------------carlos.fernandez@empresa.com      4000\t\t 3\tID----------NOMBRE--------------------------------------------------------------------------------APELLIDO--------------------------------------------------------------------------------EMAIL--------------------------------------------------------------------------------   SALARIO DEPARTAMENTO_ID---------- ---------------\t 4AnaG??mez\tID----------NOMBRE--------------------------------------------------------------------------------APELLIDO--------------------------------------------------------------------------------EMAIL--------------------------------------------------------------------------------   SALARIO DEPARTAMENTO_ID---------- ---------------ana.gomez@empresa.com      3200\t\t 4Se observa de nuevo que los datos han sido cargados correctamente en la tabla."
  },
  
  {
    "title": "Auditoría",
    "url": "/posts/auditoria/",
    "categories": "Base de Datos",
    "tags": "",
    "date": "2025-02-25 21:00:00 +0100",
    





    
    "snippet": "1. Activa desde SQL*Plus la auditoría de los intentos de acceso no exitosos al sistema. Comprueba su funcionamiento.Para activar la auditoría de los intentos de acceso no exitosos en Oracle, lo pri...",
    "content": "1. Activa desde SQL*Plus la auditoría de los intentos de acceso no exitosos al sistema. Comprueba su funcionamiento.Para activar la auditoría de los intentos de acceso no exitosos en Oracle, lo primero que haremos será comprobar si la auditoría está habilitada con el siguiente comando:SELECT name, value FROM v$parameter WHERE name LIKE 'audit_trail';Si la salida muestra:significa que la auditoría está activada a nivel de base de datos (DB). Si estuviera desactivada (NONE), tendríamos que activarla con:ALTER SYSTEM SET audit_trail=DB SCOPE=SPFILE;O si por el contrario queremos desactivarla por alguna razón, sería de la siguiente forma:ALTER SYSTEM SET audit_trail=NONE SCOPE=SPFILE;Para que la modificación sea efectiva, debemos reiniciar la base de datos:SHUTDOWN IMMEDIATE;STARTUP;Una vez comprobado que tenemos activada la funcionalidad de auditorías, activamos la auditoría de intentos de acceso fallidos con:AUDIT SESSION WHENEVER NOT SUCCESSFUL;Esto registrará en los logs de auditoría todos los intentos fallidos de inicio de sesión en la base de datos.Para comprobar su funcionamiento, intentaré conectarme con credenciales incorrectas desde SQL*Plus:Después, verificamos los registros de auditoría con:SELECT username, action_name, returncode FROM dba_audit_trail WHERE action_name = 'LOGON' ORDER BY timestamp DESC;Como vemos la salida indica que hubo un intento fallido de inicio de sesión (LOGON) con el usuario USUARIO_NO_EXISTE. El código de error 1017 significa “nombre de usuario o contraseña no válidos”.También podemos consultar los intentos de acceso fallidos utilizando la vista DBA_AUDIT_SESSION, que nos proporciona información detallada sobre las sesiones auditadas.Si ejecutamos el siguiente comando:SELECT OS_USERNAME, USERNAME, EXTENDED_TIMESTAMP, ACTION_NAME FROM DBA_AUDIT_SESSION;obtendremos datos como el usuario del sistema operativo (OS_USERNAME), el usuario de la base de datos que intentó iniciar sesión (USERNAME), la marca de tiempo exacta del intento (EXTENDED_TIMESTAMP) y la acción realizada (ACTION_NAME).Esta es la salida de ejemplo:2. Realiza un procedimiento en PL/SQL que te muestre los accesos fallidos junto con el motivo de los mismos, transformando el código de error almacenado en un mensaje de texto comprensible. Contempla todos los motivos posibles para que un acceso sea fallido.Lo primero que deberíamos hacer es activar la auditoría de intentos de acceso fallidos, pero como en el ejercicio anterior ya lo hicimos, no es necesario.Para realizar las comprobaciones, voy a provocar distintos accesos fallidos al sistema con usuarios y contraseñas que no existen:También, probaré con un usuario que sí existe pero no concuerda la contraseña:He creado una función llamada obtener_motivo_error, que recibe un código de error y devuelve un mensaje explicativo. He utilizado una estructura CASE para mostrar una descripción clara a cada código de error posible.CREATE OR REPLACE FUNCTION obtener_motivo_error (codigo_error NUMBER) RETURN VARCHAR2IS    mensaje_error VARCHAR2(150);BEGIN    CASE codigo_error        WHEN 911 THEN mensaje_error := 'El intento contiene caracteres no permitidos.';        WHEN 1004 THEN mensaje_error := 'Acceso denegado.';        WHEN 1017 THEN mensaje_error := 'Credenciales incorrectas.';        WHEN 1033 THEN mensaje_error := 'El usuario no está registrado en la base de datos.';        WHEN 1045 THEN mensaje_error := 'Falta el permiso CREATE SESSION.';        WHEN 28000 THEN mensaje_error := 'Cuenta bloqueada por intentos fallidos.';        WHEN 28001 THEN mensaje_error := 'La contraseña ha caducado, debe actualizarse.';        WHEN 28002 THEN mensaje_error := 'Advertencia: la contraseña está próxima a caducar.';        WHEN 28003 THEN mensaje_error := 'La contraseña no cumple los requisitos de seguridad.';        WHEN 28007 THEN mensaje_error := 'Intento de reutilización de contraseña detectado.';        WHEN 28008 THEN mensaje_error := 'Contraseña anterior incorrecta.';        WHEN 28009 THEN mensaje_error := 'Conexión a SYS requiere privilegios SYSDBA o SYSOPER.';        WHEN 28011 THEN mensaje_error := 'Cuenta a punto de expirar, se recomienda cambiar la contraseña.';        WHEN 28511 THEN mensaje_error := 'Contraseña caducada, inicie sesión para restablecerla.';        WHEN 28512 THEN mensaje_error := 'Cuenta bloqueada, contacte con el administrador.';        ELSE mensaje_error := 'Error desconocido, contacte con soporte técnico.';    END CASE;    RETURN mensaje_error;END obtener_motivo_error;/Luego, he definido el procedimiento listar_accesos_fallidos, donde abro un cursor que selecciona los intentos de acceso fallidos desde dba_audit_session.CREATE OR REPLACE PROCEDURE listar_accesos_fallidosIS    CURSOR cursor_accesos IS        SELECT os_username, username, returncode, timestamp        FROM dba_audit_session        WHERE action_name = 'LOGON'        AND returncode &lt;&gt; 0        ORDER BY timestamp;    motivo VARCHAR2(150);BEGIN    dbms_output.put_line('Lista de intentos de acceso fallidos:');    FOR intento IN cursor_accesos LOOP        motivo := obtener_motivo_error(intento.returncode);        dbms_output.put_line('------------------------------------------------------------------------------------------------');        dbms_output.put_line('Usuario SO: ' || intento.os_username || ' | Usuario BD: ' || intento.username || ' | Fecha: ' || TO_CHAR(intento.timestamp, 'YYYY/MM/DD HH24:MI') || ' | Motivo: ' || motivo);    END LOOP;END listar_accesos_fallidos;/Hacemos la comprobación y vemos que funciona correctamente:3. Activa la auditoría de las operaciones DML realizadas por el usuario Prueba en tablas de su esquema. Comprueba su funcionamiento.Primero, creamos el usuario PRUEBA y le asignamos una contraseña:SQL&gt; CREATE USER PRUEBA IDENTIFIED BY password;Usuario creado.Luego, le otorgamos los permisos necesarios para conectarse y gestionar sus propias tablas:SQL&gt; GRANT CONNECT, RESOURCE TO PRUEBA;Concesión terminada correctamente.SQL&gt; ALTER USER PRUEBA QUOTA UNLIMITED ON USERS;Usuario modificado.A continuación, creamos una tabla de prueba dentro del esquema PRUEBA e insertamos algunos datos:SQL&gt; CREATE TABLE PRUEBA.CLIENTES (  2      ID NUMBER PRIMARY KEY,  3      NOMBRE VARCHAR2(100),  4      EMAIL VARCHAR2(100),  5      FECHA_REGISTRO DATE DEFAULT SYSDATE  6  );Tabla creada.SQL&gt; INSERT INTO PRUEBA.CLIENTES (ID, NOMBRE, EMAIL) VALUES (1, 'Chema García', 'chema@example.com');INSERT INTO PRUEBA.CLIENTES (ID, NOMBRE, EMAIL) VALUES (2, 'Jesús Martín', 'jesús@example.com');INSERT INTO PRUEBA.CLIENTES (ID, NOMBRE, EMAIL) VALUES (3, 'Roberto Carlos', 'roberto@example.com');1 fila creada.SQL&gt; 1 fila creada.SQL&gt; 1 fila creada.Para auditar todas las operaciones DML (INSERT, UPDATE y DELETE) realizadas por el usuario PRUEBA, ejecutamos:AUDIT INSERT TABLE, UPDATE TABLE, DELETE TABLE BY PRUEBA BY ACCESS;Con esto, cada vez que PRUEBA realice una de estas operaciones, se registrará en la tabla de auditoría.Para verificar si la auditoría está funcionando, nos conectamos con el usuario PRUEBA y realizamos algunas modificaciones en la tabla:Ahora, consultamos la tabla de auditoría específica de objetos para ver los registros de las operaciones DML realizadas por el usuario PRUEBA en sus tablas:SELECT obj_name, action_name, extended_timestamp FROM dba_audit_object WHERE username = 'PRUEBA'ORDER BY extended_timestamp DESC;Con esta consulta, obtenemos un listado detallado de las tablas modificadas, el tipo de acción ejecutada (INSERT, UPDATE, DELETE) y la fecha y hora exacta en que se realizaron.De este modo, verificamos que la auditoría de operaciones DML en el esquema de PRUEBA está funcionando correctamente.4. Realiza una auditoría de grano fino para almacenar información sobre la inserción de empleados con comisión en la tabla emp de scott.Para realizar una auditoría de grano fino que registre las inserciones de empleados con comisión en la tabla EMP del usuario SCOTT, utilizamos el paquete DBMS_FGA. En este caso, en lugar de auditar por el salario, configuramos la auditoría para que registre cualquier inserción en la tabla EMP donde la columna COMM (comisión) no sea nula.El siguiente bloque PL/SQL crea la política de auditoría:BEGIN  DBMS_FGA.ADD_POLICY (    object_schema   =&gt; 'SCOTT',    object_name     =&gt; 'EMP',    policy_name     =&gt; 'comm_audit',    audit_condition =&gt; 'COMM IS NOT NULL',    statement_types =&gt; 'INSERT'  );END;/Este código define una política llamada comm_audit, que auditará todas las inserciones (INSERT) en la tabla EMP cuando la columna COMM tenga un valor distinto de NULL.Ahora nos conectamos con el usuario SCOTT y probamos la auditoría insertando un empleado con comisión (debería ser auditado) y un empleado sin comisión (no debería ser auditado):SQL&gt; INSERT INTO EMP VALUES (1600, 'Carlos', 'SALESMAN', 7698, TO_DATE('2025-02-25', 'YYYY-MM-DD'), 1800, 300, 30);1 fila creada.SQL&gt; INSERT INTO EMP VALUES (1601, 'Ana', 'CLERK', 7782, TO_DATE('2025-02-25', 'YYYY-MM-DD'), 1200, NULL, 20);1 fila creada.Luego, consultamos la auditoría:SELECT db_user, object_name, object_schema, sql_text, timestamp FROM dba_fga_audit_trail WHERE policy_name = 'COMM_AUDIT' ORDER BY timestamp;Y como podemos ver, solo se ha registrado la primera inserción, pues es la que sí tiene comisión.5. Explica la diferencia entre auditar una operación by access o by session ilustrándolo con ejemplos.Al auditar una operación by access, lo que estamos registrando es cada acceso que se hace a un objeto de la base de datos, sin importar si la sesión del usuario ha terminado o no. Esto significa que se genera un registro para cada acción que se realice, como SELECT, INSERT, UPDATE o DELETE. Por ejemplo, si configuramos la auditoría para el usuario SCOTT con el siguiente comando:SQL&gt; AUDIT INSERT TABLE, UPDATE TABLE, DELETE TABLE BY SCOTT BY ACCESS;Auditoria terminada correctamente.Este comando registrará cada operación de INSERT, UPDATE y DELETE realizada por SCOTT sobre las tablas de la base de datos. Si SCOTT realiza las siguientes operaciones en una sesión:INSERT:SQL&gt; INSERT INTO emp VALUES (1234, 'Juan', 'MANAGER', 7839, to_date('2024-02-25', 'YYYY-MM-DD'), 3000, null, 20);1 fila creada.DELETE:SQL&gt; DELETE FROM emp WHERE empno = 1234;1 fila suprimida.UPDATE:SQL&gt; UPDATE emp SET sal = 4500 WHERE empno = 7654;1 fila actualizada.Al consultar la tabla de auditoría con el siguiente comando:SELECT username, owner, obj_name, action, action_name, timestampFROM dba_audit_trailWHERE username = 'SCOTT'ORDER BY extended_timestamp DESCFETCH FIRST 3 ROWS only;Se generarán tres registros, uno por cada operación, con los siguientes datos:Cada operación (INSERT, UPDATE, DELETE) se registra por separado con un timestamp detallado.Por otro lado, cuando auditamos by session, se genera un solo registro por sesión del usuario. Aunque dentro de esa sesión el usuario ejecute múltiples operaciones, solo se registrará una entrada para toda la sesión. Este forma es menos detallado, ya que no se registra cada operación individual, sino que se crea un único registro que agrupa todas las operaciones realizadas durante esa sesión.Si configuramos la auditoría by session con el siguiente comando:SQL&gt; AUDIT INSERT TABLE, UPDATE TABLE, DELETE TABLE BY SCOTT BY SESSION;Auditoria terminada correctamente.Este comando registrará solo una entrada por sesión del usuario SCOTT, sin importar cuántas operaciones realice en esa sesión. Si SCOTT ejecuta las siguientes operaciones dentro de una misma sesión:INSERT:SQL&gt; INSERT INTO emp VALUES (7777, 'Torrente', 'MANAGER', 7839, to_date('2025-02-25', 'YYYY-MM-DD'), 3000, null, 20);1 fila creada.DELETE:SQL&gt; DELETE FROM emp WHERE empno = 7777;1 fila suprimida.UPDATE:SQL&gt; UPDATE emp SET sal = 4500 WHERE empno = 7654;1 fila actualizada.Al consultar la tabla de auditoría para la sesión de SCOTT, se generará solo un registro de auditoría que reflejará que se inició una sesión y se realizaron operaciones, pero no se detallarán de manera individual. Lo vemos a continuación:SELECT USERNAME,ACTION_NAME,TIMESTAMP, obj_name FROM DBA_AUDIT_OBJECT WHERE USERNAME='SCOTT';Esto indica que SCOTT inició una sesión y realizó varias operaciones, pero no las desglosa. El número de ACTION puede variar, pero se registrará solo una vez por sesión.6. Documenta las diferencias entre los valores db y db, extended del parámetro audit_trail de ORACLE. Demuéstralas poniendo un ejemplo de la información sobre una operación concreta recopilada con cada uno de ellos.En Oracle, el parámetro audit_trail controla la configuración de la auditoría. Existen dos valores principales para este parámetro: db y db, extended, que se diferencian en el nivel de detalle que almacenan durante el proceso de auditoría.      db: Este valor permite auditar las operaciones en la base de datos, pero sin almacenar información detallada sobre los bind variables y el SQL ejecutado. Solo se guarda la información básica de la operación, como el nombre de la tabla, la acción realizada y la hora del evento.        db, extended: Este valor, en cambio, almacena un nivel de auditoría mucho más detallado. No solo guarda la información básica de la operación, sino que también captura el SQL ejecutado (el código SQL original) y las bind variables que fueron utilizadas en la operación. Esto proporciona un nivel de detalle mucho mayor, lo que es útil para auditar con precisión las acciones realizadas.  dbPara ver el valor por defecto de audit_trail, deberemos ejecutar la siguiente consulta:SHOW PARAMETER audit_trail;Como podemos ver, el valor por defecto es “DB”. Si el valor de audit_trail es db, entonces solo se almacenará la información básica de las operaciones.Podemos consultar la información que hemos recopilado a través de la auditoría de la base de datos utilizando la consulta correspondiente del ejercicio 3.SELECT obj_name, action_name, extended_timestamp FROM dba_audit_object WHERE username = 'PRUEBA'ORDER BY extended_timestamp DESC;Podemos ver que todos estos datos están almacenados mediante auditoría db.db, extendedPara cambiar el parámetro a db, extended y habilitar la auditoría extendida, usamos el siguiente comando:ALTER SYSTEM SET audit_trail = DB,EXTENDED SCOPE=SPFILE;Luego, debemos reiniciar la base de datos para que los cambios tengan efecto:SHUTDOWN IMMEDIATE;STARTUP;SHOW PARAMETER audit_trail;Para ver cómo se registran las operaciones con la auditoría db, extended, realizaremos algunas acciones sobre una tabla. En este caso, creamos una tabla de prueba y ejecutamos varias operaciones sobre ella (insertar, actualizar y eliminar). Los comandos son los siguientes:CONNECT scott/tiger;CREATE TABLE EMPLOYEES (    EMP_ID NUMBER(10) NOT NULL,    EMP_NAME VARCHAR2(50) NOT NULL,    EMP_SALARY NUMBER(8, 2) NOT NULL,    PRIMARY KEY (EMP_ID));INSERT INTO EMPLOYEES VALUES (101, 'Alice', 5000);UPDATE EMPLOYEES SET EMP_SALARY = 5500 WHERE EMP_ID = 101;DELETE FROM EMPLOYEES WHERE EMP_ID = 101;Para ver los registros con el nivel extendido de auditoría, ejecutamos la siguiente consulta:SELECT USERNAME, ACTION_NAME, TIMESTAMP, OBJ_NAME, SQL_TEXT, SQL_BINDFROM DBA_AUDIT_OBJECTWHERE USERNAME = 'SCOTT'ORDER BY TIMESTAMP DESC;Con la auditoría db, extended activada, veremos que la salida no solo incluirá la información básica (como el nombre de la tabla, la acción realizada y el timestamp), sino también:  SQL_TEXT: El SQL que fue ejecutado. Esto incluye las instrucciones SQL completas.  SQL_BIND: Las bind variables utilizadas en la operación, lo cual nos da información detallada sobre los valores reales procesados por la base de datos.Esta es la salida que recibimos de la auditoría:7. Averigua si en Postgres se pueden realizar los cuatro primeros apartados. Si es así, documenta el proceso adecuadamente.Para auditar eventos en PostgreSQL, existen diversas herramientas, entre ellas pgAudit y Audit Trigger. En este caso, utilizaremos Audit Trigger, que permite registrar cambios en las tablas de la base de datos de forma sencilla.He decidido instalar esta funcionalidad en la base de datos postgres, aunque podría implementarse en cualquier otra base de datos dentro del servidor.El proceso de instalación es bastante simple. En primer lugar, descargamos el archivo SQL necesario desde el repositorio oficial con el siguiente comando:wget https://raw.githubusercontent.com/2ndQuadrant/audit-trigger/master/audit.sqlUna vez descargado, accedemos al servidor PostgreSQL con el usuario postgres y ejecutamos el script SQL para instalar la extensión:sudo -u postgres psql\\i audit.sqlLa salida indica que el script audit.sql ha creado la extensión, el esquema y varias estructuras necesarias para la auditoría, como tablas, índices, funciones y vistas. Además, se han aplicado restricciones de permisos (REVOKE) y comentarios (COMMENT) para documentar los elementos creados.Ejercicio 1: Auditoría de accesos fallidosPara realizar una auditoría que registre los intentos de acceso fallidos en PostgreSQL, tendremos que configurar el sistema de logs de la base de datos para que almacene este tipo de eventos. PostgreSQL nos da varios parámetros que controlan la generación de registros relacionados con las conexiones y la autenticación.El primer paso es habilitar el registro de conexiones en el sistema. Para ello, desde la consola de PostgreSQL, ejecutamos el siguiente comando:postgres=# ALTER SYSTEM SET log_connections = 'ON';ALTER SYSTEMEsto permite que PostgreSQL registre cada intento de conexión al servidor, lo que incluye tanto los accesos exitosos como los fallidos.Tras aplicar estos cambios, reiniciamos el servicio de PostgreSQL para que la configuración tenga efecto:pablo@servidor-postgre1:~$ sudo systemctl restart postgresqlUna vez reiniciado, los eventos de autenticación se almacenarán en el archivo de logs de PostgreSQL:tail -f /var/log/postgresql/postgresql-15-main.logA continuación, se muestra un ejemplo de un intento de conexión fallido debido a una autenticación incorrecta:Aquí, el mensaje “FATAL: la autentificación password falló para el usuario «pablomh»” nos dice que hubo un intento de conexión fallido debido a una contraseña incorrecta. Además, la línea “DETALLE: La conexión coincidió con la línea 98 de pg_hba.conf” dice que la autenticación se realizó según la configuración establecida en el archivo pg_hba.conf, donde se especifica el método de autenticación md5.Ejercicio 2: Accesos fallidos junto al motivoPues al igual que en el ejercicio anterior, podemos revisar los logs y este nos dirá el motivo del acceso fallido. Aquí un ejemplo:Ejercicio 3: Operaciones DMLPara llevar a cabo la auditoría de DML, utilizaremos la extensión Audit Trigger. Para ello, primero crearemos una tabla en la base de datos de Postgres. Luego, procederemos a insertar, actualizar y eliminar datos dentro de la base de datos SCOTT.postgres=# INSERT INTO DEPT VALUES (100, 'VENTAS', 'SEVILLA');INSERT INTO DEPT VALUES (110, 'COMPRAS', 'CADIZ');INSERT INTO DEPT VALUES (120, 'CONTABILIDAD', 'GRANADA');INSERT INTO DEPT VALUES (130, 'VENTAS', 'HUELVA');    DELETE FROM DEPT WHERE DEPTNO = 100;DELETE FROM DEPT WHERE DEPTNO = 110;DELETE FROM DEPT WHERE DEPTNO = 120;DELETE FROM DEPT WHERE DEPTNO = 130;UPDATE DEPT SET LOC = 'SEVILLA' WHERE DEPTNO = 10;UPDATE DEPT SET LOC = 'CADIZ' WHERE DEPTNO = 20;UPDATE DEPT SET LOC = 'GRANADA' WHERE DEPTNO = 30;UPDATE DEPT SET LOC = 'HUELVA' WHERE DEPTNO = 40;INSERT 0 1INSERT 0 1INSERT 0 1INSERT 0 1DELETE 1DELETE 1DELETE 1DELETE 1UPDATE 1UPDATE 1UPDATE 1UPDATE 1Una vez que hayamos realizado las operaciones de inserción, actualización y eliminación, procederemos a verificar la extensión Audit Trigger para asegurarnos de que la auditoría se ha ejecutado correctamente. Esto nos permitirá confirmar que las acciones realizadas sobre la base de datos han sido registradas adecuadamente, lo cual es fundamental para revisar el historial de cambios y asegurar la integridad de las operaciones realizadas.SELECT audit.audit_table('DEPT');Para poder ver los datos de la auditoría, primero nos conectaremos a la base de datos como el usuario postgres. Una vez dentro de la base de datos que estamos auditando, ejecutaremos la consulta correspondiente para visualizar los registros generados por la extensión Audit Trigger. Esto nos permitirá revisar las auditorías de las operaciones DML (inserciones, actualizaciones y eliminaciones) realizadas.La consulta que debemos ejecutar:SELECT session_user_name, action, table_name, action_tstamp_clk, client_query FROM audit.logged_actions;Como se puede apreciar en la imagen, la información registrada por la auditoría incluye varios detalles clave. Entre ellos, podemos observar el nombre del usuario que ejecutó la acción, el tipo de operación realizada (ya sea un Insert, Update o Delete), la tabla sobre la cual se ejecutó la acción, así como la fecha y la hora exacta en la que se llevó a cabo la operación. Además, también se muestra la consulta SQL que fue ejecutada para realizar la acción, lo que proporciona una trazabilidad completa de las operaciones realizadas en la base de datos.Ejercicio 4: Auditoría grano finoLo primero que necesitamos hacer es crear una tabla para almacenar la información sobre las inserciones que queremos auditar. En esta tabla vamos a registrar el usuario que realizó la inserción, el nombre de la tabla afectada, el esquema de la tabla, la operación realizada y la fecha y hora de la operación. Para esto, usamos el siguiente comando:CREATE TABLE public.audit_emp_commission (    id SERIAL PRIMARY KEY,    db_user VARCHAR(50),    object_name VARCHAR(50),    object_schema VARCHAR(50),    operation VARCHAR(10),    timestamp TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP);Con esta tabla creamos el esquema básico para registrar las operaciones que vamos a auditar, en este caso, las inserciones de empleados con comisión.Luego, necesitamos crear una función que se activará cuando se inserte un registro en la tabla emp. La función verificará si el campo comm (comisión) del nuevo registro es diferente de NULL. Si tiene comisión, insertará un registro en la tabla de auditoría con la información relevante.La función se escribe así:CREATE OR REPLACE FUNCTION public.audit_emp_commission()RETURNS TRIGGER AS $$BEGIN    IF NEW.comm IS NOT NULL THEN        INSERT INTO public.audit_emp_commission (            db_user,            object_name,            object_schema,            operation        ) VALUES (            CURRENT_USER,            TG_TABLE_NAME,            TG_TABLE_SCHEMA,            TG_OP        );    END IF;    RETURN NEW;END;$$ LANGUAGE plpgsql;En esta función, el IF NEW.comm IS NOT NULL nos asegura que solo se registre la operación si el campo comm (comisión) no es nulo, es decir, si el empleado tiene una comisión.Con la función lista, necesitamos crear un trigger que se active después de cada inserción en la tabla emp. El trigger llamará a la función de auditoría para registrar la operación en la tabla de auditoría cuando se inserte un empleado con una comisión.CREATE OR REPLACE TRIGGER emp_commission_audit_triggerAFTER INSERT ON public.empFOR EACH ROWEXECUTE FUNCTION public.audit_emp_commission();Este trigger se ejecutará después de cada inserción en la tabla emp, y si la inserción es de un empleado con una comisión, la función de auditoría insertará un registro en la tabla audit_emp_commission.Ahora, podemos probar que todo funciona correctamente. Vamos a insertar un nuevo empleado en la tabla emp que tenga una comisión. Por ejemplo:INSERT INTO public.emp (empno, ename, job, mgr, hiredate, sal, comm, deptno)VALUES (1001, 'Juan', 'CLERK', 7839, '2025-02-25', 1800, 300, 30);Finalmente, para ver si la auditoría se ha realizado correctamente, podemos consultar la tabla de auditoría. Ejecutamos la siguiente consulta:SELECT * FROM public.audit_emp_commission;Con esto, hemos configurado la auditoría para registrar todas las inserciones de empleados con comisión en la tabla emp del esquema scott. Cada vez que se inserte un nuevo empleado con comisión, se registrará una entrada en la tabla de auditoría.8. Averigua si en MySQL se pueden realizar los apartados 1, 3 y 4. Si es así, documenta el proceso adecuadamente.Para llevar a cabo una auditoría en MySQL, necesitaremos crear dos bases de datos. La auditoría se realizará utilizando el plugin server_audit, el cual nos permite registrar y monitorear las acciones que se ejecutan en el servidor de MySQL.Para instalar este plugin, debemos ejecutar el comando INSTALL SONAME 'server_audit'; mientras estamos conectados al servidor de bases de datos.Ejercicio 1: Auditoría de accesos fallidosUna vez instalado el plugin, será necesario modificar el archivo de configuración de MySQL. Este archivo se encuentra en la ruta /etc/mysql/mariadb.conf.d/50-server.cnf. En él, deberemos realizar las configuraciones necesarias para habilitar y personalizar el comportamiento del plugin de auditoría, asegurándonos de que las acciones de auditoría sean registradas adecuadamente según nuestras necesidades.Ahora voy a crear un directorio para almacenar logs, asignar los permisos necesarios para que el servidor de bases de datos pueda escribir en ese directorio y, por último, reiniciar el servicio de MariaDB para que los cambios tengan efecto.pablo@servidor-mariadb:~$ sudo mkdir /var/log/mysql/pablo@servidor-mariadb:~$ sudo chown mysql: /var/log/mysql/pablo@servidor-mariadb:~$ sudo systemctl restart mariadb.serviceDespués de reiniciar el servicio, verificaremos que la auditoría esté funcionando correctamente. Para esto, realizaremos intentos de acceso fallidos y exitosos, y así comprobar que se registre todo adecuadamente.Ejercicio 3: Operaciones DMLEste este ejercicio hay que modificar el archivo de configuración de MySQL/MariaDB, que se encuentra en la ruta /etc/mysql/mariadb.conf.d/50-server.cnf. Una vez dentro tendremos que añadir las siguientes líneas:server_audit_events=CONNECT,QUERY,TABLEserver_audit_logging=ONserver_audit_incl_users=scottserver_audit_file_path=/var/log/mysql/audit.logDespués de modificar el fichero de configuración, tendremos que reiniciar el servicio:pablo@servidor-mariadb:~$ sudo systemctl restart mariadb.servicePara las pruebas utilizaré las tablas del esquema scott.Por lo que accedemos con el usuario scott que es el que contiene las tablas, y realizamos alguna operación para que se registren:INSERT INTO scott.emp VALUES(7777, 'JACINTO', 'CAUDILLO', 7902, '2025-02-26', 999, NULL, 10);UPDATE scott.emp SET sal = 1509 WHERE empno = 7777;DELETE FROM scott.emp WHERE empno = 7777;Una vez realizadas las operaciones, nos salimos y miramos el log:Donde podemos observar que se han registrado correctamente.Ejercicio 4: Auditoría grano finoPara la auditoría que registre la inserción de empleados con comisión en la tabla emp de la base de datos scott, tendremos que crear una tabla de auditoría. Esta tabla almacenará información clave como el identificador del empleado, su nombre, el monto de la comisión, el momento en que se realizó la inserción y el tipo de acción registrada.La estructura de la tabla de auditoría se define de la siguiente manera:CREATE TABLE scott.emp_auditoria (    audit_id INT AUTO_INCREMENT PRIMARY KEY,    empno INT,    ename VARCHAR(10),    comm DECIMAL(7,2),    action_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    action_type VARCHAR(10));Una vez creada la tabla, el siguiente paso es configurar un trigger que se active cada vez que se realice una inserción en la tabla emp. Este trigger verificará si el campo comm tiene un valor distinto de NULL, lo que indicaría que el empleado recibe una comisión. En caso afirmativo, se insertará un nuevo registro en emp_auditoria con los datos correspondientes.El trigger se define de la siguiente forma:DELIMITER $$CREATE TRIGGER audit_emp_insercionAFTER INSERT ON scott.empFOR EACH ROWBEGIN    IF NEW.comm IS NOT NULL THEN        INSERT INTO scott.emp_auditoria (empno, ename, comm, action_type)        VALUES (NEW.empno, NEW.ename, NEW.comm, 'INSERT');    END IF;END $$DELIMITER ;Después de crear el trigger, es momento de comprobar su funcionamiento insertando algunos empleados en la tabla emp. Por ejemplo:INSERT INTO scott.emp VALUES (7904, 'ERWIN', 'SMITH', 7839, '1981-05-15', 3500, 600, 20);INSERT INTO scott.emp VALUES (7901, 'MIKASA', 'ACKERMAN', 7839, '1981-06-10', 3200, 450, 30);INSERT INTO scott.emp VALUES (7905, 'KIPSTA', 'ACKERMAN', 7839, '1981-07-20', 3300, 550, 40);Ahora, si consultamos la tabla emp_auditoria, deberíamos ver que los registros de los empleados con comisión han sido almacenados correctamente:SELECT * FROM scott.emp_auditoria;De este modo, se confirma que la auditoría funciona correctamente, registrando únicamente aquellos empleados que tienen una comisión asignada.9. Averigua las posibilidades que ofrece MongoDB para auditar los cambios que va sufriendo un documento. Demuestra su funcionamiento.Para auditar los cambios que sufren los documentos en MongoDB, necesitaremos la versión Enterprise, ya que solo esta edición permite habilitar la auditoría de eventos. Para la instalación de esta versión he seguido la página oficial:Una vez tengamos esta versión instalada, podemos configurar MongoDB para registrar todas las operaciones que se realicen sobre la base de datos. Aquí la comprobación de que realmente tenemos instalado la versión Enterprise:vagrant@mongo:~$ mongod --versiondb version v8.0.5Build Info: {    \"version\": \"8.0.5\",    \"gitVersion\": \"cb9e2e5e552ee39dea1e39d7859336456d0c9820\",    \"openSSLVersion\": \"OpenSSL 3.0.15 3 Sep 2024\",    \"modules\": [        \"enterprise\"    ],    \"allocator\": \"tcmalloc-google\",    \"environment\": {        \"distmod\": \"debian12\",        \"distarch\": \"x86_64\",        \"target_arch\": \"x86_64\"    }}MongoDB nos ofrece cuatro formas de almacenar los registros de auditoría: podemos enviarlos directamente a la consola, redirigirlos al syslog, guardarlos en un archivo en formato JSON o BSON, o configurar la auditoría a través del archivo de configuración de MongoDB.Si queremos ver los registros en la consola mientras ejecutamos MongoDB, podemos iniciar el servicio con:mongod --dbpath data/db --auditDestination consoleSi preferimos que los eventos queden almacenados en el syslog, usamos:mongod --dbpath data/db --auditDestination syslogEn caso de querer registrar los eventos en un archivo JSON o BSON, podemos utilizar las siguientes opciones:mongod --dbpath data/db --auditDestination file --auditFormat JSON --auditPath data/db/auditLog.jsonmongod --dbpath data/db --auditDestination file --auditFormat BSON --auditPath data/db/auditLog.bsonTambién podemos configurar la auditoría desde el archivo de configuración de MongoDB (/etc/mongod.conf). En nuestro caso, optaremos por almacenar los registros en un archivo JSON para facilitar su lectura y análisis. Para ello, editamos el archivo de configuración:nano /etc/mongod.confY añadimos la siguiente configuración:auditLog:  destination: file  format: JSON  path: /var/log/mongodb/auditLog.jsonCon esto, MongoDB registrará información detallada sobre los cambios que se realicen en los documentos. Para aplicar los cambios, reiniciamos el servicio:sudo systemctl restart mongodAntes de comenzar a trabajar con los registros de auditoría, instalaremos jq, una herramienta que nos ayudará a visualizar los archivos JSON desde la terminal:sudo apt install jq -yCreación de una colección y prueba de auditoríaPrimero, vamos a crear una colección llamada “productos”, donde definiremos un esquema que validará ciertos campos para asegurar que se ingresen correctamente los datos. En este caso, vamos a exigir que cada producto tenga un código de producto, un nombre, una categoría, y un precio. Los datos deben cumplir con ciertas reglas de longitud para cada campo.db.createCollection(\"productos\", {    validator: {        $jsonSchema: {            bsonType: \"object\",            required: [\"codigo_producto\", \"nombre\", \"categoria\", \"precio\"],            properties: {                codigo_producto: { bsonType: \"string\", maxLength: 10 },                nombre: { bsonType: \"string\", maxLength: 100 },                categoria: { bsonType: \"string\", maxLength: 50 },                precio: { bsonType: \"double\" }            }        }    }})Cuando creamos la colección con éxito, esta configuración asegura que solo se puedan insertar documentos que tengan estos campos obligatorios y dentro de los límites establecidos.Insertar datos en la colecciónA continuación, insertamos varios productos en la colección productos. Para ello, vamos a insertar algunos documentos representando distintos productos disponibles en la tienda, con su código, nombre, categoría y precio.db.productos.insertMany([  { codigo_producto: \"A001\", nombre: \"Camiseta Roja\", categoria: \"Ropa\", precio: 19.99 },  { codigo_producto: \"B002\", nombre: \"Zapatos de Cuero\", categoria: \"Calzado\", precio: 49.99 },  { codigo_producto: \"C003\", nombre: \"Gafas de Sol\", categoria: \"Accesorios\", precio: 25.50 },  { codigo_producto: \"D004\", nombre: \"Chaqueta de Invierno\", categoria: \"Ropa\", precio: 89.99 }])Con estos documentos insertados, hemos registrado una pequeña parte de los productos disponibles en nuestra tienda.Realizar cambios en los documentosVamos a actualizar el precio de un producto, por ejemplo, de “Camiseta Roja” de 19.99 a 18.99.db.productos.updateOne(   { codigo_producto: \"A001\" },   { $set: { precio: 18.99 } })Eliminamos el producto con el código de producto “C003” (las gafas de sol):db.productos.deleteOne({ codigo_producto: \"C003\" })Crear un rol y un usuarioEn este caso, vamos a crear un rol de solo lectura para la colección productos, para que los usuarios con este rol solo puedan consultar los productos, pero no realizar modificaciones. A continuación, creamos un rol llamado “lectura_productos” y luego asignamos ese rol a un usuario llamado “juan”.Creamos el rol lectura_productos:db.createRole({    role: \"lectura_productos\",    privileges: [        {            resource: { db: \"productos\", collection: \"productos\" },            actions: [ \"find\" ]        }    ],    roles: []})Creamos el usuario pavlo con el rol lectura_productos:db.createUser({    user: \"pavlo\",    pwd: \"pavlo1234\",    roles: [\"lectura_productos\"]})Finalmente, una vez que tenemos los datos insertados, los cambios realizados, y el rol/usuario configurado, podemos empezar a revisar los registros de auditoría.Abrimos el archivo de auditoría en tiempo real usando jq para visualizar los eventos en formato JSON, lo cual nos permite filtrar y entender las operaciones más fácilmente:vagrant@mongo:~$ sudo tail -f /var/log/mongodb/auditLog.json | jq{  \"atype\": \"createIndex\",  \"ts\": {    \"$date\": \"2025-02-27T12:15:49.008+00:00\"  },  \"uuid\": {    \"$binary\": \"Gm0NSSdOSuKmDjXIQV/xrw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42096  },  \"users\": [],  \"roles\": [],  \"param\": {    \"ns\": \"admin.system.roles\",    \"indexName\": \"role_1_db_1\",    \"indexSpec\": {      \"v\": 2,      \"unique\": true,      \"key\": {        \"role\": 1,        \"db\": 1      },      \"name\": \"role_1_db_1\"    },    \"indexBuildState\": \"IndexBuildStarted\"  },  \"result\": 0}{  \"atype\": \"createIndex\",  \"ts\": {    \"$date\": \"2025-02-27T12:15:49.013+00:00\"  },  \"uuid\": {    \"$binary\": \"Gm0NSSdOSuKmDjXIQV/xrw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42096  },  \"users\": [],  \"roles\": [],  \"param\": {    \"ns\": \"admin.system.roles\",    \"indexName\": \"role_1_db_1\",    \"indexSpec\": {      \"v\": 2,      \"unique\": true,      \"key\": {        \"role\": 1,        \"db\": 1      },      \"name\": \"role_1_db_1\"    },    \"indexBuildState\": \"IndexBuildSucceeded\"  },  \"result\": 0}{  \"atype\": \"directAuthMutation\",  \"ts\": {    \"$date\": \"2025-02-27T12:15:49.013+00:00\"  },  \"uuid\": {    \"$binary\": \"Gm0NSSdOSuKmDjXIQV/xrw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42096  },  \"users\": [],  \"roles\": [],  \"param\": {    \"document\": {      \"_id\": \"admin.lectura_productos\",      \"role\": \"lectura_productos\",      \"db\": \"admin\",      \"privileges\": [        {          \"resource\": {            \"db\": \"productos\",            \"collection\": \"productos\"          },          \"actions\": [            \"find\"          ]        }      ],      \"roles\": []    },    \"ns\": \"admin.system.roles\",    \"operation\": \"insert\"  },  \"result\": 0}{  \"atype\": \"clientMetadata\",  \"ts\": {    \"$date\": \"2025-02-27T12:15:56.587+00:00\"  },  \"uuid\": {    \"$binary\": \"lANCxt3YT3O6RPm1/w9kWw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 33144  },  \"users\": [],  \"roles\": [],  \"param\": {    \"localEndpoint\": {      \"ip\": \"127.0.0.1\",      \"port\": 27017    },    \"clientMetadata\": {      \"application\": {        \"name\": \"mongosh 2.4.0\"      },      \"driver\": {        \"name\": \"nodejs|mongosh\",        \"version\": \"6.13.0|2.4.0\"      },      \"platform\": \"Node.js v20.18.3, LE\",      \"os\": {        \"name\": \"linux\",        \"architecture\": \"x64\",        \"version\": \"3.10.0-327.22.2.el7.x86_64\",        \"type\": \"Linux\"      }    }  },  \"result\": 0}{  \"atype\": \"createUser\",  \"ts\": {    \"$date\": \"2025-02-27T12:16:46.226+00:00\"  },  \"uuid\": {    \"$binary\": \"Gm0NSSdOSuKmDjXIQV/xrw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42096  },  \"users\": [],  \"roles\": [],  \"param\": {    \"user\": \"pavlo\",    \"db\": \"admin\",    \"roles\": [      {        \"role\": \"lectura_productos\",        \"db\": \"admin\"      }    ]  },  \"result\": 0}{  \"atype\": \"createCollection\",  \"ts\": {    \"$date\": \"2025-02-27T12:16:46.226+00:00\"  },  \"uuid\": {    \"$binary\": \"Gm0NSSdOSuKmDjXIQV/xrw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42096  },  \"users\": [],  \"roles\": [],  \"param\": {    \"ns\": \"admin.system.users\"  },  \"result\": 0}{  \"atype\": \"createIndex\",  \"ts\": {    \"$date\": \"2025-02-27T12:16:46.241+00:00\"  },  \"uuid\": {    \"$binary\": \"Gm0NSSdOSuKmDjXIQV/xrw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42096  },  \"users\": [],  \"roles\": [],  \"param\": {    \"ns\": \"admin.system.users\",    \"indexName\": \"_id_\",    \"indexSpec\": {      \"v\": 2,      \"key\": {        \"_id\": 1      },      \"name\": \"_id_\"    },    \"indexBuildState\": \"IndexBuildStarted\"  },  \"result\": 0}{  \"atype\": \"createIndex\",  \"ts\": {    \"$date\": \"2025-02-27T12:16:46.246+00:00\"  },  \"uuid\": {    \"$binary\": \"Gm0NSSdOSuKmDjXIQV/xrw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42096  },  \"users\": [],  \"roles\": [],  \"param\": {    \"ns\": \"admin.system.users\",    \"indexName\": \"_id_\",    \"indexSpec\": {      \"v\": 2,      \"key\": {        \"_id\": 1      },      \"name\": \"_id_\"    },    \"indexBuildState\": \"IndexBuildSucceeded\"  },  \"result\": 0}{  \"atype\": \"createIndex\",  \"ts\": {    \"$date\": \"2025-02-27T12:16:46.246+00:00\"  },  \"uuid\": {    \"$binary\": \"Gm0NSSdOSuKmDjXIQV/xrw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42096  },  \"users\": [],  \"roles\": [],  \"param\": {    \"ns\": \"admin.system.users\",    \"indexName\": \"user_1_db_1\",    \"indexSpec\": {      \"v\": 2,      \"unique\": true,      \"key\": {        \"user\": 1,        \"db\": 1      },      \"name\": \"user_1_db_1\"    },    \"indexBuildState\": \"IndexBuildStarted\"  },  \"result\": 0}{  \"atype\": \"createIndex\",  \"ts\": {    \"$date\": \"2025-02-27T12:16:46.251+00:00\"  },  \"uuid\": {    \"$binary\": \"Gm0NSSdOSuKmDjXIQV/xrw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42096  },  \"users\": [],  \"roles\": [],  \"param\": {    \"ns\": \"admin.system.users\",    \"indexName\": \"user_1_db_1\",    \"indexSpec\": {      \"v\": 2,      \"unique\": true,      \"key\": {        \"user\": 1,        \"db\": 1      },      \"name\": \"user_1_db_1\"    },    \"indexBuildState\": \"IndexBuildSucceeded\"  },  \"result\": 0}10. Averigua si en MongoDB se pueden auditar los accesos a una colección concreta. Demuestra su funcionamiento.Para auditar los accesos a una colección específica en MongoDB Enterprise, debemos configurar el sistema de auditoría en el archivo de configuración de MongoDB, como se muestra a continuación. En este caso, vamos a auditar las operaciones realizadas sobre la colección llamada Productos dentro de la base de datos tienda.Primero, editamos el archivo de configuración de MongoDB, que usualmente se encuentra en /etc/mongod.conf. Utilizamos el siguiente comando para abrirlo:sudo nano /etc/mongod.confDentro del archivo de configuración, añadimos una sección de auditoría como esta:auditLog:   destination: file   format: JSON   path: /var/log/mongodb/auditLog_productos.json   filter: '{ atype: \"authCheck\", \"param.ns\": \"tienda.Productos\", \"param.command\": { $in: [\"insert\", \"update\", \"delete\", \"find\"] } }'setParameter: { auditAuthorizationSuccess: true }Este bloque configura MongoDB para registrar en un archivo los eventos de auditoría relacionados con las operaciones de insertar, actualizar, eliminar y consultar en la colección Productos dentro de la base de datos tienda. Asegúrate de guardar el archivo después de hacer los cambios.Una vez hecho esto, reiniciamos el servicio de MongoDB para que los cambios surtan efecto:sudo systemctl restart mongodAhora que la auditoría está configurada, vamos a realizar algunas operaciones en la colección Productos para asegurarnos de que se están registrando correctamente.      Insertamos un nuevo documento en la colección Productos:      db.Productos.insertOne({ codigo: \"P1001\", nombre: \"Silla\", precio: 25.50, stock: 100 })                Realizamos una actualización en un documento existente de la colección Productos:      db.Productos.updateOne(     { codigo: \"P1001\" },     { $set: { precio: 27.00 } }  )                Eliminamos un documento de la colección Productos:      db.Productos.deleteOne({ nombre: \"Mesa\" })          Ahora que hemos realizado estas operaciones, podemos revisar el archivo de auditoría que se generó en /var/log/mongodb/auditLog_productos.json para ver los registros.vagrant@mongo:~$ sudo tail -f /var/log/mongodb/auditLog_productos.json | jq{  \"atype\": \"authCheck\",  \"ts\": {    \"$date\": \"2025-02-27T12:29:59.341+00:00\"  },  \"uuid\": {    \"$binary\": \"W1VU30OJQJ2iPH7H85PQjw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42944  },  \"users\": [],  \"roles\": [],  \"param\": {    \"command\": \"insert\",    \"ns\": \"tienda.Productos\",    \"args\": {      \"insert\": \"Productos\",      \"documents\": [        {          \"codigo\": \"P1001\",          \"nombre\": \"Silla\",          \"precio\": 25.5,          \"stock\": 100,          \"_id\": {            \"$oid\": \"67c05ac7de2c6140ff51e948\"          }        }      ],      \"ordered\": true,      \"lsid\": {        \"id\": {          \"$binary\": \"Eh4EwQUaQTuk/Jd94obwZQ==\",          \"$type\": \"04\"        }      },      \"$db\": \"tienda\"    }  },  \"result\": 0}{  \"atype\": \"authCheck\",  \"ts\": {    \"$date\": \"2025-02-27T12:30:06.444+00:00\"  },  \"uuid\": {    \"$binary\": \"W1VU30OJQJ2iPH7H85PQjw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42944  },  \"users\": [],  \"roles\": [],  \"param\": {    \"command\": \"update\",    \"ns\": \"tienda.Productos\",    \"args\": {      \"update\": \"Productos\",      \"updates\": [        {          \"q\": {            \"codigo\": \"P1001\"          },          \"u\": {            \"$set\": {              \"precio\": 27            }          }        }      ],      \"ordered\": true,      \"lsid\": {        \"id\": {          \"$binary\": \"Eh4EwQUaQTuk/Jd94obwZQ==\",          \"$type\": \"04\"        }      },      \"$db\": \"tienda\"    }  },  \"result\": 0}{  \"atype\": \"authCheck\",  \"ts\": {    \"$date\": \"2025-02-27T12:32:01.862+00:00\"  },  \"uuid\": {    \"$binary\": \"W1VU30OJQJ2iPH7H85PQjw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42944  },  \"users\": [],  \"roles\": [],  \"param\": {    \"command\": \"update\",    \"ns\": \"tienda.Productos\",    \"args\": {      \"update\": \"Productos\",      \"updates\": [        {          \"q\": {            \"codigo\": \"P1001\"          },          \"u\": {            \"$set\": {              \"precio\": 27            }          }        }      ],      \"ordered\": true,      \"lsid\": {        \"id\": {          \"$binary\": \"Eh4EwQUaQTuk/Jd94obwZQ==\",          \"$type\": \"04\"        }      },      \"$db\": \"tienda\"    }  },  \"result\": 0}{  \"atype\": \"authCheck\",  \"ts\": {    \"$date\": \"2025-02-27T12:32:59.347+00:00\"  },  \"uuid\": {    \"$binary\": \"W1VU30OJQJ2iPH7H85PQjw==\",    \"$type\": \"04\"  },  \"local\": {    \"ip\": \"127.0.0.1\",    \"port\": 27017  },  \"remote\": {    \"ip\": \"127.0.0.1\",    \"port\": 42944  },  \"users\": [],  \"roles\": [],  \"param\": {    \"command\": \"delete\",    \"ns\": \"tienda.Productos\",    \"args\": {      \"delete\": \"Productos\",      \"deletes\": [        {          \"q\": {            \"nombre\": \"Mesa\"          },          \"limit\": 1        }      ],      \"ordered\": true,      \"lsid\": {        \"id\": {          \"$binary\": \"Eh4EwQUaQTuk/Jd94obwZQ==\",          \"$type\": \"04\"        }      },      \"$db\": \"tienda\"    }  },  \"result\": 0}Estos registros muestran que las operaciones sobre la colección Productos están siendo correctamente auditadas, incluyendo detalles sobre el tipo de operación, el usuario que realizó la acción, la base de datos y colección afectadas, así como los parámetros y resultados de las operaciones.11. Averigua si en Cassandra se pueden auditar las inserciones de datos.En Cassandra, es posible realizar auditorías sobre las inserciones de datos, lo cual resulta útil para rastrear todas las solicitudes CQL (Cassandra Query Language) que se ejecutan, así como los intentos de autenticación en los nodos. Existen dos formas principales de implementar esta auditoría:  BinAuditLogger: Una forma eficiente de registrar eventos en un archivo binario.  FileAuditLogger: Registra los eventos en un archivo de texto plano, específicamente en audit/audit.log, utilizando un registrador como slf4j.Estas implementaciones permiten capturar eventos como:  Intentos de inicio de sesión, tanto exitosos como fallidos.  Todos los comandos de base de datos ejecutados a través del protocolo CQL, ya sea que hayan tenido éxito o hayan fallado.  No se registran los valores reales que se vinculan con las sentencias preparadas.Cada implementación de auditoría tiene acceso a atributos importantes como el nombre del usuario (si está disponible), la dirección IP y el puerto de origen, la categoría y el tipo de solicitud (por ejemplo, INSERT, SELECT, etc.), el keyspace y la tabla que se está modificando, y el comando CQL ejecutado.Para implementar la auditoría, primero creamos un nuevo keyspace. En la terminal de Cassandra, ejecutamos el siguiente comando:cqlsh&gt; CREATE KEYSPACE auditoria_prueba WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 1};Una vez que tenemos el keyspace, editamos el archivo de configuración /etc/cassandra/cassandra.yaml para habilitar la auditoría. Buscamos la sección correspondiente a las opciones de auditoría y agregamos lo siguiente:audit_logging_options:  enabled: true  logger:    - class_name: BinAuditLogger  included_keyspaces: [\"auditoria_prueba\"]  included_categories: [DML]Esto habilita la auditoría para el keyspace auditoria_prueba y limita el registro solo a las operaciones DML (Data Manipulation Language), como INSERT, UPDATE, y DELETE.Después de realizar estos cambios, reiniciamos Cassandra ejecutando los siguientes comandos:nodetool disableauditlognodetool enableauditlogUna vez que Cassandra se ha reiniciado, nos conectamos al keyspace auditoria_prueba y realizamos algunas operaciones. Creamos una tabla y luego insertamos algunos datos. Los comandos que usamos son los siguientes:cqlsh&gt; USE auditoria_prueba;cqlsh:auditoria_prueba&gt; CREATE TABLE empleados (                      ...     id UUID PRIMARY KEY,                      ...     nombre TEXT,                      ...     correo TEXT                      ... );cqlsh:auditoria_prueba&gt; INSERT INTO empleados (id, nombre, correo)                       ... VALUES (uuid(), 'Juan Pérez', 'juanperez@example.com');cqlsh:auditoria_prueba&gt; INSERT INTO empleados (id, nombre, correo)                    ... VALUES (uuid(), 'Raúl Perez', 'raulperez@example.com');cqlsh:auditoria_prueba&gt; SELECT * FROM empleados; id                                   | correo                | nombre--------------------------------------+-----------------------+------------ 30722a56-bddb-4c54-bc4e-5f94b1afb030 | raulperez@example.com | Raúl Perez 6a177462-a22d-4051-8a9f-50498f7abafb | juanperez@example.com | Juan Pérez(2 rows)Posteriormente, si revisamos los logs, podemos observar que las inserciones y consultas realizadas han quedado registradas. Los logs de auditoría se verían algo así:2025-02-27 15:00:11,234 [AuditLogger:1] INFO  com.datastax.bdp.audit.BinAuditLogger - Query: CREATE TABLE empleados (id UUID PRIMARY KEY, nombre TEXT, correo TEXT)2025-02-27 15:00:23,123 [AuditLogger:1] INFO  com.datastax.bdp.audit.BinAuditLogger - Query: INSERT INTO empleados (id, nombre, correo) VALUES (6a177462-a22d-4051-8a9f-50498f7abafb, 'Juan Pérez', 'juanperez@example.com')2025-02-27 15:00:33,233 [AuditLogger:1] INFO  com.datastax.bdp.audit.BinAuditLogger - Query: INSERT INTO empleados (id, nombre, correo) VALUES (30722a56-bddb-4c54-bc4e-5f94b1afb030, 'Raúl Pérez', 'raulperez@example.com')2025-02-27 15:01:02,678 [AuditLogger:1] INFO  com.datastax.bdp.audit.BinAuditLogger - Query: SELECT * FROM empleados;En los logs podemos ver información detallada como la fecha y hora exacta, el nivel de log (INFO), el tipo de operación (INSERT, CREATE, SELECT), y los valores de las operaciones ejecutadas. Esto nos da un buen control sobre las inserciones y otros eventos importantes dentro de la base de datos.De esta manera, podemos auditar de forma eficaz las inserciones de datos y otras operaciones dentro de Cassandra, garantizando que toda actividad en la base de datos quede registrada adecuadamente para su posterior revisión."
  },
  
  {
    "title": "Informática forense",
    "url": "/posts/forense/",
    "categories": "Seguridad, Análisis",
    "tags": "Análisis",
    "date": "2025-01-29 20:00:00 +0100",
    





    
    "snippet": "La informática forense es el conjunto de técnicas que nos permite obtener la máxima información posible tras un incidente o delito informático.En esta práctica, realizarás la fase de toma de eviden...",
    "content": "La informática forense es el conjunto de técnicas que nos permite obtener la máxima información posible tras un incidente o delito informático.En esta práctica, realizarás la fase de toma de evidencias y análisis de las mismas sobre una máquina Linux y otra Windows. Supondremos que pillamos al delincuente in fraganti y las máquinas se encontraban encendidas. Opcionalmente, podéis realizar el análisis de un dispositivo Android.Sobre cada una de las máquinas debes realizar el proceso de toma de evidencias siguiendo las directrices contenidas en RFC 3227(incluyendo un volcado de memoria y otro de disco duro), tomando las medidas necesarias para certificar posteriormente la cadena de custodia.Apartado A) Máquina WindowsVolcado de disco duro en WindowsComenzaremos realizando un volcado de disco duro en Windows, en concreto una máquina virtual con 30GB de disco. Este disco tiene registros e información necesarios para el caso práctico, pero tendremos que añadir otro disco del doble de tamaño (60GB) para hacer allí el volcado de información.Algo muy a tener en cuenta es que estamos trabajando sobre un entorno que no es real, además, del poco tiempo para realizar la práctica. Por lo que lo recomendable es utilizar un disco cuanto más pequeño mejor, ya que de lo contrario puede tardar días en realizar el análisis. Evidentemente en un caso real pues los discos estarían mucho más llenos y el proceso tardaría más, pero en este caso lo haré así.El volcado del disco duro con FTK Imager crea una copia exacta del almacenamiento de la máquina sin alterar su contenido. Esta imagen contiene todos los datos del sistema, incluyendo archivos, registros del sistema, historial de actividad y posibles rastros de malware. Este proceso es fundamental en el análisis forense, ya que permite examinar el estado del disco en un entorno seguro sin modificar la evidencia original.Una vez dicho esto, tendremos que instalar la herramienta que utilizaremos para el volcado, existen muchas pero yo me he decantado por AccessData FTK Imager.Después de instalarlo accedemos a la aplicación y comenzamos con el volcado, para ello seguimos los siguientes pasos:      Primero de todo le damos a “File” y seleccionamos la opción “Create Disk Image…”            Elegimos como origen el disco físico de la máquina virtual, lo que nos permite capturar una copia exacta de su contenido.            Seleccionamos ahora el disco desde el cual haremos el volcado.            En este paso tendremos que especificar donde se va a realizar el volcado, para ello seleccionamos la opción “Add…”, luego la primera opción Raw (dd), en la siguiente pestaña rellenamos datos meramente informativos y por último, elegimos el disco de destino donde se hará el volcado de datos.                        Una vez configurado donde se realizará el volcado le damos a “Start”.            En donde nos saldrá una pestaña así con un progreso, el cual tardará unos 10 minutos.            Durante el proceso también nos saldrá a lo último una verificación.            Una vez terminado el volcado nos saldrá una pestaña con varios detalles, incluido el hash.            También esta pestaña con una recopilación del volcado.      Bien, pues ya habríamos terminado de esta forma el volcado de disco, para corroborar que se ha realizado con éxito nos podemos dirigir a “Archivos” y ver que el nuevo disco (Nuevo Vol (E:)) se ha llenado de información:Si accedemos a los archivos del disco donde hemos hecho el volcado, podemos ver todos estos ficheros:Básicamente lo que hace es fragmentar el disco en varios archivos para así poder dividir la imagen en partes más manejables. Esto es especialmente útil si el disco de destino tiene restricciones de tamaño de archivo.Volcado de memoria en WindowsPara el volcado de memoria utilizaré la misma herramienta que anteriormente, pues es un proceso muy sencillo y similar al de disco.Primero de todo seleccionamos de nuevo en “File” y pulsamos en “Capture Memory…”.Nos saldrá una ventana en donde tendremos que seleccionar el disco E: como destino, además de marcar la casilla “Include page file”.Le damos a “Capture Memory” y comenzará el proceso:Una vez terminado nos dirigimos de nuevo al disco para corroborar que se ha añadido los ficheros del volcado:Volcado de registros en WindowsAhora realizaré un volcado de registro, el cual consiste en extraer las bases de datos del Registro de Windows, donde se almacenan configuraciones del sistema, historial de actividad, credenciales y rastros de software o malware.Para ello, usamos la misma herramienta que los dos caso anteriores. En donde le tendremos que dar al icono amarillo de arriba:Se abrirá una pestaña y ahí tendremos que especificar la ruta del disco de destino, el cual es el mismo que en las dos anteriores:Comenzará el volcado de registro y una vez terminado, volvemos de nuevo al disco E: y vemos como se han generado nuevos ficheros:Análisis disco con AutopsyUna vez realizados los volcados del disco, memoria y registros, procederemos con el análisis forense utilizando Autopsy. Autopsy es una herramienta gráfica que facilita la investigación y análisis de las evidencias recogidas, como las imágenes de disco, volcados de memoria y registros.Una vez realizada la instalación, accedemos a la aplicación y nos saldrán diferentes opciones, nosotros marcamos “New Case”:En la siguiente pestaña le damos un nombre al Caso y elegimos donde se guardará:En el siguiente paso rellenamos los datos meramente informativos:Una vez que hayamos creado el caso en Autopsy, la herramienta generará una base de datos que servirá como su estructura principal para el análisis.El siguiente paso será elegir la fuente de datos desde la cual se recopilará la información.Esta pestaña es muy importante, pues solo marcaremos las opciones que nos interesan, pues de lo contrario hará que el análisis tarde mucho más. Las opciones que yo he marcado son las siguientes:Le damos a “Finish” y en ese preciso momento comenzará el análisis:Como vemos se está empezando a recopilar información, este proceso puede tardar mucho dependiendo de muchas variables. En mi caso lo paré al 35% después de unas 4-5 horas, pues con lo que había recopilado ya era suficiente para lo que nos pide la práctica.Instalación Volatility3 en Debian 12Volatility es una herramienta de análisis forense de memoria RAM que permite extraer información de volcados de memoria de sistemas Windows, Linux y macOS. Se usa para investigar incidentes de seguridad, detectar malware, recuperar datos y analizar procesos en ejecución.Por lo tanto, procedemos a su instalación la cual tendremos que bajarnos desde el repositorio:pavlo@debian:~()$ git clone https://github.com/volatilityfoundation/volatility3.gitClonando en 'volatility3'...remote: Enumerating objects: 42556, done.remote: Counting objects: 100% (346/346), done.remote: Compressing objects: 100% (168/168), done.remote: Total 42556 (delta 281), reused 195 (delta 178), pack-reused 42210 (from 3)Recibiendo objetos: 100% (42556/42556), 8.38 MiB | 15.93 MiB/s, listo.Resolviendo deltas: 100% (32743/32743), listo.Accedemos al directorio del repositorio clonado y creamos un entorno virtual de Python para aislar la instalación:pavlo@debian:~()$ cd volatility3/pavlo@debian:~/volatility3(develop)$ python3 -m venv venvpavlo@debian:~/volatility3(develop)$ source venv/bin/activateEn este punto, Volatility 3 no incluye un requirements.txt, ya que usa pyproject.toml para gestionar dependencias, por lo que ejecutamos el siguiente comando para la instalación:(venv) pavlo@debian:~/volatility3(develop)$ pip install .Processing /home/pavlo/volatility3  Installing build dependencies ... done  Getting requirements to build wheel ... done  Preparing metadata (pyproject.toml) ... doneCollecting pefile&gt;=2024.8.26  Downloading pefile-2024.8.26-py3-none-any.whl (74 kB)     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 74.8/74.8 kB 734.5 kB/s eta 0:00:00Building wheels for collected packages: volatility3  Building wheel for volatility3 (pyproject.toml) ... done  Created wheel for volatility3: filename=volatility3-2.20.1-py3-none-any.whl size=912249 sha256=e2fe6f191532e493cc5e305d706c26e69f569b60bba6a6ff55bf73cf5e8f1760  Stored in directory: /tmp/pip-ephem-wheel-cache-oo31pspy/wheels/5f/87/74/6ce43180018f0afedce648bb9388f6ff390d38822e323a4083Successfully built volatility3Installing collected packages: pefile, volatility3Successfully installed pefile-2024.8.26 volatility3-2.20.1Para comprobar que la instalación fue exitosa, ejecutamos el siguiente comando:(venv) pavlo@debian:~/volatility3(develop)$ python3 vol.py -hVolatility 3 Framework 2.20.1usage: vol.py [-h] [-c CONFIG] [--parallelism [{processes,threads,off}]] [-e EXTEND] [-p PLUGIN_DIRS] [-s SYMBOL_DIRS] [-v] [-l LOG] [-o OUTPUT_DIR] [-q] [-r RENDERER]              [-f FILE] [--write-config] [--save-config SAVE_CONFIG] [--clear-cache] [--cache-path CACHE_PATH] [--offline | -u URL] [--filters FILTERS]              [--hide-columns [HIDE_COLUMNS ...]] [--single-location SINGLE_LOCATION] [--stackers [STACKERS ...]] [--single-swap-locations [SINGLE_SWAP_LOCATIONS ...]]              PLUGIN ...Montaje del disco de Windows en DebianPara la realización de las comprobaciones, necesitaremos utilizar distintas herramientas y entre ellas Volatility, la cual instalamos anteriormente. Por lo tanto, tendremos que montar el disco de Windows con el volcado en nuestra máquina física, el cual se encuentra en la ruta /var/lib/libvirt/images/win10-1.qcow2. Para ello seguiremos los siguientes pasos:Primero, cargamos el módulo necesario para manejar discos en red con el siguiente comando:(venv) pavlo@debian:~()$ sudo modprobe nbdLuego, conectamos el archivo de imagen del disco virtual (en formato qcow2) a un dispositivo de bloque, utilizando qemu-nbd:(venv) pavlo@debian:~()$ sudo qemu-nbd --connect=/dev/nbd0 /var/lib/libvirt/images/win10-1.qcow2A continuación, listamos las particiones del disco con fdisk -l para verificar la estructura del disco y las particiones disponibles:(venv) pavlo@debian:~()$ sudo fdisk -l /dev/nbd0Disco /dev/nbd0: 60 GiB, 64424509440 bytes, 125829120 sectoresUnidades: sectores de 1 * 512 = 512 bytesTamaño de sector (lógico/físico): 512 bytes / 512 bytesTamaño de E/S (mínimo/óptimo): 512 bytes / 512 bytesTipo de etiqueta de disco: gptIdentificador del disco: 479ABFDB-206B-403A-AF13-FEB3282C2C41Disposit.   Comienzo     Final  Sectores Tamaño Tipo/dev/nbd0p1       34     32767     32734    16M Reservado para Microsoft/dev/nbd0p2    32768 125825023 125792256    60G Datos básicos de MicrosoftEsto nos muestra las particiones del disco, donde identificamos la partición de datos del sistema operativo. Posteriormente, creamos un directorio para montar la partición y proceder con el análisis:(venv) pavlo@debian:~()$ sudo mkdir -p /mnt/windowsMontamos la partición de datos del disco en modo solo lectura:(venv) pavlo@debian:~()$ sudo mount -o ro /dev/nbd0p2 /mnt/windows/Ya montada la partición, podemos verificar que los archivos del sistema y los volcados de memoria están presentes con el comando:(venv) pavlo@debian:~()$ ls /mnt/windows/'$RECYCLE.BIN'       SAM                          Users                  VolcadoDisco.004   VolcadoDisco.009   VolcadoDisco.014   VolcadoDisco.019 default             SECURITY                     VolcadoDisco.001       VolcadoDisco.005   VolcadoDisco.010   VolcadoDisco.015   VolcadoDisco.020 DumpStack.log.tmp   software                     VolcadoDisco.001.txt   VolcadoDisco.006   VolcadoDisco.011   VolcadoDisco.016   VolcadoDisco.021 memdump.mem         system                       VolcadoDisco.002       VolcadoDisco.007   VolcadoDisco.012   VolcadoDisco.017 pagefile.sys       'System Volume Information'   VolcadoDisco.003       VolcadoDisco.008   VolcadoDisco.013   VolcadoDisco.018Una vez que tenemos acceso al volcado de memoria (memdump.mem), utilizamos Volatility para analizarlo, ejecutando el siguiente comando:(venv) pavlo@debian:~/volatility3(develop)$ python3 vol.py -f \"/mnt/windows/memdump.mem\" windows.infoVolatility 3 Framework 2.20.1Progress:  100.00\t\tPDB scanning finished                                                                                              Variable\tValueKernel Base\t0xf8012be00000DTB\t0x1ad000Symbols\tfile:///home/pavlo/volatility3/volatility3/symbols/windows/ntkrnlmp.pdb/89284D0CA6ACC8274B9A44BD5AF9290B-1.json.xzIs64Bit\tTrueIsPAE\tFalselayer_name\t0 WindowsIntel32ememory_layer\t1 FileLayerKdVersionBlock\t0xf8012ca0f3a0Major/Minor\t15.19041MachineType\t34404KeNumberProcessors\t2SystemTime\t2025-02-12 10:49:55+00:00NtSystemRoot\tC:\\WindowsNtProductType\tNtProductWinNtNtMajorVersion\t10NtMinorVersion\t0PE MajorOperatingSystemVersion\t10PE MinorOperatingSystemVersion\t0PE Machine\t34404PE TimeDateStamp\tFri May 20 08:24:42 2101ComprobacionesPara las siguiente comprobaciones utilizaré Volatility, CMD, PowerShell y RegistryViewer.      Procesos en ejecución.    Con PsList enumeramos los procesos del sistema en el momento que se tomó el volcado de la memoria. Cada fila representa un proceso en el sistema, mostrando su ID, la ID del proceso padre, nombre de archivo, sesión, etc.     python3 vol.py -f \"/mnt/windows/memdump.mem\" windows.pslist.PsList                Servicios en ejecución.    Mostramos una lista de servicios en el sistema, indicador y nombre del servicio:     python vol.py -f \"/mnt/windows/memdump.mem\" windows.getservicesids.GetServiceSIDs                Puertos abiertos.    Muestra las conexiones de red actualmente establecidas, incluyendo los puertos en uso, las direcciones IP de origen y destino, los identificadores de proceso (PID) asociados y las marcas de tiempo correspondientes.     python vol.py -f \"/mnt/windows/memdump.mem\" windows.netstat.NetStat                Conexiones establecidas por la máquina.    Muestra las conexiones de red activas en la máquina, incluyendo los protocolos utilizados, las direcciones IP de origen y destino, los puertos implicados, el estado de cada conexión, el usuario propietario y el identificador del proceso asociado.     python vol.py -f \"/mnt/forense/windows/memoria/memdump.mem\" windows.netscan.NetScan                Sesiones de usuario establecidas remotamente.    Presenta las sesiones activas en el sistema en el instante en que se realizó el volcado, incluyendo la identificación de la sesión, su tipo, el identificador y nombre del proceso asociado, el usuario que la inició y la marca temporal correspondiente.     python vol.py -f \"/mnt/windows/memdump.mem\" windows.sessions.Sessions                Ficheros transferidos recientemente por NetBios.    Dado que ni Autopsy ni Volatility ofrecen opciones directas para visualizar los archivos transferidos mediante NetBIOS, ejecutaremos el comando nbtstat -n en la misma máquina. Este comando nos permitirá ver la tabla de NetBIOS local en los adaptadores de red, mostrando los nombres registrados y su estado en la red.            Contenido de la caché DNS.    Ejecutaremos el comando ipconfig /displaydns, el cual nos permitirá visualizar los nombres de dominio y hosts que han sido resueltos recientemente, junto con sus direcciones IP correspondientes. Esta información puede ser útil para analizar conexiones previas establecidas por el sistema.            Variables de entorno.    Expondremos las variables de entorno del sistema en el momento del volcado, detallando el identificador y nombre del proceso asociado, la ubicación en memoria, el nombre de la variable y su valor correspondiente.     python vol.py -f \"/mnt/forense/windows/memoria/memdump.mem\" windows.envars.Envars                Dispositivos USB conectados    En Autopsy, utilizando la opción USB Device Attached, podremos visualizar los dispositivos USB extraíbles que han sido conectados a la máquina en algún momento.            Redes wifi utilizadas recientemente.    Utilizando la herramienta Registry Viewer, podemos analizar el archivo system del registro de Windows y navegar hasta la ruta system/ControlSet001/Control/Network/Connections. En esta ubicación, encontramos claves del registro que contienen información sobre las redes Wi-Fi a las que se ha conectado la máquina.            Configuración del firewall de nodo.    Para examinar la configuración de las reglas del firewall, utilizaremos Registry Viewer y abriremos el archivo system. Luego, navegaremos hasta la ruta:    system\\ControlSet001\\Services\\SharedAccess\\Defaults\\FirewallPolicy\\FirewallRules        Aquí encontraremos diversas reglas del firewall almacenadas en el registro de Windows. Por ejemplo, una regla destacada podría ser:            Programas que se ejecutan en el Inicio.    Abrimos nuevamente el archivo software y navegamos hasta la ruta:    software\\Microsoft\\Windows\\CurrentVersion\\Run    Aquí podemos ver los programas configurados para ejecutarse automáticamente al iniciar el sistema. En este caso, solo encontramos un antivirus integrado en el sistema que se inicia con Windows. Esta clave del registro es útil para identificar programas que se ejecutan al inicio, lo que puede ayudar en la detección de posibles malware o herramientas de administración remota ocultas.            Asociación de extensiones de ficheros y aplicaciones.    En el desplegable File Types, encontraremos una lista de diversas extensiones de archivo.                Aplicaciones usadas recientemente.    Para ver las aplicaciones que se han utilizado en el sistema, podemos dirigirnos al artefacto Run Programs.        Otra forma de ver las aplicaciones utilizadas es acceder al archivo de volcado del disco (dump) en la pestaña Summary, específicamente en la sección User Activity.            Ficheros abiertos recientemente.    Podemos verlo en el apartado Recent Documents.            Software Instalado.    Podemos ver el software instalado en el artefacto Installed Programs.            Contraseñas guardadas.    Las contraseñas guardadas las podemos ver en Web Account Type.            Cuentas de Usuario    Para ver las cuentas en OS Accounts.            Historial de navegación y descargas. Cookies.    Para ver el historial de navegación iremos a Web History.        Para ver las búsquedas en Web Search.        Las descargas en Web Downloads.        Las cookies en Web Cookies.            Volúmenes cifrados    Podemos verlos en la sección Encryption Suspected.            Archivos con extensión cambiada.    Para identificar los archivos que tienen una extensión cambiada o no adecuada, podemos acceder a la sección Extension Mismatch Detected.            Archivos eliminados.    Podemos ver los archivos eliminados en la sección File Views » Deleted Files » File System.            Archivos Ocultos.    Para encontrar los archivos Hidden debemos seleccionar justo el fichero y fijarnos en las Flags, donde indicará si está oculto o no:            Archivos que contienen una cadena determinada.    Para buscar una cadena debemos escribir la/s palabra/s en cuestión dentro de Keyword Search.            Búsqueda de imágenes por ubicación.    Para ver la ubicación de la imagen nos dirigimos al apartado Geolocation de arriba. Ahí nos movemos hacia la flecha y si pinchamos nos saldrá la imagen.                Búsqueda de archivos por autor.    Para los archivos por autor vamos al artefacto Metadata y podemos ver que aparecen diferentes archivos y podemos ver el autor en el apartado de Owner.      Apartado B) Máquina LinuxVolcado de disco duroTenemos un disco vda de 20GB que contiene el sistema operativo, y vdb de 40GB que utilizaremos para almacenar el volcado.pablo@forense:~$ lsblkNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTSsr0     11:0    1 1024M  0 rom  vda    254:0    0   20G  0 disk ├─vda1 254:1    0   19G  0 part /├─vda2 254:2    0    1K  0 part └─vda5 254:5    0  975M  0 part [SWAP]vdb    254:16   0   40G  0 disk Dado que vdb es un disco nuevo sin particiones, primero le asignamos una tabla de particiones GPT:pablo@forense:~$ sudo parted /dev/vdb -- mklabel gptInformation: You may need to update /etc/fstab.Luego, creamos una partición primaria que ocupará todo el espacio disponible y la formateamos con ext4:pablo@forense:~$ sudo parted /dev/vdb -- mkpart primary ext4 1MiB 100%    Information: You may need to update /etc/fstab.pablo@forense:~$ sudo mkfs.ext4 /dev/vdb1mke2fs 1.47.0 (5-Feb-2023)Discarding device blocks: done                            Creating filesystem with 10485248 4k blocks and 2621440 inodesFilesystem UUID: b125a5f4-a782-43db-893b-e1ac045d71b8Superblock backups stored on blocks: \t32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, \t4096000, 7962624Allocating group tables: done                            Writing inode tables: done                            Creating journal (65536 blocks): doneWriting superblocks and filesystem accounting information: done   Para poder escribir en la nueva partición, la montamos en un directorio específico:pablo@forense:~$ sudo mkdir -p /mnt/nuevopablo@forense:~$ sudo mount /dev/vdb1 /mnt/nuevoEl siguiente paso es realizar el volcado del disco vda hacia un archivo de imagen en vdb. Para ello, usamos dd, una herramienta que copia datos a nivel de bytes:pablo@forense:~$ sudo dd if=/dev/vda of=/mnt/nuevo/discodebian.img bs=64K status=progress21441085440 bytes (21 GB, 20 GiB) copied, 459 s, 46,7 MB/s 327680+0 records in327680+0 records out21474836480 bytes (21 GB, 20 GiB) copied, 459,091 s, 46,8 MB/sVerificamos que la imagen se ha creado correctamente y que el disco vdb1 sigue montado:pablo@forense:~$ lsblkNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTSsr0     11:0    1 1024M  0 rom  vda    254:0    0   20G  0 disk ├─vda1 254:1    0   19G  0 part /├─vda2 254:2    0    1K  0 part └─vda5 254:5    0  975M  0 part [SWAP]vdb    254:16   0   40G  0 disk └─vdb1 254:17   0   40G  0 part /mnt/nuevoVolcado de memoriaLo primero que hacemos es clonar el repositorio de LiME desde GitHub para obtener su código fuente:pablo@forense:~$ git clone https://github.com/504ensicsLabs/LiME.gitClonando en 'LiME'...remote: Enumerating objects: 389, done.remote: Counting objects: 100% (40/40), done.remote: Compressing objects: 100% (26/26), done.remote: Total 389 (delta 20), reused 28 (delta 14), pack-reused 349 (from 1)Recibiendo objetos: 100% (389/389), 1.62 MiB | 3.09 MiB/s, listo.Resolviendo deltas: 100% (209/209), listo.Una vez completada la descarga, instalamos el paquete lime-forensics-dkms con APT, que nos facilita la compilación del módulo necesario para el volcado de memoria:pablo@forense:~$ sudo apt install lime-forensics-dkms -yDespués de instalar las dependencias necesarias, accedemos al directorio donde se encuentra el código fuente y compilamos el módulo de LiME:pablo@forense:~/LiME/src$ makemake -C /lib/modules/6.1.0-31-amd64/build M=\"/home/pablo/LiME/src\" modulesmake[1]: se entra en el directorio '/usr/src/linux-headers-6.1.0-31-amd64'  CC [M]  /home/pablo/LiME/src/tcp.o  CC [M]  /home/pablo/LiME/src/disk.o  CC [M]  /home/pablo/LiME/src/main.o  CC [M]  /home/pablo/LiME/src/hash.o  CC [M]  /home/pablo/LiME/src/deflate.o  LD [M]  /home/pablo/LiME/src/lime.o  MODPOST /home/pablo/LiME/src/Module.symvers  CC [M]  /home/pablo/LiME/src/lime.mod.o  LD [M]  /home/pablo/LiME/src/lime.ko  BTF [M] /home/pablo/LiME/src/lime.koSkipping BTF generation for /home/pablo/LiME/src/lime.ko due to unavailability of vmlinuxmake[1]: se sale del directorio '/usr/src/linux-headers-6.1.0-31-amd64'strip --strip-unneeded lime.komv lime.ko lime-6.1.0-31-amd64.koEste proceso genera un módulo de kernel con el nombre lime.ko, que nos permitirá capturar la memoria volcada.Para proceder con el volcado de memoria, insertamos el módulo en el kernel con la siguiente instrucción:pablo@forense:~/LiME/src$ sudo insmod lime-6.1.0-31-amd64.ko \"path=/mnt/nuevo/memdump.mem format=lime\"Una vez finalizado el proceso, comprobamos que el archivo se ha generado correctamente listando el contenido del directorio de destino:pablo@forense:~/LiME/src$ ls -l /mnt/nuevo/total 23068152-rw-r--r-- 1 root root 21474836480 feb 14 08:46 discodebian.imgdrwx------ 2 root root       16384 feb 14 08:37 lost+found-r--r--r-- 1 root root  2146925632 feb 14 08:52 memdump.memEl resultado nos muestra que el archivo memdump.mem ha sido creado con éxito, junto con la imagen del disco que volcamos previamente.Para garantizar la integridad del volcado, generamos su hash SHA-256 con el siguiente comando:pablo@forense:~$ sudo find /mnt/nuevo -type f -exec sha256sum {} +93ee746af8ca6a4ebaf5e38f215b848fd5e6319d93c7bba9a72d8039e4d0c0fc  /mnt/nuevo/memdump.memde77108bcc533bfc9125cc54d60927cd2d687d5e1f8f316713ca35b9f3a5fb67  /mnt/nuevo/discodebian.imgEsto nos proporciona un hash único que nos permitirá verificar en el futuro que el archivo no ha sido modificado.ComprobacionesNo he sido capaz de realizar el volcado correctamente con Volatility, pues no lo reconocía. Además, tampoco he conseguido que Autopsy me funciones correctamente en Debian. Por lo tanto, no me queda otra que hacer las comprobaciones a través de la terminal.      Procesos en ejecución.     pablo@forense:~$ ps -aux USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND root           1  1.7  0.6 168172 12536 ?        Ss   08:57   0:00 /sbin/init root           2  0.0  0.0      0     0 ?        S    08:57   0:00 [kthreadd] root           3  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [rcu_gp] root           4  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [rcu_par_gp] root           5  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [slub_flushwq] root           6  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [netns] root           7  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/0:0-events] root           8  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kworker/0:0H-events_highpri] root           9  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/u4:0-events_unbound] root          10  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [mm_percpu_wq] root          11  0.0  0.0      0     0 ?        I    08:57   0:00 [rcu_tasks_kthread] root          12  0.0  0.0      0     0 ?        I    08:57   0:00 [rcu_tasks_rude_kthread] root          13  0.0  0.0      0     0 ?        I    08:57   0:00 [rcu_tasks_trace_kthread] root          14  0.0  0.0      0     0 ?        S    08:57   0:00 [ksoftirqd/0] root          15  0.0  0.0      0     0 ?        I    08:57   0:00 [rcu_preempt] root          16  0.0  0.0      0     0 ?        S    08:57   0:00 [migration/0] root          17  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/0:1-events] root          18  0.0  0.0      0     0 ?        S    08:57   0:00 [cpuhp/0] root          19  0.0  0.0      0     0 ?        S    08:57   0:00 [cpuhp/1] root          20  0.0  0.0      0     0 ?        S    08:57   0:00 [migration/1] root          21  0.0  0.0      0     0 ?        S    08:57   0:00 [ksoftirqd/1] root          22  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/1:0-events] root          23  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kworker/1:0H-kblockd] root          25  0.6  0.0      0     0 ?        I    08:57   0:00 [kworker/u4:1-events_unbound] root          26  0.0  0.0      0     0 ?        S    08:57   0:00 [kdevtmpfs] root          27  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [inet_frag_wq] root          28  0.0  0.0      0     0 ?        S    08:57   0:00 [kauditd] root          29  0.0  0.0      0     0 ?        S    08:57   0:00 [khungtaskd] root          30  0.0  0.0      0     0 ?        S    08:57   0:00 [oom_reaper] root          31  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/u4:2-events_unbound] root          32  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [writeback] root          33  0.0  0.0      0     0 ?        S    08:57   0:00 [kcompactd0] root          34  0.0  0.0      0     0 ?        SN   08:57   0:00 [ksmd] root          35  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/1:1-events_power_efficient] root          36  0.0  0.0      0     0 ?        SN   08:57   0:00 [khugepaged] root          37  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kintegrityd] root          38  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kblockd] root          39  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [blkcg_punt_bio] root          40  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [tpm_dev_wq] root          41  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [edac-poller] root          42  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [devfreq_wq] root          43  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kworker/1:1H-kblockd] root          44  0.0  0.0      0     0 ?        S    08:57   0:00 [kswapd0] root          50  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kthrotld] root          52  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/24-aerdrv] root          53  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/25-aerdrv] root          54  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/26-aerdrv] root          55  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/27-aerdrv] root          56  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/28-aerdrv] root          57  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/29-aerdrv] root          58  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/30-aerdrv] root          59  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/31-aerdrv] root          60  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/32-aerdrv] root          61  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/33-aerdrv] root          62  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/34-aerdrv] root          63  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/35-aerdrv] root          64  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/36-aerdrv] root          65  0.0  0.0      0     0 ?        S    08:57   0:00 [irq/37-aerdrv] root          66  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [acpi_thermal_pm] root          67  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/1:2-cgroup_destroy] root          68  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [mld] root          69  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [ipv6_addrconf] root          74  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kstrp] root          79  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [zswap-shrink] root          80  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kworker/u5:0] root         140  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kworker/0:1H-kblockd] root         143  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [ata_sff] root         145  0.0  0.0      0     0 ?        S    08:57   0:00 [scsi_eh_0] root         147  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [scsi_tmf_0] root         148  0.0  0.0      0     0 ?        S    08:57   0:00 [scsi_eh_1] root         149  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [scsi_tmf_1] root         150  0.0  0.0      0     0 ?        S    08:57   0:00 [scsi_eh_2] root         151  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [scsi_tmf_2] root         152  0.0  0.0      0     0 ?        S    08:57   0:00 [scsi_eh_3] root         153  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [scsi_tmf_3] root         154  0.0  0.0      0     0 ?        S    08:57   0:00 [scsi_eh_4] root         155  0.0  0.0      0     0 ?        S    08:57   0:00 [scsi_eh_5] root         156  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/0:2-events] root         157  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [scsi_tmf_5] root         158  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [scsi_tmf_4] root         159  0.0  0.0      0     0 ?        S    08:57   0:00 [scsi_eh_6] root         160  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [scsi_tmf_6] root         161  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/u4:3-flush-254:0] root         162  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/u4:4-events_unbound] root         163  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/u4:5-flush-254:0] root         164  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/u4:6-events_unbound] root         165  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/u4:7-scsi_tmf_0] root         166  0.1  0.0      0     0 ?        I    08:57   0:00 [kworker/0:3-rcu_gp] root         168  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/0:4-cgroup_destroy] root         169  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [kworker/1:2H-kblockd] root         208  0.0  0.0      0     0 ?        S    08:57   0:00 [jbd2/vda1-8] root         209  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [ext4-rsv-conver] root         223  0.0  0.0      0     0 ?        S    08:57   0:00 [hwrng] root         251  0.3  0.8  41540 16272 ?        Ss   08:57   0:00 /lib/systemd/systemd-journald root         280  0.1  0.3  28232  7348 ?        Ss   08:57   0:00 /lib/systemd/systemd-udevd systemd+     297  0.0  0.3  90252  6952 ?        Ssl  08:57   0:00 /lib/systemd/systemd-timesyncd root         337  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/1:3-events] root         348  0.0  0.0      0     0 ?        S    08:57   0:00 [watchdogd] root         351  0.0  0.0      0     0 ?        I&lt;   08:57   0:00 [cryptd] root         473  0.0  0.0      0     0 ?        I    08:57   0:00 [kworker/1:4-events] root         518  0.0  0.4 237640  9932 ?        Ssl  08:57   0:00 /usr/libexec/accounts-daemon avahi        520  0.0  0.1   8288  3980 ?        Ss   08:57   0:00 avahi-daemon: running [forense.local] root         521  0.0  0.0   6608  1200 ?        Ss   08:57   0:00 /usr/sbin/cron -f message+     522  0.3  0.3  10608  6156 ?        Ss   08:57   0:00 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only root         524  0.0  0.2 230020  4420 ?        SLsl 08:57   0:00 /usr/libexec/low-memory-monitor polkitd      526  0.2  0.4 310756  9752 ?        Ssl  08:57   0:00 /usr/lib/polkit-1/polkitd --no-debug root         527  0.0  0.4 237268  9060 ?        Ssl  08:57   0:00 /usr/libexec/power-profiles-daemon root         528  0.0  0.0  80236  1880 ?        Ssl  08:57   0:00 /usr/sbin/qemu-ga root         529  0.0  0.4 233400  8792 ?        Ssl  08:57   0:00 /usr/libexec/switcheroo-control root         530  0.0  0.2 651308  5032 ?        Ssl  08:57   0:00 /usr/sbin/nscd root         531  0.1  0.3  17352  7904 ?        Ss   08:57   0:00 /lib/systemd/systemd-logind root         532  0.1  0.7 395040 14692 ?        Ssl  08:57   0:00 /usr/libexec/udisks2/udisksd avahi        533  0.0  0.0   8100   364 ?        S    08:57   0:00 avahi-daemon: chroot helper root         563  0.0  0.0      0     0 ?        S    08:57   0:00 [psimon] root         565  0.1  1.0 259328 20572 ?        Ssl  08:57   0:00 /usr/sbin/NetworkManager --no-daemon root         578  0.0  0.2  16532  5916 ?        Ss   08:57   0:00 /sbin/wpa_supplicant -u -s -O DIR=/run/wpa_supplicant GROUP=netdev root         580  0.0  0.6 317332 12216 ?        Ssl  08:57   0:00 /usr/sbin/ModemManager root         595  0.0  0.4  27080  8772 ?        Ss   08:57   0:00 /usr/sbin/cupsd -l lp           612  0.0  0.2  16592  5292 ?        S    08:57   0:00 /usr/lib/cups/notifier/dbus dbus:// root         618  0.0  0.4  15648  8880 ?        Ss   08:57   0:00 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups root         646  0.0  0.6 240808 13388 ?        Ssl  08:57   0:00 /usr/sbin/gdm3 root         664  0.0  0.7 176520 14836 ?        Ssl  08:57   0:00 /usr/sbin/cups-browsed root         667  0.0  0.5 165576 10580 ?        Sl   08:57   0:00 gdm-session-worker [pam/gdm-launch-environment] root         670  0.0  1.4 221352 28876 ?        Ss   08:57   0:00 /usr/sbin/apache2 -k start Debian-+     675  0.1  0.5  19520 11180 ?        Ss   08:57   0:00 /lib/systemd/systemd --user Debian-+     676  0.0  0.1 103844  3284 ?        S    08:57   0:00 (sd-pam) www-data     677  0.0  0.5 221384 10828 ?        S    08:57   0:00 /usr/sbin/apache2 -k start www-data     678  0.0  0.5 221384 10828 ?        S    08:57   0:00 /usr/sbin/apache2 -k start www-data     679  0.0  0.5 221384 10828 ?        S    08:57   0:00 /usr/sbin/apache2 -k start www-data     680  0.0  0.5 221384 10828 ?        S    08:57   0:00 /usr/sbin/apache2 -k start www-data     681  0.0  0.5 221384 10828 ?        S    08:57   0:00 /usr/sbin/apache2 -k start Debian-+     696  0.0  0.5  44784 11756 ?        S&lt;sl 08:57   0:00 /usr/bin/pipewire Debian-+     698  0.1  0.9 257744 18860 ?        S&lt;sl 08:57   0:00 /usr/bin/wireplumber Debian-+     699  0.0  0.4 159464  8132 tty1     Ssl+ 08:57   0:00 /usr/libexec/gdm-wayland-session dbus-run-session -- gnome-session --autostart /usr/share/gdm/greeter/autostart Debian-+     700  0.0  0.4  27388  9204 ?        S&lt;sl 08:57   0:00 /usr/bin/pipewire-pulse Debian-+     702  0.0  0.2   8460  4404 ?        Ss   08:57   0:00 /usr/bin/dbus-daemon --session --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only Debian-+     704  0.0  0.0   6260  1512 tty1     S+   08:57   0:00 dbus-run-session -- gnome-session --autostart /usr/share/gdm/greeter/autostart rtkit        705  0.0  0.0  22912  1536 ?        SNsl 08:57   0:00 /usr/libexec/rtkit-daemon Debian-+     706  0.1  0.2   8784  4724 tty1     S+   08:57   0:00 dbus-daemon --nofork --print-address 4 --session Debian-+     708  0.1  1.0 791064 20288 tty1     Sl+  08:57   0:00 /usr/libexec/gnome-session-binary --autostart /usr/share/gdm/greeter/autostart Debian-+     713  0.0  0.4 237720  9904 ?        Ssl  08:57   0:00 /usr/libexec/gvfsd Debian-+     720  0.0  0.3 380372  6504 ?        Sl   08:57   0:00 /usr/libexec/gvfsd-fuse /run/user/112/gvfs -f Debian-+     746  2.4 10.6 3684276 214624 tty1   Sl+  08:57   0:00 /usr/bin/gnome-shell Debian-+     763  0.5  1.4 629672 28832 ?        SNsl 08:57   0:00 /usr/libexec/tracker-miner-fs-3 Debian-+     769  0.0  0.3 311420  7712 tty1     Sl+  08:57   0:00 /usr/libexec/at-spi-bus-launcher Debian-+     774  0.0  0.2   8200  4084 tty1     S+   08:57   0:00 /usr/bin/dbus-daemon --config-file=/usr/share/defaults/at-spi2/accessibility.conf --nofork --print-address 11 --address=unix:path=/run/user/112/ Debian-+     775  0.0  0.6 352120 13988 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-udisks2-volume-monitor Debian-+     783  0.0  0.5 312632 10176 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-afc-volume-monitor Debian-+     788  0.0  0.4 234492  8772 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-gphoto2-volume-monitor Debian-+     792  0.0  0.4 233536  8528 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-mtp-volume-monitor Debian-+     796  0.1  3.2 229120 65868 tty1     S+   08:57   0:00 /usr/bin/Xwayland :1024 -rootless -noreset -accessx -core -auth /run/user/112/.mutter-Xwaylandauth.BJFG12 -listenfd 4 -listenfd 5 -displayfd 6 - Debian-+     797  0.0  0.4 233728  8360 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-goa-volume-monitor Debian-+     801  0.1  2.1 672264 42588 ?        Sl   08:57   0:00 /usr/libexec/goa-daemon Debian-+     809  0.0  0.6 386620 13208 ?        Sl   08:57   0:00 /usr/libexec/goa-identity-service root         816  0.0  0.4 233880  8836 ?        Ssl  08:57   0:00 /usr/libexec/upowerd Debian-+     829  0.0  0.3 237000  7760 tty1     Sl+  08:57   0:00 /usr/libexec/xdg-permission-store geoclue      845  0.0  0.5 244848 12052 ?        Ssl  08:57   0:00 /usr/libexec/geoclue root         846  0.0  1.1 297952 22924 ?        Ssl  08:57   0:00 /usr/libexec/packagekitd Debian-+     853  0.0  1.3 2453060 26980 tty1    Sl+  08:57   0:00 /usr/bin/gjs /usr/share/gnome-shell/org.gnome.Shell.Notifications Debian-+     854  0.0  0.4 164320  9212 tty1     Sl+  08:57   0:00 /usr/libexec/at-spi2-registryd --use-gnome-session colord       855  0.1  0.8 242688 17764 ?        Ssl  08:57   0:00 /usr/libexec/colord Debian-+     860  0.0  0.6 463836 13168 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-sharing Debian-+     866  0.1  1.3 413520 27256 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-wacom Debian-+     875  0.1  1.2 340748 25664 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-color Debian-+     877  0.1  1.3 339096 26912 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-keyboard Debian-+     879  0.0  0.6 247660 13512 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-print-notifications Debian-+     881  0.0  0.5 454996 10592 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-rfkill Debian-+     885  0.0  0.6 312420 12192 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-smartcard Debian-+     887  0.0  0.6 355812 13988 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-datetime Debian-+     894  0.1  1.4 521828 29832 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-media-keys Debian-+     901  0.0  0.4 233412  8304 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-screensaver-proxy Debian-+     905  0.0  0.5 319940 11916 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-sound Debian-+     914  0.0  0.4 307928  8956 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-a11y-settings Debian-+     917  0.0  0.4 383220  9656 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-housekeeping Debian-+     925  0.1  1.4 451296 28624 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-power Debian-+    1019  0.0  0.8 342144 17684 tty1     Sl+  08:57   0:00 /usr/libexec/gsd-printer root        1042  0.0  0.5 242732 10624 ?        Ssl  08:57   0:00 /usr/libexec/realmd Debian-+    1053  0.0  0.6 312956 12384 tty1     Sl   08:57   0:00 ibus-daemon --panel disable -r --xim Debian-+    1058  0.0  1.3 2453056 27196 tty1    Sl+  08:57   0:00 /usr/bin/gjs /usr/share/gnome-shell/org.gnome.ScreenSaver Debian-+    1069  0.0  0.4 234488  9252 tty1     Sl   08:57   0:00 /usr/libexec/ibus-dconf Debian-+    1070  1.9  1.6 344492 32496 tty1     Sl   08:57   0:00 /usr/libexec/ibus-extension-gtk3 Debian-+    1078  0.1  3.7 397600 74820 tty1     Sl   08:57   0:00 /usr/libexec/ibus-x11 --kill-daemon Debian-+    1083  0.0  0.4 234432  9536 tty1     Sl+  08:57   0:00 /usr/libexec/ibus-portal Debian-+    1096  0.0  0.3 160628  7148 tty1     Sl   08:57   0:00 /usr/libexec/ibus-engine-simple root        1100  0.2  0.5  18424 10960 ?        Ss   08:57   0:00 sshd: pablo [priv] pablo       1107  0.2  0.5  19528 11176 ?        Ss   08:57   0:00 /lib/systemd/systemd --user pablo       1109  0.0  0.1 104172  3524 ?        S    08:57   0:00 (sd-pam) pablo       1128  0.0  0.5  44692 11868 ?        Ssl  08:57   0:00 /usr/bin/pipewire pablo       1130  0.1  0.9 257736 19236 ?        Ssl  08:57   0:00 /usr/bin/wireplumber pablo       1136  0.0  0.4  26908  8760 ?        Ssl  08:57   0:00 /usr/bin/pipewire-pulse pablo       1143  0.0  0.3  18684  6636 ?        S    08:57   0:00 sshd: pablo@pts/0 pablo       1144  0.0  0.2   8464  4384 ?        Ss   08:57   0:00 /usr/bin/dbus-daemon --session --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only pablo       1150  0.0  0.4 237716  9904 ?        Ssl  08:57   0:00 /usr/libexec/gvfsd pablo       1162  0.0  0.3 380372  6612 ?        Sl   08:57   0:00 /usr/libexec/gvfsd-fuse /run/user/1000/gvfs -f pablo       1173  0.0  0.2   8444  4984 pts/0    Ss   08:57   0:00 -bash pablo       1178  0.6  3.8 634044 78296 ?        SNsl 08:57   0:00 /usr/libexec/tracker-miner-fs-3 pablo       1183  0.0  0.6 352128 13872 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-udisks2-volume-monitor pablo       1188  0.0  0.5 312632 10192 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-afc-volume-monitor pablo       1193  0.0  0.4 234488  8776 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-gphoto2-volume-monitor pablo       1197  0.0  0.4 233532  8664 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-mtp-volume-monitor pablo       1201  0.0  0.4 233728  8648 ?        Ssl  08:57   0:00 /usr/libexec/gvfs-goa-volume-monitor pablo       1205  0.0  2.1 598536 42432 ?        Sl   08:57   0:00 /usr/libexec/goa-daemon pablo       1212  0.0  0.5 312888 10976 ?        Sl   08:57   0:00 /usr/libexec/goa-identity-service pablo       1234  200  0.2  11348  4416 pts/0    R+   08:58   0:00 ps -aux            Servicios en ejecución.     pablo@forense:~$ systemctl list-units --type=service UNIT                               LOAD   ACTIVE SUB     DESCRIPTION                                    accounts-daemon.service            loaded active running Accounts Service alsa-restore.service               loaded active exited  Save/Restore Sound Card State apache2.service                    loaded active running The Apache HTTP Server apparmor.service                   loaded active exited  Load AppArmor profiles avahi-daemon.service               loaded active running Avahi mDNS/DNS-SD Stack colord.service                     loaded active running Manage, Install and Generate Color Profiles console-setup.service              loaded active exited  Set console font and keymap cron.service                       loaded active running Regular background program processing daemon cups-browsed.service               loaded active running Make remote CUPS printers available locally cups.service                       loaded active running CUPS Scheduler dbus.service                       loaded active running D-Bus System Message Bus gdm.service                        loaded active running GNOME Display Manager ifupdown-pre.service               loaded active exited  Helper to synchronize boot up for ifupdown keyboard-setup.service             loaded active exited  Set the console keyboard layout kmod-static-nodes.service          loaded active exited  Create List of Static Device Nodes low-memory-monitor.service         loaded active running Low Memory Monitor ModemManager.service               loaded active running Modem Manager networking.service                 loaded active exited  Raise network interfaces NetworkManager-wait-online.service loaded active exited  Network Manager Wait Online NetworkManager.service             loaded active running Network Manager nscd.service                       loaded active running Name Service Cache Daemon packagekit.service                 loaded active running PackageKit Daemon plymouth-quit-wait.service         loaded active exited  Hold until boot process finishes up plymouth-read-write.service        loaded active exited  Tell Plymouth To Write Out Runtime Data plymouth-start.service             loaded active exited  Show Plymouth Boot Screen polkit.service                     loaded active running Authorization Manager power-profiles-daemon.service      loaded active running Power Profiles daemon qemu-guest-agent.service           loaded active running QEMU Guest Agent rtkit-daemon.service               loaded active running RealtimeKit Scheduling Policy Service ssh.service                        loaded active running OpenBSD Secure Shell server switcheroo-control.service         loaded active running Switcheroo Control Proxy service systemd-binfmt.service             loaded active exited  Set Up Additional Binary Formats systemd-journal-flush.service      loaded active exited  Flush Journal to Persistent Storage systemd-journald.service           loaded active running Journal Service systemd-logind.service             loaded active running User Login Management systemd-modules-load.service       loaded active exited  Load Kernel Modules systemd-random-seed.service        loaded active exited  Load/Save Random Seed systemd-remount-fs.service         loaded active exited  Remount Root and Kernel File Systems systemd-sysctl.service             loaded active exited  Apply Kernel Variables systemd-sysusers.service           loaded active exited  Create System Users systemd-timesyncd.service          loaded active running Network Time Synchronization systemd-tmpfiles-setup-dev.service loaded active exited  Create Static Device Nodes in /dev systemd-tmpfiles-setup.service     loaded active exited  Create System Files and Directories systemd-udev-trigger.service       loaded active exited  Coldplug All udev Devices systemd-udevd.service              loaded active running Rule-based Manager for Device Events and Files systemd-update-utmp.service        loaded active exited  Record System Boot/Shutdown in UTMP systemd-user-sessions.service      loaded active exited  Permit User Sessions udisks2.service                    loaded active running Disk Manager upower.service                     loaded active running Daemon for power management user-runtime-dir@1000.service      loaded active exited  User Runtime Directory /run/user/1000 user-runtime-dir@112.service       loaded active exited  User Runtime Directory /run/user/112 user@1000.service                  loaded active running User Manager for UID 1000 user@112.service                   loaded active running User Manager for UID 112 wpa_supplicant.service             loaded active running WPA supplicant            Puertos abiertos.     pablo@forense:~$ sudo netstat -tulpn Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name     tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      595/cupsd            tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      618/sshd: /usr/sbin  tcp6       0      0 :::80                   :::*                    LISTEN      670/apache2          tcp6       0      0 :::22                   :::*                    LISTEN      618/sshd: /usr/sbin  tcp6       0      0 ::1:631                 :::*                    LISTEN      595/cupsd            udp        0      0 0.0.0.0:5353            0.0.0.0:*                           520/avahi-daemon: r  udp        0      0 0.0.0.0:46385           0.0.0.0:*                           520/avahi-daemon: r  udp6       0      0 :::5353                 :::*                                520/avahi-daemon: r  udp6       0      0 :::58253                :::*                                520/avahi-daemon: r            Conexiones establecidas por la máquina.     pablo@forense:~$ ss -ta State                      Recv-Q                  Send-Q                                     Local Address:Port                                      Peer Address:Port                   Process                   LISTEN                     0                       128                                            127.0.0.1:ipp                                            0.0.0.0:*                                                LISTEN                     0                       128                                              0.0.0.0:ssh                                            0.0.0.0:*                                                TIME-WAIT                  0                       0                                        192.168.122.134:55152                                   146.75.118.132:http                                             ESTAB                      0                       0                                        192.168.122.134:ssh                                      192.168.122.1:41756                                            LISTEN                     0                       511                                                    *:http                                                 *:*                                                LISTEN                     0                       128                                                 [::]:ssh                                               [::]:*                                                LISTEN                     0                       128                                                [::1]:ipp                                               [::]:*             Sesiones de usuario establecidas remotamente.     pablo@forense:~$ who -a         arranque del sistema 2025-02-14 08:57         `run-level' 5 2025-02-14 08:57 pablo    + pts/0        2025-02-14 08:57   .          1100 (192.168.122.1)         pts/1        2025-02-14 09:01              1295 id=ts/1  term=0 salida=0            Ficheros transferidos recientemente por NetBios.    No existe NetBios en Debian.        Contenido de la caché DNS.     pablo@forense:~$ sudo strings /var/cache/nscd/hosts localhost owave. localhost ip6-localhost ip6-loopback forense forense forense localhost localhost .net debian.map.fastlydns.net debian.map.fastlydns.net debian.map.fastlydns.net debian.map.fastlydns.net ipv4only.arpa ipv4only.arpa prod.remote-settings.prod.webservices.mozgcp.net firefox.settings.services.mozilla.com \"$6P&amp; ads-img.mozilla.org ads-img.mozilla.org muyinteresante.com www.muyinteresante.com theconversation.com theconversation.com pis. t0.gstatic.com t0.gstatic.com www.sleuthkit.org www.sleuthkit.org github.githubassets.com github.githubassets.com tic. avatars.githubusercontent.com avatars.githubusercontent.com user-images.githubusercontent.com user-images.githubusercontent.com objects.githubusercontent.com objects.githubusercontent.com firefox-api-proxy-prod.pocket.prod.cloudops.mozgcp.net firefox-api-proxy.cdn.mozilla.net debian.map.fastlydns.net debian.map.fastlydns.net debian.map.fastlydns.net debian.map.fastlydns.net github.com github.com cdn. t2.gstatic.com t2.gstatic.com t1.gstatic.com t1.gstatic.com cdn. sleuthkit.hosted-by-discourse.com sleuthkit.discourse.group t1.gstatic.com t1.gstatic.com cdn. sleuthkit.hosted-by-discourse.com sleuthkit.discourse.group t1.gstatic.com t1.gstatic.com cdn. sleuthkit.hosted-by-discourse.com sleuthkit.discourse.group sleuthkit.hosted-by-discourse.com sleuthkit.discourse.group t1.gstatic.com t1.gstatic.com cdn. ocsp.comodoca.com.cdn.cloudflare.net ocsp.sectigo.com wp.wpenginepowered.com www.autopsy.com aistati wp.wpenginepowered.com www.autopsy.com ....            Variables de entorno.     pablo@forense:~$ printenv SHELL=/bin/bash PWD=/home/pablo LOGNAME=pablo XDG_SESSION_TYPE=tty MOTD_SHOWN=pam HOME=/home/pablo LANG=es_ES.UTF-8 LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=00:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.avif=01;35:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.webp=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:*~=00;90:*#=00;90:*.bak=00;90:*.old=00;90:*.orig=00;90:*.part=00;90:*.rej=00;90:*.swp=00;90:*.tmp=00;90:*.dpkg-dist=00;90:*.dpkg-old=00;90:*.ucf-dist=00;90:*.ucf-new=00;90:*.ucf-old=00;90:*.rpmnew=00;90:*.rpmorig=00;90:*.rpmsave=00;90: SSH_CONNECTION=192.168.122.1 41756 192.168.122.134 22 XDG_SESSION_CLASS=user TERM=xterm-256color USER=pablo SHLVL=1 XDG_SESSION_ID=2 XDG_RUNTIME_DIR=/run/user/1000 SSH_CLIENT=192.168.122.1 41756 22 XDG_DATA_DIRS=/usr/share/gnome:/usr/local/share/:/usr/share/ PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus SSH_TTY=/dev/pts/0 _=/usr/bin/printenv            Dispositivos USB conectados     pablo@forense:~$ lsusb Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 001 Device 002: ID 0627:0001 Adomax Technology Co., Ltd QEMU Tablet Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub            Redes wifi utilizadas recientemente.    pablo@forense:~$ nmcli c show --activeNAME                UUID                                  TYPE      DEVICE Wired connection 1  8fcaf683-6d5c-4944-bd2f-5f9be35c0a36  ethernet  enp1s0 lo                  77238d91-b61a-41c7-8df5-b3b3e3fc8122  loopback  lo     pablo@forense:~$ nmcli c showNAME                UUID                                  TYPE      DEVICE Wired connection 1  8fcaf683-6d5c-4944-bd2f-5f9be35c0a36  ethernet  enp1s0 lo                  77238d91-b61a-41c7-8df5-b3b3e3fc8122  loopback  lo            Configuración del firewall de nodo.    pablo@forense:~$ sudo iptables -LChain INPUT (policy ACCEPT)target     prot opt source               destination         Chain FORWARD (policy ACCEPT)target     prot opt source               destination         Chain OUTPUT (policy ACCEPT)target     prot opt source               destination            Programas que se ejecutan en el Inicio.    pablo@forense:~$ systemctl list-unit-files --type=service | grep enabledaccounts-daemon.service                    enabled         enabledalsa-utils.service                         masked          enabledanacron.service                            enabled         enabledapache-htcacheclean.service                disabled        enabledapache-htcacheclean@.service               disabled        enabledapache2.service                            enabled         enabledapache2@.service                           disabled        enabledapparmor.service                           enabled         enabledavahi-daemon.service                       enabled         enabledbluetooth.service                          enabled         enabledconsole-setup.service                      enabled         enabledcron.service                               enabled         enabledcryptdisks-early.service                   masked          enabledcryptdisks.service                         masked          enabledcups-browsed.service                       enabled         enabledcups.service                               enabled         enablede2scrub_reap.service                       enabled         enabledgetty@.service                             enabled         enabledhwclock.service                            masked          enabledifupdown-wait-online.service               disabled        enabledkeyboard-setup.service                     enabled         enabledlow-memory-monitor.service                 enabled         enabledModemManager.service                       enabled         enablednetworking.service                         enabled         enabledNetworkManager-dispatcher.service          enabled         enabledNetworkManager-wait-online.service         enabled         enabledNetworkManager.service                     enabled         enablednftables.service                           disabled        enablednscd.service                               enabled         enabledpower-profiles-daemon.service              enabled         enabledrc.service                                 masked          enabledrcS.service                                masked          enabledrtkit-daemon.service                       disabled        enabledsaned.service                              masked          enabledsaned@.service                             indirect        enabledserial-getty@.service                      disabled        enabledspeech-dispatcherd.service                 disabled        enabledssh.service                                enabled         enabledsudo.service                               masked          enabledswitcheroo-control.service                 enabled         enabledsystemd-fsck-root.service                  enabled-runtime enabledsystemd-network-generator.service          disabled        enabledsystemd-networkd-wait-online@.service      disabled        enabledsystemd-networkd.service                   disabled        enabledsystemd-pstore.service                     enabled         enabledsystemd-remount-fs.service                 enabled-runtime enabledsystemd-sysext.service                     disabled        enabledsystemd-timesyncd.service                  enabled         enabledudisks2.service                            enabled         enabledupower.service                             disabled        enabledwpa_supplicant-nl80211@.service            disabled        enabledwpa_supplicant-wired@.service              disabled        enabledwpa_supplicant.service                     enabled         enabledwpa_supplicant@.service                    disabled        enabledx11-common.service                         masked          enabled            Asociación de extensiones de ficheros y aplicaciones.    pablo@forense:~$ cat /usr/share/applications/mimeinfo.cache[MIME Cache]application/bzip2=org.gnome.FileRoller.desktop;org.gnome.Nautilus.desktop;application/clarisworks=libreoffice-calc.desktop;libreoffice-draw.desktop;libreoffice-writer.desktop;application/csv=libreoffice-calc.desktop;application/excel=libreoffice-calc.desktop;application/gpx+xml=org.gnome.Maps.desktop;application/gzip=org.gnome.FileRoller.desktop;org.gnome.Nautilus.desktop;application/illustrator=org.gnome.Evince.desktop;application/macwriteii=libreoffice-writer.desktop;application/mathml+xml=libreoffice-math.desktop;application/mbox=org.gnome.Evolution.desktop;application/msexcel=libreoffice-calc.desktop;application/mspowerpoint=libreoffice-impress.desktop;application/msword=libreoffice-writer.desktop;application/mxf=org.gnome.Totem.desktop;application/ogg=org.gnome.Rhythmbox3.desktop;application/oxps=org.gnome.Evince.desktop;application/pdf=libreoffice-draw.desktop;org.gnome.Evince.desktop;application/pgp-keys=org.gnome.seahorse.Application.desktop;application/pkcs10=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkcs10+pem=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkcs12=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkcs12+pem=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkcs7-mime=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkcs7-mime+pem=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkcs8=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkcs8+pem=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkix-cert=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkix-cert+pem=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkix-crl=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/pkix-crl+pem=gcr-viewer.desktop;org.gnome.seahorse.Application.desktop;application/postscript=org.gnome.Evince.desktop;application/prs.plucker=libreoffice-writer.desktop;application/ram=org.gnome.Totem.desktop;application/rdf+xml=firefox-esr.desktop;application/rss+xml=firefox-esr.desktop;application/rtf=libreoffice-writer.desktop;application/sdp=org.gnome.Totem.desktop;application/smil=org.gnome.Totem.desktop;application/smil+xml=org.gnome.Totem.desktop;application/tab-separated-values=libreoffice-calc.desktop;application/vnd.android.package-archive=org.gnome.FileRoller.desktop;application/vnd.apple.mpegurl=org.gnome.Totem.desktop;application/vnd.comicbook+zip=org.gnome.Evince.desktop;application/vnd.comicbook-rar=org.gnome.Evince.desktop;application/vnd.corel-draw=libreoffice-draw.desktop;application/vnd.debian.binary-package=org.gnome.FileRoller.desktop;application/vnd.flatpak=gnome-software-local-file-flatpak.desktop;application/vnd.flatpak.ref=gnome-software-local-file-flatpak.desktop;application/vnd.flatpak.repo=gnome-software-local-file-flatpak.desktop;application/vnd.geo+json=org.gnome.Maps.desktop;application/vnd.google-earth.kml+xml=org.gnome.Maps.desktop;application/vnd.iccprofile=gcm-import.desktop;application/vnd.lotus-1-2-3=libreoffice-calc.desktop;application/vnd.lotus-wordpro=libreoffice-writer.desktop;application/vnd.mozilla.xul+xml=firefox-esr.desktop;application/vnd.ms-asf=org.gnome.Totem.desktop;application/vnd.ms-cab-compressed=gnome-software-local-file-fwupd.desktop;org.gnome.FileRoller.desktop;application/vnd.ms-excel=libreoffice-calc.desktop;application/vnd.ms-excel.sheet.binary.macroEnabled.12=libreoffice-calc.desktop;application/vnd.ms-excel.sheet.macroEnabled.12=libreoffice-calc.desktop;application/vnd.ms-excel.template.macroEnabled.12=libreoffice-calc.desktop;application/vnd.ms-powerpoint=libreoffice-impress.desktop;application/vnd.ms-powerpoint.presentation.macroEnabled.12=libreoffice-impress.desktop;application/vnd.ms-powerpoint.slideshow.macroEnabled.12=libreoffice-impress.desktop;application/vnd.ms-powerpoint.template.macroEnabled.12=libreoffice-impress.desktop;application/vnd.ms-publisher=libreoffice-draw.desktop;application/vnd.ms-word=libreoffice-writer.desktop;application/vnd.ms-word.document.macroEnabled.12=libreoffice-writer.desktop;application/vnd.ms-word.template.macroEnabled.12=libreoffice-writer.desktop;application/vnd.ms-works=libreoffice-calc.desktop;libreoffice-writer.desktop;application/vnd.ms-wpl=org.gnome.Totem.desktop;.....            Aplicaciones usadas recientemente.    pablo@forense:~$ history | awk '{print $2}' | sort | uniq -c | sort -nr | head    89 sudo    25 clear    19 ls    14 cd    6 dpkg    5 ss    5 export    4 java            Ficheros abiertos recientemente.    pablo@forense:~$ sudo lsof....lsof      1427                            root  cwd       DIR              254,1      4096     265581 /home/pablolsof      1427                            root  rtd       DIR              254,1      4096          2 /lsof      1427                            root  txt       REG              254,1    179824     803700 /usr/bin/lsoflsof      1427                            root  mem       REG              254,1   3048800     797691 /usr/lib/locale/locale-archivelsof      1427                            root  mem       REG              254,1     60328     784887 /usr/lib/x86_64-linux-gnu/libresolv.so.2lsof      1427                            root  mem       REG              254,1     22448     788949 /usr/lib/x86_64-linux-gnu/libkeyutils.so.1.10lsof      1427                            root  mem       REG              254,1     52224     788939 /usr/lib/x86_64-linux-gnu/libkrb5support.so.0.1lsof      1427                            root  mem       REG              254,1     18344     785052 /usr/lib/x86_64-linux-gnu/libcom_err.so.2.1lsof      1427                            root  mem       REG              254,1    183048     788944 /usr/lib/x86_64-linux-gnu/libk5crypto.so.3.1lsof      1427                            root  mem       REG              254,1    888080     788962 /usr/lib/x86_64-linux-gnu/libkrb5.so.3.3lsof      1427                            root  mem       REG              254,1    629384     783985 /usr/lib/x86_64-linux-gnu/libpcre2-8.so.0.11.2lsof      1427                            root  mem       REG              254,1    338680     790065 /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2.2lsof      1427                            root  mem       REG              254,1   1922136     784696 /usr/lib/x86_64-linux-gnu/libc.so.6lsof      1427                            root  mem       REG              254,1    174312     785595 /usr/lib/x86_64-linux-gnu/libselinux.so.1lsof      1427                            root  mem       REG              254,1    186832     791056 /usr/lib/x86_64-linux-gnu/libtirpc.so.3.0.0lsof      1427                            root  mem       REG              254,1    210904     784693 /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2lsof      1427                            root    4r     FIFO               0,13       0t0      23231 pipelsof      1427                            root    7w     FIFO               0,13       0t0      23232 pipe            Software Instalado.    pablo@forense:~$ sudo dpkg -l||/ Nombre                                  Versión                             Arquitectura Descripción+++-=======================================-===================================-============-================================================================================ii  accountsservice                         22.08.8-6                           amd64        query and manipulate user account informationii  acl                                     2.3.1-3                             amd64        access control list - utilitiesii  adduser                                 3.134                               all          add and remove users and groupsii  adwaita-icon-theme                      43-1                                all          default icon theme of GNOMEii  afflib-tools                            3.7.20-1                            amd64        Advanced Forensics Format Library (utilities)ii  aisleriot                               1:3.22.23-1                         amd64        GNOME solitaire card game collectionii  alsa-topology-conf                      1.2.5.1-2                           all          ALSA topology configuration filesii  alsa-ucm-conf                           1.2.8-1                             all          ALSA Use Case Manager configuration filesii  alsa-utils                              1.2.8-1                             amd64        Utilities for configuring and using ALSAii  amd64-microcode                         3.20240820.1~deb12u1                amd64        Platform firmware and microcode for AMD CPUs and SoCsii  anacron                                 2.3-36                              amd64        cron-like program that doesn't go by timeii  ant                                     1.10.13-1                           all          Java based build tool like makeii  ant-optional                            1.10.13-1                           all          Java based build tool like make - optional librariesii  apache2                                 2.4.62-1~deb12u2                    amd64        Apache HTTP Serverii  apache2-bin                             2.4.62-1~deb12u2                    amd64        Apache HTTP Server (modules and other binary files)ii  apache2-data                            2.4.62-1~deb12u2                    all          Apache HTTP Server (common files)ii  apache2-utils                           2.4.62-1~deb12u2                    amd64        Apache HTTP Server (utility programs for web servers)ii  apg                                     2.2.3.dfsg.1-5+b2                   amd64        Automated Password Generator - Standalone versionii  apparmor                                3.0.8-3                             amd64        user-space parser utility for AppArmorii  appstream                               0.16.1-2                            amd64        Software component metadata managementii  apt                                     2.6.1                               amd64        commandline package managerii  apt-config-icons                        0.16.1-2                            all          APT configuration snippet to enable icon downloadsii  apt-listchanges                         3.24                                all          package change history notification toolii  apt-utils                               2.6.1                               amd64        package management related utility programsii  aspell                                  0.60.8-4+b1                         amd64        GNU Aspell spell-checkerii  aspell-es                               1.11-20                             all          Spanish dictionary for aspellii  at-spi2-common                          2.46.0-5                            all          Assistive Technology Service Provider Interface (common files)ii  at-spi2-core                            2.46.0-5                            amd64        Assistive Technology Service Provider Interface (D-Bus core)ii  avahi-daemon                            0.8-10+deb12u1                      amd64        Avahi mDNS/DNS-SD daemonii  baobab                                  43.0-1                              amd64        GNOME disk usage analyzerii  base-files                              12.4+deb12u9                        amd64        Debian base system miscellaneous filesii  base-passwd                             3.6.1                               amd64        Debian base system master password and group filesii  bash                                    5.2.15-2+b7                         amd64        GNU Bourne Again SHell            Contraseñas guardadas.    pablo@forense:~$ sudo cat /etc/shadowroot:$y$j9T$Chb8fAS.YcHKcL5R1.UuL.$QghyEAV6vIH9ovW9AA4zYnAfNCg/I1wcDK6Fi0CFCEA:20132:0:99999:7:::daemon:*:20132:0:99999:7:::bin:*:20132:0:99999:7:::sys:*:20132:0:99999:7:::sync:*:20132:0:99999:7:::games:*:20132:0:99999:7:::man:*:20132:0:99999:7:::lp:*:20132:0:99999:7:::mail:*:20132:0:99999:7:::news:*:20132:0:99999:7:::uucp:*:20132:0:99999:7:::proxy:*:20132:0:99999:7:::www-data:*:20132:0:99999:7:::backup:*:20132:0:99999:7:::list:*:20132:0:99999:7:::irc:*:20132:0:99999:7:::_apt:*:20132:0:99999:7:::nobody:*:20132:0:99999:7:::systemd-network:!*:20132::::::tss:!:20132::::::systemd-timesync:!*:20132::::::messagebus:!:20132::::::usbmux:!:20132::::::sshd:!:20132::::::dnsmasq:!:20132::::::avahi:!:20132::::::speech-dispatcher:!:20132::::::fwupd-refresh:!:20132::::::saned:!:20132::::::geoclue:!:20132::::::polkitd:!*:20132::::::rtkit:!:20132::::::colord:!:20132::::::gnome-initial-setup:!:20132::::::Debian-gdm:!:20132::::::pablo:$y$j9T$G.NSU/fZ4YKOk5oWQV5un.$YPw9I3pAIA1fqI8jiVZYfum1UYHDtx.QKDQWz7ZKjn3:20132:0:99999:7:::            Cuentas de Usuario    pablo@forense:~$ sudo cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin_apt:x:42:65534::/nonexistent:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:998:998:systemd Network Management:/:/usr/sbin/nologintss:x:100:107:TPM software stack,,,:/var/lib/tpm:/bin/falsesystemd-timesync:x:997:997:systemd Time Synchronization:/:/usr/sbin/nologinmessagebus:x:101:108::/nonexistent:/usr/sbin/nologinusbmux:x:102:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologinsshd:x:103:65534::/run/sshd:/usr/sbin/nologindnsmasq:x:999:65534:dnsmasq:/var/lib/misc:/usr/sbin/nologinavahi:x:104:112:Avahi mDNS daemon,,,:/run/avahi-daemon:/usr/sbin/nologinspeech-dispatcher:x:105:29:Speech Dispatcher,,,:/run/speech-dispatcher:/bin/falsefwupd-refresh:x:106:115:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologinsaned:x:107:117::/var/lib/saned:/usr/sbin/nologingeoclue:x:108:118::/var/lib/geoclue:/usr/sbin/nologinpolkitd:x:996:996:polkit:/nonexistent:/usr/sbin/nologinrtkit:x:109:119:RealtimeKit,,,:/proc:/usr/sbin/nologincolord:x:110:120:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologingnome-initial-setup:x:111:65534::/run/gnome-initial-setup/:/bin/falseDebian-gdm:x:112:121:Gnome Display Manager:/var/lib/gdm3:/bin/falsepablo:x:1000:1000:pablo,,,:/home/pablo:/bin/bash            Historial de navegación y descargas. Cookies.        Volúmenes cifrados    pablo@forense:~$ sudo find / -type f -name \"*.gpg\"/usr/share/gnupg/distsigkey.gpg/usr/share/keyrings/debian-archive-bullseye-automatic.gpg/usr/share/keyrings/debian-archive-bookworm-security-automatic.gpg/usr/share/keyrings/debian-archive-bookworm-stable.gpg/usr/share/keyrings/debian-archive-bullseye-security-automatic.gpg/usr/share/keyrings/debian-archive-removed-keys.gpg/usr/share/keyrings/debian-archive-keyring.gpg/usr/share/keyrings/debian-archive-buster-stable.gpg/usr/share/keyrings/debian-archive-bullseye-stable.gpg/usr/share/keyrings/debian-archive-buster-security-automatic.gpg/usr/share/keyrings/debian-archive-bookworm-automatic.gpg/usr/share/keyrings/debian-archive-buster-automatic.gpgfind: ‘/run/user/1000/gvfs’: Permiso denegadofind: ‘/run/user/112/gvfs’: Permiso denegado/var/lib/fwupd/gnupg/trustdb.gpg/home/pablo/.gnupg/trustdb.gpg            Archivos con extensión cambiada.        Archivos eliminados.        Archivos Ocultos.        Archivos que contienen una cadena determinada.        Búsqueda de imágenes por ubicación.        Búsqueda de archivos por autor.  "
  },
  
  {
    "title": "Configuración/activación de SELinux",
    "url": "/posts/selinux/",
    "categories": "Sistemas, SELinux",
    "tags": "SELinux",
    "date": "2025-01-29 20:00:00 +0100",
    





    
    "snippet": "Hoy nos adentramos en la configuración de un servidor basado en Rocky Linux con SELinux activado en modo enforcing. Nuestro objetivo es asegurar que los servicios SSHFS, Samba y NFS funcionen corre...",
    "content": "Hoy nos adentramos en la configuración de un servidor basado en Rocky Linux con SELinux activado en modo enforcing. Nuestro objetivo es asegurar que los servicios SSHFS, Samba y NFS funcionen correctamente bajo una configuración estricta y segura de SELinux. Además, habilitaremos el inicio de sesión remoto como root y cambiaremos el puerto de acceso SSH por uno no habitual.Preparación del entornoAntes de empezar, verificamos el estado de SELinux para asegurarnos de que está activado y en modo enforcing:[rocky@rocky ~]$ sestatus SELinux status:                 enabledSELinuxfs mount:                /sys/fs/selinuxSELinux root directory:         /etc/selinuxLoaded policy name:             targetedCurrent mode:                   enforcingMode from config file:          enforcingPolicy MLS status:              enabledPolicy deny_unknown status:     allowedMemory protection checking:     actual (secure)Max kernel policy version:      33Perfecto, SELinux está activado y en modo enforcing. Ahora actualizamos el sistema e instalamos los paquetes necesarios:[rocky@rocky ~]$ sudo dnf update -y[rocky@rocky ~]$ sudo dnf install samba samba-common samba-client nfs-utils -yPara la instalación de sshfs debemos disponer del repositorio EPEL, por lo que primero hay que instalarlo:[rocky@rocky ~]$ sudo dnf install -y epel-releaseUna vez habilitado el repositorio, ya podemos instalar SSHFS con:[rocky@rocky ~]$ sudo dnf install -y fuse fuse-sshfsIMPORTANTE: en OpenStack debemos asignar a las máquina un sabor m1.medium como mínimo, pues de lo contrario la máquina se quedará pillada y tendremos que destruirla.SSHFSConfiguración del servidor SSHPrimero, necesitamos asegurarnos de que nuestro servidor SSH esté configurado correctamente para permitir conexiones desde el cliente. En nuestro caso, decidimos cambiar el puerto predeterminado de SSH (22) al puerto 2222 por razones de seguridad. Para ello, editamos el archivo de configuración de SSH en /etc/ssh/sshd_config:Port 2222PermitRootLogin yesPubkeyAuthentication yesEstas líneas indican que:      SSH escuchará en el puerto 2222.        Permitiremos el inicio de sesión como root.        Habilitaremos la autenticación mediante claves públicas.  Después de realizar estos cambios, reiniciamos el servicio SSH para que los cambios surtan efecto:[rocky@rocky ~]$ sudo systemctl restart sshd[rocky@rocky ~]$ sudo systemctl status sshd● sshd.service - OpenSSH server daemon     Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled; preset: enabled)     Active: active (running) since Sat 2025-02-08 12:01:35 UTC; 5min ago       Docs: man:sshd(8)             man:sshd_config(5)   Main PID: 14817 (sshd)      Tasks: 1 (limit: 10890)     Memory: 3.4M        CPU: 151ms     CGroup: /system.slice/sshd.service             └─14817 \"sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups\"También necesitamos asegurarnos de que el firewall permita conexiones en el puerto 2222:[rocky@rocky ~]$ sudo firewall-cmd --permanent --add-port=2222/tcpsuccess[rocky@rocky ~]$ sudo firewall-cmd --reloadsuccessAdemás, utilizamos semanage para agregar el puerto 2222 al contexto de seguridad de SSH:[rocky@rocky ~]$ sudo semanage port -a -t ssh_port_t -p tcp 2222[rocky@rocky ~]$ sudo semanage port -l | grep sshssh_port_t                     tcp      2222, 22Configuración de SELinux para SSHFSEn nuestro servidor, SELinux estaba habilitado, por lo que necesitamos ajustar algunas políticas para permitir el uso de SSHFS. Utilizamos los siguientes comandos para habilitar las opciones necesarias:[rocky@rocky ~]$ sudo setsebool -P use_fusefs_home_dirs on[rocky@rocky ~]$ sudo setsebool -P virt_use_fusefs onPara verificar que los cambios se aplicaron correctamente, ejecutamos:[rocky@rocky ~]$ getsebool -a | grep fuseftpd_use_fusefs --&gt; offglance_use_fusefs --&gt; offhttpd_use_fusefs --&gt; offlogrotate_use_fusefs --&gt; offmailman_use_fusefs --&gt; offrpcd_use_fusefs --&gt; offsamba_share_fusefs --&gt; offsanlock_use_fusefs --&gt; offuse_fusefs_home_dirs --&gt; onvirt_sandbox_use_fusefs --&gt; offvirt_use_fusefs --&gt; onY confirmamos que use_fusefs_home_dirs y virt_use_fusefs están habilitados.Configuración de claves SSHPara facilitar la conexión sin necesidad de introducir contraseñas cada vez, configuramos la autenticación mediante claves SSH. Añadimos la clave pública del cliente al archivo authorized_keys del usuario root en el servidor:[rocky@rocky ~]$ sudo cat /root/.ssh/authorized_keysno-port-forwarding,no-agent-forwarding,no-X11-forwarding,command=\"echo 'Please login as the user \\\"rocky\\\" rather than the user \\\"root\\\".';echo;sleep 10;exit 142\" ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQClFcnIhYd1oaEpvGi/f4psQc4+DaAZvSNIxVRRJHtRoJui8wbJybi3Om8yTOflgEcmBaUrJLkfmzmWqVq1j6MpESq72p7J2hdq2lXnvzdt3huYv5evFwyd0p/r72RfpVZzr3ILi/BS//SJqfVKlDEVbZRaOE5MU2XuElmFFY4EO7NiiZAkbatVqUOT8H/nrfXcad0mjZVxroVqHhsHV+06rxiB0xifG0xZv204Qj4zRura8uqZlEVAAwU+NO/SIGdRwpLY7n7xbQGe1DbjHgPUeVPjJX6HpMK41a43eGj4XYdYtZBLugaU8Mq1y6Kl3tE6cvYkQ9WFTYTLLNy3bvNRZpP2p6qAy5qn03ZLFICiXBNXPmrl5+KVrKaSipNaPHkmInvczbYJjXpfyVBsfEabt+0Y1629M+eEKkkl+iZmVr2ySDSS1gHxMC7zlJRaUhG27o26agpNPYPHH3mVXVjqdGg0ryH0YHZk1V8+Gt1Z9hZ7UYWE1UX8DCgFfecqdX0= pavlo@debianssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwTo+Y3zoaYeUIZu5qcDG8HPyTWszbRc6Hx25+Zm9r1YhmMA/amVLUjldhC5N48/7vryBDpVqV+NaAKjXrYqUJjym2SJxDJlUU1etrtAJ4f8aLtCOzF2HZihv/szRFl/x72F0sb+NHQJsMISERJJ4uWJlsw10O1vo2E8+6JKYMgKTbzVrgun1MyAgXQTY73+wYkbhhgXtF9s3+L1p8HffsaaSSXOgcJRL2RxoZ/2yciVpk5Jo2fsy+z+aXjKglQqZmOUkbamcQ14Hr6Ol+JfY8H0qQNVMJCG3ZgWuoe2sqDoDd17QMoNg/vklmScgS3k/iTvgRD2zMZbUqNXHFQXbzbRUUP87OUJvuVx2vRzV3XsbSP8ZAP+bM91tIZHnZ0G8p32UM75EnrSbog+ZcYT/2SUoXgNENI4X8YcNNts73OKWEU04sNbxayJIBKcMoqa/NJifn2kSIOKyNFqoaT6wH9Tlyg3tixE/ngRSH5WN7REWw3bF8gVkYxNY3Rus9iDs= rocky@cliente-rocky.novalocalEste archivo contiene las claves públicas de los clientes que pueden conectarse al servidor. En nuestro caso, añadimos la clave del usuario rocky desde el cliente.Creación del directorio compartidoEn el servidor, creamos un directorio que queremos compartir con el cliente:[rocky@rocky ~]$ sudo mkdir compartir[rocky@rocky ~]$ sudo chown rocky:rocky compartir/Dentro de este directorio, colocamos un archivo de prueba para verificar que todo funciona correctamente:[rocky@rocky ~]$ sudo cat compartir/kk.txt Buenas tardes por la mañanaMontaje del directorio remoto en el clienteAhora, desde el cliente, procedemos a montar el directorio remoto utilizando SSHFS. Primero, creamos un directorio donde montaremos el directorio remoto:[rocky@cliente-rocky ~]$ mkdir montajeLuego, utilizamos el comando sshfs para montar el directorio remoto:[rocky@cliente-rocky ~]$ sshfs -p 2222 root@10.0.0.25:/home/rocky/compartir montaje/Este comando indica que queremos montar el directorio /home/rocky/compartir del servidor 10.0.0.25 en el directorio montaje de nuestro cliente, utilizando el puerto 2222.Para verificar que el montaje se realizó correctamente, ejecutamos:[rocky@cliente-rocky ~]$ df -hFilesystem                            Size  Used Avail Use% Mounted ondevtmpfs                              4.0M     0  4.0M   0% /devtmpfs                                 888M     0  888M   0% /dev/shmtmpfs                                 355M  532K  355M   1% /run/dev/vda4                              19G  1.2G   18G   7% //dev/vda3                             936M  257M  680M  28% /boot/dev/vda2                             100M  7.0M   93M   8% /boot/efitmpfs                                 178M     0  178M   0% /run/user/1000root@10.0.0.25:/home/rocky/compartir   19G  1.2G   18G   7% /home/rocky/montajeY confirmamos que el sistema de archivos remoto aparece en la lista de sistemas de archivos montados.Finalmente, accedemos al archivo de prueba que creamos en el servidor:[rocky@cliente-rocky ~]$ lsmontaje[rocky@cliente-rocky ~]$ cat montaje/kk.txt Buenas tardes por la mañanaSAMBASamba es un servicio crítico para compartir archivos en redes mixtas (Linux/Windows). Vamos a configurarlo paso a paso.Antes de realizar cambios, es una buena práctica hacer una copia de seguridad del archivo de configuración original:[rocky@rocky ~]$ sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backupVamos a crear un directorio que será compartido a través de Samba. En este ejemplo, usaremos /mnt/samba/share:[rocky@rocky ~]$ sudo mkdir -p /mnt/samba/shareAseguramos que los permisos y la propiedad del directorio sean correctos:[rocky@rocky ~]$ sudo chmod -R 0755 /mnt/samba/share/[rocky@rocky ~]$ sudo chown -R rocky:rocky /mnt/samba/share/SELinux utiliza contextos de seguridad para controlar el acceso a los recursos. Para que Samba pueda acceder al directorio compartido, debemos asignar el contexto correcto:[rocky@rocky ~]$ sudo chcon -t samba_share_t /mnt/samba/share/Aquí, chcon cambia el contexto de seguridad de SELinux para que el directorio sea accesible por Samba.Editamos el archivo de configuración de Samba (/etc/samba/smb.conf) para definir nuestro recurso compartido. Añadimos la siguiente sección al final del archivo:[Anonymous]path = /mnt/samba/sharebrowsable = yeswritable = yesguest ok = yesread only = novalid users = rocky      path: Especifica la ruta del directorio compartido.        browsable: Permite que el recurso sea visible en la red.        writable: Permite la escritura en el recurso.        guest ok: Permite el acceso a usuarios invitados.        read only: Define si el recurso es de solo lectura.        valid users: Especifica los usuarios permitidos para acceder al recurso.  Y para realizar la comprobación de que la configuración es correcta ejecutamos el siguiente comando:[rocky@rocky ~]$ testparmLoad smb config files from /etc/samba/smb.confLoaded services file OK.Weak crypto is allowed by GnuTLS (e.g. NTLM as a compatibility fallback)Server role: ROLE_STANDALONEPress enter to see a dump of your service definitions# Global parameters[global]\tprintcap name = cups\tsecurity = USER\tworkgroup = SAMBA\tidmap config * : backend = tdb\tcups options = raw[homes]\tbrowseable = No\tcomment = Home Directories\tinherit acls = Yes\tread only = No\tvalid users = %S %D%w%S[printers]\tbrowseable = No\tcomment = All Printers\tcreate mask = 0600\tpath = /var/tmp\tprintable = Yes[print$]\tcomment = Printer Drivers\tcreate mask = 0664\tdirectory mask = 0775\tforce group = @printadmin\tpath = /var/lib/samba/drivers\twrite list = @printadmin root[Anonymous]\tguest ok = Yes\tpath = /mnt/samba/share\tread only = No\tvalid users = rockyEste comando valida la sintaxis del archivo smb.conf y muestra un resumen de la configuración.Permitimos el tráfico de Samba a través del firewall:[rocky@rocky ~]$ sudo firewall-cmd --add-service=samba --zone=public --permanentsuccess[rocky@rocky ~]$ sudo firewall-cmd --reloadsuccessIniciamos y habilitamos los servicios de Samba (smb y nmb):[rocky@rocky ~]$ sudo systemctl start smb[rocky@rocky ~]$ sudo systemctl enable smbCreated symlink /etc/systemd/system/multi-user.target.wants/smb.service → /usr/lib/systemd/system/smb.service.[rocky@rocky ~]$ sudo systemctl start nmb[rocky@rocky ~]$ sudo systemctl enable nmbCreated symlink /etc/systemd/system/multi-user.target.wants/nmb.service → /usr/lib/systemd/system/nmb.service.Añadimos un usuario de Samba y establecemos una contraseña:[rocky@rocky ~]$ sudo smbpasswd -a rockyNew SMB password:Retype new SMB password:Added user rocky.Este comando añade al usuario rocky a la base de datos de Samba y solicita una contraseña.Prueba de funcionamiento desde el clientePara verificar que todo funciona correctamente, realizamos pruebas de acceso desde un cliente.Primero debemos instalar el paquete samba-client:[rocky@cliente-rocky ~]$ sudo dnf install samba-client -yListamos los recursos compartidos en el servidor:[rocky@cliente-rocky ~]$ smbclient --user=rocky -L //10.0.0.175Password for [SAMBA\\rocky]:\tSharename       Type      Comment\t---------       ----      -------\tprint$          Disk      Printer Drivers\tAnonymous       Disk      \tIPC$            IPC       IPC Service (Samba 4.20.2)\trocky           Disk      Home DirectoriesSMB1 disabled -- no workgroup availableEsto mostrará los recursos compartidos disponibles.Montamos el recurso compartido en el cliente:[rocky@cliente-rocky ~]$ sudo mount -t cifs -o username=rocky,password=messi,rw,vers=2.1,file_mode=0777,dir_mode=0777 //10.0.0.175/Anonymous /home/rocky/montaje/Aquí, username y password son las credenciales del usuario de Samba, y //10.0.0.175/Anonymous es la ruta del recurso compartido.Por último, verificamos que el recurso se ha montado correctamente:rocky@cliente-rocky ~]$ df -hFilesystem              Size  Used Avail Use% Mounted ondevtmpfs                4.0M     0  4.0M   0% /devtmpfs                   385M     0  385M   0% /dev/shmtmpfs                   154M  532K  154M   1% /run/dev/vda4               8.9G  1.1G  7.8G  13% //dev/vda3               936M  257M  680M  28% /boot/dev/vda2               100M  7.0M   93M   8% /boot/efitmpfs                    77M     0   77M   0% /run/user/1000//10.0.0.175/Anonymous  8.9G  1.3G  7.7G  14% /home/rocky/montajeY como vemos el recurso compartido está en la lista de sistemas de archivos montados.NFSInstalación y Configuración del Servidor NFSLo primero que debemos hacer en el servidor Rocky Linux es asegurarnos de que el servicio NFS está habilitado. Para ello, ejecutamos:[rocky@rocky ~]$ sudo systemctl start nfs-server.service[rocky@rocky ~]$ sudo systemctl enable nfs-server.serviceCreated symlink /etc/systemd/system/multi-user.target.wants/nfs-server.service → /usr/lib/systemd/system/nfs-server.service.Ahora, creamos el directorio que vamos a compartir mediante NFS:[rocky@rocky ~]$ sudo mkdir -p /mnt/nfs/kkEste será el punto de montaje donde guardaremos los archivos que estarán disponibles para los clientes NFS.A continuación, debemos definir las reglas de exportación en el archivo /etc/exports, que indica qué directorios se comparten y con qué permisos. Lo editamos y agregamos la siguiente línea:[rocky@rocky ~]$ sudo nano /etc/exports[rocky@rocky ~]$ cat /etc/exports/mnt/nfs/kk  10.0.0.0/24(rw,sync,no_all_squash,no_root_squash)Esto significa que estamos compartiendo el directorio /mnt/nfs/kk con la red 10.0.0.0/24, permitiendo lectura y escritura (rw), asegurando que las escrituras se realicen de forma sincronizada (sync), y permitiendo que el usuario root del cliente actúe como root en el servidor (no_root_squash).Aplicamos la configuración ejecutando:[rocky@rocky ~]$ sudo exportfs -arvexporting 10.0.0.0/24:/mnt/nfs/kkY verificamos que el directorio esté efectivamente exportado:[rocky@rocky ~]$ sudo exportfs -s/mnt/nfs/kk  10.0.0.0/24(sync,wdelay,hide,no_subtree_check,sec=sys,rw,secure,no_root_squash,no_all_squash)Si todo está correcto, deberíamos ver una salida que confirma que el directorio /mnt/nfs/kk está compartido con la red 10.0.0.0/24.Configuración del FirewallPara que el servidor NFS pueda comunicarse con los clientes, necesitamos permitir el tráfico necesario a través del firewall. Instalamos y configuramos firewalld:[rocky@rocky ~]$ sudo dnf install firewalld -y[rocky@rocky ~]$ sudo systemctl start firewalld[rocky@rocky ~]$ sudo systemctl enable firewalld[rocky@rocky ~]$ sudo systemctl status firewalld● firewalld.service - firewalld - dynamic firewall daemon     Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; preset: enabled)     Active: active (running) since Thu 2025-02-06 19:26:09 UTC; 6s ago       Docs: man:firewalld(1)   Main PID: 34890 (firewalld)      Tasks: 2 (limit: 4450)     Memory: 26.7M        CPU: 471ms     CGroup: /system.slice/firewalld.service             └─34890 /usr/bin/python3 -s /usr/sbin/firewalld --nofork --nopidFeb 06 19:26:09 rocky.novalocal systemd[1]: Starting firewalld - dynamic firewall daemon...Feb 06 19:26:09 rocky.novalocal systemd[1]: Started firewalld - dynamic firewall daemon.Habilitamos los servicios requeridos para NFS:[rocky@rocky ~]$ sudo firewall-cmd --permanent --add-service=nfssuccess[rocky@rocky ~]$ sudo firewall-cmd --permanent --add-service=rpc-bindsuccess[rocky@rocky ~]$ sudo firewall-cmd --permanent --add-service=mountdsuccess[rocky@rocky ~]$ sudo firewall-cmd --reloadsuccessCon esto, hemos asegurado que el tráfico necesario para NFS pueda pasar sin problemas.Configuración del Cliente NFSAhora pasamos al cliente, que también es una máquina Rocky Linux. En primer lugar, instalamos los paquetes necesarios:[rocky@cliente-rocky ~]$ sudo dnf install nfs-utils nfs4-acl-toolsVerificamos que el servidor está compartiendo correctamente el directorio usando el comando showmount:[rocky@cliente-rocky ~]$ showmount -e 10.0.0.175Export list for 10.0.0.175:/mnt/nfs/kk 10.0.0.0/24Si todo está en orden, veremos la exportación del directorio /mnt/nfs/kk para la red 10.0.0.0/24.Desde el servidor, creamos un archivo en el directorio compartido y verificamos sus permisos:[rocky@rocky ~]$ echo 'Hola desde el servidor' | sudo tee /mnt/nfs/kk/hola.txtHola desde el servidor[rocky@rocky ~]$ ls -l /mnt/nfs/kk/hola.txt -rw-r--r--. 1 root root 22 Feb  6 19:37 /mnt/nfs/kk/hola.txtDesde el cliente, comprobamos que el archivo también está disponible en el punto de montaje /mnt/nfs:[rocky@cliente-rocky ~]$ ls -l /mnt/nfs/hola.txt -rw-r--r--. 1 root root 22 Feb  6 19:37 /mnt/nfs/hola.txtTambién verificamos el sistema de archivos montado en el cliente, donde observamos que el recurso 10.0.0.175:/mnt/nfs/kk está disponible en /mnt/nfs:[rocky@cliente-rocky ~]$ ls -l /mnt/nfs/hola.txt -rw-r--r--. 1 root root 22 Feb  6 19:37 /mnt/nfs/hola.txt[rocky@cliente-rocky ~]$ df -hFilesystem              Size  Used Avail Use% Mounted ondevtmpfs                4.0M     0  4.0M   0% /devtmpfs                   385M     0  385M   0% /dev/shmtmpfs                   154M  532K  154M   1% /run/dev/vda4               8.9G  1.1G  7.9G  12% //dev/vda3               936M  257M  680M  28% /boot/dev/vda2               100M  7.0M   93M   8% /boot/efitmpfs                    77M     0   77M   0% /run/user/100010.0.0.175:/mnt/nfs/kk  8.9G  1.3G  7.7G  14% /mnt/nfsAhora realizamos la misma prueba con Samba. En el servidor, creamos un archivo en el recurso compartido de Samba:[rocky@rocky ~]$ echo 'Hola desde el servidor' | sudo tee /mnt/samba/share/hola.txtHola desde el servidorEn el cliente, comprobamos que el archivo está accesible en el punto de montaje de Samba:[rocky@cliente-rocky ~]$ ls -l montaje/total 4-rwxrwxrwx. 1 root root 23 Feb  6 20:16 hola.txtFinalmente, verificamos su contenido:[rocky@cliente-rocky ~]$ cat montaje/hola.txt Hola desde el servidorCon esto, confirmamos que tanto NFS como Samba como SSHFS están configurados correctamente y permiten el acceso a los archivos compartidos entre servidor y cliente."
  },
  
  {
    "title": "VPN sitio a sitio con WireGuard",
    "url": "/posts/site_to_site_wireguard/",
    "categories": "Seguridad, VPN",
    "tags": "VPN",
    "date": "2025-01-29 20:00:00 +0100",
    





    
    "snippet": "EscenarioPara la realización de esta práctica reutilizaré el escenario creado en el ejercicio B, solo que esta vez haciendo uso de WireGuard.Configuración ServidorCasaComenzamos actualizando el sis...",
    "content": "EscenarioPara la realización de esta práctica reutilizaré el escenario creado en el ejercicio B, solo que esta vez haciendo uso de WireGuard.Configuración ServidorCasaComenzamos actualizando el sistema e instalando WireGuard:debian@ServidorCasa:~$ sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt install wireguard -yActivamos el bit de forwarding que nos permitirá dejar pasar los paquetes a través de las máquinas para así permitir la conexión entre los dos clientes.debian@ServidorCasa:~$ sudo sysctl -pnet.ipv4.ip_forward = 1Nos hemos movido al directorio de WireGuard y generado las claves:debian@ServidorCasa:~$ sudo suroot@ServidorCasa:/home/debian# cd /etc/wireguard/root@ServidorCasa:/etc/wireguard# wg genkey | tee clave_priv_servidor | wg pubkey &gt; clave_pub_servidorVerificamos la creación de las claves:root@ServidorCasa:/etc/wireguard# ls -ltotal 8-rw-r--r-- 1 root root 45 Jan 29 18:37 clave_priv_servidor-rw-r--r-- 1 root root 45 Jan 29 18:37 clave_pub_servidorVemos las claves generadas:root@ServidorCasa:/etc/wireguard# cat clave_priv_servidor KCsoaA/EFnFZTHPvy+LLwhS7pzOi8ZZ7XnOWsVFR60E=root@ServidorCasa:/etc/wireguard# cat clave_pub_servidor Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=Ahora pasamos a la configuración inicial del túnel:root@ServidorCasa:/etc/wireguard# cat wg0.conf [Interface]Address = 10.99.99.1PrivateKey = KCsoaA/EFnFZTHPvy+LLwhS7pzOi8ZZ7XnOWsVFR60E=ListenPort = 51820Donde:  Address: Define la dirección IP del túnel.  PrivateKey: Clave privada del mismo Servidor que sirve para descifrar el tráfico entrante.  ListenPort: Puerto UDP para conexiones WireGuard.Después de crear el archivo de configuración, levantamos la interfaz del túnel:root@ServidorCasa:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[  567.662716] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[  567.663520] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0Y comprobamos que funciones:root@ServidorCasa:/etc/wireguard# wginterface: wg0  public key: Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=  private key: (hidden)  listening port: 51820ServidorInstiSeguimos los mismos pasos de actualización e instalación:debian@ServidorInsti:~$ sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt install wireguard -yHabilitamos el bit de forwarding:debian@ServidorInsti:~$ sudo sysctl -pnet.ipv4.ip_forward = 1Generamos las claves, tanto privada como pública:debian@ServidorInsti:~$ sudo suroot@ServidorInsti:/home/debian# cd /etc/wireguard/root@ServidorInsti:/etc/wireguard# wg genkey | tee clave_priv_servidor | wg pubkey &gt; clave_pub_servidorComprobamos que se hayan creado:root@ServidorInsti:/etc/wireguard# ls -ltotal 8-rw-r--r-- 1 root root 45 Jan 29 18:43 clave_priv_servidor-rw-r--r-- 1 root root 45 Jan 29 18:43 clave_pub_servidorY vemos su contenido:root@ServidorInsti:/etc/wireguard# cat clave_priv_servidor kBOZ9Y2KQov8MG1abu/GlPAV1zVf+BroKJ0Y11+B+1U=root@ServidorInsti:/etc/wireguard# cat clave_pub_servidor /XRNDwaFmadC4eCe+KtjoxPg4q9nJZnBCVZymBqJBXE=Creamos el fichero de configuración wg0.conf:root@ServidorInsti:/etc/wireguard# cat wg0.conf [Interface]Address = 10.99.99.2PrivateKey = kBOZ9Y2KQov8MG1abu/GlPAV1zVf+BroKJ0Y11+B+1U=ListenPort = 51820[Peer]PublicKey = Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=AllowedIPs = 10.99.99.1/32, 192.168.1.0/24Endpoint = 10.10.10.33:51820Donde:  PublicKey: Clave pública del ServidorCasa  AllowedIPs:          10.99.99.1/32: IP del túnel del peer      192.168.1.0/24: Red remota accesible        Endpoint: Dirección IP y puerto del ServidorCasaSeguidamente levantamos la interfaz del túnel:root@ServidorInsti:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[ 1183.306337] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[ 1183.307164] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.2 dev wg0[#] ip link set mtu 1420 up dev wg0[#] ip -4 route add 10.99.99.1/32 dev wg0[#] ip -4 route add 192.168.1.0/24 dev wg0Y compobamos:root@ServidorInsti:/etc/wireguard# wginterface: wg0  public key: /XRNDwaFmadC4eCe+KtjoxPg4q9nJZnBCVZymBqJBXE=  private key: (hidden)  listening port: 51820peer: Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=  endpoint: 10.10.10.33:51820  allowed ips: 10.99.99.1/32, 192.168.1.0/24También podemos ver que se ha añadido la interfaz del túnel correctamente:root@ServidorInsti:/etc/wireguard# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:a7:2a:ff:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 10.10.10.44/24 brd 10.10.10.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::ea7:2aff:feff:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:a7:2a:ff:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 172.22.0.1/24 brd 172.22.0.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::ea7:2aff:feff:1/64 scope link        valid_lft forever preferred_lft forever4: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000    link/none     inet 10.99.99.2/32 scope global wg0       valid_lft forever preferred_lft foreverUna vez terminado en ServidorInsti debemos volver al fichero de configuración del túnel de ServidorCasaroot@ServidorCasa:/etc/wireguard# cat wg0.conf [Interface]Address = 10.99.99.1PrivateKey = KCsoaA/EFnFZTHPvy+LLwhS7pzOi8ZZ7XnOWsVFR60E=ListenPort = 51820[Peer]PublicKey = /XRNDwaFmadC4eCe+KtjoxPg4q9nJZnBCVZymBqJBXE=AllowedIPs = 10.99.99.2/32, 172.22.0.0/24Endpoint = 10.10.10.44:51820En donde hemos añadido los parámetros necesarios para la conectividad con el otro servidor.De forma que reiniciamos:root@ServidorCasa:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0[#] ip -4 route add 10.99.99.2/32 dev wg0[#] ip -4 route add 172.22.0.0/24 dev wg0Comprobamos de nuevo:root@ServidorCasa:/etc/wireguard# wginterface: wg0  public key: Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=  private key: (hidden)  listening port: 51820peer: /XRNDwaFmadC4eCe+KtjoxPg4q9nJZnBCVZymBqJBXE=  endpoint: 10.10.10.44:51820  allowed ips: 10.99.99.2/32, 172.22.0.0/24Y nos damos cuenta que se ha añadido la interfaz del túnel:root@ServidorCasa:/etc/wireguard# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:aa:df:00:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::eaa:dfff:fe00:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:aa:df:00:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 10.10.10.33/24 brd 10.10.10.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::eaa:dfff:fe00:1/64 scope link        valid_lft forever preferred_lft forever5: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000    link/none     inet 10.99.99.1/32 scope global wg0       valid_lft forever preferred_lft foreverPruebas de funcionamientoPara verificar que la VPN está funcionando correctamente y que los paquetes están siendo enrutados entre ambas redes, realizamos pruebas de traceroute desde ClienteCasa hacia ClienteInsti y al revés.De ClienteCasa a ClienteInsti:debian@ClienteCasa:~$ ping -c 2 172.22.0.2PING 172.22.0.2 (172.22.0.2) 56(84) bytes of data.64 bytes from 172.22.0.2: icmp_seq=1 ttl=62 time=6.40 ms64 bytes from 172.22.0.2: icmp_seq=2 ttl=62 time=4.77 ms--- 172.22.0.2 ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 4.770/5.584/6.399/0.814 msdebian@ClienteCasa:~$ traceroute 172.22.0.2traceroute to 172.22.0.2 (172.22.0.2), 30 hops max, 60 byte packets 1  _gateway (192.168.1.1)  1.157 ms  1.100 ms  1.085 ms 2  10.99.99.2 (10.99.99.2)  2.813 ms  2.817 ms  2.803 ms 3  172.22.0.2 (172.22.0.2)  4.195 ms  4.183 ms  4.171 msDe ClienteInsti a ClienteCasa:debian@ClienteInsti:~$ ping -c 2 192.168.1.2PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data.64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=1.27 ms64 bytes from 192.168.1.2: icmp_seq=2 ttl=62 time=4.47 ms--- 192.168.1.2 ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 1.274/2.873/4.472/1.599 msdebian@ClienteInsti:~$ traceroute 192.168.1.2traceroute to 192.168.1.2 (192.168.1.2), 30 hops max, 60 byte packets 1  _gateway (172.22.0.1)  0.325 ms  0.300 ms  0.295 ms 2  10.99.99.1 (10.99.99.1)  0.713 ms  0.700 ms  0.697 ms 3  192.168.1.2 (192.168.1.2)  1.264 ms  1.260 ms  1.255 msConclusiónAl igual que dije en el apartado anterior, definitivamente WireGuard me parece mucho más cómodo y fácil de usar. Además, es más rápido ya que no tienes que tratar con certificados, tan solo con el intercambio de claves para que funcione el túnel."
  },
  
  {
    "title": "VPN de acceso remoto con WireGuard",
    "url": "/posts/acceso_remoto_wireguard/",
    "categories": "Seguridad, VPN",
    "tags": "VPN",
    "date": "2025-01-27 21:00:00 +0100",
    





    
    "snippet": "El objetivo de esta práctica es configurar una red privada virtual (VPN) de acceso remoto mediante la implementación de WireGuard en un entorno simulado con GNS3. Esta práctica tiene como fin propo...",
    "content": "El objetivo de esta práctica es configurar una red privada virtual (VPN) de acceso remoto mediante la implementación de WireGuard en un entorno simulado con GNS3. Esta práctica tiene como fin proporcionar una solución de conectividad segura y eficiente, permitiendo la comunicación remota y cifrada entre los clientes y el servidor VPN.EscenarioEl escenario consta de lo siguiente:  Dispositivos Cliente:  Cliente-Windows (172.22.0.2/24)  Cliente-Android (172.22.0.3/24)  Cliente-Linux (172.22.0.4/24)      Un Servidor que dispone de dos redes diferentes, la que conecta con los clientes (172.22.0.1/24) y la que conecta con el PC-Local (192.168.1.1/24).        Un PC-Local (192.168.1.2/24)        Cuatro nubes NAT (NAT1, NAT2, NAT3 y NAT4) que proporcionan traducción de direcciones de red        Un Switch central que interconecta todos los clientes con el servidor  La topología está organizada de la siguiente manera:  Los tres clientes (Windows, Android y Linux) se conectan al Switch1 a través de diferentes puertos (e0, e1, e2)  Cada cliente tiene su propia nube NAT conectada a través de interfaces nat0  El servidor está conectado al Switch1 a través del puerto e3  El servidor también tiene una conexión directa a la PC local a través de una red separada (192.168.1.0/24)  Hay una cuarta nube NAT (NAT4) conectada directamente al servidorPodemos verlo en imagen:IMPORTANTE ⚠️El cliente Android, como se ve en la imagen, está conectado a dos interfaces de red. Sin embargo, esto no significa que pueda usarlas simultáneamente, ya que Android no permite tener activas dos conexiones de red al mismo tiempo cuando una de ellas no es Wi-Fi.Inicialmente, utilizaremos la red proporcionada por la nube NAT para descargar e instalar las aplicaciones necesarias. Sin embargo, cuando llegue el momento de realizar las pruebas de conectividad con la VPN, será necesario cambiar manualmente a la interfaz que tiene la dirección 172.22.0.3/24, ya que es la que permite la comunicación con el servidor y el resto de la red en el escenario de GNS3.Configuración del ServidorPrimero, actualizamos los paquetes de nuestro sistema e instalamos WireGuard con los siguientes comandos:debian@Servidor:~$ sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt install wireguard -yPara que los dispositivos conectados a la VPN puedan comunicarse con otras redes, debemos habilitar el reenvío de paquetes en el kernel. Para que sea persistente, lo agregamos en el archivo /etc/sysctl.conf:debian@Servidor:~$ sudo sysctl -pnet.ipv4.ip_forward = 1WireGuard utiliza criptografía de clave pública-privada para la autenticación entre los pares. Cada nodo de la VPN necesita generar su propio par de claves.Nos dirigimos al directorio de configuración de WireGuard:debian@Servidor:~$ sudo suroot@Servidor:/home/debian# cd /etc/wireguard/Generamos la clave privada y la almacenamos en un archivo llamado clave_priv_servidor. Simultáneamente, generamos la clave pública derivada de la privada y la almacenamos en clave_pub_servidor:root@Servidor:/etc/wireguard# wg genkey | tee clave_priv_servidor | wg pubkey &gt; clave_pub_servidorVerificamos que los archivos se han generado correctamente:root@Servidor:/etc/wireguard# ls -ltotal 8-rw-r--r-- 1 root root 45 Jan 28 22:13 clave_priv_servidor-rw-r--r-- 1 root root 45 Jan 28 22:13 clave_pub_servidorMostramos el contenido de las claves para asegurarnos de que están bien creadas:root@Servidor:/etc/wireguard# cat clave_priv_servidor oOWo8ekqChcY31za9QsNHu75NqioypbFqZgFcTc9WEQ=root@Servidor:/etc/wireguard# cat clave_pub_servidor 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=La clave privada nunca debe ser compartida, ya que es la que permite el acceso seguro al servidor.WireGuard utiliza archivos de configuración en formato INI para definir la interfaz de red VPN y sus parámetros.Creamos el archivo de configuración con:nano /etc/wireguard/wg0.confAñadimos el siguiente contenido:root@Servidor:/etc/wireguard# cat wg0.conf [Interface]# Dirección IP que tendrá el servidor dentro de la VPNAddress = 10.99.99.1# Clave privada generada anteriormentePrivateKey = oOWo8ekqChcY31za9QsNHu75NqioypbFqZgFcTc9WEQ=# Puerto de escucha del servidor (por defecto WireGuard usa el 51820)ListenPort = 51820Este archivo define la interfaz wg0, que será utilizada por WireGuard para la comunicación VPN.Para levantar la VPN, utilizamos el comando wg-quick:root@Servidor:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[ 9304.006929] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[ 9304.007862] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0Para verificar el estado de la interfaz WireGuard y confirmar que está activa, usamos:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820Esto indica que la interfaz wg0 está en funcionamiento, tiene la clave pública correcta y está escuchando en el puerto 51820.Vamos a listar todas las interfaces de red disponibles, donde deberíamos ver algo similar a esto:root@Servidor:/etc/wireguard# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:40:52:9a:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::e40:52ff:fe9a:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:40:52:9a:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 172.22.0.1/24 brd 172.22.0.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::e40:52ff:fe9a:1/64 scope link        valid_lft forever preferred_lft forever4: ens6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:40:52:9a:00:02 brd ff:ff:ff:ff:ff:ff    altname enp0s6    inet 192.168.122.51/24 brd 192.168.122.255 scope global dynamic ens6       valid_lft 2744sec preferred_lft 2744sec    inet6 fe80::e40:52ff:fe9a:2/64 scope link        valid_lft forever preferred_lft forever5: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000    link/none     inet 10.99.99.1/32 scope global wg0       valid_lft forever preferred_lft foreverAquí podemos confirmar que la interfaz wg0 está activa y que tiene asignada la dirección 10.99.99.1/32, la cual servirá como puerta de enlace VPN.Configuración del Cliente-LinuxPara configurar el cliente Linux en nuestra VPN con WireGuard, primero aseguramos que el sistema esté actualizado e instalamos el paquete necesario. Ejecutamos:debian@Cliente-Linux:~$ sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt install wireguard -yLuego, cambiamos al usuario root y nos desplazamos al directorio de configuración de WireGuard:debian@Cliente-Linux:~$ sudo suroot@Cliente-Linux:/home/debian# cd /etc/wireguard/Generamos la clave privada del cliente y a partir de ella obtenemos la clave pública:root@Cliente-Linux:/etc/wireguard# wg genkey | tee clave_priv_cliente | wg pubkey &gt; clave_pub_clienteVerificamos que los archivos de claves se han generado correctamente:root@Cliente-Linux:/etc/wireguard# ls -ltotal 8-rw-r--r-- 1 root root 45 Jan 28 22:33 clave_priv_cliente-rw-r--r-- 1 root root 45 Jan 28 22:33 clave_pub_clienteConsultamos el contenido de las claves para asegurarnos de que se han creado correctamente:root@Cliente-Linux:/etc/wireguard# cat clave_priv_cliente  kKnEefJbY6wvEwS0Gkj9nPKUDyol6VnguYik11U4AkQ=root@Cliente-Linux:/etc/wireguard# cat clave_pub_cliente F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=A continuación, creamos el archivo de configuración wg0.conf con los siguientes parámetros:root@Cliente-Linux:/etc/wireguard# cat wg0.conf[Interface]# IP que tomará el cliente en el túnelAddress = 10.99.99.2/24 # Clave privada del clientePrivateKey = kKnEefJbY6wvEwS0Gkj9nPKUDyol6VnguYik11U4AkQ=# Puerto escucha y por defecto de WireguardListenPort = 51820[Peer]# Clave pública del servidorPublicKey = 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=# Rango de direcciones permitidas en el túnel.AllowedIPs = 0.0.0.0/0#Punto de acceso del servidorEndpoint = 172.22.0.1:51820#Tiempo de espera de la conexiónPersistentKeepalive = 25Levantamos la interfaz de WireGuard con:root@Cliente-Linux:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[ 2154.668085] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[ 2154.670429] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.2/24 dev wg0[#] ip link set mtu 1420 up dev wg0[#] wg set wg0 fwmark 51820[#] ip -4 route add 0.0.0.0/0 dev wg0 table 51820[#] ip -4 rule add not fwmark 51820 table 51820[#] ip -4 rule add table main suppress_prefixlength 0[#] sysctl -q net.ipv4.conf.all.src_valid_mark=1[#] iptables-restore -nSi todo funciona correctamente, deberíamos ver mensajes indicando que la interfaz se ha creado y configurado con éxito. Podemos verificar el estado de la conexión ejecutando:root@Cliente-Linux:/etc/wireguard# wginterface: wg0  public key: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  private key: (hidden)  listening port: 51820  fwmark: 0xca6cpeer: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  endpoint: 172.22.0.1:51820  allowed ips: 0.0.0.0/0  transfer: 0 B received, 296 B sent  persistent keepalive: every 25 secondsY confirmamos que la interfaz wg0 ha sido añadida correctamente al sistema:root@Cliente-Linux:/etc/wireguard# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:89:3b:46:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 172.22.0.4/24 brd 172.22.0.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::e89:3bff:fe46:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:89:3b:46:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 192.168.122.208/24 brd 192.168.122.255 scope global dynamic ens5       valid_lft 1416sec preferred_lft 1416sec    inet6 fe80::e89:3bff:fe46:1/64 scope link        valid_lft forever preferred_lft forever4: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000    link/none     inet 10.99.99.2/24 scope global wg0       valid_lft forever preferred_lft foreverAhora volvemos al servidor para añadir la configuración del cliente. En el archivo wg0.conf del servidor agregamos la información correspondiente al cliente:root@Servidor:/etc/wireguard# cat wg0.conf # SERVIDOR[Interface]# Aquí ponemos la IP virtual que tomará el túnelAddress = 10.99.99.1# Clave privada del servidor creada hace momentosPrivateKey = oOWo8ekqChcY31za9QsNHu75NqioypbFqZgFcTc9WEQ=# Puerto escucha y por defecto de WireguardListenPort = 51820# CLIENTE[Peer]# Clave pública del clientePublickey = F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=# IP túnel del clienteAllowedIPs = 10.99.99.2/32#Tiempo de espera de respuestaPersistentKeepAlive = 25Para aplicar los cambios, reiniciamos la interfaz en el servidor:root@Servidor:/etc/wireguard# wg-quick down wg0[#] ip link delete dev wg0root@Servidor:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0[#] ip -4 route add 10.99.99.2/32 dev wg0Verificamos el estado de la VPN en el servidor con:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820peer: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  allowed ips: 10.99.99.2/32  persistent keepalive: every 25 secondsComprobación funcionamientoPara comprobar la conexión desde el cliente, utilizamos traceroute para ver si el tráfico se está enviando correctamente a través del túnel VPN:Si todo está configurado correctamente, veremos que los paquetes viajan por la interfaz wg0, confirmando que la VPN está funcionando de manera óptima.Configuración Cliente-WindowsPara configurar WireGuard en un cliente Windows, comenzamos descargando e instalando el cliente oficial desde su página de descargas.Una vez completada la instalación, ejecutamos la aplicación y procedemos a agregar un nuevo túnel vacío. Esto nos permitirá definir manualmente la configuración de nuestra conexión VPN:Al crear el túnel, editamos el archivo de configuración con los siguientes parámetros:[Interface]PrivateKey = wHLqf5MSCuBHQ+Gi0kBFCjqIYZVlQC540JtAywT4K04=ListenPort = 51820Address = 10.99.99.3/32[Peer]PublicKey = 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=AllowedIPs = 0.0.0.0/1EndPoint = 172.22.0.1:51820Analizando esta configuración, observamos que en la sección [Interface] se especifica la clave privada del cliente, el puerto en el que escuchará y la dirección IP asignada dentro de la VPN. En la sección [Peer], se define el servidor al que nos conectaremos, incluyendo su clave pública, las IPs permitidas en la VPN y la dirección del endpoint, que corresponde al servidor WireGuard.Después de guardar la configuración, activamos el túnel y verificamos que la conexión se haya establecido correctamente mediante el handshake:También podemos observar que se ha creado una nueva interfaz de red asociada a WireGuard:A continuación, nos dirigimos al servidor y añadimos la información del nuevo cliente Windows en su archivo de configuración (/etc/wireguard/wg0.conf):root@Servidor:/etc/wireguard# cat wg0.conf # SERVIDOR[Interface]# Aquí ponemos la IP virtual que tomará el túnelAddress = 10.99.99.1# Clave privada del servidor creada hace momentosPrivateKey = oOWo8ekqChcY31za9QsNHu75NqioypbFqZgFcTc9WEQ=# Puerto escucha y por defecto de WireguardListenPort = 51820# CLIENTE LINUX[Peer]# Clave pública del clientePublickey = F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=# IP túnel del clienteAllowedIPs = 10.99.99.2/32#Tiempo de espera de respuestaPersistentKeepAlive = 25# CLIENTE WINDOWS[Peer]Publickey = Gw9vvlbUvr/Q2t2poFA1R53Y9mYlP718EKPCaWvsTns=AllowedIPs = 10.99.99.3/32PersistentKeepAlive = 25Para aplicar los cambios, reiniciamos la interfaz de WireGuard en el servidor:root@Servidor:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[ 1439.522887] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[ 1439.524019] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0[#] ip -4 route add 10.99.99.3/32 dev wg0[#] ip -4 route add 10.99.99.2/32 dev wg0Si ejecutamos wg, podemos comprobar que ambos clientes (Linux y Windows) están conectados correctamente, ya que se observa el handshake reciente y tráfico intercambiado con el servidor:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820peer: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  endpoint: 172.22.0.4:51820  allowed ips: 10.99.99.2/32  latest handshake: 26 seconds ago  transfer: 2.20 KiB received, 1.46 KiB sent  persistent keepalive: every 25 secondspeer: Gw9vvlbUvr/Q2t2poFA1R53Y9mYlP718EKPCaWvsTns=  endpoint: 172.22.0.2:51820  allowed ips: 10.99.99.3/32  latest handshake: 1 minute, 11 seconds ago  transfer: 61.41 KiB received, 632 B sent  persistent keepalive: every 25 secondsComprobación funcionamientoPara finalizar, realizamos una prueba de conectividad ejecutando un traceroute desde el cliente Windows hacia el dispositivo que tenemos en la red local. Esto nos confirmará que el tráfico está siendo correctamente enrutado a través de la VPN.Y como podemos ver funciona correctamente. Este proceso garantiza que el cliente Windows pueda comunicarse con el servidor y con otros clientes conectados a la VPN de WireGuard, proporcionando una conexión segura y estable.Configuración AndroidPara comenzar nuestra configuración en Android, necesitaremos instalar dos aplicaciones fundamentales desde la Play Store. La primera es WireGuard, que nos permitirá crear y gestionar nuestro túnel VPN. La segunda es Termius, un versátil cliente SSH que además nos proporciona una terminal integrada, esta será esencial para realizar nuestras pruebas de conectividad y verificar la correcta creación del túnel.Una vez que hayamos completado la instalación de ambas aplicaciones, debemos proceder a configurar nuestra conexión Wi-Fi. En este caso, necesitaremos modificar la configuración de red para utilizar la dirección IP 172.22.0.3/24. Para realizar este cambio, nos dirigiremos a los Ajustes de nuestro dispositivo, donde tendremos que añadir manualmente la configuración:Con la red correctamente configurada, procedemos a crear nuestro túnel VPN mediante la aplicación WireGuard. La configuración que utilizaremos sigue el mismo patrón que hemos venido utilizando en nuestras configuraciones anteriores:Podemos observar que el handshake está funcionando correctamente, lo cual nos indica que el intercambio inicial de claves se ha realizado con éxito.Para verificar la creación del túnel, abrimos nuestra terminal en Termius y ejecutamos el comando ip a. Este nos mostrará todas las interfaces de red, donde podremos confirmar la presencia de nuestro túnel WireGuard:El siguiente paso nos lleva de vuelta a nuestro Servidor, donde necesitamos actualizar el archivo wg0.conf con los parámetros correspondientes a nuestro cliente Android:# CLIENTE ANDROID[Peer]Publickey = YlKnopzZ1myt29MnP6rZ1WwMgLm1QVSOY+t0vyngtD8=AllowedIPs = 10.99.99.4/32PersistentKeepAlive = 25Tras añadir esta configuración, debemos reiniciar la interfaz del túnel para que los cambios surtan efecto. Podemos verificar el estado actual de nuestras conexiones mediante el comando wg:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820peer: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  endpoint: 172.22.0.4:51820  allowed ips: 10.99.99.2/32  latest handshake: 26 seconds ago  transfer: 2.20 KiB received, 1.46 KiB sent  persistent keepalive: every 25 secondspeer: Gw9vvlbUvr/Q2t2poFA1R53Y9mYlP718EKPCaWvsTns=  endpoint: 172.22.0.2:51820  allowed ips: 10.99.99.3/32  latest handshake: 1 minute, 11 seconds ago  transfer: 61.41 KiB received, 632 B sent  persistent keepalive: every 25 secondspeer: YlKnopzZ1myt29MnP6rZ1WwMgLm1QVSOY+t0vyngtD8=  allowed ips: 10.99.99.4/32  persistent keepalive: every 25 secondsComprobación funcionamientoPara asegurarnos de que todo está funcionando correctamente, realizaremos una prueba de conectividad utilizando la terminal de Termius. Ejecutamos un traceroute para visualizar la ruta que siguen nuestros paquetes:Como podemos ver, el túnel está funcionando a la perfección.Para tener una visión completa del funcionamiento de nuestra red, podemos ver el estado del tráfico entre todos los clientes conectados:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820peer: YlKnopzZ1myt29MnP6rZ1WwMgLm1QVSOY+t0vyngtD8=  endpoint: 172.22.0.3:51820  allowed ips: 10.99.99.4/32  latest handshake: 45 seconds ago  transfer: 3.62 KiB received, 8.24 KiB sent  persistent keepalive: every 25 secondspeer: Gw9vvlbUvr/Q2t2poFA1R53Y9mYlP718EKPCaWvsTns=  endpoint: 172.22.0.2:51820  allowed ips: 10.99.99.3/32  latest handshake: 1 minute, 15 seconds ago  transfer: 205.21 KiB received, 11.40 KiB sent  persistent keepalive: every 25 secondspeer: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  endpoint: 172.22.0.4:51820  allowed ips: 10.99.99.2/32  latest handshake: 2 minutes, 8 seconds ago  transfer: 14.00 KiB received, 6.36 KiB sent  persistent keepalive: every 25 secondsConclusiónSin ningún tipo de duda me ha parecido mucho mejor y más práctico esta forma de hacerlo con WireGuard que con OpenVPN. De la otra forma pienso que es más lioso ya que tienes que estar creando y moviendo ficheros de certificado con lo que ello conlleva. Esta forma es mucho más intuitiva y fácil de entender en mi opinión."
  },
  
  {
    "title": "VPN sitio a sitio con OpenVPN y certificados x509",
    "url": "/posts/site_to_site_openvpn/",
    "categories": "Seguridad, VPN",
    "tags": "VPN",
    "date": "2025-01-26 18:00:00 +0100",
    





    
    "snippet": "Configura una conexión VPN sitio a sitio entre dos equipos del cloud:  Cada equipo estará conectado a dos redes, una de ellas en común          Para la autenticación de los extremos se usarán oblig...",
    "content": "Configura una conexión VPN sitio a sitio entre dos equipos del cloud:  Cada equipo estará conectado a dos redes, una de ellas en común          Para la autenticación de los extremos se usarán obligatoriamente certificados digitales, que se generarán utilizando openssl y se almacenarán en el directorio /etc/openvpn, junto con con los parámetros Diffie-Helman y el certificado de la propia Autoridad de Certificación.      Se utilizarán direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN.      Tras el establecimiento de la VPN, una máquina de cada red detrás de cada servidor VPN debe ser capaz de acceder a una máquina del otro extremo.      EscenarioComentar que antes de montar el escenario, conectamos una nube a las máquinas para que tengan acceso a Internet y así poder instalar openvpn.Ya instalado, el escenario tendrá la siguiente forma:      ClienteCasa: interfaz ens4 con la dirección 192.168.1.2/24 conectada con la interfaz ens4 de ServidorCasa.        ServidorCasa: interfaz ens4 con la dirección 192.168.1.1/24 conectada con la interfaz ens4 de ClienteCasa. Por otro lado, la interfaz ens5 con la dirección 10.10.10.33/24 que conecta con la interfaz ens4 de ServidorInsti.        ServidorInsti: interfaz ens4 con la dirección 10.10.10.44/24 conectada con la interfaz ens5 de ServidorCasa. Por otro lado, la interfaz ens5 con la dirección 172.22.0.1/24 conectada con la interfaz ens4 de ClienteInsti.        ClienteInsti: interfaz ens4 con la dirección 172.22.0.2/24 conectada con la interfaz ens5 de ServidorInsti.  🔗 Red de interconexión VPN: 10.99.99.0/24🖧 Objetivo: Tras establecer la VPN, ClienteCasa podrá comunicarse con ClienteInsti y viceversa.Antes de comenzar, cada máquina debe tener acceso a Internet para instalar OpenVPN:sudo apt update &amp;&amp; sudo apt install openvpn easy-rsa -yUna vez instalado estos dos paquetes en las máquinas que nos permitirán realizar la conexión VPN, tendremos que activar el bit de forwarding que nos permitirá dejar pasar los paquetes a través de las máquinas (tanto la máquina ServidorCasa como la máquina ServidorInsti) para así permitir la conexión entre los dos clientes.debian@ServidorCasa:~$ sudo sysctl -pnet.ipv4.ip_forward = 1debian@ServidorInsti:~$ sudo sysctl -pnet.ipv4.ip_forward = 1Configuración del ServidorCasaPara establecer la VPN con autenticación basada en certificados, necesitamos generar:  Una Autoridad de Certificación (CA), que firmará los certificados utilizados por los servidores y clientes de OpenVPN.  Un certificado y una clave privada para cada servidor (ServidorCasa y ServidorInsti).  Un conjunto de parámetros Diffie-Hellman, necesarios para establecer un canal de comunicación seguro.Para esto, utilizaremos Easy-RSA, una herramienta que facilita la generación y administración de certificados.En primer lugar, copiamos el archivo de configuración base de Easy-RSA:debian@ServidorCasa:~$ sudo cp /usr/share/easy-rsa/vars.example /usr/share/easy-rsa/varsLuego, editamos el archivo vars para definir los valores predeterminados de los certificados, donde configuramos los siguientes parámetros:debian@ServidorCasa:~$ sudo cat /usr/share/easy-rsa/varsset_var EASYRSA_REQ_COUNTRY     \"ES\"set_var EASYRSA_REQ_PROVINCE    \"Sevilla\"set_var EASYRSA_REQ_CITY        \"Dos Hermanas\"set_var EASYRSA_REQ_ORG         \"PabloMartin SL\"set_var EASYRSA_REQ_EMAIL       \"pmartinhidalgo19@gmail.com\"set_var EASYRSA_REQ_OU          \"Site to site OpenVPN\"Una vez guardados los cambios, inicializamos la infraestructura de claves pública (PKI):debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa init-pki* Notice:  init-pki complete; you may now create a CA or requests.  Your newly created PKI dir is:  * /usr/share/easy-rsa/pkiA continuación, generamos los parámetros Diffie-Hellman, que se utilizarán para establecer un canal seguro entre los servidores OpenVPN:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa gen-dhPara generar nuestra CA, ejecutamos:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa build-ca* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.13 30 Jan 2024 (Library: OpenSSL 3.0.13 30 Jan 2024)Enter New CA Key Passphrase: Re-Enter New CA Key Passphrase: Using configuration from /usr/share/easy-rsa/pki/be063ba2/temp.83878b4b.+......+......+..+.+.....+.+......+.....+...............+...+...............+........................+..........+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+...+...+.........+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+..+..........+..................+...+...+.....................+...............+.....+.+..+...+....+......+..............+.+...+.........+...........+.+......+..+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++...+.....+...+....+........+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+.+...+.....+.+..+.......+..+....+.....+......+...+...+...+............+.......+.....................+..+.......+.....+.+............+............+.....+.+......+.........+.....+...............+......+.+...+..............+.......+...+......+..+....+...........+.......+.....+.+...........+....+..+...+.........+...+.........+.+.....+...+....+...+.........+...+..+......+...+..........+.....+..........+.....+.......+..............+.+....................+..........+..+.......+...+......+..+....+........+.+.....+.+...+...+........+.......+..+.+...........+...+......+....+..+.+...............+............+...............+...+..+.+..+.............+......+.....+.+.................+......+....+...........+....+..+.+.....+....+...+........+...+.+...+.....+.+..+....+.....+.+...............+..+.+...........+.+.........+...........+...+......+.+.........+........+...+...+.........+.+......+...+..+.....................+.......+...+.....+.........+.+...+.....+....+......+..............+..........+...+........+....+...+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++Enter PEM pass phrase:Verifying - Enter PEM pass phrase:-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:pavlo* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtDurante este proceso, se nos pedirá que introduzcamos un nombre común (Common Name) para la CA. También se nos solicitará una contraseña para proteger la clave de la CA.Ahora generamos la clave privada y la solicitud de certificado para el servidor OpenVPN en ServidorCasa:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa gen-req server* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.13 30 Jan 2024 (Library: OpenSSL 3.0.13 30 Jan 2024)....+.......+............+....................+...+...+.+......+..+.+..+.......+..+....+.....+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...........+.......+..+.+...+..+.........+...+..........+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+..+.............+...........+......+...+.+............+............+..+...+................+..+...+...................+.....+...+...+.+......+..+.+.....+.+..............+.+......+..+......+....+...+..+................+...........+.+...+......+...+...........+...............+.+...+..+.........+............+.......+...+..+...+....+...+..+.........+............+............+.+..+.......+...+..+......+.+.....+....+..............+.+......+...........+....+...........+.........+.+............+..+.........+.+........+......+......+.+..+.+...........+......+.......+...........+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++........+...+....+...+..+.+.......................+....+..+.+..+.......+...+..+.............+..+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+........+...+..........+...+.....+.+.....+...+..........+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++Enter PEM pass phrase:Verifying - Enter PEM pass phrase:-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Common Name (eg: your user, host, or server name) [server]:* Notice:Keypair and certificate request completed. Your files are:req: /usr/share/easy-rsa/pki/reqs/server.reqkey: /usr/share/easy-rsa/pki/private/server.keyLuego, firmamos la solicitud con nuestra CA:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server server* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.13 30 Jan 2024 (Library: OpenSSL 3.0.13 30 Jan 2024)You are about to sign the following certificate.Please check over the details shown below for accuracy. Note that this requesthas not been cryptographically verified. Please be sure it came from a trustedsource or that you have verified the request checksum with the sender.Request subject, to be signed as a server certificate for 825 days:subject=    commonName                = serverType the word 'yes' to continue, or any other input to abort.  Confirm request details: yesUsing configuration from /usr/share/easy-rsa/pki/b5cd863e/temp.ff729ff0Enter pass phrase for /usr/share/easy-rsa/pki/private/ca.key:Check that the request matches the signatureSignature okThe Subject's Distinguished Name is as followscommonName            :ASN.1 12:'server'Certificate is to be certified until May  1 17:12:31 2027 GMT (825 days)Write out database with 1 new entriesDatabase updated* Notice:Certificate created at: /usr/share/easy-rsa/pki/issued/server.crtSe nos pedirá que confirmemos la firma y que ingresemos la contraseña de la CA.Repetimos el proceso para generar la clave privada y la solicitud de certificado en ServidorInsti:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa gen-req server2Luego, firmamos la solicitud:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa sign-req client server2Una vez generados los certificados y claves, los copiamos a los directorios correspondientes en ServidorCasa:root@ServidorCasa:/usr/share/easy-rsa/pki# cp ca.crt dh.pem issued/server.crt private/server.key /etc/openvpn/server/Verificamos que los archivos se copiaron correctamente:debian@ServidorCasa:~$ ls -l /etc/openvpn/server/total 20-rw------- 1 root root 1180 Jan 26 17:16 ca.crt-rw------- 1 root root  424 Jan 26 17:16 dh.pem-rw------- 1 root root 4580 Jan 26 17:16 server.crt-rw------- 1 root root 1854 Jan 26 17:16 server.keyLuego, copiamos los certificados de ServidorInsti:root@ServidorCasa:/usr/share/easy-rsa/pki# cp ca.crt issued/server2.crt private/server2.key /home/debian/ServidorInsti/Y verificamos la copia:debian@ServidorCasa:~$ ls -l ServidorInsti/total 16-rw------- 1 root root 1180 Jan 26 17:18 ca.crt-rw------- 1 root root 4466 Jan 26 17:18 server2.crt-rw------- 1 root root 1854 Jan 26 17:18 server2.keyPara garantizar una conexión cifrada y autenticada entre los servidores, primero generamos los certificados y claves necesarias en ServidorCasa y luego los transferimos a ServidorInsti:debian@ServidorCasa:~$ scp -r ServidorInsti/ debian@10.10.10.44:/home/debianThe authenticity of host '10.10.10.44 (10.10.10.44)' can't be established.ED25519 key fingerprint is SHA256:Gojcktfl97qAXF9KaBhKTK93gIYeN/574t8Ph9Zl2D0.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.10.44' (ED25519) to the list of known hosts.debian@10.10.10.44's password: server2.crt                                   100% 4466     2.9MB/s   00:00    ca.crt                                        100% 1180     1.0MB/s   00:00    server2.key                                   100% 1854     1.7MB/s   00:00Al realizar la conexión por primera vez, se nos solicita verificar la autenticidad del host remoto mediante su huella ED25519. Aceptamos la conexión y procedemos a ingresar la contraseña del usuario remoto. La transferencia de archivos se completa con éxito.Verificamos que los archivos han sido transferidos correctamente en ServidorInsti:debian@ServidorInsti:~$ cd ServidorInsti/debian@ServidorInsti:~/ServidorInsti$ ls -ltotal 16-rw------- 1 debian debian 1180 Jan 26 17:34 ca.crt-rw------- 1 debian debian 4466 Jan 26 17:34 server2.crt-rw------- 1 debian debian 1854 Jan 26 17:34 server2.keyEn ServidorCasa, configuramos el servicio OpenVPN con el siguiente archivo /etc/openvpn/server/servidor.conf:debian@ServidorCasa:~$ sudo cat /etc/openvpn/server/servidor.confdev tunifconfig 10.99.99.1 10.99.99.2route 172.22.0.0 255.255.255.0tls-serverca ca.crtcert server.crtkey server.keydh dh.pemcomp-lzokeepalive 10 120log /var/log/openvpn/server.logverb 3askpass clavepaso.txtDonde:  Modo TUN (dev tun), creando un túnel IP punto a punto.  Asignación de IPs (ifconfig 10.99.99.1 10.99.99.2).  Ruta estática (route 172.22.0.0 255.255.255.0) para permitir acceso a la red interna.  Seguridad TLS (tls-server), autenticación con certificados (ca.crt, server.crt, server.key) y clave Diffie-Hellman (dh.pem).  Compresión LZO (comp-lzo), keepalive (keepalive 10 120), y nivel de logs (verb 3).  Registro de eventos en /var/log/openvpn/server.log.  Askpass: aquí debemos declarar el fichero .txt donde guardaremos la clave de paso para que no nos la pida más.Verificamos que los archivos de configuración y certificados están correctamente ubicados en /etc/openvpn/server/:debian@ServidorCasa:~$ ls -l /etc/openvpn/server/total 28-rw------- 1 root root 1180 Jan 26 17:16 ca.crt-rw-r--r-- 1 root root    6 Jan 26 17:42 clavepaso.txt-rw------- 1 root root  424 Jan 26 17:16 dh.pem-rw------- 1 root root 4580 Jan 26 17:16 server.crt-rw------- 1 root root 1854 Jan 26 17:16 server.key-rw-r--r-- 1 root root  219 Jan 26 17:41 servidor.confHabilitamos y arrancamos el servicio OpenVPN en ServidorCasa:debian@ServidorCasa:~$ sudo systemctl enable --now openvpn-server@servidorCreated symlink /etc/systemd/system/multi-user.target.wants/openvpn-server@servidor.service → /lib/systemd/system/openvpn-server@.service.debian@ServidorCasa:~$ [ 5609.481659] tun: Universal TUN/TAP device driver, 1.6Verificamos el estado del servicio para asegurarnos de que está corriendo correctamente:debian@ServidorCasa:~$ sudo systemctl status openvpn-server@servidorTambién comprobamos que la interfaz de túnel tun0 ha sido creada correctamente:debian@ServidorCasa:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:d5:bf:e7:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::ed5:bfff:fee7:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:d5:bf:e7:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 10.10.10.33/24 brd 10.10.10.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::ed5:bfff:fee7:1/64 scope link        valid_lft forever preferred_lft forever4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500    link/none     inet 10.99.99.1 peer 10.99.99.2/32 scope global tun0       valid_lft forever preferred_lft forever    inet6 fe80::c25e:9b6e:e6a7:3651/64 scope link stable-privacy        valid_lft forever preferred_lft foreverConfiguración del ServidorInstiEn ServidorInsti, aseguramos que los certificados y claves tengan los permisos correctos y sean propiedad de root:debian@ServidorInsti:~$ sudo chown -R root:root ServidorInsti/debian@ServidorInsti:~$ ls -l ServidorInsti/total 16-rw------- 1 root root 1180 Jan 26 17:34 ca.crt-rw------- 1 root root 4466 Jan 26 17:34 server2.crt-rw------- 1 root root 1854 Jan 26 17:34 server2.keydebian@ServidorInsti:~$ sudo mv ServidorInsti/* /etc/openvpn/client/Verificamos los archivos en /etc/openvpn/client/:debian@ServidorInsti:~$ ls -l /etc/openvpn/client/total 20-rw------- 1 root root 1180 Jan 26 17:34 ca.crt-rw-r--r-- 1 root root    6 Jan 26 18:07 clavepaso.txt-rw------- 1 root root 4466 Jan 26 17:34 server2.crt-rw------- 1 root root 1854 Jan 26 17:34 server2.keyConfiguramos el cliente OpenVPN con /etc/openvpn/client/client.conf:debian@ServidorInsti:~$ sudo cat /etc/openvpn/client/client.confdev tunremote 10.10.10.33ifconfig 10.99.99.2 10.99.99.1route 192.168.1.0 255.255.255.0tls-clientca ca.crtcert server2.crtkey server2.keycomp-lzokeepalive 10 60verb 3askpass clavepaso.txtHabilitamos y arrancamos el cliente OpenVPN:debian@ServidorInsti:~$ sudo systemctl enable --now openvpn-client@clientCreated symlink /etc/systemd/system/multi-user.target.wants/openvpn-client@client.service → /lib/systemd/system/openvpn-client@.service.debian@ServidorInsti:~$ [ 7208.575935] tun: Universal TUN/TAP device driver, 1.6Comprobamos que la interfaz tun0 en el cliente se haya creado correctamente:debian@ServidorInsti:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:83:0e:cf:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 10.10.10.44/24 brd 10.10.10.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::e83:eff:fecf:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:83:0e:cf:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 172.22.0.1/24 brd 172.22.0.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::e83:eff:fecf:1/64 scope link        valid_lft forever preferred_lft forever4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500    link/none     inet 10.99.99.2 peer 10.99.99.1/32 scope global tun0       valid_lft forever preferred_lft forever    inet6 fe80::d8c0:e10c:3d:44f3/64 scope link stable-privacy        valid_lft forever preferred_lft foreverVerificamos que la conexión se ha establecido correctamente:debian@ServidorInsti:~$ sudo systemctl status openvpn-client@client.service Pruebas de conectividadPara verificar que la VPN está funcionando correctamente y que los paquetes están siendo enrutados entre ambas redes, realizamos pruebas de traceroute desde ClienteCasa hacia ClienteInsti y al revés.Desde ClienteCasa a ClienteInsti:Desde ClienteInsti a ClienteCasa:"
  },
  
  {
    "title": "VPN de acceso remoto con OpenVPN y certificados x509",
    "url": "/posts/acceso_remoto_openvpn/",
    "categories": "Seguridad, VPN",
    "tags": "VPN",
    "date": "2025-01-23 13:00:00 +0100",
    





    
    "snippet": "Configura una conexión VPN de acceso remoto entre dos equipos del cloud:  Uno de los dos equipos (el que actuará como servidor) estará conectado a dos redes          Para la autenticación de los ex...",
    "content": "Configura una conexión VPN de acceso remoto entre dos equipos del cloud:  Uno de los dos equipos (el que actuará como servidor) estará conectado a dos redes          Para la autenticación de los extremos se usarán obligatoriamente certificados digitales, que se generarán utilizando openssl y se almacenarán en el directorio /etc/openvpn, junto con  los parámetros Diffie-Helman y el certificado de la propia Autoridad de Certificación.      Se utilizarán direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN. La dirección 10.99.99.1 se asignará al servidor VPN.      Los ficheros de configuración del servidor y del cliente se crearán en el directorio /etc/openvpn de cada máquina, y se llamarán servidor.conf y cliente.conf respectivamente.      Tras el establecimiento de la VPN, la máquina cliente debe ser capaz de acceder a una máquina que esté en la otra red a la que está conectado el servidor.      EscenarioMontaremos el pequeño escenario en GNS3 con tres máquinas Debian 12 y una nube NAT que nos proporcionará Internet para instalaciones necesarias:      Servidor: contará con tres interfaces, ens4 que conectará con Cliente1 en la red 192.168.1.0/24, la interfaz ens5 que conectará con Cliente2 en la red 192.168.2.0/24 y la interfaz ens6 que estará conectada a la nube NAT.        Cliente1: conectado a la red 192.168.1.0/24 a través de la interfaz ens4.        Cliente2: conectado a la red 192.168.2.0/24 a través de la interfaz ens4.        NAT: conectada al Servidor.  Quedando de la siguiente forma:Configuración del servidorPara configurar el servidor OpenVPN, lo primero que debemos hacer es asegurarnos de que las interfaces de red están activas para tener conexión a Internet. Esto es fundamental, ya que necesitaremos instalar el paquete openvpn en nuestro sistema. Para ello, ejecutamos los siguientes comandos en la terminal:debian@servidor:~$ sudo apt updatedebian@servidor:~$ sudo apt install openvpn -yUna vez instalado OpenVPN, es necesario habilitar el reenvío de paquetes en el sistema para permitir que el tráfico fluya correctamente a través de la VPN. Esto se hace modificando el archivo de configuración del kernel /etc/sysctl.conf. Para aplicar el cambio inmediatamente, ejecutamos:debian@servidor:~$ sudo sysctl -pEste comando verificará y aplicará la configuración, asegurando que el tráfico IP pueda ser reenviado entre las interfaces de red. La salida del comando debería incluir la siguiente línea:net.ipv4.ip_forward = 1Ahora procederemos a copiar los archivos de configuración de easy-rsa desde su ubicación predeterminada en /usr/share/easy-rsa al directorio de configuración de OpenVPN en /etc/openvpn. Este paso es importante porque nos aseguramos de que futuras actualizaciones del paquete no sobrescriban nuestros archivos personalizados:debian@servidor:~$ sudo cp -r /usr/share/easy-rsa /etc/openvpnPodemos verificar que la copia se ha realizado correctamente listando el contenido del directorio /etc/openvpn:debian@servidor:~$ ls -l /etc/openvpn/Lo que nos devolverá algo similar a:total 16drwxr-xr-x 2 root root 4096 Nov 11  2023 clientdrwxr-xr-x 3 root root 4096 Jan 23 18:28 easy-rsadrwxr-xr-x 2 root root 4096 Nov 11  2023 server-rwxr-xr-x 1 root root 1468 Nov 11  2023 update-resolv-confA partir de este momento, trabajaremos dentro del directorio /etc/openvpn/easy-rsa, ya que este será el entorno donde generaremos los certificados y claves necesarios para nuestra infraestructura de clave pública (PKI).EasyRSA es una herramienta de línea de comandos diseñada para simplificar la creación y gestión de una PKI (Infraestructura de Clave Pública) utilizada en OpenVPN. También nos permite generar parámetros de Diffie-Hellman, que son esenciales para establecer un canal seguro de comunicación en OpenVPN.El siguiente paso en la configuración será inicializar la infraestructura PKI dentro del directorio de trabajo. Para ello, ejecutamos:debian@servidor:~$ cd /etc/openvpn/easy-rsa/debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa init-pki* Notice:  init-pki complete; you may now create a CA or requests.  Your newly created PKI dir is:  * /etc/openvpn/easy-rsa/pki* Notice:  IMPORTANT: Easy-RSA 'vars' file has now been moved to your PKI above.Este comando creará la estructura de archivos y directorios necesaria para la gestión de certificados en OpenVPN.El siguiente paso en la configuración de OpenVPN es la creación de una Autoridad Certificadora (CA, por sus siglas en inglés). La CA es responsable de firmar los certificados de los clientes y del servidor, asegurando la autenticidad de las conexiones dentro de la VPN.Para iniciar este proceso, ejecutamos el siguiente comando dentro del directorio /etc/openvpn/easy-rsa:debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa build-ca* Notice:Using Easy-RSA configuration from: /etc/openvpn/easy-rsa/pki/vars* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)Enter New CA Key Passphrase: Re-Enter New CA Key Passphrase: Using configuration from /etc/openvpn/easy-rsa/pki/563317df/temp.f856c430...+..+......+.+.........+.....+..........+..+....+...............+..............+......+....+.................+..........+...+.........+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+.............+..+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*....+.....+...+...+....+..................+.....+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++...+.+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+.........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+..........+.....+.+.....+.........+.+.....+.+......+.....+.......+.....+...+..........+..............+....+...........+..........+...+........+...+......+...+......+......+.+...+..+.......+..+.........+...............+......+....+..+....+...+...........+.......+...+..+.........+...+...............+.+..+.........+.+.....+.............+..............+.+......+...+..+....+..+...+.+.....................+.........+.....+.+..+.+.....+.......+..............+......+...+................+.....+......+...+..........+..+.......+...+...+..............+...+...+............+....+...+..+.............+.....+...+..................+............+.......+...........+.......+..+...............+...+....+......+...+..............+.+......+........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++Enter PEM pass phrase:Verifying - Enter PEM pass phrase:-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:pavlo* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/etc/openvpn/easy-rsa/pki/ca.crtDurante el proceso de generación de la Autoridad Certificadora (CA), se nos pedirá establecer una frase de paso para proteger la clave privada. Esta contraseña será requerida cada vez que firmemos certificados nuevos. Como resultado del comando, se han generado dos archivos importantes:      El certificado de la CA, ubicado en /etc/openvpn/easy-rsa/pki/ca.crt, el cual será compartido con los clientes y el servidor OpenVPN para validar la autenticidad de los certificados.        La clave privada de la CA, almacenada en /etc/openvpn/easy-rsa/pki/private/ca.key, que debe mantenerse segura y no compartirse, ya que con ella se firman los certificados dentro de la infraestructura VPN.  El siguiente paso en la configuración será la generación de los parámetros Diffie-Hellman (DH), que OpenVPN utilizará en el proceso de establecimiento de sesión segura entre los nodos de la VPN.El intercambio de claves Diffie-Hellman es un protocolo criptográfico que permite a dos partes comunicarse de manera segura sobre un canal no confiable, acordando una clave de cifrado común sin necesidad de enviarla explícitamente. Esto proporciona una capa adicional de seguridad en el cifrado de la conexión VPN.Para generar el certificado y la clave del servidor OpenVPN, utilizamos el siguiente comando dentro del directorio de trabajo de EasyRSA:debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa build-server-full server nopass* Notice:Using Easy-RSA configuration from: /etc/openvpn/easy-rsa/pki/vars* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..........+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+..........+.....+.......+......+..............+......+....+...+...+...........+....+.........+........+...+....+..+......+.........+....+..+....+.....+...+...+....+...+.....+...+...+......+...+.......+.........+.....+.+...+.....+...+.......+...........+............+.............+......+...............+.....+...+.............+..+...+...+.+.....+.+.........+...+.................+....+..+.......+...........+.......+..+.+..+...+....+..................+..+...+....+......+..+..........+......+.....+......+...+.......+...+.....+.+.........+...+..+..........+.................+.+.......................+............+.......+...+...+...........+....+.....+.......+..+............+.........+.+...........+...+....+............+.....+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++........+...+.+......+............+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+...+...+.........+....+.....+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.......+.....+.......+.....+...+.......+........+....+..+...............+..........+...+..+....+......+......+..............+....+.....+.+........+...+....+.....+...+...+...+....+...........................+...+..+...+......+.+...+......+.....+.......+..+...............+.+.....+.+...+..+.+..+...+.............+.................+....+...............+...+.....+.+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----* Notice:Keypair and certificate request completed. Your files are:req: /etc/openvpn/easy-rsa/pki/reqs/server.reqkey: /etc/openvpn/easy-rsa/pki/private/server.keyYou are about to sign the following certificate.Please check over the details shown below for accuracy. Note that this requesthas not been cryptographically verified. Please be sure it came from a trustedsource or that you have verified the request checksum with the sender.Request subject, to be signed as a server certificate for 825 days:subject=    commonName                = serverType the word 'yes' to continue, or any other input to abort.  Confirm request details: yesUsing configuration from /etc/openvpn/easy-rsa/pki/086ccb9e/temp.95232f12Enter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:Check that the request matches the signatureSignature okThe Subject's Distinguished Name is as followscommonName            :ASN.1 12:'server'Certificate is to be certified until Apr 28 18:52:24 2027 GMT (825 days)Write out database with 1 new entriesDatabase updated* Notice:Certificate created at: /etc/openvpn/easy-rsa/pki/issued/server.crtEste comando realiza dos acciones principales:      Genera la clave privada del servidor, que se almacena en:     /etc/openvpn/easy-rsa/pki/private/server.key        Esta clave debe mantenerse segura, ya que se utilizará para cifrar las comunicaciones del servidor VPN.        Crea y firma el certificado del servidor, que se guarda en:     /etc/openvpn/easy-rsa/pki/issued/server.crt        Este certificado será utilizado por el servidor OpenVPN para autenticarse ante los clientes VPN.  Como hemos ejecutado el comando con la opción nopass, el certificado no requiere una frase de paso para su uso, lo que facilita la automatización del arranque del servidor VPN sin intervención manual.Una vez generado el certificado del servidor, el siguiente paso es la creación de los parámetros Diffie-Hellman (DH), esenciales para el cifrado seguro durante el proceso de establecimiento de sesión. Esto se hace con el siguiente comando:debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa gen-dh* Notice:Using Easy-RSA configuration from: /etc/openvpn/easy-rsa/pki/vars* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)Generating DH parameters, 2048 bit long safe prime.......+...................................................................................................................................+.............................................................+...............................................................................................................................................................................................................................................................+.............+...................................+.......................................................+...............................................................................................................................................................................................................................................................................................................................................................................................................................+....................................................................................+.......................................................................................................+..........................................................................................................................................................+.............................................................................+...........................................................+...............................................................................+.............................................................................................................................................................................................................+...................................................................................................................................+...................................................................................+...........................+................................................................................................................+...........................................................................++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++** Notice:DH parameters of size 2048 created at /etc/openvpn/easy-rsa/pki/dh.pemEste proceso puede tardar varios minutos, ya que se generan números primos grandes que serán utilizados en el protocolo de intercambio de claves. Una vez completado, los parámetros DH se guardan en:/etc/openvpn/easy-rsa/pki/dh.pemPara que un cliente pueda autenticarse en la VPN, necesita un certificado y una clave privada, que deben ser generados en el servidor OpenVPN utilizando Easy-RSA. Esto se realiza con el siguiente comando:debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa build-client-full cliente1 nopassAquí, cliente1 es el nombre del cliente y la opción nopass indica que la clave privada del cliente no tendrá contraseña.Una vez generados, los archivos necesarios para la autenticación del cliente son:  ca.crt: Certificado de la Autoridad Certificadora (CA), que permite verificar la autenticidad de los certificados emitidos.  cliente1.crt: Certificado específico del cliente.  cliente1.key: Clave privada del cliente.Ahora, copiamos los ficheros necesarios a una carpeta temporal que nos servirá para transferir a la máquina Cliente1:root@servidor:~# cp /etc/openvpn/easy-rsa/pki/ca.crt /home/debian/cliente1/root@servidor:~# cp /etc/openvpn/easy-rsa/pki/issued/cliente1.crt /home/debian/cliente1/root@servidor:~# cp /etc/openvpn/easy-rsa/pki/private/cliente1.key /home/debian/cliente1/Cambiamos los permisos para que el usuario debian pueda acceder a ellos:debian@servidor:~$ sudo chown -R debian:debian cliente1/Y verificamos que los archivos han sido copiados correctamente:debian@servidor:~$ ls -l cliente1/total 16-rw------- 1 debian debian 1180 Jan 23 19:22 ca.crt-rw------- 1 debian debian 4471 Jan 23 19:23 cliente1.crt-rw------- 1 debian debian 1704 Jan 23 19:23 cliente1.keyPara transferir estos archivos al cliente, usaremos scp (Secure Copy Protocol), copiándolos a la IP 192.168.1.2:debian@servidor:~$ cd cliente1/debian@servidor:~/cliente1$ scp * debian@192.168.1.2:/home/debianThe authenticity of host '192.168.1.2 (192.168.1.2)' can't be established.ED25519 key fingerprint is SHA256:Gojcktfl97qAXF9KaBhKTK93gIYeN/574t8Ph9Zl2D0.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '192.168.1.2' (ED25519) to the list of known hosts.debian@192.168.1.2's password: ca.crt                                        100% 1180   486.0KB/s   00:00    cliente1.crt                                  100% 4471     2.7MB/s   00:00    cliente1.key                                  100% 1704   763.9KB/s   00:00 El servidor OpenVPN está configurado en /etc/openvpn/server/servidor.conf con los siguientes parámetros clave:debian@servidor:~$ sudo cat /etc/openvpn/server/servidor.confport 1194proto udpdev tunca /etc/openvpn/easy-rsa/pki/ca.crtcert /etc/openvpn/easy-rsa/pki/issued/server.crtkey /etc/openvpn/easy-rsa/pki/private/server.keydh /etc/openvpn/easy-rsa/pki/dh.pemtopology subnetserver 10.99.99.0 255.255.255.0ifconfig-pool-persist /var/log/openvpn/ipp.txtpush \"route 192.168.2.0 255.255.255.0\"keepalive 10 120cipher AES-256-CBCpersist-keypersist-tunstatus /var/log/openvpn/openvpn-status.logverb 3explicit-exit-notify 1Donde:  Puertos y protocolo: OpenVPN escucha en el puerto 1194 utilizando UDP.  Configuración de certificados: Se especifican el certificado de la CA, el certificado del servidor y su clave privada.  Topología de red: Se usa topology subnet, lo que permite asignar direcciones IP individuales dentro de la subred VPN.  Direcciones IP de la VPN: Se define la subred 10.99.99.0/24 con ifconfig-pool-persist para asignar direcciones IP fijas a clientes recurrentes.  Enrutamiento: Se usa push \"route 192.168.2.0 255.255.255.0\" para permitir a los clientes acceder a la red 192.168.2.0/24.  Seguridad: Se especifica el cifrado AES-256-CBC y parámetros como persist-key y persist-tun para mantener la sesión en caso de reinicios.  Registro y verbosidad: Se habilita el registro de estado en /var/log/openvpn/openvpn-status.log y verb 3 para obtener información de depuración.Ahora, habilitamos el servicio OpenVPN para poner en marcha el túnel:debian@servidor:~$ sudo systemctl enable --now openvpn-server@servidorCreated symlink /etc/systemd/system/multi-user.target.wants/openvpn-server@servidor.service → /lib/systemd/system/openvpn-server@.service.debian@servidor:~$ [ 8384.381168] tun: Universal TUN/TAP device driver, 1.6Verificamos su estado y vemos que está funcionando correctamente:debian@servidor:~$ sudo systemctl status openvpn-server@servidor● openvpn-server@servidor.service - OpenVPN service for servidor     Loaded: loaded (/lib/systemd/system/openvpn-server@.service; enabled; pres&gt;     Active: active (running) since Thu 2025-01-23 20:44:51 UTC; 1min 53s ago       Docs: man:openvpn(8)             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage             https://community.openvpn.net/openvpn/wiki/HOWTO   Main PID: 1024 (openvpn)     Status: \"Initialization Sequence Completed\"      Tasks: 1 (limit: 2348)     Memory: 1.7M        CPU: 35ms     CGroup: /system.slice/system-openvpn\\x2dserver.slice/openvpn-server@servid&gt;             └─1024 /usr/sbin/openvpn --status /run/openvpn-server/status-servi&gt;Si mostramos las interfaces con sus respectivos direccionamientos nos damos cuenta que la interfaz de túnel tun0 se crea correctamente con la dirección 10.99.99.1, confirmando que OpenVPN está activo.debian@servidor:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:fe:ae:66:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::efe:aeff:fe66:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:fe:ae:66:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 192.168.2.1/24 brd 192.168.2.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::efe:aeff:fe66:1/64 scope link        valid_lft forever preferred_lft forever4: ens6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:fe:ae:66:00:02 brd ff:ff:ff:ff:ff:ff    altname enp0s6    inet 192.168.122.222/24 brd 192.168.122.255 scope global dynamic ens6       valid_lft 2320sec preferred_lft 2320sec    inet6 fe80::efe:aeff:fe66:2/64 scope link        valid_lft forever preferred_lft forever5: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500    link/none     inet 10.99.99.1/24 scope global tun0       valid_lft forever preferred_lft forever    inet6 fe80::774f:979b:9e65:1c85/64 scope link stable-privacy        valid_lft forever preferred_lft foreverConfiguración del Cliente1En la máquina cliente Cliente1, instalamos OpenVPN:sudo apt updatesudo apt install openvpn -yLos archivos de certificado y clave los movemos a /etc/openvpn/client/ y le cambiamos los permisos a root:debian@cliente1:~$ sudo mv cliente/* /etc/openvpn/client/debian@cliente1:~$ sudo chown -R root:root /etc/openvpn/client/Verificamos que tengan los permisos correctos:debian@cliente1:~$ ls -l /etc/openvpn/client/total 16-rw------- 1 root root 1180 Jan 23 20:37 ca.crt-rw------- 1 root root 4471 Jan 23 20:37 cliente1.crt-rw------- 1 root root 1704 Jan 23 20:37 cliente1.keyY pasamos a la configuración del cliente, el cual se encuentra en /etc/openvpn/client/client.conf:debian@cliente1:~$ sudo cat /etc/openvpn/client/client.confclientdev tunproto udpremote 192.168.1.1 1194resolv-retry infinitenobindpersist-keypersist-tunca /etc/openvpn/client/ca.crtcert /etc/openvpn/client/cliente1.crtkey /etc/openvpn/client/cliente1.keyremote-cert-tls servercipher AES-256-CBCverb 3Donde:  Modo cliente: client  Interfaz virtual: dev tun  Protocolo y puerto: proto udp en el puerto 1194  Dirección del servidor: remote 192.168.1.1 1194  Persistencia: persist-key y persist-tun para mantener la sesión  Seguridad: Se especifican los archivos ca.crt, cliente1.crt y cliente1.key, además del cifrado AES-256-CBC.  Verbosidad: verb 3 para registros detallados.Conectamos el cliente a la VPN y verificamos su estado:debian@cliente1:~$ sudo systemctl enable --now openvpn-client@clientdebian@cliente1:~$ sudo systemctl status openvpn-client@client● openvpn-client@client.service - OpenVPN tunnel for client     Loaded: loaded (/lib/systemd/system/openvpn-client@.service; enabled; pres     Active: active (running) since Thu 2025-01-23 21:41:41 UTC; 1min 25s ago       Docs: man:openvpn(8)             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage             https://community.openvpn.net/openvpn/wiki/HOWTO   Main PID: 713 (openvpn)     Status: \"Initialization Sequence Completed\"      Tasks: 1 (limit: 2349)     Memory: 1.9M        CPU: 39ms     CGroup: /system.slice/system-openvpn\\x2dclient.slice/openvpn-client@client             └─713 /usr/sbin/openvpn --suppress-timestamps --nobind --config clY si la conexión es exitosa, la interfaz tun0 aparecerá con la IP 10.99.99.2, lo que indica que el cliente está dentro de la red VPN:debian@cliente1:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:3a:24:e0:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.2/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::e3a:24ff:fee0:0/64 scope link        valid_lft forever preferred_lft forever3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500    link/none     inet 10.99.99.2/24 scope global tun0       valid_lft forever preferred_lft forever    inet6 fe80::d9f3:6eaa:7b14:2952/64 scope link stable-privacy        valid_lft forever preferred_lft foreverComprobaciónPara comprobar que el cliente puede alcanzar la red remota 192.168.2.0/24 a través del servidor VPN, se usa traceroute:debian@cliente1:~$ traceroute 192.168.2.2traceroute to 192.168.2.2 (192.168.2.2), 30 hops max, 60 byte packets 1  10.99.99.1 (10.99.99.1)  1.910 ms  1.824 ms  1.814 ms 2  192.168.2.2 (192.168.2.2)  2.734 ms  2.755 ms  2.755 msSi el tráfico sigue el camino esperado a través de la VPN, significa que la configuración ha sido exitosa."
  },
  
  {
    "title": "Recolección centralizada de logs de sistema, mediante journald",
    "url": "/posts/journald/",
    "categories": "Sistemas, Monitoreo y Gestión de Logs",
    "tags": "Monitoreo y Gestión de Logs",
    "date": "2025-01-21 14:00:00 +0100",
    





    
    "snippet": "Implementa en tu escenario de trabajo de Openstack, un sistema de recolección de log mediante journald. Para ello debes, implementar un sistema de recolección de log mediante el paquete systemd-jou...",
    "content": "Implementa en tu escenario de trabajo de Openstack, un sistema de recolección de log mediante journald. Para ello debes, implementar un sistema de recolección de log mediante el paquete systemd-journal-remote, o similares.Instalación de systemd-journal-remoteEn nuestro entorno, el primer paso será instalar el paquete systemd-journal-remote, que nos brindará la posibilidad de acceder a estas máquinas de manera remota. Para llevar a cabo la instalación en las máquinas de nuestro escenario, emplearemos el gestor de paquetes apt en Luffy, que está basado en Debian 12. Además, instalaremos el mismo paquete en los contenedores Nami y Sanji, que están alojados dentro de Luffy. Por otro lado, en Zoro, que ejecuta Rocky, utilizaremos el gestor de paquetes dnf para realizar la instalación.pablo@luffy:~$ sudo apt install systemd-journal-remote -y[pablo@zoro ~]$ sudo dnf install systemd-journal-remote -ypablo@sanji:~$ sudo apt install systemd-journal-remote -ypablo@nami:~$ sudo apt install systemd-journal-remote -yEn el servidor, habilitaremos y activaremos los dos componentes de systemd necesarios para recibir los mensajes de registro con el siguiente comando:pablo@luffy:~$ sudo systemctl enable --now systemd-journal-remote.socketCreated symlink /etc/systemd/system/sockets.target.wants/systemd-journal-remote.socket → /lib/systemd/system/systemd-journal-remote.socket.pablo@luffy:~$ sudo systemctl enable systemd-journal-remote.serviceEn el cliente, habilitaremos el componente que systemd usa para enviar los mensajes de registro al servidor:[pablo@zoro ~]$ sudo systemctl enable systemd-journal-upload.serviceCreated symlink /etc/systemd/system/multi-user.target.wants/systemd-journal-upload.service → /usr/lib/systemd/system/systemd-journal-upload.service.Luego, en el servidor, abriremos los puertos 19532 y 80 en el firewall. Esto permitirá que el servidor reciba los mensajes de registro del cliente. El puerto 80 será utilizado por certbot para generar el certificado TLS. Sin embargo, en nuestro caso no tenemos ningún cortafuegos, por lo que no será necesario realizar esta configuración.Generación de claves y certificadosDado que utilizaremos el servicio con cifrado para asegurar que nuestros registros estén protegidos, procederemos a generar los certificados utilizando OpenSSL. Aunque podemos generar los certificados manualmente, existe una herramienta llamada Easy RSA que facilita este proceso de forma automatizada. Yo me encargaré de generar todos los certificados en Luffy y luego los transferiré a las máquinas correspondientes.Para comenzar, en Luffy ejecutaremos el siguiente comando para instalar Easy RSA y OpenSSL:pablo@luffy:~$ sudo apt install easy-rsa openssl -yEsta utilidad incluye un archivo de ejemplo que nos ayudará a generar los certificados. Primero, copiaremos el archivo de ejemplo y luego editaremos los valores necesarios para personalizar la configuración:pablo@luffy:/usr/share/easy-rsa$ sudo cp vars.example varspablo@luffy:/usr/share/easy-rsa$ sudo nano varspablo@luffy:/usr/share/easy-rsa$ cat varsset_var EASYRSA_REQ_COUNTRY     \"ES\"set_var EASYRSA_REQ_PROVINCE    \"Sevilla\"set_var EASYRSA_REQ_CITY        \"Dos Hermanas\"set_var EASYRSA_REQ_ORG         \"PabloMartin SL\"set_var EASYRSA_REQ_EMAIL       \"pmartinhidalgo19@gmail.com\"set_var EASYRSA_REQ_OU          \"Informatica\"A continuación, vamos a crear la estructura de directorios junto a los archivos necesarios para poder comenzar a trabajar con easyRSA:pablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa init-pki* Notice:  init-pki complete; you may now create a CA or requests.  Your newly created PKI dir is:  * /usr/share/easy-rsa/pkiSeguidamente, construimos nuestra CA:pablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa build-ca nopass* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)Using configuration from /usr/share/easy-rsa/pki/eff500c6/temp.8849e576...+..............+...+.........+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+..+...+...+....+......+.....+......+....+......+...+.....+..........+...+..+.+......+........+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+..+.............+..+.+......+.........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++...+......+.+...+........+...+....+.....+......+.......+........+.+......+.........+.....+.+.....+.........+...+...+.........+...+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+....+......+........+....+........+.......+...+..+.+..+............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+...+......+......+...+....+.....+...+.............+..+...+.+...+...+.....+.......+.....+.............+..............+...............+...............+.+..+.+......+.........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:luffy.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtAhora vamos a generar la clave privada de todas las máquina, además, generaremos a la vez una solicitud de firma del certificado:pablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa gen-req zoro nopass-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:zoro.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtpablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa gen-req nami nopass-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:nami.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtpablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa gen-req sanji nopass-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:sanji.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtpablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa gen-req luffy nopass-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:luffy.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtUna vez generadas las claves privadas y las solicitudes de firma de los certificados, procederemos a firmarlas. Para evitar repetir el proceso en cada máquina, mostraremos cómo firmar el certificado de Luffy, ya que los demás se firman de la misma manera.En primer lugar, ejecutaremos el siguiente comando en Luffy para firmar la solicitud de certificado:pablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server luffy* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)You are about to sign the following certificate.Please check over the details shown below for accuracy. Note that this requesthas not been cryptographically verified. Please be sure it came from a trustedsource or that you have verified the request checksum with the sender.Request subject, to be signed as a server certificate for 825 days:subject=    commonName                = luffy.pablo.gonzalonazareno.orgType the word 'yes' to continue, or any other input to abort.  Confirm request details: yesUsing configuration from /usr/share/easy-rsa/pki/732b7266/temp.39f65a14Check that the request matches the signatureSignature okThe Subject's Distinguished Name is as followscommonName            :ASN.1 12:'luffy.pablo.gonzalonazareno.org'Certificate is to be certified until Apr 27 07:27:31 2027 GMT (825 days)Write out database with 1 new entriesDatabase updated* Notice:Certificate created at: /usr/share/easy-rsa/pki/issued/luffy.crtDurante el proceso, EasyRSA nos pedirá que confirmemos la firma y que verifiquemos los datos de la solicitud. Aceptaremos escribiendo yes y luego se generará el certificado firmado correspondiente.Tras firmar el certificado de Luffy, repetiremos el mismo procedimiento para las demás máquinas, sustituyendo luffy por el nombre correspondiente de cada una. Esto asegurará que todas las máquinas tengan su certificado firmado correctamente.Mover los certificados a las máquinas correspondientesAhora debemos transferir los certificados y claves privadas a las máquinas correspondientes utilizando el método para compartir que queramos, en mi caso, a través de un servidor python3 temporal. Para cada una de ellas, copiaremos el certificado firmado, ubicado en /usr/share/easy-rsa/pki/issued/, junto con su clave privada, que se encuentra en /usr/share/easy-rsa/pki/private/.root@luffy:/usr/share/easy-rsa/pki/issued# ls -ltotal 32-rw------- 1 root root 4821 Jan 22 07:27 luffy.crt-rw------- 1 root root 4815 Jan 22 07:28 nami.crt-rw------- 1 root root 4821 Jan 22 07:28 sanji.crt-rw------- 1 root root 4815 Jan 22 07:28 zoro.crtroot@luffy:/usr/share/easy-rsa/pki/private# ls -ltotal 20-rw------- 1 root root 1704 Jan 21 12:54 ca.key-rw------- 1 root root 1704 Jan 22 07:24 luffy.key-rw------- 1 root root 1704 Jan 21 13:04 nami.key-rw------- 1 root root 1708 Jan 21 13:05 sanji.key-rw------- 1 root root 1704 Jan 21 13:01 zoro.keyAdemás, en el caso de los clientes, será necesario enviarles también el certificado de la Autoridad Certificadora (CA), almacenado en /usr/share/easy-rsa/pki/ca.crt.root@luffy:/usr/share/easy-rsa/pki# ls -ltotal 76-rw------- 1 root root 1285 Jan 21 12:54 ca.crtdrwx------ 2 root root 4096 Jan 22 07:28 certs_by_serial-rw------- 1 root root  374 Jan 22 07:28 index.txt-rw------- 1 root root   20 Jan 22 07:28 index.txt.attr-rw------- 1 root root   20 Jan 22 07:28 index.txt.attr.old-rw------- 1 root root  280 Jan 22 07:28 index.txt.olddrwx------ 2 root root 4096 Jan 22 07:28 issued-rw------- 1 root root 4935 Jan 21 11:57 openssl-easyrsa.cnfdrwx------ 2 root root 4096 Jan 22 07:25 privatedrwx------ 2 root root 4096 Jan 22 07:25 reqsdrwx------ 5 root root 4096 Jan 21 12:54 revoked-rw------- 1 root root 4927 Jan 22 07:28 safessl-easyrsa.cnf-rw------- 1 root root   33 Jan 22 07:28 serial-rw------- 1 root root   33 Jan 22 07:28 serial.old-rw------- 1 root root 9425 Jan 21 11:57 vars.exampleNos transferimos todos los archivos:root@luffy:/usr/share/easy-rsa/pki/issued# python3 -m http.serverServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...172.16.0.200 - - [22/Jan/2025 07:42:44] \"GET /zoro.crt HTTP/1.1\" 200 -192.168.0.3 - - [22/Jan/2025 07:46:12] \"GET /sanji.crt HTTP/1.1\" 200 -192.168.0.2 - - [22/Jan/2025 07:46:30] \"GET /nami.crt HTTP/1.1\" 200 -root@luffy:/usr/share/easy-rsa/pki# python3 -m http.serverServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...172.16.0.200 - - [22/Jan/2025 07:49:54] \"GET /ca.crt HTTP/1.1\" 200 -192.168.0.3 - - [22/Jan/2025 07:50:02] \"GET /ca.crt HTTP/1.1\" 200 -192.168.0.2 - - [22/Jan/2025 07:50:04] \"GET /ca.crt HTTP/1.1\" 200 -root@luffy:/usr/share/easy-rsa/pki/private# python3 -m http.serverServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...172.16.0.200 - - [22/Jan/2025 07:50:45] \"GET /zoro.key HTTP/1.1\" 200 -192.168.0.3 - - [22/Jan/2025 07:50:55] \"GET /sanji.key HTTP/1.1\" 200 -192.168.0.2 - - [22/Jan/2025 07:51:01] \"GET /nami.key HTTP/1.1\" 200 -El comando para transferir los archivos desde el cliente es el siguiente:wget http://&lt;IP_servidor&gt;:8000/ruta_al_archivoEl directorio /etc/letsencrypt/live/ es utilizado por Let’s Encrypt para almacenar certificados generados mediante certbot, pero como en este caso estamos generando los certificados manualmente con EasyRSA, ese directorio no existe por defecto. Por lo tanto, debemos crearlo para posteriormente mover los archivos allí:root@luffy:~# sudo mkdir -p /etc/letsencrypt/live/pablomh.esroot@luffy:~# sudo mv /usr/share/easy-rsa/pki/issued/luffy.crt /etc/letsencrypt/live/pablomh.es/root@luffy:~# sudo mv /usr/share/easy-rsa/pki/private/luffy.key /etc/letsencrypt/live/pablomh.es/Además, debemos generar un fichero combined.pem solamente en luffy, para realizar esto debemos concatenar nuestro certificado con la clave privada en un solo archivo:root@luffy:~# cat /etc/letsencrypt/live/pablomh.es/luffy.crt /etc/letsencrypt/live/pablomh.es/luffy.key &gt; /etc/letsencrypt/live/pablomh.es/combined.pemCambiamos los permisos:root@luffy:~# chown root:systemd-journal-remote /etc/letsencrypt/live/pablomh.es/*root@luffy:~# chmod 640 /etc/letsencrypt/live/pablomh.es/luffy.crtroot@luffy:~# chmod 640 /etc/letsencrypt/live/pablomh.es/luffy.keyQuedando luffy de la siguiente forma:root@luffy:~# ls -l /etc/letsencrypt/live/pablomh.es/total 20-rw-r--r-- 1 root systemd-journal-remote 6525 Jan 22 08:02 combined.pem-rw-r----- 1 root systemd-journal-remote 4821 Jan 22 07:27 luffy.crt-rw-r----- 1 root systemd-journal-remote 1704 Jan 22 07:24 luffy.keyAhora, en las demás máquinas realizamos lo requerido para que queden las máquinas de la siguiente forma:Zoro:[pablo@zoro ~]$ ls -l /etc/letsencrypt/live/zoro.pablomh.es/total 16-rw-r-----. 1 systemd-journal-upload systemd-journal-upload 1285 Jan 21 12:54 ca.crt-rw-r-----. 1 systemd-journal-upload systemd-journal-upload 4815 Jan 22 07:28 zoro.crt-rw-r-----. 1 systemd-journal-upload systemd-journal-upload 1704 Jan 21 13:01 zoro.keySanji:pablo@sanji:~$ sudo ls -l /etc/letsencrypt/live/sanji.pablomh.es/total 16-rw-r----- 1 systemd-journal-upload systemd-journal-upload 1285 Jan 21 12:54 ca.crt-rw-r----- 1 systemd-journal-upload systemd-journal-upload 4821 Jan 22 07:28 sanji.crt-rw-r----- 1 systemd-journal-upload systemd-journal-upload 1708 Jan 21 13:05 sanji.keyNami:pablo@nami:~$ sudo ls -l /etc/letsencrypt/live/nami.pablomh.es/total 16-rw-r----- 1 systemd-journal-upload systemd-journal-upload 1285 Jan 21 12:54 ca.crt-rw-r----- 1 systemd-journal-upload systemd-journal-upload 4815 Jan 22 07:28 nami.crt-rw-r----- 1 systemd-journal-upload systemd-journal-upload 1704 Jan 21 13:04 nami.keyAunque he empleado el directorio destinado a los certificados de Let’s Encrypt, no ha sido posible utilizarlos debido a la falta de control sobre el dominio gonzalonazareno.org. Por esta razón, los certificados fueron generados manualmente con anterioridad. Es importante destacar que la ubicación donde se almacenen no es relevante, siempre y cuando se configuren con los permisos adecuados.Configuración del servidorYa solamente nos quedaría indicar la configuración del servicio, donde tendremos que cambiar las rutas correspondientes a nuestros ficheros:pablo@luffy:~$ sudo cat /etc/systemd/journal-remote.conf[Remote]Seal=falseSplitMode=hostServerKeyFile=/etc/letsencrypt/live/pablomh.es/luffy.keyServerCertificateFile=/etc/letsencrypt/live/pablomh.es/luffy.crtTrustedCertificateFile=/etc/letsencrypt/live/pablomh.es/combined.pemUna vez configurado, reiniciamos el servicio y comprobamos que se haya levantado:pablo@luffy:~$ sudo systemctl restart systemd-journal-remote.servicepablo@luffy:~$ sudo systemctl status systemd-journal-remote.service● systemd-journal-remote.service - Journal Remote Sink Service     Loaded: loaded (/lib/systemd/system/systemd-journal-remote.service; indirect; preset: disabled)     Active: active (running) since Wed 2025-01-22 08:18:34 UTC; 3s agoTriggeredBy: ● systemd-journal-remote.socket       Docs: man:systemd-journal-remote(8)             man:journal-remote.conf(5)   Main PID: 40106 (systemd-journal)     Status: \"Processing requests...\"      Tasks: 1 (limit: 2314)     Memory: 2.0M        CPU: 78ms     CGroup: /system.slice/systemd-journal-remote.service             └─40106 /lib/systemd/systemd-journal-remote --listen-https=-3 --output=/var/log/journal/remote/Configuración del clienteLo que se debe hacer es agregar los archivos necesarios para la configuración, incluyendo tu clave privada y el certificado que te corresponde, así como el certificado de la Autoridad Certificadora (CA) que utilizaste para generar esos archivos.[pablo@zoro ~]$ sudo cat /etc/systemd/journal-upload.conf [Upload]URL=https://luffy.pablo.gonzalonazareno.org:19532ServerKeyFile=/etc/letsencrypt/live/zoro.pablomh.es/luffy.keyServerCertificateFile=/etc/letsencrypt/live/zoro.pablomh.es/luffy.crtTrustedCertificateFile=/etc/letsencrypt/live/zoro.pablomh.es/ca.crtReiniciamos el servicio y comprobamos el estado:[pablo@zoro ~]$ sudo systemctl restart systemd-journal-upload.service[pablo@zoro ~]$ sudo systemctl status systemd-journal-upload.service● systemd-journal-upload.service - Journal Remote Upload Service     Loaded: loaded (/usr/lib/systemd/system/systemd-journal-upload.service; enabled; preset: disabled)     Active: active (running) since Wed 2025-01-22 09:44:31 UTC; 3s ago       Docs: man:systemd-journal-upload(8)   Main PID: 2251 (systemd-journal)     Status: \"Processing input...\"      Tasks: 1 (limit: 10890)     Memory: 4.2M        CPU: 71ms     CGroup: /system.slice/systemd-journal-upload.service             └─2251 /usr/lib/systemd/systemd-journal-upload --save-stateJan 22 09:44:31 zoro systemd[1]: Started Journal Remote Upload Service.Comprobación de funcionamientoUna vez que ambos servicios estén en funcionamiento, se almacenará en el servidor un archivo que contendrá los registros (logs) generados por el cliente.root@luffy:~# ls -la /var/log/journal/remote/total 16396drwxr-xr-x  2 systemd-journal-remote systemd-journal-remote     4096 Jan 22 09:35 .drwxr-sr-x+ 4 root                   systemd-journal            4096 Jan 22 08:18 ..-rw-r-----  1 systemd-journal-remote systemd-journal-remote 16777216 Jan 22 09:39 remote-172.16.0.200.journalPodemos ver los logs de los diferentes servicios, por ejemplo realizaremos el filtro por httpd:root@luffy:~# journalctl -u httpd --file=/var/log/journal/remote/remote-172.16.0.200.journalJan 22 09:42:27 zoro systemd[1]: Starting The Apache HTTP Server...Jan 22 09:42:27 zoro httpd[2021]: Server configured, listening on: port 80Jan 22 09:42:27 zoro systemd[1]: Started The Apache HTTP Server."
  },
  
  {
    "title": "Systemd-Boot",
    "url": "/posts/systemd-boot/",
    "categories": "Sistemas, Systemd",
    "tags": "Systemd",
    "date": "2025-01-14 14:30:00 +0100",
    





    
    "snippet": "Los desarrolladores de Debian han propuesto el uso de systemd-boot para instalaciones UEFI de Debian Trixie, que se lanzará en 2025. Opción disponible, de momento, en instalaciones debian 13 en mod...",
    "content": "Los desarrolladores de Debian han propuesto el uso de systemd-boot para instalaciones UEFI de Debian Trixie, que se lanzará en 2025. Opción disponible, de momento, en instalaciones debian 13 en modo experto. El objetivo es agregar soporte de arranque seguro firmado a Debian para intentar resolver el problema relacionado con UEFI y Secure Boot con sistemas Debian. Proponen utilizar un gestor de arranque llamado “systemd-boot” para mejorar el proceso de arranque de Debian en sistemas UEFI.1. Instala en máquina virtual, debian 13 con systemd-boot, y familiarízate con este nuevo gestor de arranque.En esta parte del artículo, aprenderemos a instalar Debian 13 (Trixie) con el gestor de arranque systemd-boot en un sistema UEFI.Comenzamos descargando la ISO de Debian 13 Trixie desde la página oficial del proyecto Debian. En esta sección elegiremos la opción que más nos convenga, en mi caso la netinst.En esta instalación utilizaremos QEMU/KVM como plataforma de virtualización para crear la máquina virtual. Es fundamental configurar correctamente UEFI antes de comenzar la instalación, ya que Debian 13 utiliza este modo de arranque junto con systemd-boot.Para asegurarnos de que systemd-boot se instale correctamente en Debian 13, es imprescindible seleccionar la instalación en modo experto. Esto nos permitirá elegir manualmente el gestor de arranque y realizar configuraciones avanzadas.En lugar de seleccionar la opción estándar Install, elegimos “Advanced options” y luego “Expert install”.Una vez elegida esta opción, seguimos con las instalación en donde primero de todo debemos elegir el idioma:Durante la instalación en modo experto de Debian 13, el instalador puede ofrecer una opción llamada “Detectar y montar el medio de instalación”. Esta opción es especialmente útil si estamos utilizando una instalación por red o un medio de instalación que no es el disco duro local (por ejemplo, un USB o una ISO montada). Por lo tanto, seleccionamos la que nos muestra automáticamente.Seguidamente nos mostrará una serie de componentes opcionales para descargarlos en caso de ser necesarios. Yo personalmente no he seleccionado ninguno, pues para el objetivo de esta práctica no nos hará falta:Luego, nos pedirá como queremos configurar la red, elegimos automáticamente:Una vez seleccionado esto, seguiremos con la instalación tal y como estamos acostumbrados. Pero llegados al punto del particionado de discos debemos pararnos.El particionado del disco es una de las etapas clave en la instalación de Debian, especialmente cuando estamos configurando un sistema UEFI. Al seleccionar el particionado del disco, es importante configurar adecuadamente las particiones para que Debian se instale correctamente y utilice systemd-boot como gestor de arranque.Por lo tanto, debemos seleccionar que queremos un particionado manual, pues nos permite tener un control total sobre cómo se organiza el disco.Luego, seleccionamos el disco donde realizaremos el particionado, en este caso solo disponemos de uno:Nos preguntará que si queremos particionar el disco y le diremos que “Sí”, luego nos dará a elegir que tipo de tabla de partición vamos a utilizar. En este caso seleccionamos gpt:Ahora, debemos realizar el particionado, el cual yo haré de la siguiente forma:  Partición EFI:  Tipo: EFI System Partition  Tamaño recomendado: Al menos 100 MB, aunque se recomienda entre 300 MB y 500 MB para asegurar un arranque adecuado.  Punto de montaje: /boot/efi  Esta partición es crucial para UEFI, ya que contiene los archivos del cargador de arranque, como systemd-boot.  Partición raíz (/):  Tipo: ext4  Tamaño recomendado: Al menos 20 GB o más  Punto de montaje: /  Esta partición contendrá el sistema operativo y todos los archivos de configuración.  Área de intercambio (swap):  Tipo: Linux swap  Tamaño recomendado: el tamaño será el restante, en este caso 142MB.  Esta partición es utilizada como espacio de intercambio cuando la RAM se llena.De forma que el particionado quedaría de la siguiente forma:Una vez que hayamos creado y configurado las particiones, el instalador nos pedirá que confirmemos el esquema de particionado. Si todo es correcto, seleccionaremos “Sí” para aplicar los cambios. Esto formateará el disco y creará las particiones seleccionadas.Bien, pues una vez realizado el particionado debemos instalar el sistema base, el cual nos dará a elegir que núcleo queremos. Yo personalmente he seleccionado la segunda opción:Después, nos pedirá que opción elegir en cuanto a los controladores se refiere. Yo elegiré “dirigido”, pues para esta práctica no me interesa cargar tantos drivers.Cuando lleguemos a la parte del proceso de instalación donde el instalador te pregunta si deseas analizar medios de instalación adicionales, es importante seleccionar “No”.Esta opción permite al instalador buscar e instalar paquetes adicionales desde otros medios (por ejemplo, discos o dispositivos USB adicionales que contengan paquetes de instalación). Sin embargo, en la mayoría de los casos, no es necesario agregar más medios de instalación si ya estamos utilizando una imagen ISO completa o una instalación por red.Cuando lleguemos a la opción de “¿Desea utilizar una réplica en red?” durante la instalación, es importante seleccionar “Sí”.En este paso, el instalador te da la opción de utilizar una réplica en red (mirror) para obtener paquetes adicionales y actualizaciones durante el proceso de instalación. Dado que estás utilizando una imagen de instalación mínima (netinst), el sistema base que se instalará inicialmente será bastante reducido. Al seleccionar “Sí”, podrás acceder a una réplica en red que proporcionará los paquetes necesarios para completar la instalación y actualizar el sistema.Al hacerlo, se descargará software adicional y se instalarán los paquetes que permiten completar un sistema Debian completamente funcional.Seguidamente seleccionamos HTTP como el protocolo para acceder a la réplica en red.En esta etapa del proceso de instalación, nos preguntará si queremos usar firmware no libre para que ciertos componentes de hardware (como tarjetas Wi-Fi, chipsets de audio, etc.) funcionen correctamente.El firmware no libre es necesario para que algunos dispositivos de hardware funcionen, pero no es software libre. Sin embargo, Debian ofrece estos firmwares para garantizar la compatibilidad con una amplia variedad de hardware, aunque sus licencias restringen la libertad de usar, modificar o compartir el software.Seleccionar “Sí” en esta opción permitirá que el instalador cargue y use los firmwares no libres que puedan ser necesarios para que tu hardware funcione correctamente, especialmente si estás utilizando hardware específico que requiere controladores no libres.En esta etapa, se te preguntará si deseas habilitar ciertos servicios de actualización para tu sistema Debian. Debian ofrece dos servicios principales relacionados con las actualizaciones: actualizaciones de seguridad y actualizaciones de la distribución.      Actualizaciones de seguridad: Estas actualizaciones son fundamentales para mantener el sistema protegido contra vulnerabilidades de seguridad. Debian recomienda encarecidamente habilitar este servicio para recibir actualizaciones que solucionen posibles fallos de seguridad en el sistema.        Actualizaciones de la distribución: Este servicio ofrece versiones más recientes de los paquetes del sistema que contienen cambios importantes. Mantener este servicio habilitado asegura que el sistema se mantenga actualizado con las últimas versiones estables de los paquetes.        Programas migrados a nuevas versiones (opcional): Esta opción permite acceder a programas más recientes que se encuentran en desarrollo o que han sido migrados a una nueva versión. Estos paquetes pueden no ser tan estables, ya que no han sido probados completamente, pero pueden ofrecer nuevas características.  Por lo tanto, dejamos marcadas las dos primeras opciones que vienen por defecto:En esta parte nos dirá si queremos que se realicen actualizaciones automáticas, aunque es una opción interesante, para esta práctica seleccionaremos que no:En la selección de programas elegiremos a nuestro gusto:Después de varios minutos en los que el instalador descarga e instala los paquetes del sistema, llegamos a uno de los puntos más importantes de la instalación: la selección del cargador de arranque.El cargador de arranque es un software esencial que permite iniciar el sistema operativo tras encender el equipo. Tradicionalmente, Debian utiliza GRUB como su gestor de arranque por defecto, pero en esta instalación estamos configurando systemd-boot, un gestor más ligero y moderno diseñado específicamente para sistemas UEFI.Después de completar la instalación del sistema y llegar al momento del reinicio, es necesario desactivar el “Secure Boot” en el firmware UEFI para que el cargador de arranque systemd-boot funcione correctamente.¿Por qué desactivar Secure Boot?El Secure Boot es una característica de UEFI diseñada para evitar que se cargue software no firmado o malicioso al iniciar el sistema. Sin embargo, en algunos casos, como al instalar Debian con systemd-boot, el firmware puede bloquear el arranque si el sistema operativo no está firmado digitalmente o no es compatible con el Secure Boot.systemd-boot es un gestor de arranque que no siempre es compatible con Secure Boot de forma predeterminada, por lo que es necesario desactivarlo para permitir que el sistema se inicie correctamente.Para desactivarlo seguimos los pasos de las siguientes capturas:Guardamos los cambios con F10 y le damos a “Continue”, de esta forma ya se iniciará correctamente el sistema:Después de haber reiniciado el sistema con Secure Boot desactivado, es importante verificar que el cargador de arranque systemd-boot se ha instalado y configurado correctamente.Para hacerlo, utilizamos el siguiente comando en la terminal:root@debian:~# bootctl statusbootctl es una herramienta integrada en systemd que permite gestionar systemd-boot. El subcomando status muestra información sobre el estado actual del gestor de arranque.Como podemos observar en la imagen, systemd-boot está instalado y configurado correctamente.Por último, podemos ver la versión de Debian instalando Neofetch:Y como vemos nos sale la versión correcta:2. Cambiar el tradicional gestor de arranque grub por systemd boot en una máquina virtual con debian 12.1. Ventajas y Desventajassystemd-bootVentajas      Diseño Ligero y Sencillo:systemd-boot destaca por su enfoque minimalista, lo que lo hace más liviano en comparación con GRUB. Su simplicidad puede traducirse en tiempos de arranque más ágiles y un menor consumo de recursos.        Integración con Systemd:Al estar diseñado para trabajar de manera estrecha con systemd, este gestor de arranque facilita la administración del sistema, especialmente en entornos donde systemd ya está implementado como parte esencial.        Inicio Rápido:Debido a su diseño optimizado, systemd-boot suele arrancar el sistema más rápido que GRUB, lo que puede ser una ventaja para quienes buscan reducir los tiempos de inicio.  Desventajas      Menos Opciones de Configuración:Su enfoque simplificado significa que carece de algunas características avanzadas que GRUB sí proporciona. Esto puede ser una limitación para quienes requieren configuraciones detalladas y personalizadas. Además, solo es compatible con sistemas que utilizan EFI.        Compatibilidad con Múltiples Sistemas Operativos:A diferencia de GRUB, que maneja de forma eficiente sistemas operativos múltiples en un solo menú de arranque, systemd-boot puede necesitar configuraciones manuales adicionales para lograr lo mismo.  GRUBVentajas      Soporte para Arranque Dual y Multisistema:GRUB es ideal para aquellos que necesitan administrar varios sistemas operativos en una sola máquina, ya que facilita la selección del sistema a iniciar desde un menú de arranque.        Opciones de Configuración Avanzadas:Proporciona una amplia gama de opciones para personalizar el proceso de arranque, lo que lo convierte en una herramienta poderosa para usuarios que requieren un control detallado sobre la configuración del sistema.  Desventajas      Mayor Complejidad para Principiantes:Debido a sus múltiples opciones de configuración, puede resultar difícil de manejar para usuarios con poca experiencia. Editar archivos de configuración manualmente puede ser una tarea desafiante para quienes no están familiarizados con su funcionamiento.        Tiempo de Arranque Más Lento:Comparado con gestores de arranque más livianos como systemd-boot, GRUB puede tardar más en cargar el sistema operativo, lo que podría ser un inconveniente para quienes buscan un arranque rápido.  2. Versiones de GNU/Linux que están usando systemd boot como gestor de arranque por defectoEn mayo de 2011, Fedora se convirtió en la primera distribución principal de Linux en habilitar systemd por defecto.Distribuciones en las que systemd está habilitado de forma predeterminada:  Arch Linux, Clear Linux, Pop!_Os, Fedora y Antergos.3. Migración de Grub a SystemdBootPara hacer la migración del gestor de arranque grub a systemd-boot usaré una máquina virtual con Debian 12.Tenemos el siguiente esquema de particiones:Como podemos comprobar,el sistema ha arrancado mediante grub, ya que tiene su partición correspondiente /boot/efi. Para hacer la instalación de SystemdBoot es importante que la partición de arranque se encuentre en formato vfat, ya que SystemdBoot no reconoce otro sistema de de ficheros.Empezaremos instalando el paquete que contiene todos los binarios que usaremos para el cambio:sudo apt install systemd-bootPor defecto, en un sistema con UEFI (Unified Extensible Firmware Interface), la partición de arranque EFI (/boot/efi) ya debería estar formateada en FAT32. Esto se debe a que el sistema UEFI utiliza este formato para almacenar los cargadores de arranque (como systemd-boot o GRUB) y otros archivos necesarios para el arranque del sistema.Pero por error durante la instalación, he tenido que modificar el formato de la partición de la siguiente forma:pablo@debian:~$ sudo gdisk /dev/vdaCommand (? for help): t Partition number (1-3): 1Current type is 700 (Microsoft basic data)Hex code or GUID (L to show codes, Enter = 700): EF00Changed type of partition to 'EFI system partition'Command (? for help): wFinal checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTINGPARTITIONS!!Do you want to proceed? (Y/N): YOK; writing new GUID partition table (GPT) to /dev/vda.Warning: The kernel is still using the old partition table.The new table will be used at the next reboot or after yourun partprobe(8) or kpartx(8)The operation has completed successfully.Esto formateó la partición correctamente en FAT32. Después de formatear la partición, he ejecutado el comando bootctl para instalar el cargador de arranque, y esta vez se completó correctamente sin errores:pablo@debian:~$ sudo bootctl --path=/boot/efi installCreated \"/boot/efi/EFI/systemd\".Created \"/boot/efi/EFI/BOOT\".Created \"/boot/efi/loader\".Created \"/boot/efi/loader/entries\".Created \"/boot/efi/EFI/Linux\".Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi\" to \"/boot/efi/EFI/systemd/systemd-bootx64.efi\".Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi\" to \"/boot/efi/EFI/BOOT/BOOTX64.EFI\".Random seed file /boot/efi/loader/random-seed successfully written (32 bytes).Not installing system token, since we are running in a virtualized environment.Created EFI boot entry \"Linux Boot Manager\".Ahora, la instalación se completó con éxito, creando los archivos y directorios esperados en /boot/efi:A continuación ejecutaremos el siguiente comando:pablo@debian:~$ sudo bootctl install Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi\" to \"/boot/efi/EFI/systemd/systemd-bootx64.efi\".Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi\" to \"/boot/efi/EFI/BOOT/BOOTX64.EFI\".Random seed file /boot/efi/loader/random-seed successfully written (32 bytes).Not installing system token, since we are running in a virtualized environment.Created EFI boot entry \"Linux Boot Manager\".Este comando instalará el cargador de inicialización de SystemdBoot.Vamos a editar el fichero loader.conf el cual se encuentra en el directorio que hemos comentado antes. En este fichero definimos las opciones de arranque del cargador. Habrá que insertar el siguiente contenido:pablo@debian:~$ sudo cat /boot/efi/loader/loader.conf timeout 3console-mode keepeditor yesdefault debian.confPodemos comprobar que hemos especificado el fichero debian.conf, este fichero habrá que crearlo manualmente a continuación y será nuestra entrada por defecto. Todas las entradas del cargador de arranque serán definidas en el directorio /boot/efi/loader/entries como ficheros .conf.El fichero debian.conf que crearé contiene lo siguiente:pablo@debian:/boot/efi/loader/entries$ cat debian.conf title Debian pavlolinux /boot/vmlinuz-6.1.0-30-amd64initrd /boot/initrd.img-6.1.0-30-amd64options root=UUID=1b5bfe97-7afe-4adb-8230-a03707f63e2d rw  Title: Título de la entrada que veremos en el arranque.  Linux: Ruta de la imagen del kernel que vamos a iniciar, partiendo del directorio /boot/efi.  Initrd: Ruta de la imagen initrd que vamos a iniciar, partiendo del directorio /boot/efi.  Options: Partición raíz que se montará. En esta debemos especificar el UUID de la partición (Podemos obtenerlo con el comando blkid). Aquí también podemos definir las opciones de montaje, en mi caso rw, para lectura y escritura.También crearé otra entrada para la Shell EFI:pablo@debian:/boot/efi/loader/entries$ cat shellefi.conftitle EFI Shellefi /EFI/shellx64.efiEl firmware shellx64.efi podemos descargarlo desde el siguiente enlace:https://github.com/holoto/efi_shell_flash_bios/blob/master/Shellx64.efiEl cual moveremos a la ruta que hemos especificado:pablo@debian:~$ sudo mv Shellx64.efi /boot/efi/EFI/pablo@debian:~$ ls -l /boot/efi/EFI/total 948drwxr-xr-x 2 root root   4096 ene 16 14:20 BOOTdrwxr-xr-x 2 root root   4096 ene 16 13:46 debiandrwxr-xr-x 2 root root   4096 ene 16 14:11 Linux-rwxr-xr-x 1 root root 951744 ene 16 14:28 Shellx64.efidrwxr-xr-x 2 root root   4096 ene 16 14:20 systemdUna vez hecho esTo debemos desactivar el Secure Boot, podemos hacerlo desde la BIOS o bien ejecutando el comando:pablo@debian:~$ sudo mokutil --disable-validationpassword length: 8~16input password: input password again: Después, actualizaremos el gestor de arranque SystemdBoot:pablo@debian:~$ sudo bootctl updateSkipping \"/boot/efi/EFI/systemd/systemd-bootx64.efi\", since same boot loader version in place already.Skipping \"/boot/efi/EFI/BOOT/BOOTX64.EFI\", since same boot loader version in place already.Como último paso, podemos comprobar el orden de arranque con efibootmgr:pablo@debian:~$ efibootmgrBootCurrent: 0004Timeout: 0 secondsBootOrder: 0001,0004,0002,0000,0003Boot0000* UiAppBoot0001* Linux Boot ManagerBoot0002* UEFI Misc DeviceBoot0003* EFI Internal ShellBoot0004* debianEl primero debe ser Linux Boot Manager, podemos cambiar el orden con efibootmgr -o XXXXPodemos opcionalmente desintalar grub, aunque yo no lo haré en esta ocasión. Finalmente reiniciamos el equipo y comprobamos si arranca con SystemdBoot.A mi me dió fallo, y tras varias pruebas e investigando conseguí solucionarlo de la siguiente forma:Eliminé la entrada de debian.conf, la cual estaba rota ya que no reconocía bien los archivos:pablo@debian:~$ sudo rm /boot/efi/loader/entries/debian.confLuego, regeneré las entradas de systemd-boot para que apunten a los archivos correctos:pablo@debian:~$ sudo bootctl updateSkipping \"/boot/efi/EFI/systemd/systemd-bootx64.efi\", since same boot loader version in place already.Skipping \"/boot/efi/EFI/BOOT/BOOTX64.EFI\", since same boot loader version in place already.Y finalmente reinicié el sistema y me apareció correctamente:Pudiendo acceder sin problemas tanto al sistema:Como a la shell EFI:"
  },
  
  {
    "title": "systemd/sshfs",
    "url": "/posts/systemd/",
    "categories": "Sistemas, Systemd",
    "tags": "Systemd",
    "date": "2024-12-19 18:30:00 +0100",
    





    
    "snippet": "EnunciadoCrea dos instancias en OpenStack, basadas en la distribución de tu elección, anexa un volumen de 2GB.Una de las instancias hará de servidor, donde anexarás el volumen anterior. Deberás con...",
    "content": "EnunciadoCrea dos instancias en OpenStack, basadas en la distribución de tu elección, anexa un volumen de 2GB.Una de las instancias hará de servidor, donde anexarás el volumen anterior. Deberás configurar sshfs en el escenario, de tal forma que el cliente pueda montar el sistema de archivos remoto usando sshfs y systemd. La validación del usuario se realizará mediante clave pública/privada.      Monta manualmente el sistema de archivos remoto.        Monta el sistema de archivos remoto de forma automática, mediante fichero /etc/fstab.        Monta el sistema de archivos remoto de forma automática, mediante fichero unidad .mount        Mediante fichero unidad .mount creado en el punto 3 y crea un fichero unidad de automontaje. unidad.automount, para que se monte automáticamente cuando detecte peticiones al sistema de archivos remoto y se desmonte automáticamente transcurrido un tiempo.  Ejercicio 1Comenzamos creando el escenario necesario para la práctica, en donde utilizaremos dos instancias de OpenStack. Una de ellas actuará como servidor y otra como cliente.Luego, anexamos un volumen de 2GB a la instancia del servidor:Seguidamente accedemos a las máquinas y generamos un par de claves en ellas:debian@systemd-server:~$ ssh-keygenGenerating public/private rsa key pair.Enter file in which to save the key (/home/debian/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/debian/.ssh/id_rsaYour public key has been saved in /home/debian/.ssh/id_rsa.pubThe key fingerprint is:SHA256:nUOO1c1ppJFcV7DSmpBD3PUqjQkfIQttT7cf4k+F0Qw debian@systemd-serverThe key's randomart image is:+---[RSA 3072]----+|        .oooo+E=+||         o+==Oo=o||         .Oo=.B+.||         * *.@oo.||        S = O +.o||           . o ..||              o  ||               . ||                 |+----[SHA256]-----+debian@systemd-client:~$ ssh-keygen Generating public/private rsa key pair.Enter file in which to save the key (/home/debian/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/debian/.ssh/id_rsaYour public key has been saved in /home/debian/.ssh/id_rsa.pubThe key fingerprint is:SHA256:Mzy940zFH1GQxcXWT73pMETToeu9eVZ8yOP24PReETA debian@systemd-clientThe key's randomart image is:+---[RSA 3072]----+|            .EoBO||             .*oB||            ...++||       . . . o.+o||        S . oo=+ ||         + o..=o=||          +  o+o+||         + . ooo*||          o  ..*=|+----[SHA256]-----+Comprobamos que el volumen que hemos anexado anteriormente aparezca en la instancia:debian@systemd-server:~$ lsblkNAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTSvda     254:0    0   10G  0 disk ├─vda1  254:1    0  9.9G  0 part /├─vda14 254:14   0    3M  0 part └─vda15 254:15   0  124M  0 part /boot/efivdb     254:16   0    2G  0 disk Como vemos el volumen ha sido añadido, por lo que ahora vamos a usar fdisk para crear una nueva partición en el volumen vdb:debian@systemd-server:~$ sudo fdisk /dev/vdbWelcome to fdisk (util-linux 2.38.1).Changes will remain in memory only, until you decide to write them.Be careful before using the write command.The device contains 'ext4' signature and it will be removed by a write command. See fdisk(8) man page and --wipe option for more details.Device does not contain a recognized partition table.Created a new DOS (MBR) disklabel with disk identifier 0x954ead4c.Command (m for help): nPartition type   p   primary (0 primary, 0 extended, 4 free)   e   extended (container for logical partitions)Select (default p): pPartition number (1-4, default 1): 1First sector (2048-4194303, default 2048): Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-4194303, default 4194303): Created a new partition 1 of type 'Linux' and of size 2 GiB.Command (m for help): wThe partition table has been altered.Calling ioctl() to re-read partition table.Syncing disks.Volvemos a comprobar las particiones:debian@systemd-server:~$ lsblkNAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTSvda     254:0    0   10G  0 disk ├─vda1  254:1    0  9.9G  0 part /├─vda14 254:14   0    3M  0 part └─vda15 254:15   0  124M  0 part /boot/efivdb     254:16   0    2G  0 disk └─vdb1  254:17   0    2G  0 partFormateamos la partición que acabamos de crear con un sistema ext4:debian@systemd-server:~$ sudo mkfs.ext4 /dev/vdb1mke2fs 1.47.0 (5-Feb-2023)Discarding device blocks: done                            Creating filesystem with 524032 4k blocks and 131072 inodesFilesystem UUID: b891fbd6-085d-4d5b-88c6-dc6093301465Superblock backups stored on blocks: \t32768, 98304, 163840, 229376, 294912Allocating group tables: done                            Writing inode tables: done                            Creating journal (8192 blocks): doneWriting superblocks and filesystem accounting information: doneLuego creamos el punto de montaje de la particción y lo montamos en el directorio que hemos seleccionado:debian@systemd-server:~$ sudo mkdir -p /mountdebian@systemd-server:~$ sudo mount /dev/vdb1 /mountVolvemos a comprobar que la partición se ha montado correctamente en el directorio indicado:debian@systemd-server:~$ lsblkNAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTSvda     254:0    0   10G  0 disk ├─vda1  254:1    0  9.9G  0 part /├─vda14 254:14   0    3M  0 part └─vda15 254:15   0  124M  0 part /boot/efivdb     254:16   0    2G  0 disk └─vdb1  254:17   0    2G  0 part /mountCreamos un fichero de prueba que usaremos para comprobar más tarde que el montaje ha funcionado correctamente:debian@systemd-server:/mount$ cat kk.txt Buenas tardes por la mañanadebian@systemd-server:/mount$ ls -ltotal 20-rw-r--r-- 1 root root    29 Jan  9 07:51 kk.txtdrwx------ 2 root root 16384 Jan  9 07:48 lost+foundInstalamos sshfs en ambas instancias:debian@systemd-server:~$ sudo apt install sshfsdebian@systemd-client:~$ sudo apt install sshfsImportante, necesitaremos tener la clave pública de la máquina cliente en el fichero authorized_keys de la máquina servidor para que el montaje funcione correctamente.Por último, montamos el sistema de ficheros creado en la máquina servidor en la máquina cliente, utilizando sshfs con las siguientes instrucciones:debian@systemd-client:~$ mkdir montajedebian@systemd-client:~$ sshfs debian@10.0.0.22:/mount /home/debian/montaje/ -o IdentityFile=/home/debian/.ssh/id_rsaThe authenticity of host '10.0.0.22 (10.0.0.22)' can't be established.ED25519 key fingerprint is SHA256:jA8NMNDhdcLCYkll2HrP9UHnwsoIXcb/ZdbBlaNMvfo.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesdebian@systemd-client:~$ ls -l montaje/total 20-rw-r--r-- 1 root root    29 Jan  9 07:51 kk.txtdrwx------ 1 root root 16384 Jan  9 07:48 lost+founddebian@systemd-client:~$ cat montaje/kk.txt Buenas tardes por la mañanaComo vemos, el montaje ha funcionado a la perfección:debian@systemd-client:~$ df -hFilesystem               Size  Used Avail Use% Mounted onudev                     462M     0  462M   0% /devtmpfs                     97M  512K   96M   1% /run/dev/vda1                9.7G  1.2G  8.1G  13% /tmpfs                    481M     0  481M   0% /dev/shmtmpfs                    5.0M     0  5.0M   0% /run/lock/dev/vda15               124M   12M  113M  10% /boot/efitmpfs                     97M     0   97M   0% /run/user/1000debian@10.0.0.22:/mount  2.0G   28K  1.9G   1% /home/debian/montajeEjercicio 2Para la realización del montaje automático usaremos fstab, donde tendremos que añadir la siguiente línea al fichero /etc/fstab de la máquina cliente:sshfs#debian@10.0.0.22:/mount /mnt/sshfs fuse defaults,_netdev,identityfile=/home/debian/.ssh/id_rsa,allow_other 0 0Esta configuración permite montar un sistema de archivos remoto a través de SSH en el directorio local /mnt/sshfs. Para ello, se utiliza un usuario específico, una dirección IP, y se accede a la carpeta remota empleando el sistema de archivos FUSE. Además, el proceso de autenticación se realiza mediante una clave privada ubicada en /home/debian/.ssh/id_rsa.En la máquina cliente, se crea previamente el punto de montaje especificado:debian@systemd-client:~$ sudo mkdir -p /mnt/sshfsdebian@systemd-client:~$ sudo chown debian:debian /mnt/sshfsTras realizar un reinicio, comprobamos que el montaje se ha realizado correctamente:debian@systemd-client:~$ df -hFilesystem               Size  Used Avail Use% Mounted onudev                     462M     0  462M   0% /devtmpfs                     97M  500K   96M   1% /run/dev/vda1                9.7G  1.2G  8.1G  13% /tmpfs                    481M     0  481M   0% /dev/shmtmpfs                    5.0M     0  5.0M   0% /run/lock/dev/vda15               124M   12M  113M  10% /boot/efidebian@10.0.0.22:/mount  2.0G   28K  1.9G   1% /mnt/sshfstmpfs                     97M     0   97M   0% /run/user/1000Comprobamos que podemos ver el contenido del fichero anteriormente montado:debian@systemd-client:~$ ls -l /mnt/sshfs/total 20-rw-r--r-- 1 root root    29 Jan  9 07:51 kk.txtdrwx------ 1 root root 16384 Jan  9 07:48 lost+founddebian@systemd-client:~$ cat /mnt/sshfs/kk.txt Buenas tardes por la mañanaEjercicio 3En lugar de utilizar el archivo /etc/fstab para el montaje automático del sistema de archivos remoto, podemos emplear una unidad de systemd en la máquina cliente. Esto nos permitirá gestionar el montaje con systemd de forma eficiente, especificando los parámetros necesarios.debian@systemd-client:~$ cat /etc/systemd/system/home-debian-sshfs.mount[Unit]Description=Montaje sistema de archivos remoto[Mount]What=debian@10.0.0.22:/mountWhere=/home/debian/sshfsType=fuse.sshfsOptions=_netdev,IdentityFile=/home/debian/.ssh/id_rsa,allow_other,default_permissions,reconnectHacemos un reinicio para que los cambios se ejecuten:debian@systemd-client:~$ sudo systemctl daemon-reloaddebian@systemd-client:~$ sudo systemctl enable home-debian-sshfs.mountThe unit files have no installation config (WantedBy=, RequiredBy=, Also=,Alias= settings in the [Install] section, and DefaultInstance= for templateunits). This means they are not meant to be enabled using systemctl. Possible reasons for having this kind of units are:• A unit may be statically enabled by being symlinked from another unit's  .wants/ or .requires/ directory.• A unit's purpose may be to act as a helper for some other unit which has  a requirement dependency on it.• A unit may be started when needed via activation (socket, path, timer,  D-Bus, udev, scripted systemctl call, ...).• In case of template units, the unit is meant to be enabled with some  instance name specified.debian@systemd-client:~$ sudo systemctl start home-debian-sshfs.mountComprobamos que el montaje haya salido correctamente:debian@systemd-client:~$ df -hFilesystem               Size  Used Avail Use% Mounted onudev                     462M     0  462M   0% /devtmpfs                     97M  500K   96M   1% /run/dev/vda1                9.7G  1.2G  8.1G  13% /tmpfs                    481M     0  481M   0% /dev/shmtmpfs                    5.0M     0  5.0M   0% /run/lock/dev/vda15               124M   12M  113M  10% /boot/efitmpfs                     97M     0   97M   0% /run/user/1000debian@10.0.0.22:/mount  2.0G   28K  1.9G   1% /home/debian/sshfsAdemás, podemos ver el contenido:debian@systemd-client:~$ ls -l sshfs/total 20-rw-r--r-- 1 root root    29 Jan  9 07:51 kk.txtdrwx------ 1 root root 16384 Jan  9 07:48 lost+founddebian@systemd-client:~$ cat sshfs/kk.txt Buenas tardes por la mañanaEjercicio 4Vamos a configurar una unidad de automontaje adicional que trabajará en conjunto con la unidad .mount creada anteriormente. En esta nueva unidad de automontaje, definiremos la unidad de montaje previamente configurada, el punto de montaje que utilizaremos y un tiempo de inactividad (en segundos) tras el cual se desmontará automáticamente si no hay actividad. Esto permitirá que el sistema gestione el montaje de forma dinámica.debian@systemd-client:~$ cat /etc/systemd/system/home-debian-sshfs.automount[Unit]Description=Automontaje del sistema de archivos remoto[Automount]Where=/home/debian/sshfsTimeoutIdleSec=10[Install]WantedBy=multi-user.targetAntes de reiniciar y activar el servicio del .automont, debemos deshabilitar y parar el servicio anterior de .mount.Esto se debe a que de lo contrario, el nuevo servicio no podrá automontar el directorio, pues este ya estaría creado.debian@systemd-client:~$ sudo systemctl disable home-debian-sshfs.mountdebian@systemd-client:~$ sudo systemctl stop home-debian-sshfs.mountWarning: Stopping home-debian-sshfs.mount, but it can still be activated by:  home-debian-sshfs.automountAhora sí, reiniciamos los cambios e iniciamos la unidad que acabamos de crear.debian@systemd-client:~$ sudo systemctl daemon-reloaddebian@systemd-client:~$ sudo systemctl enable home-debian-sshfs.automountThe unit files have no installation config (WantedBy=, RequiredBy=, Also=,Alias= settings in the [Install] section, and DefaultInstance= for templateunits). This means they are not meant to be enabled using systemctl. Possible reasons for having this kind of units are:• A unit may be statically enabled by being symlinked from another unit's  .wants/ or .requires/ directory.• A unit's purpose may be to act as a helper for some other unit which has  a requirement dependency on it.• A unit may be started when needed via activation (socket, path, timer,  D-Bus, udev, scripted systemctl call, ...).• In case of template units, the unit is meant to be enabled with some  instance name specified.debian@systemd-client:~$ sudo systemctl start home-debian-sshfs.automountPara realizar las comprobaciones debemos ver que si estamos en /home, no debemos tener el directorio montado:debian@systemd-client:~$ df -hFilesystem                Size  Used Avail Use% Mounted onudev                      462M     0  462M   0% /devtmpfs                      97M  500K   96M   1% /run/dev/vda1                 9.7G  1.7G  7.7G  18% /tmpfs                     481M     0  481M   0% /dev/shmtmpfs                     5.0M     0  5.0M   0% /run/lock/dev/vda15                124M   12M  113M  10% /boot/efidebian@10.0.0.151:/mount  2.0G   28K  1.9G   1% /mnt/sshfstmpfs                      97M     0   97M   0% /run/user/1000En cambio, si accedemos al directorio /sshfs notará la actividad y lo montará:debian@systemd-client:~$ cd sshfs/debian@systemd-client:~/sshfs$ ls -ltotal 20-rw-r--r-- 1 root root    29 Feb  6 12:02 kk.txtdrwx------ 1 root root 16384 Feb  6 12:01 lost+founddebian@systemd-client:~/sshfs$ cat kk.txt Buenas tardes por la mañanadebian@systemd-client:~/sshfs$ df -hFilesystem                Size  Used Avail Use% Mounted onudev                      462M     0  462M   0% /devtmpfs                      97M  500K   96M   1% /run/dev/vda1                 9.7G  1.7G  7.7G  18% /tmpfs                     481M     0  481M   0% /dev/shmtmpfs                     5.0M     0  5.0M   0% /run/lock/dev/vda15                124M   12M  113M  10% /boot/efidebian@10.0.0.151:/mount  2.0G   28K  1.9G   1% /mnt/sshfstmpfs                      97M     0   97M   0% /run/user/1000debian@10.0.0.151:/mount  2.0G   28K  1.9G   1% /home/debian/sshfsY al igual que lo monta cuando estamos en el directorio especificado, si nos volvemos a mover al directorio /home y esperamos 10 segundos, nos daremos cuenta de que se ha vuelto a desmontar:debian@systemd-client:~$ df -hFilesystem                Size  Used Avail Use% Mounted onudev                      462M     0  462M   0% /devtmpfs                      97M  500K   96M   1% /run/dev/vda1                 9.7G  1.7G  7.7G  18% /tmpfs                     481M     0  481M   0% /dev/shmtmpfs                     5.0M     0  5.0M   0% /run/lock/dev/vda15                124M   12M  113M  10% /boot/efidebian@10.0.0.151:/mount  2.0G   28K  1.9G   1% /mnt/sshfstmpfs                      97M     0   97M   0% /run/user/1000"
  },
  
  {
    "title": "Certificados digitales. HTTPS",
    "url": "/posts/certificado/",
    "categories": "Seguridad, Criptografía",
    "tags": "Criptografía",
    "date": "2024-12-19 18:30:00 +0100",
    





    
    "snippet": "Certificado digital de persona físicaTarea 1: Instalación del certificado1. Una vez que hayas obtenido tu certificado, explica brevemente como se instala en tu navegador favorito.Para la instalació...",
    "content": "Certificado digital de persona físicaTarea 1: Instalación del certificado1. Una vez que hayas obtenido tu certificado, explica brevemente como se instala en tu navegador favorito.Para la instalación del certificado digital en mi navegador (Firefox), debemos dirigirnos al correo que nos manda la Fábrica Nacional de Moneda y Timbre al realizar la solicitud:Pinchamos en el enlace de descarga he introducimos los datos para continuar con la descarga:Una vez que hayamos descargado el certificado digital desde la FNMT, normalmente estará en formato .p12. Este archivo contiene tanto la clave pública como la clave privada del certificado.Por lo que para la instalación:      Abrimos Firefox y nos dirigimos al menú principal (ícono de tres líneas horizontales).        Hacemos clic en Ajustes y luego seleccionamos la sección Privacidad &amp; Seguridad.        Nos desplazamos hasta la opción Certificados y pulsamos el botón Ver Certificados.        En la pestaña Sus Certificados, seleccionamos Importar… y buscamos el archivo .p12.        Durante la importación, nos pedirá la contraseña que asignamos al descargar el certificado.  Una vez completado, el certificado aparecerá en la lista de certificados personales.2. Muestra una captura de pantalla donde se vea las preferencias del navegador donde se ve instalado tu certificado.3. ¿Cómo puedes hacer una copia de tu certificado?, ¿Como vas a realizar la copia de seguridad de tu certificado?. Razona la respuesta.  En el menú de opciones: Preferencias &gt; Privacidad y seguridad &gt; Seguridad &gt; Certificados.  Selecciona Ver certificados.  En Sus Certificados selecciona Hacer copia.De esta forma se realiza una copia del certificado digital. Y se introduce en un dispositivo externo para tener la copia.El certificado digital es único y personal. Si perdemos el archivo o la clave privada, no podremos firmar documentos ni realizar trámites online que requieran autenticación. Además, una pérdida implicaría solicitar de nuevo el certificado desde cero a la FNMT.4. Investiga como exportar la clave pública de tu certificado.En Preferencias &gt; Privacidad y seguridad &gt; Seguridad &gt; Certificados &gt; Ver certificados hacemos doble click sobre el certificado para que aparezca el visor de certificados. En la pestaña Detalles da la opción de Exportar….Una vez descargado el .pem debemos extraer la clave pública, pues en un principio estará cifrado y no podremos ver el contenido. Para ello:pavlo@debian:~/certificado()$ ls -ltotal 12-rw-r--r-- 1 pavlo pavlo 7010 dic 20 20:39 MARTIN_HIDALGO_PABLO.p12-rw-r--r-- 1 pavlo pavlo 3012 dic 27 17:29 martin-hidalgo-pablo.pempavlo@debian:~/certificado()$ sudo openssl pkcs12 -in MARTIN_HIDALGO_PABLO.p12 -clcerts -nokeys -out martin-hidalgo-pablo.pemEnter Import Password:Donde:  -in MARTIN_HIDALGO_PABLO.p12: Especifica el archivo de entrada en formato .p12.  -clcerts: Indica que se extraiga únicamente el certificado del archivo, excluyendo certificados de la cadena o intermedios.  -nokeys: Evita que se exporte la clave privada.  -out martin-hidalgo-pablo.pem: Especifica el nombre del archivo de salida que contendrá la clave pública en formato PEM.Una vez hecho esto ya podremos ver la clave pública.Tarea 2: Validación del certificado1. Instala en tu ordenador el software autofirma y desde la página de VALIDe valida tu certificado. Muestra capturas de pantalla donde se comprueba la validación.Descargamos el software desde la página https://firmaelectronica.gob.es/Home/Descargas.html. El archivo es un .zip.Antes de descomprimirlo, es necesario un paquete de java, donde tenemos que instalar los siquientes paquetes:pavlo@debian:~()$ sudo apt-get install default-jrpavlo@debian:~()$ sudo apt-get install default-jdkUna vez instalados los paquetes y descargada la herramienta necesaria:pavlo@debian:~/Descargas()$ unzip AutoFirma_Linux_Debian.zippavlo@debian:~/Descargas()$ sudo apt install libnss3-toolspavlo@debian:~/Descargas()$ sudo dpkg -i AutoFirma_1_8_3.debDespués de instalar el software de AutoFirma nos dirigimos a la página web VALIDe para verificar el certificado.En donde debemos seleccionar el certificado:E introducir el código de seguridad del CAPTCHA. Y ya tendríamos el certificado validado correctamente:Tarea 3: Firma electrónica1. Utilizando la página VALIDe y el programa autofirma, firma un documento con tu certificado y envíalo por correo a un compañero.Para esta apartado voy a crear dos ficheros para posteriormente firmarlos con nuestro certificado digital. Uno de ellos se llamará ficherovalide.txt y otro ficheroautofirma.txtpavlo@debian:~/certificado()$ echo 'Este fichero está firmado por VALIDe' &gt; ficherovalide.txtpavlo@debian:~/certificado()$ echo 'Este fichero está firmado por AutoFirma' &gt; ficheroautofirma.txtUna vez generados los ficheros vamos a proceder a firmar el primero de ellos a través de la página VALIDe. En este caso, pulsaremos en el apartado Realizar Firma.En el menú correspondiente, seleccionaremos la opción de Firmar. A continuación, el sistema nos solicitará que indiquemos el archivo que deseamos firmar. En este caso, será necesario elegir ficherovalide.txt y, además, especificar el certificado que utilizaremos para llevar a cabo la firma.Si todo ha salido correctamente nos saldrá el siguiente mensaje:Una vez completado el proceso, se confirma que la firma se ha realizado con éxito. En este punto, procederemos a Guardar Firma para almacenar en nuestro equipo el archivo generado. En mi caso, he optado por nombrarlo ficherovalide.txt_firmado.csig con el fin de distinguirlo fácilmente.Con esto, ya hemos firmado el primer archivo. Ahora, repetiremos el procedimiento con el segundo. Abriremos nuevamente la aplicación de escritorio AutoFirma y seleccionaremos, en esta ocasión, el archivo ficheroautofirma.txt. Al pulsar en Firmar, se nos solicitará el certificado a utilizar y, posteriormente, la ubicación donde deseamos guardar el documento firmado. Para diferenciarlo, he decidido asignarle el nombre ficheroautofirma.txt_firmado.csig.Si todo ha funcionado correctamente obtendremos el siguiente mensaje informativo:2. Tu debes recibir otro documento firmado por un compañero y utilizando las herramientas anteriores debes visualizar la firma (Visualizar Firma) y (Verificar Firma). ¿Puedes verificar la firma aunque no tengas la clave pública de tu compañero?, ¿Es necesario estar conectado a internet para hacer la validación de la firma?. Razona tus respuestas.Para verificar estas firmas, accederemos a la plataforma VALIDe y seleccionaremos la opción “Validar Firma”.En esta sección, elegiremos el archivo firmado que deseamos comprobar. En este caso, seleccionaremos el archivo hola.txt_signed.csig, completaremos el Captcha solicitado y haremos clic en “Validar”.Si el proceso se realiza correctamente, obtendremos un mensaje informativo que confirma que la validación ha sido exitosa:Este mensaje indica que la firma ha sido validada correctamente, lo que certifica que el archivo ha sido firmado por mi compañero, quien no puede negar haber realizado esta acción. Luego, repetiremos el mismo procedimiento con el archivo hola2.txt_firmado.csig y obtendremos el siguiente resultado:3. Entre dos compañeros, firmar los dos un documento, verificar la firma para comprobar que está firmado por los dos.Tarea 4: AutentificaciónAccedemos a la web de la DGT para verificar el funcionamiento de nuestro certificado digital accediendo a nuestro historial de puntos.Podremos elegir entre los distintos tipos de acceso y elegimos Cl@ve. Seguidamente, pulsaremos en DNIe / Certificado electrónico y se abrirá una ventana emergente. En dicha ventana emergente tendremos que seleccionar aquel certificado que queremos utilizar para la autenticación, así que en mi caso, seleccionaré el único disponible, de manera que si no ha habido ningún problema, nos habremos autenticado en la página de la Dirección General de Tráfico sin tener que introducir ningún tipo de credenciales:HTTPS / SSLAntes de hacer esta práctica vamos a crear una página web (puedes usar una página estática o instalar una aplicación web) en un servidor web apache2 que se acceda con el nombre tunombre.iesgn.org.Preparación del sitio webPara realizar este punto, instalaremos un servidor apache, y lo configuraremos para que nos sirva una página web con https. Para ello, deberemos seguir los siguientes pasos:  Instalamos el servidor:debian@https:~$ sudo apt install apache2  Deshabilitamos el VirtualHost que viene por defecto para que no nos dé problemas:debian@https:~$ sudo a2dissite 000-default.confSite 000-default disabled.To activate the new configuration, you need to run:  systemctl reload apache2debian@https:~$ sudo systemctl reload apache2  Creamos un nuevo fichero de configuración donde irá el contenido:debian@https:~$ sudo mkdir /var/www/html/pablo.iesgn.orgdebian@https:~$ sudo nano /var/www/html/pablo.iesgn.org/index.htmldebian@https:~$ cat /var/www/html/pablo.iesgn.org/index.html&lt;!DOCTYPE html&gt;            &lt;html&gt;                &lt;head&gt;                &lt;title&gt;pablo.iesgn.org&lt;/title&gt;                &lt;/head&gt;            &lt;body&gt;                &lt;h1&gt;pablo.iesgn.org&lt;/h1&gt;                &lt;p&gt;Pagina web sencilla para criptografia - HTTPS/SSL&lt;/p&gt;            &lt;/body&gt;        &lt;/html&gt;  Ahora creamos un archivo de configuración para el dominio pablo.iesgn.orgdebian@https:~$ cat /etc/apache2/sites-available/pablo.iesgn.org.conf&lt;VirtualHost *:80&gt;    ServerName pablo.iesgn.org    DocumentRoot /var/www/html/pablo.iesgn.org    &lt;Directory /var/www/html/pablo.iesgn.org&gt;        Options Indexes FollowSymLinks        AllowOverride All        Require all granted    &lt;/Directory&gt;    ErrorLog ${APACHE_LOG_DIR}/pablo.iesgn.org_error.log    CustomLog ${APACHE_LOG_DIR}/pablo.iesgn.org_access.log combined&lt;/VirtualHost&gt;  Habilitamos el nuevo VirtualHost y reiniciamos el servicio de Apache.debian@https:~$ sudo a2ensite pablo.iesgn.org.confEnabling site pablo.iesgn.org.To activate the new configuration, you need to run:  systemctl reload apache2debian@https:~$ sudo systemctl reload apache2  Por último tenemos que realizar la resolución estática, pues la página web está en una instancia de OpenStack:debian@https:~$ cat /etc/hosts127.0.0.1\tlocalhost::1\t\tlocalhost ip6-localhost ip6-loopbackff02::1\t\tip6-allnodesff02::2\t\tip6-allrouters172.22.200.222\tpablo.iesgn.orgpavlo@debian:~()$ cat /etc/hosts127.0.0.1\tlocalhost127.0.1.1\tdebian172.22.203.178  django-pablo.com#172.22.7.9\twordpress.pablo.beer#172.22.9.234\tbiblioteca.pablo.org172.22.123.1\tproxmox.gonzalonazareno.org172.22.200.222\tpablo.iesgn.org# The following lines are desirable for IPv6 capable hosts::1     localhost ip6-localhost ip6-loopbackff02::1 ip6-allnodesff02::2 ip6-allroutersY como vemos la página ya se puede ver correctamente:Tarea 1: Certificado autofirmadoEsta práctica la vamos a realizar con un compañero. En un primer momento un alumno creará una Autoridad Certficadora y firmará un certificado para la página del otro alumno. Posteriormente se volverá a realizar la práctica con los roles cambiados.Para hacer esta práctica puedes buscar información en internet, algunos enlaces interesantes:Phil’s X509/SSL GuideHow to setup your own CA with OpenSSLEn esta ocasión voy a ser yo el que haga de autoridad certificadora, de manera que podremos firmar el certificado para que nuestro compañero pueda implementar HTTPS en su servidor.Crear una autoridad certificadoraEl primer paso consiste en establecer un directorio base para la Autoridad Certificadora (CA), con subdirectorios dedicados a diferentes funciones. Esto ayudará a mantener la organización durante todo el proceso. En este ejemplo, el directorio principal será CA/ y contendrá:      certsdb: Almacén de certificados firmados.        certreqs: Almacén de solicitudes de firma de certificados (CSR).        crl: Almacén de la lista de certificados revocados (CRL).        private: Almacén para la clave privada de la autoridad certificadora.  Para crear esta estructura de directorios, ejecutaremos:debian@https:~$ mkdir -p CA/{certsdb,certreqs,crl,private}Una vez creados los directorios, accedemos al directorio principal y visualizamos la estructura:debian@https:~/CA$ tree.├── certreqs├── certsdb├── crl└── privateComo el directorio private contendrá información sensible (la clave privada de la CA), es importante restringir su acceso únicamente al propietario. Cambiamos sus permisos a 700:debian@https:~/CA$ chmod 700 ./privateLa CA necesitará un archivo que actúe como base de datos para registrar los certificados emitidos. Este archivo se creará con:debian@https:~/CA$ touch index.txtEn este paso, copiaremos el archivo de configuración predeterminado de OpenSSL a nuestro directorio de trabajo y lo personalizaremos para adaptarlo a nuestra CA.  Buscamos el archivo de configuración de OpenSSL en nuestro sistema. Las ubicaciones comunes son:      /usr/lib/ssl/openssl.cnf        /etc/openssl.cnf        /usr/share/ssl/openssl.cnf    Copiamos el archivo al directorio CA:debian@https:~/CA$ cp /usr/lib/ssl/openssl.cnf ./  Realizamos las siguientes modificaciones para que OpenSSL utilice los directorios creados anteriormente:dir             = /home/debian/CAcerts           = $dir/certsdbnew_certs_dir   = $certscountryName_default             = ESstateOrProvinceName_default     = SevillalocalityName                    = Dos Hermanas0.organizationName              = PabloMartin SLorganizationalUnitName          = Informatica#challengePassword              = A challenge password#challengePassword_min          = 4#challengePassword_max          = 20#unstructuredName               = An optional company nameImportante recalcar que estas solo son las modificaciones que yo he realizado, no es el fichero de configuración al completo.Una vez completados estos pasos, estaremos preparados para generar nuestro par de claves junto con un archivo de solicitud de firma de certificado. Posteriormente, procederemos a su autofirma. Para ello, ejecutaremos el siguiente comando:debian@https:~/CA$ sudo openssl req -new -newkey rsa:2048 -keyout private/cakey.pem -out careq.pem -config ./openssl.cnf..+...+.+.....+.+.....+....+..+...+.......+.....+...+..........+.........+..+...+.+.................+...................+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+...........................+.+...+.........+..+..........+...+......+..+...+.......+..+.+.....+.........+....................................+.........+.+......+.....+..........+...+..................+.........+.....+...+.+..+...+....+...+.........+.........+.........+.....+.......+...+..................+...+..+....+......+...+...........+...+.......+...+.....+...+....+......+............+.................+................+..............+....+...........+........................+.+.....+......+..........+.....+....+...............+......+...+..+....+...+...+.........+........+.+.........+..+.+.........+...+..+....+..+...+....+........+.......+..+....+.....+............+...+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++....+.+........+....+..+....+.........+...............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+............+..+.......+.....+....+..+...+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++Enter PEM pass phrase:Verifying - Enter PEM pass phrase:-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Country Name (2 letter code) [ES]:State or Province Name (full name) [Sevilla]:Dos Hermanas []:PabloMartin SL [Internet Widgits Pty Ltd]:Informatica []:Common Name (e.g. server FQDN or YOUR name) []:pablo.debianEmail Address []:pmartinhidalgo19@gmail.comEl comando para crear un nuevo par de claves y una solicitud de firma de certificado (CSR) incluye estas opciones:  -new: Genera un par de claves nuevo.  -newkey: Define el tipo y tamaño del par de claves, en este caso RSA de 2048 bits.  -keyout: Especifica la ubicación donde se guardará la clave privada (por ejemplo, en private/cakey.pem).  -out: Define dónde guardar el CSR (por ejemplo, careq.pem).  -config: Indica a OpenSSL usar un archivo de configuración personalizado (openssl.cnf).Al ejecutar el comando, se solicita una frase de paso para proteger la clave privada. También se piden algunos datos básicos que deben coincidir con la información previamente configurada en el archivo openssl.cnf.Después de crear el CSR, se puede autofirmar el certificado para usarlo como Autoridad Certificadora (CA). Esto se realiza con el comando:debian@https:~/CA$ sudo openssl ca -create_serial -out cacert.pem -days 365 -keyfile private/cakey.pem -selfsign -extensions v3_ca -config ./openssl.cnf -infiles careq.pemUsing configuration from ./openssl.cnfEnter pass phrase for private/cakey.pem:Check that the request matches the signatureSignature okCertificate Details:        Serial Number:            36:15:6a:51:89:82:f6:66:e0:d2:4a:5d:43:61:6f:7b:3b:87:c3:5b        Validity            Not Before: Jan 11 11:56:18 2025 GMT            Not After : Jan 11 11:56:18 2026 GMT        Subject:            countryName               = ES            stateOrProvinceName       = Sevilla            organizationName          = Internet Widgits Pty Ltd            commonName                = pablo.debian            emailAddress              = pmartinhidalgo19@gmail.com        X509v3 extensions:            X509v3 Subject Key Identifier:                 70:63:CD:8F:AD:5E:82:EF:B8:DB:43:10:03:24:CA:AE:EB:6D:2F:5F            X509v3 Authority Key Identifier:                 70:63:CD:8F:AD:5E:82:EF:B8:DB:43:10:03:24:CA:AE:EB:6D:2F:5F            X509v3 Basic Constraints: critical                CA:TRUECertificate is to be certified until Jan 11 11:56:18 2026 GMT (365 days)Sign the certificate? [y/n]:y1 out of 1 certificate requests certified, commit? [y/n]yWrite out database with 1 new entriesDatabase updatedParámetros clave:  -create_serial: Genera un número de serie único de 128 bits para evitar conflictos si se reinicia el proceso.  -out: Especifica el archivo de salida del certificado firmado (por ejemplo, cacert.pem).  -days: Define la validez del certificado en días (en este caso, 365 días).  -keyfile: Utiliza la clave privada creada anteriormente (private/cakey.pem) para la firma.  -selfsign: Indica que el certificado será autofirmado.  -extensions: Selecciona las extensiones configuradas en el archivo openssl.cnf (por ejemplo, v3_ca).  -config: Indica el archivo de configuración de OpenSSL modificado.  -infiles: Especifica el CSR a firmar (en este caso, careq.pem).Durante la ejecución, OpenSSL solicita:  La frase de paso configurada para la clave privada.  Confirmación de la información del certificado antes de firmarlo.  Aprobación final para guardar el certificado.Para asegurarnos de que el certificado de la autoridad certificadora está presente en el directorio actual, procederemos a listar su contenido utilizando el siguiente comando:debian@https:~/CA$ ls -ltotal 52-rw-r--r-- 1 root root  4614 Jan 11 11:56 cacert.pem-rw-r--r-- 1 root root  1045 Jan 11 11:51 careq.pemdrwxr-xr-x 2 root root  4096 Jan 11 11:30 certreqsdrwxr-xr-x 2 root root  4096 Jan 11 11:56 certsdbdrwxr-xr-x 2 root root  4096 Jan 11 11:30 crl-rw-r--r-- 1 root root   166 Jan 11 11:56 index.txt-rw-r--r-- 1 root root    21 Jan 11 11:56 index.txt.attr-rw-r--r-- 1 root root     0 Jan 11 11:37 index.txt.old-rw-r--r-- 1 root root 12279 Jan 11 11:46 openssl.cnfdrwx------ 2 root root  4096 Jan 11 11:50 private-rw-r--r-- 1 root root    41 Jan 11 11:56 serialComo vemos existe un fichero cacert.pem que es resultado de firmar el fichero de solicitud de firma de certificado careq.pem.Todo está preparado para firmar el certificado del servidor de mi compañero. Por ello, he colocado su archivo de solicitud de firma dentro del directorio certreqs/, que es la ubicación designada para estos casos.debian@https:~/CA$ ls -l certreqs/total 4-rw-r--r-- 1 root root 1074 Jan 11 12:10 joseantoniocgonzalez.csrYa podemos proceder a firmar usando el siguiente comando:debian@https:~/CA$ sudo openssl ca -config openssl.cnf -out certsdb/joseantoniocgonzalez.crt -infiles certreqs/joseantoniocgonzalez.csrUsing configuration from openssl.cnfEnter pass phrase for /home/debian/CA/private/cakey.pem:Check that the request matches the signatureSignature okCertificate Details:        Serial Number:            36:15:6a:51:89:82:f6:66:e0:d2:4a:5d:43:61:6f:7b:3b:87:c3:5d        Validity            Not Before: Jan 11 12:37:59 2025 GMT            Not After : Jan 11 12:37:59 2026 GMT        Subject:            countryName               = ES            stateOrProvinceName       = SEVILLA            localityName              = SEVILLA            organizationName          = ASIR            commonName                = joseantoniocgonzalez.iesgn.org            emailAddress              = joseantoniocgonzalez83@gmail.com        X509v3 extensions:            X509v3 Basic Constraints:                 CA:FALSE            X509v3 Subject Key Identifier:                 0C:95:B9:A0:01:E3:46:16:7D:FE:4D:E1:6B:54:A4:E0:AA:DC:05:80            X509v3 Authority Key Identifier:                 70:63:CD:8F:AD:5E:82:EF:B8:DB:43:10:03:24:CA:AE:EB:6D:2F:5FCertificate is to be certified until Jan 11 12:37:59 2026 GMT (365 days)Sign the certificate? [y/n]:y1 out of 1 certificate requests certified, commit? [y/n]yWrite out database with 1 new entriesDatabase updatedDonde:  -config: Indica a OpenSSL que utilice un archivo de configuración personalizado, en este caso llamado openssl.cnf, en lugar del predeterminado.  -out: Especifica dónde se guardará el certificado firmado. Aquí, se almacenará en el directorio certsdb/ con el nombre joseantoniocgonzalez.crt.  -infiles: Señala el archivo CSR que se desea firmar. En este caso, es el archivo joseantoniocgonzalez.csr, ubicado en el directorio certreqs/.Al ejecutar el comando, OpenSSL solicita la frase de paso configurada previamente para proteger la clave privada de la autoridad certificadora. Esto garantiza que, incluso si la clave privada cae en manos equivocadas, no puedan realizar firmas indebidas. Antes de proceder, OpenSSL también muestra la información contenida en el certificado para confirmar que es correcta.Una vez firmado, el certificado se almacena en el directorio certsdb/. Para confirmar su creación, listamos el contenido de dicho directorio con el comando:debian@https:~/CA$ ls -l certsdb/total 24-rw-r--r-- 1 root root 4614 Jan 11 11:56 36156A518982F666E0D24A5D43616F7B3B87C35B.pem-rw-r--r-- 1 root root 4643 Jan 11 12:38 36156A518982F666E0D24A5D43616F7B3B87C35D.pem-rw-r--r-- 1 root root 4643 Jan 11 12:38 joseantoniocgonzalez.crtEl resultado muestra tres archivos:  El certificado de la autoridad certificadora.  Dos archivos relacionados con el certificado del compañero: uno identificado con un número de serie y otro con un nombre descriptivo, facilitando su identificación.El archivo que debe entregarse al compañero es certsdb/joseantoniocgonzalez.crt, que contiene su certificado firmado. Además, debe recibir el archivo cacert.pem, que es el certificado de la autoridad certificadora, necesario para verificar la validez del certificado.El archivo index.txt funciona como una base de datos en texto plano que registra información sobre los certificados emitidos por la CA. Se puede visualizar con:debian@https:~/CA$ cat index.txtV\t260111115618Z\t\t36156A518982F666E0D24A5D43616F7B3B87C35B\tunknown\t/C=ES/ST=Sevilla/O=Internet Widgits Pty Ltd/CN=pablo.debian/emailAddress=pmartinhidalgo19@gmail.comV\t260111123759Z\t\t36156A518982F666E0D24A5D43616F7B3B87C35D\tunknown\t/C=ES/ST=SEVILLA/L=SEVILLA/O=ASIR/CN=joseantoniocgonzalez.iesgn.org/emailAddress=joseantoniocgonzalez83@gmail.comEn el contenido se puede observar:  Estado de los certificados: En este caso, ambos están marcados como válidos (V).  Fecha de expiración: Indica hasta cuándo es válido cada certificado.  Número de serie: Identificador único de cada certificado.  Información del sujeto: Detalla los campos incluidos en el CSR, como el país, la organización y el correo electrónico.Configurar HTTPSAhora me toca hacerlo al revés, lo primero será generar una solicitud de firma de certificado (CSR, por sus siglas en inglés). En este caso utilizaremos OpenSSL, aunque también se podrían emplear otras herramientas de software para lograrlo.Para crear la solicitud, primero necesitamos contar con una clave privada que estará vinculada al certificado. Por lo tanto, procederemos a generar una clave privada RSA de 4096 bits, la cual será almacenada en el directorio /etc/ssl/private/. Esto se realiza mediante el siguiente comando:debian@https:~$ sudo openssl genrsa 4096 &gt; pablomh.keydebian@https:~$ sudo mv pablomh.key /etc/ssl/private/Después de generar la clave privada, ajustaremos sus permisos a 400, lo que restringirá el acceso para que únicamente el propietario pueda leer su contenido. Dado que se trata de información sensible, este paso, aunque no obligatorio, es altamente recomendable por razones de seguridad.debian@https:~$ sudo chmod 400 /etc/ssl/private/pablomh.keyA continuación, procederemos a generar un archivo .csr, que será la solicitud de firma de certificado destinada a ser validada por la autoridad certificadora (CA) configurada por nuestro compañero. Este archivo no incluye información sensible, por lo que su ubicación y los permisos asignados no son críticos. Por lo tanto:debian@https:~$ sudo openssl req -new -key /etc/ssl/private/pablomh.key -out pablomh.csrYou are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Country Name (2 letter code) [AU]:ESState or Province Name (full name) [Some-State]:SevillaLocality Name (eg, city) []:Dos HermanasOrganization Name (eg, company) [Internet Widgits Pty Ltd]:ASIROrganizational Unit Name (eg, section) []:InformaticaCommon Name (e.g. server FQDN or YOUR name) []:pablo.debian   Email Address []:pmartinhidalgo19@gmail.comPlease enter the following 'extra' attributesto be sent with your certificate requestA challenge password []:An optional company name []:Durante la ejecución, nos pedirá una serie de valores para identificar al certificado, que tendremos que rellenar en base a la información que nos proporcionará la autoridad certificadora; excepto los dos últimos valores, los cuales pedirán una serie de valores cuya introducción es opcional.Para verificar que el fichero de solicitud de firma ha sido correctamente generado listaremos el contenido del directorio actual:debian@https:~$ ls -ltotal 16drwxr-xr-x 6 root   root   4096 Jan 11 12:38 CA-rw-r--r-- 1 root   root   1773 Jan 14 17:00 pablomh.csrEn el directorio podemos observar un archivo llamado pablomh.csr, el cual debemos enviar a nuestro compañero para que sea firmado por la autoridad certificadora que ha creado. Junto con el certificado firmado, nuestro compañero también deberá enviarnos la clave pública de la entidad certificadora, es decir, su certificado, ya que será necesario para verificar la firma aplicada a nuestro certificado.Bien, pues Jose ya me ha enviado ambos ficheros, los cuales voy a almacenar en /etc/ssl/certs/.debian@https:~$ ls -l /etc/ssl/certs/ | grep 'pablomh'-rw-r--r-- 1 root root   2090 Jan 14 17:31 pablomh.crtdebian@https:~$ ls -l /etc/ssl/certs/ | grep 'cacert'-rw-r--r-- 1 root root   2244 Jan 14 17:31 cacert.pemDebe existir un fichero de nombre tunombre.crt que es el resultado de la firma de la solicitud de firma de certificado que previamente le hemos enviado, y otro de nombre cacert.pem, que es el certificado de la entidad certificadora, con el que posteriormente se comprobará la firma de la autoridad certificadora sobre dicho certificado del servidor.Al igual que Apache2 incluye un VirtualHost predeterminado para gestionar las solicitudes en el puerto 80 (HTTP), también dispone de otro por defecto para las conexiones entrantes en el puerto 443 (HTTPS). Este VirtualHost, llamado default-ssl, viene deshabilitado por defecto, por lo que será necesario activarlo y modificar su configuración.Para ello, ajustaremos las siguientes directivas esenciales:  ServerName: Especifica el dominio a través del cual accederemos al servidor, manteniéndolo coherente con la configuración del VirtualHost de HTTP.  SSLEngine: Habilita el motor SSL, requisito indispensable para el uso de HTTPS. Su valor debe establecerse en on.  SSLCertificateFile: Define la ruta del certificado del servidor firmado por la autoridad certificadora (CA). En este caso, el archivo se encuentra en /etc/ssl/certs/pablomh.crt.  SSLCertificateKeyFile: Indica la ubicación de la clave privada correspondiente al certificado del servidor. Se encuentra en /etc/ssl/private/pablomh.key.  SSLCACertificateFile: Especifica la ruta del certificado de la autoridad certificadora, necesario para verificar la firma del certificado del servidor. En este caso, se ubica en /etc/ssl/certs/cacert.pem.Con estas configuraciones correctamente aplicadas, el VirtualHost estará listo para gestionar conexiones seguras mediante HTTPS.Quedando el archivo final de la siguiente forma:debian@https:~$ cat /etc/apache2/sites-available/default-ssl.conf&lt;VirtualHost *:80&gt;   ServerName pablo.iesgn.org  Redirect permanent / https://pablo.iesgn.org/&lt;/VirtualHost&gt;&lt;VirtualHost *:443&gt;\tServerAdmin webmaster@localhost\tServerName pablo.iesgn.org\tDocumentRoot /var/www/html\tErrorLog ${APACHE_LOG_DIR}/error.log\tCustomLog ${APACHE_LOG_DIR}/access.log combined\tSSLEngine on\t\tSSLCertificateFile      /etc/ssl/certs/pablomh.crt\tSSLCertificateKeyFile /etc/ssl/private/pablomh.key\tSSLCACertificateFile /etc/ssl/certs/cacert.pem&lt;/VirtualHost&gt;Como este VirtualHost no está habilitado de manera predeterminada, será necesario activarlo manualmente. Para ello, utilizaremos las herramientas proporcionadas por Apache2 para gestionar la activación de sitios y configuraciones:debian@https:~# sudo a2ensite default-sslEnabling site default-ssl.To activate the new configuration, you need to run:  systemctl reload apache2Para garantizar que el acceso a la página siempre se realice de forma segura a través de HTTPS (https://), deberemos establecer una redirección permanente desde el VirtualHost que escucha en el puerto 80 (HTTP) hacia el VirtualHost en el puerto 443 (HTTPS). Esto impedirá que los usuarios accedan al servidor utilizando HTTP y los forzará a usar HTTPS.En el archivo de configuración del VirtualHost en el puerto 80, añadiremos una redirección permanente utilizando la directiva Redirect. Deberá quedar algo similar a lo siguiente:debian@https:~$ cat /etc/apache2/sites-available/000-default.conf&lt;VirtualHost *:80&gt;        ServerName pablo.iesgn.org        ServerAdmin webmaster@localhost        DocumentRoot /var/www/html        ErrorLog ${APACHE_LOG_DIR}/error.log        CustomLog ${APACHE_LOG_DIR}/access.log combined        Redirect 301 / https://pablo.iesgn.com/&lt;/VirtualHost&gt;Esta directiva Redirect permanent redirigirá todas las peticiones que lleguen al servidor a través del puerto 80 hacia el mismo dominio pero utilizando el puerto 443, lo cual asegura que todas las conexiones se realicen de manera segura mediante HTTPS. Con esta configuración, cualquier intento de acceso por HTTP será automáticamente redirigido a HTTPS.Reiniciamos:debian@https:~$ sudo systemctl restart apache2Podemos observar que se ha generado una advertencia de seguridad, lo que confirma que la redirección de http:// a https:// se ha realizado con éxito.Esta advertencia se debe a que el navegador no ha podido verificar la firma del certificado recibido desde el servidor, ya que no dispone de la clave pública o del certificado de la Autoridad Certificadora (CA). Para solucionar esto, es necesario importar manualmente dicho certificado en el navegador.En el caso de Firefox, para llevar a cabo esta importación, primero debemos hacer clic en el icono de las tres barras ubicado en la parte superior del navegador. Luego, accedemos a Preferencias (o Ajustes) y buscamos la sección Privacidad &amp; Seguridad. Desplazándonos hasta la parte inferior, encontraremos el apartado Certificados, donde haremos clic en Ver certificados. A continuación, en la pestaña Autoridades, seleccionamos la opción Importar, lo que nos permitirá añadir el certificado de la CA.Una vez elegido el certificado a importar, aparecerá un mensaje informándonos de que se nos solicita confiar en una nueva Autoridad Certificadora (CA). En este punto, simplemente confirmamos la acción haciendo clic en Aceptar.Después de completar estos pasos, podremos comprobar que el certificado ha sido importado correctamente.Una vez importado el certificado recargamos la página para mostrar el contenido:Como podemos notar, la advertencia de seguridad ha vuelto a aparecer. Si observamos junto a la barra de direcciones, veremos un icono de candado. Al hacer clic en él, se desplegará la información correspondiente.Además, si le damos a Ver Certificado nos mostrará información del mismo:¿Por qué el sitio no es seguro a pesar de usar HTTPS?El navegador sigue indicando que el sitio no es seguro porque el certificado utilizado ha sido emitido por una Autoridad Certificadora (CA) que no es reconocida como confiable por los navegadores. Esto ocurre porque el certificado ha sido generado por la CA de mi compañero, y aunque la conexión esté cifrada mediante HTTPS, navegadores como Chrome o Firefox no confiarán en una entidad que no esté validada a nivel internacional.Hemos verificado que con Apache2 hemos logrado que HTTPS funcione, aunque sin una certificación oficial no será reconocido como seguro. Ahora realizaremos la misma prueba con la otra alternativa: Nginx.El primer paso será desinstalar apache2 para evitar posibles conflictos, y tras ello, instalar nginx.Después de esto, podemos proceder con la configuración del nuevo servidor web. Este servicio también incluye un VirtualHost por defecto, pero a diferencia de Apache2, permite unificar en un solo archivo la configuración tanto del VirtualHost que opera en el puerto 80 como el del puerto 443. Este archivo se encuentra en la ruta /etc/nginx/sites-available/default.De forma que el fichero quedaría de la siguiente forma:debian@https:~$ sudo cat /etc/nginx/sites-enabled/default server {        listen 80 default_server;        listen [::]:80 default_server;        server_name pablo.iesgn.org;        return 301 https://$host$request_uri;}server {        listen 443 ssl default_server;        listen [::]:443 ssl default_server;        ssl    on;        ssl_certificate    /etc/ssl/certs/pablomh.crt;        ssl_certificate_key    /etc/ssl/private/pablomh.key;        root /var/www/html/pablo.iesgn.org;        index index.html index.htm index.nginx-debian.html;        server_name pablo.iesgn.org;        location / {                try_files $uri $uri/ =404;        }}Reiniciamos para que se efectúen los cambios:debian@https:~$ sudo systemctl reload nginxTras ello, ya estará todo listo para acceder a pablo.iesgn.org desde el navegador.Y como podemos observar, el certificado de mi compañero está funcionando correctamente."
  },
  
  {
    "title": "Integridad, firmas y autenticación",
    "url": "/posts/integridad/",
    "categories": "Seguridad, Criptografía",
    "tags": "Criptografía",
    "date": "2024-12-19 18:30:00 +0100",
    





    
    "snippet": "Tarea 1: Firmas electrónicasEn este primer apartado vamos a trabajar con las firmas eléctronicas, por lo que vamos a apoyarnos en los siguientes enlaces:  Intercambio de claves  Validación de otras...",
    "content": "Tarea 1: Firmas electrónicasEn este primer apartado vamos a trabajar con las firmas eléctronicas, por lo que vamos a apoyarnos en los siguientes enlaces:  Intercambio de claves  Validación de otras claves en nuestro anillo de claves públicas  Firmado de claves (Debian)Manda un documento y la firma electrónica del mismo a un compañero. Verifica la firma que tú has recibido.Antes de comenzar la práctica, voy a listar las claves existentes en mi keyring:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]Como podemos observar, en mi anillo de claves se encuentra mi clave personal. Por tanto, el siguiente paso será subir esta clave a un servidor de claves, como puede ser keys.gnupg.net, utilizando el fingerprint para identificarla de forma precisa.pavlo@debian:~()$ gpg --keyserver keys.gnupg.net --send-key C2E235639EB3A2A420828C9DED45D8BE85D4DB1Agpg: enviando clave ED45D8BE85D4DB1A a hkp://pgp.surf.nlLa clave ha sido enviada al servidor de claves, lo que permitirá que cualquier persona que reciba mi archivo firmado pueda descargarla e importarla para verificar la firma.Es posible elegir entre dos métodos al firmar un archivo: incluir la firma directamente dentro del archivo utilizando la opción --sign, o bien generar la firma en un archivo separado, dejando el original intacto. En este caso, optaremos por la segunda alternativa, usando la opción --detach-sign.Por lo tanto, procederemos a firmar un documento llamado UE-Empresa.pdf, separando la firma en un archivo distinto. Para lograrlo, ejecutaremos el comando correspondiente:pavlo@debian:~()$ gpg --detach-sign UE-Empresa.pdfDurante el proceso de firmado, el sistema solicitará la frase de paso asociada a nuestra clave privada. Una vez ingresada correctamente, el firmado se completará. A continuación, procederemos a listar el documento firmado:pavlo@debian:~()$ ls -l | grep 'UE'-rw-r--r--  1 pavlo pavlo 33734 nov 22 12:09 UE-Empresa.pdf-rw-r--r--  1 pavlo pavlo   438 dic 18 17:28 UE-Empresa.pdf.sigPara verificar que está firmado por nosotros ejecutamos el siguiente comando:pavlo@debian:~()$ gpg --verify UE-Empresa.pdf.sig UE-Empresa.pdfgpg: Firmado el mié 18 dic 2024 17:28:53 CETgpg:                usando RSA clave C2E235639EB3A2A420828C9DED45D8BE85D4DB1Agpg: Firma correcta de \"Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\" [absoluta]Podemos observar que tanto el archivo original (UE-Empresa.pdf) como su firma (UE-Empresa.pdf.sig) están en ficheros independientes. Esto nos permite enviarlos a otra persona, quien podrá verificar la integridad del archivo utilizando nuestra clave pública.En este caso, mi compañero también ha seguido un procedimiento similar al nuestro. Por lo tanto, antes de proceder a verificar la firma de su archivo, es necesario importar su clave pública. Para realizar este paso, utilizaré el siguiente comando:pavlo@debian:~()$ gpg --keyserver pgp.rediris.es --recv-keys DB72B640gpg: clave F78DAA71DB72B640: clave pública \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Como podemos observar a continuación, la clave pública de mi compañero Jose se ha importado correctamente:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]pub   rsa4096 2024-12-18 [SC] [caduca: 2025-12-18]      7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640uid        [desconocida] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa4096 2024-12-18 [E] [caduca: 2025-12-18]Jose me ha enviado dos ficheros, un fichero documento.txt que es el fichero original, y un fichero documento.txt.sig, que contiene la firma del mismo. Para verificar la firma, vamos a hacer uso de la opción --verify, pasando como parámetros ambos ficheros:pavlo@debian:~()$ gpg --verify documento.txt.sig documento.txtgpg: Firmado el mié 18 dic 2024 18:42:03 CETgpg:                usando RSA clave 7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640gpg: Firma correcta de \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" [desconocido]gpg: ATENCIÓN: ¡Esta clave no está certificada por una firma de confianza!gpg:          No hay indicios de que la firma pertenezca al propietario.Huellas dactilares de la clave primaria: 7E7E CEAC 3D3D F6FD AF90  3497 F78D AA71 DB72 B640Como muestra la salida del comando, la firma es válida. Sin embargo, también aparece un mensaje indicando que la clave no está certificada por una firma confiable. Esto significa que no existen pruebas de que la firma pertenezca realmente al propietario declarado. Esto ocurre porque la clave pública que acabamos de importar carece de validez, ya que no la hemos firmado ni contamos con intermediarios confiables que puedan respaldarla de manera indirecta. Más adelante, explicaremos este concepto con mayor profundidad.Antes de continuar con el siguiente paso, he optado por eliminar la clave pública de mi anillo de claves. Esto me permitirá empezar desde cero, asegurándome de que no quede ninguna clave almacenada. Para realizar esta acción, utilizaré la opción --delete-keys:pavlo@debian:~()$ gpg --delete-keys 7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa4096/F78DAA71DB72B640 2024-12-18 jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;¿Eliminar esta clave del anillo? (s/N) sYa he eliminado la clave pública de Jose de mi keyring.Crea un anillo de confianza entre los miembros de la clasePara garantizar la seguridad en el uso de claves GPG, es fundamental asegurarnos de que las claves públicas con las que interactuamos realmente pertenecen a sus supuestos dueños. Sin esta verificación, podríamos estar cifrando información para un atacante en lugar del destinatario legítimo o aceptando firmas falsas sin darnos cuenta. La confianza en las claves es, por tanto, un aspecto esencial en la criptografía.Una forma de establecer esta confianza es a través del anillo de confianza, un sistema basado en la validación mutua entre personas que confían entre sí. Este mecanismo permite que los usuarios firmen la huella digital (fingerprint) de una clave pública utilizando su propia clave privada. Una vez firmada, la clave se devuelve a su propietario, quien puede compartirla con otros, demostrando así que ha sido validada por alguien de confianza.Este proceso no solo fortalece la credibilidad de una clave, sino que también facilita la verificación indirecta. Si confiamos en una persona y esta, a su vez, ha certificado la clave de otra, podemos asumir que dicha clave es confiable sin necesidad de validarla directamente. La efectividad de este modelo depende de cómo se configuren las relaciones de confianza y de la fiabilidad de quienes participan en la red.Aunque puede parecer complicado al principio, este sistema es muy útil para garantizar la autenticidad de las claves en un entorno seguro. Un ejemplo práctico ayudará a comprender mejor su funcionamiento.Pasos para crear un anillo de confianzaEl primer paso es subir nuestra clave pública a un servidor de claves, en este caso lo subiré a pgp.rediris.es:pavlo@debian:~()$ gpg --keyserver hkp://pgp.rediris.es --send-keys C2E235639EB3A2A420828C9DED45D8BE85D4DB1Agpg: enviando clave ED45D8BE85D4DB1A a hkp://pgp.rediris.esLuego, procedemos a descargarnos las claves públicas de mis compañeros, usando sus nombres o correos en la búsqueda de pgp.rediris.es, con el siguiente comando:pavlo@debian:~()$ gpg --keyserver pgp.rediris.es --recv-keys DB72B640gpg: clave F78DAA71DB72B640: clave pública \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Básicamente cogemos los últimos dígitos para importar la clave y repetimos el proceso con todos los compañeros.Seguidamente, tendremos que firmar las claves públicas descargadas para poder validarlas en nuestro anillo de confianza. Lo haremos de la siguiente forma:pavlo@debian:~()$ gpg --sign-key 7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640pub  rsa4096/F78DAA71DB72B640     creado: 2024-12-18  caduca: 2025-12-18  uso: SC       confianza: desconocido   validez: desconocidosub  rsa4096/C32521E4109A45D6     creado: 2024-12-18  caduca: 2025-12-18  uso: E   [desconocida] (1). jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;pub  rsa4096/F78DAA71DB72B640     creado: 2024-12-18  caduca: 2025-12-18  uso: SC       confianza: desconocido   validez: desconocido Huella clave primaria: 7E7E CEAC 3D3D F6FD AF90  3497 F78D AA71 DB72 B640     jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;Esta clave expirará el 2025-12-18.¿Está realmente seguro de querer firmar esta clavecon su clave: \"Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\" (ED45D8BE85D4DB1A)?¿Firmar de verdad? (s/N) sRepetimos el proceso con Alejandro Liáñez y con Andrés Morales.A continuación, será necesario exportar las claves de nuestros compañeros con la firma que hemos generado recientemente. Este paso nos permitirá distribuirlas manualmente a sus propietarios, quienes podrán importarlas en su sistema. Para este propósito, en mi caso, exporté las claves de tres compañeros utilizando los siguientes comandos:pavlo@debian:~()$ gpg --armor --export -a \"Andrés Morales González\" &gt; andres123.ascpavlo@debian:~()$ gpg --armor --export -a \"jose antonio canalo gonzalez\" &gt; clave-canalo.ascpavlo@debian:~()$ gpg --armor --export -a \"Alejandro Liáñez Frutos\" &gt; ale.ascY como vemos las claves han sido correctamente exportadas a los correspondientes ficheros:pavlo@debian:~()$ ls -l | grep '.asc'-rw-r--r--  1 pavlo pavlo  4260 dic 18 19:41 ale.asc-rw-r--r--  1 pavlo pavlo  3069 dic 18 17:48 andres123.asc-rw-r--r--  1 pavlo pavlo  3780 dic 18 19:34 clave-canalo.ascMis compañeros han seguido los mismos pasos, así que ellos también me enviaron mi clave con las correspondientes firmas, que debemos importar:pavlo@debian:~/firma()$ ls -ltotal 12-rw-r--r-- 1 pavlo pavlo 3244 dic 18 19:37 pablo_firmada.asc-rw-r--r-- 1 pavlo pavlo 3663 dic 18 18:42 pmh19.asc-rw-r--r-- 1 pavlo pavlo 3069 dic 18 17:44 pmh.ascComo vemos hay 3 ficheros, pertenecientes a cada uno de los compañeros que han colaborado conmigo en este anillo de confianza, por lo que ahora tendremos que importarlas:pavlo@debian:~/firma()$ gpg --import pablo_firmada.asc gpg: clave ED45D8BE85D4DB1A: \"Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\" 1 firma nuevagpg: Cantidad total procesada: 1gpg:         nuevas firmas: 1gpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   1  firmada:   3  confianza: 0-, 0q, 0n, 0m, 0f, 1ugpg: nivel: 1  validez:   3  firmada:   0  confianza: 3-, 0q, 0n, 0m, 0f, 0ugpg: siguiente comprobación de base de datos de confianza el: 2025-12-18Ahora, verificamos que mis compañeros hayan firmado mi clave:pavlo@debian:~/firma()$ gpg --list-sig \"Pablo Martín Hidalgo\"pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sig 3        ED45D8BE85D4DB1A 2024-12-13  Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sig          1B80812C7BB9EA86 2024-12-18  Andrés Morales González &lt;asirandyglez@gmail.com&gt;sig          9E7BEEE532BE0469 2024-12-18  Alejandro Liáñez Frutos &lt;alejandroliafru@gmail.com&gt;sig          F78DAA71DB72B640 2024-12-18  jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]sig          ED45D8BE85D4DB1A 2024-12-13  Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;Y como vemos a continuación:pavlo@debian:~()$ gpg --list-keysgpg: comprobando base de datos de confianzagpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   1  firmada:   3  confianza: 0-, 0q, 0n, 0m, 0f, 1ugpg: nivel: 1  validez:   3  firmada:   0  confianza: 3-, 0q, 0n, 0m, 0f, 0ugpg: siguiente comprobación de base de datos de confianza el: 2025-12-18/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      B39722468D0599C3B62F9AEA9E7BEEE532BE0469uid        [   total   ] Alejandro Liáñez Frutos &lt;alejandroliafru@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]pub   rsa3072 2024-12-16 [SC] [caduca: 2026-12-16]      B7E822D8FB45BD8BAF2F31561B80812C7BB9EA86uid        [   total   ] Andrés Morales González &lt;asirandyglez@gmail.com&gt;sub   rsa3072 2024-12-16 [E] [caduca: 2026-12-16]pub   rsa4096 2024-12-18 [SC] [caduca: 2025-12-18]      7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640uid        [   total   ] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa4096 2024-12-18 [E] [caduca: 2025-12-18]Todas las claves han sido ya firmadas (es posible que nos haya pedido la frase de paso de nuestra clave privada a la hora de llevar a cabo el proceso de firmado), su validez ha cambiado de desconocida a total, por lo que en caso de querer encriptar con dichas claves públicas o comprobar firmas, no se nos mostrará el mensaje de advertencia.Podemos verificar que todas las claves se encuentran firmadas por todos, por lo que todos hemos validado las claves de todos.Comprueba que ya puedes verificar sin “problemas” una firma recibida por una persona en la que confías.Como podemos observar, el documento firmado anteriormente ya nos muestra el mensaje de que la firma es correcta:pavlo@debian:~()$ gpg --verify documento.txt.sig gpg: asumiendo que los datos firmados están en 'documento.txt'gpg: Firmado el mié 18 dic 2024 18:42:03 CETgpg:                usando RSA clave 7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640gpg: Firma correcta de \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" [total]Comprueba que puedes verificar con confianza una firma de una persona en las que no confías, pero sin embargo si confía otra persona en la que tu tienes confianza total.El primer paso es asignar un nivel de confianza absoluta a la clave de una persona (Andrés Morales González en este caso), bajo el supuesto de que verificará correctamente las claves de otros usuarios. Esto se realiza con los comandos:pavlo@debian:~/firma()$ gpg --edit-key \"Andrés Morales González\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa3072/1B80812C7BB9EA86     creado: 2024-12-16  caduca: 2026-12-16  uso: SC       confianza: desconocido   validez: totalsub  rsa3072/31278448B2A4EFCA     creado: 2024-12-16  caduca: 2026-12-16  uso: E   [   total   ] (1). Andrés Morales González &lt;asirandyglez@gmail.com&gt;gpg&gt; trustpub  rsa3072/1B80812C7BB9EA86     creado: 2024-12-16  caduca: 2026-12-16  uso: SC       confianza: desconocido   validez: totalsub  rsa3072/31278448B2A4EFCA     creado: 2024-12-16  caduca: 2026-12-16  uso: E   [   total   ] (1). Andrés Morales González &lt;asirandyglez@gmail.com&gt;Por favor, decida su nivel de confianza en que este usuarioverifique correctamente las claves de otros usuarios (mirandopasaportes, comprobando huellas dactilares en diferentes fuentes...)  1 = No lo sé o prefiero no decirlo  2 = NO tengo confianza  3 = Confío un poco  4 = Confío totalmente  5 = confío absolutamente  m = volver al menú principal¿Su decisión? 5¿De verdad quiere asignar absoluta confianza a esta clave? (s/N) spub  rsa3072/1B80812C7BB9EA86     creado: 2024-12-16  caduca: 2026-12-16  uso: SC       confianza: absoluta      validez: totalsub  rsa3072/31278448B2A4EFCA     creado: 2024-12-16  caduca: 2026-12-16  uso: E   [   total   ] (1). Andrés Morales González &lt;asirandyglez@gmail.com&gt;Ten en cuenta que la validez de clave mostrada no es necesariamentecorrecta a menos de que reinicies el programa.gpg&gt; quitSeleccionamos el nivel 5 (confianza absoluta) y confirmamos la acción. Esto marca la clave como confiable para firmar otras claves, lo que permite delegar la validación.Luego, importamos la clave pública del firmante final, en este caso Juan Antonio Pineda Amador, utilizando su identificador:pavlo@debian:~/firma()$ gpg --keyserver keyserver.ubuntu.com --recv-keys d30d0b7e734fcf74gpg: clave D30D0B7E734FCF74: clave pública \"Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Esto descarga e importa la clave pública al anillo de claves.Luego, importamos una versión de la clave firmada por alguien en quien confío (como Andrés Morales González):pavlo@debian:~/firma()$ gpg --import clave-firmada-pablo.asc gpg: clave ED45D8BE85D4DB1A: \"Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\" 1 firma nuevagpg: Cantidad total procesada: 1gpg:         nuevas firmas: 1gpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   2  firmada:   2  confianza: 0-, 0q, 0n, 0m, 0f, 2ugpg: nivel: 1  validez:   2  firmada:   0  confianza: 2-, 0q, 0n, 0m, 0f, 0ugpg: siguiente comprobación de base de datos de confianza el: 2025-12-18Por último damos nuestra confianza absoluta en Juan Antonio Pineda:pavlo@debian:~/firma()$ gpg --edit-key \"Juan Antonio Pineda Amador\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa3072/D30D0B7E734FCF74     creado: 2024-12-13  caduca: 2026-12-13  uso: SC       confianza: desconocido   validez: desconocidosub  rsa3072/BC028BCC730037FF     creado: 2024-12-13  caduca: 2026-12-13  uso: E   [desconocida] (1). Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;gpg&gt; trustpub  rsa3072/D30D0B7E734FCF74     creado: 2024-12-13  caduca: 2026-12-13  uso: SC       confianza: desconocido   validez: desconocidosub  rsa3072/BC028BCC730037FF     creado: 2024-12-13  caduca: 2026-12-13  uso: E   [desconocida] (1). Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;Por favor, decida su nivel de confianza en que este usuarioverifique correctamente las claves de otros usuarios (mirandopasaportes, comprobando huellas dactilares en diferentes fuentes...)  1 = No lo sé o prefiero no decirlo  2 = NO tengo confianza  3 = Confío un poco  4 = Confío totalmente  5 = confío absolutamente  m = volver al menú principal¿Su decisión? 5¿De verdad quiere asignar absoluta confianza a esta clave? (s/N) spub  rsa3072/D30D0B7E734FCF74     creado: 2024-12-13  caduca: 2026-12-13  uso: SC       confianza: absoluta      validez: desconocidosub  rsa3072/BC028BCC730037FF     creado: 2024-12-13  caduca: 2026-12-13  uso: E   [desconocida] (1). Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;Ten en cuenta que la validez de clave mostrada no es necesariamentecorrecta a menos de que reinicies el programa.gpg&gt; quitpavlo@debian:~/firma()$ gpg --list-siggpg: comprobando base de datos de confianzagpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   3  firmada:   2  confianza: 0-, 0q, 0n, 0m, 0f, 3ugpg: nivel: 1  validez:   2  firmada:   0  confianza: 2-, 0q, 0n, 0m, 0f, 0ugpg: siguiente comprobación de base de datos de confianza el: 2025-12-18/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sig 3        ED45D8BE85D4DB1A 2024-12-13  Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sig          1B80812C7BB9EA86 2024-12-18  Andrés Morales González &lt;asirandyglez@gmail.com&gt;sig          9E7BEEE532BE0469 2024-12-18  Alejandro Liáñez Frutos &lt;alejandroliafru@gmail.com&gt;sig          F78DAA71DB72B640 2024-12-18  jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sig          D30D0B7E734FCF74 2024-12-19  Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]sig          ED45D8BE85D4DB1A 2024-12-13  Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      B39722468D0599C3B62F9AEA9E7BEEE532BE0469uid        [   total   ] Alejandro Liáñez Frutos &lt;alejandroliafru@gmail.com&gt;sig 3        9E7BEEE532BE0469 2024-12-12  Alejandro Liáñez Frutos &lt;alejandroliafru@gmail.com&gt;sig          1B80812C7BB9EA86 2024-12-17  Andrés Morales González &lt;asirandyglez@gmail.com&gt;sig          EB11F07AEE22B444 2024-12-18  [ID de usuario no encontrado]sig          ED45D8BE85D4DB1A 2024-12-18  Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]sig          9E7BEEE532BE0469 2024-12-12  Alejandro Liáñez Frutos &lt;alejandroliafru@gmail.com&gt;pub   rsa3072 2024-12-16 [SC] [caduca: 2026-12-16]      B7E822D8FB45BD8BAF2F31561B80812C7BB9EA86uid        [  absoluta ] Andrés Morales González &lt;asirandyglez@gmail.com&gt;sig 3        1B80812C7BB9EA86 2024-12-16  Andrés Morales González &lt;asirandyglez@gmail.com&gt;sig          ED45D8BE85D4DB1A 2024-12-18  Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-16 [E] [caduca: 2026-12-16]sig          1B80812C7BB9EA86 2024-12-16  Andrés Morales González &lt;asirandyglez@gmail.com&gt;pub   rsa4096 2024-12-18 [SC] [caduca: 2025-12-18]      7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640uid        [   total   ] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sig 3        F78DAA71DB72B640 2024-12-18  jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sig          ED45D8BE85D4DB1A 2024-12-18  Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa4096 2024-12-18 [E] [caduca: 2025-12-18]sig          F78DAA71DB72B640 2024-12-18  jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;pub   rsa3072 2023-02-22 [SC] [caduca: 2025-02-21]      D6E21A8B6ED6E8EF9F7CE81686F55C1E2DA53D65uid        [desconocida] Raúl Ruiz &lt;raulpruebas21@gmail.com&gt;sig 3        86F55C1E2DA53D65 2023-02-22  Raúl Ruiz &lt;raulpruebas21@gmail.com&gt;sub   rsa3072 2023-02-22 [E] [caduca: 2025-02-21]sig          86F55C1E2DA53D65 2023-02-22  Raúl Ruiz &lt;raulpruebas21@gmail.com&gt;pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      97AAB306BAF9F7A0600C9F7CD30D0B7E734FCF74uid        [  absoluta ] Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;sig 3        D30D0B7E734FCF74 2024-12-13  Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]sig          D30D0B7E734FCF74 2024-12-13  Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;Con ambas claves presentes (la del intermediario y la del firmante final), verificamos el archivo firmado y el archivo original para comprobar su autenticidad:pavlo@debian:~/firma()$ gpg --verify pinedadocumento.txt.sig pinedadocumento.txtgpg: Firmado el dom 15 dic 2024 18:36:36 CETgpg:                usando RSA clave 97AAB306BAF9F7A0600C9F7CD30D0B7E734FCF74gpg: Firma correcta de \"Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;\" [absoluta]Y como vemos el sistema confirma la firma.Tarea 2: Correo seguro con evolution/thunderbirdAhora vamos a configurar nuestro cliente de correo electrónico para poder mandar correos cifrados, para ello:Configura el cliente de correo evolution con tu cuenta de correo habitualPara este apartado lo que haremos será instalar Thunderbird con el siguiente comando:pavlo@debian:~()$ sudo apt install thunderbird-l10n-es-esUna vez instalado ejecutamos Thunderbird y rellenamos los campos:Después de hacer la verificación en dos pasos ya nos dejará entrar sin ningún problema:Añade a la cuenta las opciones de seguridad para poder enviar correos firmados con tu clave privada o cifrar los mensajes para otros destinatariosPara este apartado debemos utilizar la clave privada, por lo que primero debemos listarla:pavlo@debian:~/firma()$ gpg --list-secret-keys/home/pavlo/.gnupg/pubring.kbx------------------------------sec   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;ssb   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]Ahora, utilizando el ID de nuestra clave, debemos exportarla en un fichero para más tarde configurarlo en Thunderbird:pavlo@debian:~/firma()$ gpg --export-secret-keys --armor C2E235639EB3A2A420828C9DED45D8BE85D4DB1A &gt; clave-thunderbird.ascPosiblemente nos pida la frase de paso, la introducimos y ya debería generarse el fichero:pavlo@debian:~/firma()$ ls -l | grep 'clave'-rw-r--r-- 1 pavlo pavlo 7187 dic 19 11:57 clave-thunderbird.ascSeguidamente, debemos dirigirnos a la aplicación de correos e importar la clave que acabamos de crear. Para ello nos dirigimos a Ajustes » Configuración de la cuenta » Cifrado de extremo a extremo, le damos a añadir clave y seleccionamos la creada anteriormente:Y como vemos ya se ha importado correctamente la clave:Envía y recibe varios mensajes con tus compañeros y comprueba el funcionamiento adecuado de GPGPara esta prueba, le he mandado un correo a Andrés Morales (asirandyglez@gmail.com) con su clave pública la cual me ha pasado:pavlo@debian:~/firma()$ ls -ltotal 28-rw-r--r-- 1 pavlo pavlo 4256 dic 19 12:10 andy-and1.asc-rw-r--r-- 1 pavlo pavlo 7187 dic 19 11:57 clave-thunderbird.asc-rw-r--r-- 1 pavlo pavlo 3244 dic 18 19:37 pablo_firmada.asc-rw-r--r-- 1 pavlo pavlo 3663 dic 18 18:42 pmh19.asc-rw-r--r-- 1 pavlo pavlo 3069 dic 18 17:44 pmh.ascPor lo tanto, enviamos un mensaje y seleccionamos el fichero de su clave para que se firme el correo:Por otro lado, Andrés me enviará un correo firmado con mi clave pública:Y como podemos observar, desde gmail no nos dejará ver el contenido:Enviar un correo electrónico al profesor con un mensaje firmado por vosotros y que solo pueda descifrar yo.Para la realización de este apartado extra debemos importar la clave del profesor Raúl en nuestro sistema. Para ello nos dirigimos a la página wiki y nos descargamos su clave:pavlo@debian:~/firma()$ gpg --keyserver keyserver.ubuntu.com --recv-keys 86f55c1e2da53d65gpg: clave 86F55C1E2DA53D65: clave pública \"Raúl Ruiz &lt;raulpruebas21@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Como podemos observar, su clave se ha importado correctamente:pavlo@debian:~/firma()$ gpg --list-keys /home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      B39722468D0599C3B62F9AEA9E7BEEE532BE0469uid        [   total   ] Alejandro Liáñez Frutos &lt;alejandroliafru@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]pub   rsa3072 2024-12-16 [SC] [caduca: 2026-12-16]      B7E822D8FB45BD8BAF2F31561B80812C7BB9EA86uid        [   total   ] Andrés Morales González &lt;asirandyglez@gmail.com&gt;sub   rsa3072 2024-12-16 [E] [caduca: 2026-12-16]pub   rsa4096 2024-12-18 [SC] [caduca: 2025-12-18]      7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640uid        [   total   ] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa4096 2024-12-18 [E] [caduca: 2025-12-18]pub   rsa3072 2023-02-22 [SC] [caduca: 2025-02-21]      D6E21A8B6ED6E8EF9F7CE81686F55C1E2DA53D65uid        [desconocida] Raúl Ruiz &lt;raulpruebas21@gmail.com&gt;sub   rsa3072 2023-02-22 [E] [caduca: 2025-02-21]Por lo que ahora debemos hacer lo mismo que antes, exportar la clave en un fichero .asc y añadirla en Thunderbird:pavlo@debian:~/firma()$ gpg --export --armor 86f55c1e2da53d65 &gt; clave-raul.ascVamos a enviar un nuevo correo a Raúl a su correo y debemos darle arriba a la izquierda a “Cifrar”. Una vez seleccionado esta opción nos saldrá un mensaje abajo en amarillo, en donde debemos darle a “Resolver”. Ahí importamos la clave de Raúl y ya estaría:Y como podemos comprobar a continuación, el correo ha sido enviado con OpenGPG:Tarea 3: Integridad de ficherosVamos a descargarnos la ISO de debian, y posteriormente vamos a comprobar su integridad.Puedes encontrar la ISO en la dirección: https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/.Para validar el contenido de la imagen CD, solo asegúrese de usar la herramienta apropiada para sumas de verificación. Para cada versión publicada existen archivos de suma de comprobación con algoritmos fuertes (SHA256 y SHA512); debería usar las herramientas sha256sum o sha512sum para trabajar con ellosPues lo primero que debemos hacer es descargar la ISO de Debian 12 y el fichero de suma de comprobación(SHA512):pavlo@debian:~/integridad()$ wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-12.8.0-amd64-netinst.isopavlo@debian:~/integridad()$ wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA512SUMSUtilizamos la herramienta sha512sum para generar el hash de la imagen ISO descargada y comparar el resultado con el hash proporcionado en los archivos de suma de comprobación.pavlo@debian:~/integridad()$ ls -ltotal 646148-rw-r--r-- 1 pavlo pavlo 661651456 nov  9 13:46 debian-12.8.0-amd64-netinst.iso-rw-r--r-- 1 pavlo pavlo       494 nov  9 17:34 SHA512SUMSpavlo@debian:~/integridad()$ sha512sum --check --ignore-missing SHA512SUMSdebian-12.8.0-amd64-netinst.iso: La suma coincideY como vemos el contenido de la imagen CD coincide.Verifica que el contenido del hash que has utilizado no ha sido manipulado, usando la firma digital que encontrarás en el repositorio. Puedes encontrar una guía para realizarlo en este artículo: How to verify an authenticity of downloaded Debian ISO imagesEste paso verifica que el archivo de suma de comprobación no ha sido manipulado y que está firmado por una clave confiable. Por lo que debemos descargarnos la firma digital:pavlo@debian:~/integridad()$ wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA512SUMS.signVerificamos la firma y como vemos a continuación nos saldrá un mensaje de error de que es imposible comprobar la firma:pavlo@debian:~/integridad()$ gpg --verify SHA512SUMS.sign SHA512SUMSgpg: Firmado el sáb 09 nov 2024 17:35:02 CETgpg:                usando RSA clave DF9B9C49EAA9298432589D76DA87E80D6294BE9Bgpg: Imposible comprobar la firma: No hay clave públicaEsto se debe a que no tenemos importada la clave pública de la persona que firmó dicho fichero, por lo que para solucionar esto debemos importar la clave:pavlo@debian:~/integridad()$ gpg --keyserver keyserver.ubuntu.com --recv-keys DF9B9C49EAA9298432589D76DA87E80D6294BE9Bgpg: clave DA87E80D6294BE9B: clave pública \"Debian CD signing key &lt;debian-cd@lists.debian.org&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Volvemos a verificar la firma:pavlo@debian:~/integridad()$ gpg --verify SHA512SUMS.sign SHA512SUMSgpg: Firmado el sáb 09 nov 2024 17:35:02 CETgpg:                usando RSA clave DF9B9C49EAA9298432589D76DA87E80D6294BE9Bgpg: Firma correcta de \"Debian CD signing key &lt;debian-cd@lists.debian.org&gt;\" [desconocido]gpg: ATENCIÓN: ¡Esta clave no está certificada por una firma de confianza!gpg:          No hay indicios de que la firma pertenezca al propietario.Huellas dactilares de la clave primaria: DF9B 9C49 EAA9 2984 3258  9D76 DA87 E80D 6294 BE9BY efectivamente, el hash del fichero resumen coincide con el hash del fichero resumen que Debian ha firmado, por lo que podemos concluir que no ha habido ninguna manipulación y las imágenes ISO están totalmente limpias.Al no tener validada la clave de Debian nos ha mostrado la advertencia de seguridad, pero eso no tiene nada que ver, pues la firma ha sido correctamente verificada.Tarea 4: Integridad y autenticidad (apt secure)APT Secure es el mecanismo utilizado por Debian para garantizar que los paquetes instalados desde sus repositorios oficiales sean legítimos y no hayan sido modificados. Este sistema utiliza criptografía asimétrica para verificar la autenticidad de los paquetes.¿Qué software utiliza apt secure para realizar la criptografía asimétrica?APT Secure utiliza GNU Privacy Guard (GPG) para realizar la criptografía asimétrica, firmando digitalmente los paquetes y verificando las firmas de los mismos.¿Para que sirve el comando apt-key? ¿Qué muestra el comando apt-key list?El comando apt-key es una herramienta que permite gestionar las claves utilizadas por APT para autenticar paquetes, considerando como confiables aquellos paquetes que han sido correctamente autenticados mediante estas claves. Las opciones más comunes son:      add: Añade una nueva clave a la lista de claves de confianza desde un archivo que se pasa como parámetro.        del: Elimina una clave de la lista de claves de confianza, especificando el fingerprint de la clave como parámetro.        export: Muestra la clave a través de la salida estándar, indicando el fingerprint de la misma como parámetro.        exportall: Muestra todas las claves de confianza por la salida estándar.        list: Muestra todas las claves de confianza.        finger: Muestra los fingerprints de todas las claves de confianza.  Por ejemplo, una salida del comando sería:pavlo@debian:~()$ apt-key listWarning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8))./etc/apt/trusted.gpg--------------------pub   rsa4096 2017-02-22 [SCEA]      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88uid        [desconocida] Docker Release (CE deb) &lt;docker@docker.com&gt;sub   rsa4096 2017-02-22 [S]pub   dsa1024 2004-09-12 [SC]      6302 39CC 130E 1A7F D81A  27B1 4097 6EAF 437D 05B5uid        [desconocida] Ubuntu Archive Automatic Signing Key &lt;ftpmaster@ubuntu.com&gt;sub   elg2048 2004-09-12 [E]pub   rsa4096 2024-05-03 [SC]      3648 37CF 91E0 7091 0231  C2FE 8219 B3A0 AEF3 D498uid        [desconocida] Launchpad PPA for elementary OS teampub   rsa1024 2011-10-01 [SC]      6C87 69CE DC20 F5E6 6C3B  7D37 BF36 996C 4E1F 8A59uid        [desconocida] Launchpad PPA for elementary OS team/etc/apt/trusted.gpg.d/debian-archive-bookworm-automatic.asc------------------------------------------------------------pub   rsa4096 2023-01-21 [SC] [caduca: 2031-01-19]      B8B8 0B5B 623E AB6A D877  5C45 B7C5 D7D6 3509 47F8uid        [desconocida] Debian Archive Automatic Signing Key (12/bookworm) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2023-01-21 [S] [caduca: 2031-01-19]/etc/apt/trusted.gpg.d/debian-archive-bookworm-security-automatic.asc---------------------------------------------------------------------pub   rsa4096 2023-01-21 [SC] [caduca: 2031-01-19]      05AB 9034 0C0C 5E79 7F44  A8C8 254C F3B5 AEC0 A8F0uid        [desconocida] Debian Security Archive Automatic Signing Key (12/bookworm) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2023-01-21 [S] [caduca: 2031-01-19]/etc/apt/trusted.gpg.d/debian-archive-bookworm-stable.asc---------------------------------------------------------pub   ed25519 2023-01-23 [SC] [caduca: 2031-01-21]      4D64 FEC1 19C2 0290 67D6  E791 F8D2 585B 8783 D481uid        [desconocida] Debian Stable Release Key (12/bookworm) &lt;debian-release@lists.debian.org&gt;/etc/apt/trusted.gpg.d/debian-archive-bullseye-automatic.asc------------------------------------------------------------pub   rsa4096 2021-01-17 [SC] [caduca: 2029-01-15]      1F89 983E 0081 FDE0 18F3  CC96 73A4 F27B 8DD4 7936uid        [desconocida] Debian Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2021-01-17 [S] [caduca: 2029-01-15]/etc/apt/trusted.gpg.d/debian-archive-bullseye-security-automatic.asc---------------------------------------------------------------------pub   rsa4096 2021-01-17 [SC] [caduca: 2029-01-15]      AC53 0D52 0F2F 3269 F5E9  8313 A484 4904 4AAD 5C5Duid        [desconocida] Debian Security Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2021-01-17 [S] [caduca: 2029-01-15]/etc/apt/trusted.gpg.d/debian-archive-bullseye-stable.asc---------------------------------------------------------pub   rsa4096 2021-02-13 [SC] [caduca: 2029-02-11]      A428 5295 FC7B 1A81 6000  62A9 605C 66F0 0D6C 9793uid        [desconocida] Debian Stable Release Key (11/bullseye) &lt;debian-release@lists.debian.org&gt;/etc/apt/trusted.gpg.d/debian-archive-buster-automatic.asc----------------------------------------------------------pub   rsa4096 2019-04-14 [SC] [caduca: 2027-04-12]      80D1 5823 B7FD 1561 F9F7  BCDD DC30 D7C2 3CBB ABEEuid        [desconocida] Debian Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2019-04-14 [S] [caduca: 2027-04-12]/etc/apt/trusted.gpg.d/debian-archive-buster-security-automatic.asc-------------------------------------------------------------------pub   rsa4096 2019-04-14 [SC] [caduca: 2027-04-12]      5E61 B217 265D A980 7A23  C5FF 4DFA B270 CAA9 6DFAuid        [desconocida] Debian Security Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2019-04-14 [S] [caduca: 2027-04-12]/etc/apt/trusted.gpg.d/debian-archive-buster-stable.asc-------------------------------------------------------pub   rsa4096 2019-02-05 [SC] [caduca: 2027-02-03]      6D33 866E DD8F FA41 C014  3AED DCC9 EFBF 77E1 1517uid        [desconocida] Debian Stable Release Key (10/buster) &lt;debian-release@lists.debian.org&gt;/etc/apt/trusted.gpg.d/deb-multimedia-keyring.gpg-------------------------------------------------pub   rsa4096 2014-03-05 [SC]      A401 FF99 368F A1F9 8152  DE75 5C80 8C2B 6555 8117uid        [desconocida] Christian Marillat &lt;marillat@debian.org&gt;uid        [desconocida] Christian Marillat &lt;marillat@free.fr&gt;uid        [desconocida] Christian Marillat &lt;marillat@deb-multimedia.org&gt;sub   rsa4096 2014-03-05 [E]/etc/apt/trusted.gpg.d/google-chrome.gpg----------------------------------------pub   rsa4096 2016-04-12 [SC]      EB4C 1BFD 4F04 2F6D DDCC  EC91 7721 F63B D38B 4796uid        [desconocida] Google Inc. (Linux Packages Signing Authority) &lt;linux-packages-keymaster@google.com&gt;sub   rsa4096 2023-02-15 [S] [caduca: 2026-02-14]sub   rsa4096 2024-01-30 [S] [caduca: 2027-01-29]/etc/apt/trusted.gpg.d/microsoft.gpg------------------------------------pub   rsa2048 2015-10-28 [SC]      BC52 8686 B50D 79E3 39D3  721C EB3E 94AD BE12 29CFuid        [desconocida] Microsoft (Release signing) &lt;gpgsecurity@microsoft.com&gt;¿En que fichero se guarda el anillo de claves que guarda la herramienta apt-key?El anillo de claves utilizado por apt-key se guarda en el fichero /etc/apt/trusted.gpg y en cualquier archivo .gpg dentro de /etc/apt/trusted.gpg.d/.¿Qué contiene el archivo Release de un repositorio de paquetes?. ¿Y el archivo Release.gpg?. Puedes ver estos archivos en el repositorio http://ftp.debian.org/debian/dists/Debian10.1/. Estos archivos se descargan cuando hacemos un apt update.El archivo Release contiene información sobre el repositorio, como la versión del sistema operativo, la arquitectura, la lista de componentes (main, contrib, non-free) y otra información relevante. También incluye firmas digitales (hashes criptográficos) para cada archivo de paquete (por ejemplo, Packages y Packages.gz) dentro del repositorio. Estos hashes se utilizan para verificar la integridad de los archivos descargados.El archivo Release.gpg contiene la firma digital asociada con el archivo Release. Esta firma es generada por la entidad que mantiene el repositorio y se utiliza para verificar la autenticidad del archivo Release. Esta firma digital se verifica durante el proceso de apt update, asegurando que el archivo Release no haya sido modificado y que realmente provenga del repositorio oficial.Explica el proceso por el cual el sistema nos asegura que los ficheros que estamos descargando son legítimos.Este proceso implica el uso de criptografía asimétrica y firmas digitales:      Descarga del archivo “Release” y su firma (“Release.gpg”): cuando ejecutamos apt update, el sistema descarga el archivo Release y su firma asociada Release.gpg desde el repositorio Debian o el mirror especificado.        Verificación de la firma digital: el archivo Release.gpg contiene la firma digital generada por la clave privada de la entidad que mantiene el repositorio. Utilizando la clave pública correspondiente a esa clave privada (que generalmente ya está instalada en el sistema), se verifica la autenticidad de la firma digital. Si la verificación falla, el proceso se detendrá, ya que indica que el archivo Release puede haber sido modificado.        Verificación de la integridad del archivo “Release”: si la firma digital es válida, se procede a verificar la integridad del archivo Release. El archivo Release contiene hashes criptográficos (generalmente SHA256) de otros archivos importantes en el repositorio, como Packages y Packages.gz. Se recalcula el hash localmente y se compara con los hashes proporcionados en el archivo Release. Si hay alguna discrepancia, se asume que los archivos pueden haber sido modificados y el proceso se detiene.        Descarga de archivos de índice de paquetes (por ejemplo, Packages o Packages.gz): si la verificación de firma y la integridad del archivo Release son exitosas, el sistema procede a descargar los archivos de índice de paquetes mencionados en el archivo Release.        Verificación de la integridad de los archivos de paquetes: similar al paso anterior, se verifica la integridad de los archivos de paquetes utilizando los hashes proporcionados en los archivos de índice de paquetes.  Añade de forma correcta el repositorio de virtualbox añadiendo la clave pública de virtualbox como se indica en la documentación.En primer lugar añadimos el repositorio con los siguientes comando:pavlo@debian:~()$ sudo echo \"deb [arch=amd64 signed-by=/usr/share/keyrings/oracle-virtualbox-2016.gpg] https://download.virtualbox.org/virtualbox/debian bookworm contrib\" | sudo tee /etc/apt/sources.list.d/virtualbox.listY ahora descargamos e importamos la clave pública de Oracle con el siguiente comando:pavlo@debian:~()$ wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo gpg --dearmor -o /usr/share/keyrings/oracle-virtualbox-2016.gpgHacemos un apt update y ya encontramos el repositorio listo para descargar Virtualbox:pavlo@debian:~()$ sudo apt updateObj:2 https://deb.nodesource.com/node_20.x nodistro InRelease                                                                                                               Obj:4 https://dl.google.com/linux/chrome/deb stable InRelease                                                                                                               Ign:3 https://ppa.launchpad.net/elementary-os/stable/ubuntu focal InRelease                                                                                                 Obj:1 https://deb-multimedia.org bookworm InRelease                                                                                                                         Des:8 https://packages.microsoft.com/repos/code stable InRelease [3.590 B]                                                                                        Obj:5 https://deb.debian.org/debian bookworm InRelease                                                                             Obj:6 https://security.debian.org/debian-security bookworm-security InRelease   Des:9 https://download.virtualbox.org/virtualbox/debian bookworm InRelease [4.434 B]Obj:7 https://deb.debian.org/debian bookworm-updates InRelease                           Des:10 https://packages.microsoft.com/repos/code stable/main armhf Packages [18,3 kB]Des:11 https://packages.microsoft.com/repos/code stable/main arm64 Packages [18,2 kB]Des:12 https://packages.microsoft.com/repos/code stable/main amd64 Packages [18,2 kB]Ign:3 https://ppa.launchpad.net/elementary-os/stable/ubuntu focal InReleaseDes:13 https://download.virtualbox.org/virtualbox/debian bookworm/contrib amd64 Packages [1.947 B]Des:14 https://download.virtualbox.org/virtualbox/debian bookworm/contrib amd64 Contents (deb) [4.375 B]Tarea 5: Autentificación: ejemplo SSHExplica los pasos que se producen entre el cliente y el servidor para que el protocolo cifre la información que se transmite? ¿Para qué se utiliza la criptografía simétrica? ¿Y la asimétrica?El protocolo SSH utiliza tanto criptografía simétrica como asimétrica para garantizar la seguridad en la comunicación entre el cliente y el servidor. Estos son los pasos que se producen:      El cliente inicia la conexión al servidor SSH enviando una solicitud de conexión. Intercambio de identificación y parámetros:        El servidor y el cliente intercambian información sobre sus capacidades y parámetros de configuración.        Negociación de algoritmos: se realiza una negociación para seleccionar los algoritmos que se utilizarán en la conexión, incluyendo algoritmos para cifrado simétrico, funciones hash, intercambio de claves, etc.        Intercambio de claves de sesión (cripografía asimétrica): el cliente y el servidor acuerdan sobre una clave de sesión utilizando criptografía asimétrica. Usualmente, el algoritmo de intercambio de claves utilizado es Diffie-Hellman.        Autenticación: en esta fase, se puede realizar la autenticación de las partes. Esto puede involucrar la presentación de credenciales por parte del cliente (como contraseñas o certificados).        Generación de la clave de sesión compartida (criptografía simétrica): a partir de la información intercambiada en el paso anterior, ambas partes generan de manera independiente una clave de sesión compartida. Esta clave de sesión será utilizada para cifrar y descifrar los datos durante la sesión.        Cifrado de la sesión (criptografía simétrica): a partir de este punto, la conexión SSH utiliza la criptografía simétrica para cifrar los datos durante la transmisión. La clave de sesión compartida se utiliza para este propósito, proporcionando eficiencia y velocidad en el cifrado.        Intercambio de mensajes cifrados: Todos los mensajes intercambiados entre el cliente y el servidor, incluyendo comandos, respuestas y otros datos, se cifran utilizando la clave de sesión compartida.  La criptografía simétrica se utiliza para cifrar los datos durante la transmisión debido a su eficiencia. Es más rápida que la criptografía asimétrica, por lo que es ideal para cifrar grandes cantidades de datos. Sin embargo, la criptografía asimétrica se utiliza en la fase de intercambio de claves para asegurar que las claves de sesión compartida se generen de forma segura y sin necesidad de intercambiar claves directamente, lo que sería menos seguro. La combinación de ambos tipos de criptografía en SSH aprovecha las fortalezas de cada uno para proporcionar un entorno de comunicación seguro y eficiente.Explica los dos métodos principales de autentificación: por contraseña y utilizando un par de claves públicas y privadas.      Autenticación por contraseña: el usuario inicia una conexión SSH proporcionando un nombre de usuario y contraseña, y son enviados al servidor. El servidor compara la contraseña ingresada con la almacenada para el usuario. Este método es sencillo aunque la seguridad depende de la complejidad y robustez de la contraseña, y puede ser vulnerable a ataques de fuerza bruta o de suplantación de identidad si estas son débiles.        Autenticación por par de claves: el usuario genera un par de claves. La clave pública se inyecta en el servidor SSH y se asocia con el nombre de usuario correspondiente. Al iniciarse la conexión SSH, el cliente debe hacerlo con su clave privada para demostrar la identidad. El servidor utiliza la clave pública asociada al usuario para verificar la autenticidad de la clave privada del cliente. Este método proporciona un alto nivel de seguridad, superior al método de autenticación por contraseña (por ejemplo es resistente a los ataques por fuerza bruta). Además también permite el acceso a un servidor sin necesidad de ingresar una contraseña cada vez que se establece la conexión.  En el cliente, ¿para que sirve el contenido que se guarda en el fichero ~/.ssh/know_hosts?Este archivo almacena los fingerprints de las claves públicas de los hosts remotos a los que el cliente se ha conectado anteriormente. Cuando el cliente se va a conectar a un host remoto, la clave pública de ese host se almacena en este archivo. Una vez almacenada en el cliente, en la próxima conexión se vuelve a calcular el fingerprint del host remoto y se compara con el que ya estaba almacenado de anteriores conexiones. Si la huella digital coincide con una entrada existente, se considera que el host es auténtico y la conexión procede sin problemas. Si la huella digital no coincide, el cliente emite una advertencia de posible ataque de “man-in-the-middle” (intermediario malicioso) porque la clave pública del host remoto ha cambiado.¿Qué significa este mensaje que aparece la primera vez que nos conectamos a un servidor?$ ssh debian@172.22.200.74 The authenticity of host '172.22.200.74 (172.22.200.74)' can't be established. ECDSA key fingerprint is SHA256:7ZoNZPCbQTnDso1meVSNoKszn38ZwUI4i6saebbfL4M. Are you sure you want to continue connecting (yes/no)? En este escenario, el usuario tiene la opción de continuar o no con la conexión, dependiendo de cuánto confíe en el servidor. Si decide aceptar, la clave del servidor se guardará en el archivo situado en ~/.ssh/known_hosts. Esto asegura que, en futuras conexiones, no se le pedirá nuevamente al cliente que confirme, ya que el sistema verificará si la clave ya está registrada en dicho archivo.En ocasiones cuando estamos trabajando en el cloud, y reutilizamos una ip flotante nos aparece este mensaje:$ ssh debian@172.22.200.74 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY! Someone could be eavesdropping on you right now (man-in-the-middle attack)! It is also possible that a host key has just been changed. The fingerprint for the ECDSA key sent by the remote host is SHA256:W05RrybmcnJxD3fbwJOgSNNWATkVftsQl7EzfeKJgNc. Please contact your system administrator. Add correct host key in /home/jose/.ssh/known_hosts to get rid of this message. Offending ECDSA key in /home/jose/.ssh/known_hosts:103   remove with:   ssh-keygen -f \"/home/jose/.ssh/known_hosts\" -R \"172.22.200.74\" ECDSA host key for 172.22.200.74 has changed and you have requested strict checking.Esto significa que nos estamos conectando a un host remoto que previamente teníamos su fingerprint almacenada en este archivo, pero al comparar la actual del host remoto con la que teníamos almacenada estas no coinciden, por lo que nos manda la alerta.¿Qué guardamos y para qué sirve el fichero en el servidor ~/.ssh/authorized_keys?En este archivo es donde se almacenan las claves públicas de los clientes remotos que desean acceder al servidor. Al realizarse la conexión a un usuario, la clave pública del cliente debe estar presente en el archivo authorized_keys del usuario para que tenga permisos de acceso a esa sesión. La seguridad de este archivo es importante, y sus permisos típicos son 600: de lectura y escritura solo para el propietario."
  },
  
  {
    "title": "Cifrado asimétrico con gpg y openssl",
    "url": "/posts/gpg-openssl/",
    "categories": "Seguridad, Criptografía",
    "tags": "Criptografía",
    "date": "2024-12-12 21:15:00 +0100",
    





    
    "snippet": "Tarea 1: Generación de claves (gpg)1. Genera un par de claves (pública y privada). ¿En que directorio se guarda las claves de un usuario?Para generar el par de claves haremos uso de la opción --gen...",
    "content": "Tarea 1: Generación de claves (gpg)1. Genera un par de claves (pública y privada). ¿En que directorio se guarda las claves de un usuario?Para generar el par de claves haremos uso de la opción --gen-key de gpg:pavlo@debian:~()$ gpg --gen-keygpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.Nota: Usa \"gpg --full-generate-key\" para el diálogo completo de generación de clave.GnuPG debe construir un ID de usuario para identificar su clave.Nombre y apellidos:Primero, se nos solicitará que ingresemos nuestro nombre completo, incluyendo los apellidos, con el objetivo de diferenciar nuestra clave de las demás. Escribiremos esta información y procederemos al siguiente paso.Nombre y apellidos: Pablo Martín HidalgoDirección de correo electrónico: pmartinhidalgo19@gmail.comA continuación, será necesario proporcionar nuestra dirección de correo electrónico. La ingresaremos y continuaremos con el proceso.Está usando el juego de caracteres 'utf-8'.Ha seleccionado este ID de usuario:    \"Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\"¿Cambia (N)ombre, (D)irección o (V)ale/(S)alir?Cuando hayamos completado estos datos, se nos mostrará un resumen para confirmarlos. Si todo es correcto, seleccionaremos la opción “V” para confirmar.¿Cambia (N)ombre, (D)irección o (V)ale/(S)alir? VEs necesario generar muchos bytes aleatorios. Es una buena idea realizaralguna otra tarea (trabajar en otra ventana/consola, mover el ratón, usarla red y los discos) durante la generación de números primos. Esto da algenerador de números aleatorios mayor oportunidad de recoger suficienteentropía.En este momento, se nos pedirá que configuremos una frase de paso que protegerá nuestra clave privada. Será necesario ingresarla dos veces para confirmar y, una vez hecho esto, se iniciará el proceso de generación del par de claves. Como se indica en el mensaje mostrado, es recomendable realizar alguna actividad en nuestro equipo durante este proceso para ayudar a generar entropía.gpg: creado el directorio '/home/pavlo/.gnupg/openpgp-revocs.d'gpg: certificado de revocación guardado como '/home/pavlo/.gnupg/openpgp-revocs.d/9D0AB661A8C5977C20924020130D7BAF24114BE7.rev'claves pública y secreta creadas y firmadas.pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      9D0AB661A8C5977C20924020130D7BAF24114BE7uid                      Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Una vez completada la generación, nuestro par de claves estará creado y añadido con total confianza a nuestro keyring pubring.kbx, que se encuentra ubicado en el directorio personal dentro de la carpeta .gnupg/. Además, de manera automática se habrá generado un certificado de revocación en .gnupg/openpgp-revocs.d/. Este certificado será útil en caso de que nuestra clave privada sea comprometida o si decidimos dejar de usar este par de claves, permitiendo informar a otros usuarios que la clave pública asociada no debe ser utilizada más para cifrar.2. Lista las claves públicas que tienes en tu almacén de claves. Explica los distintos datos que nos muestra. ¿Cómo deberías haber generado las claves para indicar, por ejemplo, que tenga un 1 mes de validez?Para listar las claves públicas haremos uso de la opción --list-keys de gpg:pavlo@debian:~()$ gpg --list-keysgpg: comprobando base de datos de confianzagpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   1  firmada:   0  confianza: 0-, 0q, 0n, 0m, 0f, 1ugpg: siguiente comprobación de base de datos de confianza el: 2026-12-12/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      9D0AB661A8C5977C20924020130D7BAF24114BE7uid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Si quisiéramos generar claves con un período de validez específico, podríamos haber utilizado la opción –full-gen-key de GPG. Esto nos habría mostrado un mensaje donde se solicita configurar el tiempo de validez.pavlo@debian:~()$ gpg --full-generate-keygpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.Por favor seleccione tipo de clave deseado:   (1) RSA y RSA (por defecto)   (2) DSA y ElGamal   (3) DSA (sólo firmar)   (4) RSA (sólo firmar)  (14) Existing key from cardSu elección: las claves RSA pueden tener entre 1024 y 4096 bits de longitud.¿De qué tamaño quiere la clave? (3072) El tamaño requerido es de 3072 bitsPor favor, especifique el período de validez de la clave.         0 = la clave nunca caduca      &lt;n&gt;  = la clave caduca en n días      &lt;n&gt;w = la clave caduca en n semanas      &lt;n&gt;m = la clave caduca en n meses      &lt;n&gt;y = la clave caduca en n años¿Validez de la clave (0)?En este punto, podríamos haber indicado la duración deseada siguiendo las opciones que se nos presentan. Por ejemplo, para establecer una validez de un mes, podríamos haber ingresado 30, 4w o 1m, ya que todas estas opciones representan el mismo intervalo de tiempo.3. Lista las claves privadas de tu almacén de clavesPara listar las claves privadas haremos uso de la opción --list-secret-keys de gpg:pavlo@debian:~()$ gpg --list-secret-keys/home/pavlo/.gnupg/pubring.kbx------------------------------sec   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      9D0AB661A8C5977C20924020130D7BAF24114BE7uid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;ssb   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Cuando listamos las claves públicas obtuvimos las siguientes abreviaturas:  pub: Clave primaria pública (public primary key).  uid: Identificador único (unique identifier).  sub: Clave secundaria pública (public sub-key).Al listar las claves privadas con gpg --list-secret-keys, las abreviaturas mostradas fueron:  sec: Clave primaria privada (secret primary key).  uid: Identificador único (unique identifier).  ssb: Clave secundaria privada (secret sub-key).En criptografía asimétrica trabajamos con pares de claves: una clave pública para encriptar o comprobar firmas, y una clave privada (secreta) para desencriptar o firmar, respectivamente.Cuando generamos un par de claves OpenPGP con GnuPG, se crean por defecto:  Un par de claves primario o master key:          Contiene uno o más identificadores de usuario (user-IDs), como nombre, apellidos y correo electrónico.      Se utiliza para firmar o comprobar firmas, ya que es una prueba de identidad.      La clave privada de este par debe protegerse cuidadosamente.        Un par de claves secundario:          Está firmado por el par de claves primario, lo que garantiza que pertenece al user-ID.      Se utiliza exclusivamente para encriptar o desencriptar información.      La separación entre pares de claves maestros y secundarios permite revocar estos últimos sin afectar a los primeros y almacenarlos por separado. En esencia, los pares de claves secundarios son independientes, pero están vinculados al par maestro.Tarea 2: Importar/exportar clave pública (gpg)1. Exporta tu clave pública en formato ASCII, guárdalo en un archivo “nombre_apellido.asc” y envíalo al compañero con el que vas a hacer esta práctica.Para exportar nuestras claves públicas, utilizaremos la opción --export de gpg junto con la opción -a &lt;nombre&gt;. Esto generará una salida en formato ASCII que puede ser redirigida a un archivo.El &lt;nombre&gt; que debemos especificar es el mismo que introdujimos al generar el par de claves (generalmente nuestro nombre o dirección de correo electrónico).El comando a ejecutar es el siguiente:pavlo@debian:~()$ gpg --export -a \"Pablo Martín Hidalgo\" &gt; pablo_martin.ascpavlo@debian:~()$ ls -l pablo_martin.asc -rw-r--r-- 1 pavlo pavlo 2476 dic 12 18:33 pablo_martin.ascEsta práctica la he realizado junto a Jose Antonio Canalo, así que le he enviado mis claves públicas exportadas a través de Discord:2. Importa las claves públicas recibidas de vuestro compañeroAl igual que yo, Jose me ha pasado su clave pública por Discord y como vemos ya la tengo descargada:Para importar las claves públicas de otro usuario, utilizaremos la opción --import de gpg, seguida del nombre del archivo que contiene la clave pública. En este caso, el archivo a importar es el que hemos recibido, por ejemplo, joseantoniocanalo.asc.El comando a ejecutar sería:pavlo@debian:~()$ gpg --import joseantoniocanalo.asc gpg: clave 5DD99C6F8D4E1C65: clave pública \"jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Como vemos nos ha devuelto un mensaje por pantalla informando que las claves públicas de Jose han sido correctamente importadas.3. Comprueba que las claves se han incluido correctamente en vuestro keyringDe nuevo, volveremos a hacer uso de opción --list-keys de gpg para verificar que las claves públicas han sido correctamente importadas a nuestro keyring:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      9D0AB661A8C5977C20924020130D7BAF24114BE7uid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      279F1D439CE7DA18300BF21D5DD99C6F8D4E1C65uid        [desconocida] jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Y efectivamente, las claves públicas de Jose han sido correctamente importadas a nuestro keyring en .gnupg/pubring.kbx.Tarea 3: Cifrado asimétrico con claves públicas (gpg)1. Cifraremos un archivo cualquiera y lo remitiremos por email a uno de nuestros compañeros que nos proporcionó su clave públicaEn este ejemplo, tengo un archivo llamado mensaje_encriptado.txt, el cual quiero cifrar con la clave pública de Jose para enviárselo de forma segura. Para ello, utilizaremos la opción -e de gpg junto con:  -u &lt;remitente&gt;: Indica quién es el remitente, especificando la clave privada que se usará para firmar, si es necesario.  -r &lt;destinatario&gt;: Especifica el destinatario, cuya clave pública será usada para cifrar el archivo.El comando a ejecutar sería:pavlo@debian:~()$ gpg -e -u \"Pablo Martín Hidalgo\" -r \"jose antonio Canalo Gonzalez\" mensaje_encriptado.txtgpg: 6CB51A1718E6B9E9: No hay seguridad de que esta clave pertenezca realmenteal usuario que se nombrasub  rsa3072/6CB51A1718E6B9E9 2024-12-12 jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt; Huella clave primaria: 279F 1D43 9CE7 DA18 300B  F21D 5DD9 9C6F 8D4E 1C65      Huella de subclave: F8AF 9D20 076C 877E DDEF  DE6B 6CB5 1A17 18E6 B9E9No es seguro que la clave pertenezca a la persona que se nombra en elidentificador de usuario. Si *realmente* sabe lo que está haciendo,puede contestar sí a la siguiente pregunta.¿Usar esta clave de todas formas? (s/N) sAl listar los archivos en el directorio utilizando el comando:pavlo@debian:~()$ ls -l | egrep mensaje_encriptado-rw-r--r--  1 pavlo pavlo   25 dic 12 18:45 mensaje_encriptado.txt-rw-r--r--  1 pavlo pavlo  507 dic 12 18:46 mensaje_encriptado.txt.gpgComo podemos observar ahora tenemos dos archivos, el original (mensaje_encriptado.txt) y el encriptado (mensaje_encriptado.txt.gpg).Tras ello, le enviaré dicho fichero a Jose por Discord:2. Nuestro compañero, a su vez, nos remitirá un archivo cifrado para que nosotros lo descifremos.Al igual que yo, Jose me ha pasado su mensaje cifrado por Discord:3. Tanto nosotros como nuestro compañero comprobaremos que hemos podido descifrar los mensajes recibidos respectivamentePara descifrar un archivo que hemos recibido, utilizaremos la opción -d de gpg, seguida del nombre del archivo a descifrar. En este caso, el archivo que hemos recibido de Jose es mensaje_cifrado.gpg.El comando a ejecutar sería:pavlo@debian:~()$ gpg -d mensaje_cifrado.gpggpg: cifrado con clave de 3072 bits RSA, ID 8E63E9C3C10E3D32, creada el 2024-12-12      \"Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\"Espero que ganemos el sábadoTras ejecutar el comando, se nos pedirá la frase de paso para desbloquear la clave privada con la que vamos a descifrar el fichero (pues anteriormente fue cifrado con la clave pública asociada a dicha clave privada).Como se puede observar, el contenido del archivo descifrado no está en texto plano, sino que corresponde a un archivo .txt encriptado.pavlo@debian:~()$ cat mensaje_cifrado.gpg ���c���=2         �������42�曄:�1�J;)�\t6�&gt;�),��_�-g�g*���pȆ]8@�x�,K��Ҭ�,��g�W?�m�\"��dA0jb��z�\\����ݑb��a�5mk�6�� ��c��ޘ_=\"�e�G�օb}+�3(A&amp;�T��uG�h��?��/5�;D� ֖B������. ���Al�B�[_]�Tno7��ݯ�M��IT���;BtLn���Xqߵ�&gt;�R-�[[Z�D���-������.C��zu���|���/�ˊ��'5&amp;                                                                                                                                      �2r����&gt;Vq���[ԙ��TK-����N~3Q=�g0C:���XE���U:�`V�~\t�0��˴������E$�j�~}�������2���܍�L״��k���d=-���L1T'�bp����rBjq�B�����ad1:�'s��M2�  �tw��i%�}A#%Xh�Y`��k�,�mt&gt;|~                              �]��ɽVV7b^��KPara visualizarlo correctamente, debemos redirigir la salida del archivo descifrado a un archivo de formato .txt.Para ello, volvemos a ejecutar el comando de descifrado, pero esta vez redirigiendo la salida a un archivo con extensión .txt, como por ejemplo descifrado.txt.El comando a ejecutar sería:pavlo@debian:~()$ gpg -d mensaje_cifrado.gpg &gt; descifrado.txtgpg: cifrado con clave de 3072 bits RSA, ID 8E63E9C3C10E3D32, creada el 2024-12-12      \"Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\"Y como vemos el contenido es totalmente visible:pavlo@debian:~()$ cat descifrado.txt Espero que ganemos el sábado4. Por último, enviaremos el documento cifrado a alguien que no estaba en la lista de destinatarios y comprobaremos que este usuario no podrá descifrar este archivoPara este punto hemos pedido ayuda a Andrés Morales, al cual le he enviado el fichero y ha comprobado si podía abrirlo o no. Y como podemos observar obtuvo el siguiente error:madandy@toyota-hilux:~/Descargas$ gpg -d mensaje_encriptado.txt.gpg gpg: cifrado con clave RSA, ID 6CB51A1718E6B9E9gpg: descifrado fallido: No secret keyComo se puede apreciar, el descifrado ha fallado dado que no ha encontrado ninguna clave privada para descifrar dicho fichero.5. Para terminar, indica los comandos necesarios para borrar las claves públicas y privadas que poseesEs importante seguir un orden específico al eliminar un par de claves en GPG para evitar errores. Primero, debemos eliminar la clave privada asociada y, posteriormente, la clave pública.Para eliminar la clave privada, utilizaremos la opción --delete-secret-key de gpg, seguida del nombre asociado al par de claves (el mismo que introdujimos al generarlo). El comando sería:pavlo@debian:~()$ gpg --delete-secret-key \"Pablo Martín Hidalgo\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.sec  rsa3072/130D7BAF24114BE7 2024-12-12 Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;¿Eliminar esta clave del anillo? (s/N) s¡Es una clave secreta! ¿Eliminar realmente? (s/N) sUna vez eliminada la clave privada, procedemos a eliminar la clave pública con la opción –delete-key:pavlo@debian:~()$ gpg --delete-key \"Pablo Martín Hidalgo\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa3072/130D7BAF24114BE7 2024-12-12 Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;¿Eliminar esta clave del anillo? (s/N) sAl completar ambos pasos, el par de claves (tanto público como privado) habrá sido eliminado de nuestro sistema.pavlo@debian:~()$ gpg --list-keysgpg: comprobando base de datos de confianzagpg: no se encuentran claves absolutamente fiables/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      279F1D439CE7DA18300BF21D5DD99C6F8D4E1C65uid        [desconocida] jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Tarea 4: Exportar clave a un servidor público de claves PGP1. Genera la clave de revocación de tu clave pública para utilizarla en caso de que haya problemasCuando generamos un par de claves con GPG, el programa crea automáticamente una clave de revocación. Sin embargo, para mostrar el proceso manual, generaremos una nueva clave de revocación.Para generar una clave de revocación, utilizaremos la opción --gen-revoke de gpg, seguida del identificador del par de claves (conocido como fingerprint). Este identificador es una secuencia de 40 dígitos que podemos encontrar al listar nuestras claves públicas con el siguiente comando:pavlo@debian:~()$ gpg --gen-revoke F0BCAC25DBEF1413DA96DFE02F56104F90EDEC18sec  rsa3072/2F56104F90EDEC18 2024-12-12 Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;¿Crear un certificado de revocación para esta clave? (s/N) sPor favor elija una razón para la revocación:  0 = No se dio ninguna razón  1 = La clave ha sido comprometida  2 = La clave ha sido reemplazada  3 = La clave ya no está en uso  Q = Cancelar(Probablemente quería seleccionar 1 aquí)¿Su decisión? 0Introduzca una descripción opcional; acábela con una línea vacía:&gt; Ejercicios de criptografía&gt; Razón para la revocación: No se dio ninguna razónEjercicios de criptografía¿Es correcto? (s/N) sse fuerza salida con armadura ASCII.-----BEGIN PGP PUBLIC KEY BLOCK-----Comment: This is a revocation certificateiQHRBCABCgA7FiEE8LysJdvvFBPalt/gL1YQT5Dt7BgFAmdbJhkdHQBFamVyY2ljaW9zIGRlIGNyaXB0b2dyYWbDrWEACgkQL1YQT5Dt7Bgkiwv7BLuEp9rUi3hgiYhJhCPyh9FqkD9UJByICZmdVf/wgP9BnKIy0SC9KEEjUF9Fko6N/nDz0EMVAwZ4WtCPflt3xq0ACJUfzGp9llP2iNujpcCbmdlwHDMwhCkvcI+ri4pb0fmZPRhw3BO9Ad4EcDMQ2LFffJ29zbBsWS1RqYZzTGEytjB3m5BaoIq+C5HAnM7dImfKbV5DBdCLsqCcwnwS1zvlHwFzpf9Ap6IhbmpN4Rf4H+ZBL8siVQrUDlOsbybwgBrzxLtLmaq0EZL+kZL7QHizTHaO9bUJd/PxumfiNiuq3wq5MxdUSnXNEg52bDg4AxPYlWm9IU87wAPB6fHFpwfzJh/VKyfZi7tD0CSb1fRN4qxg7abXRAS/4aRAprOaRFtbyvXiAswvD9oIY8LFxUe5P8OmvuzD9X7npsQX+H3ZbxTvJJZ9RVMn1Oxi1AHWiqqn2ae+jw7CPpgzy9C+FFWJTL/ME4vNeZ+y+EdRboRO+tx96Q453+jwo/tlLF7u=Oyi5-----END PGP PUBLIC KEY BLOCK-----Certificado de revocación creado.Por favor consérvelo en un medio que pueda esconder; si alguien consigueacceso a este certificado puede usarlo para inutilizar su clave.Es inteligente imprimir este certificado y guardarlo en otro lugar, porsi acaso su medio resulta imposible de leer. Pero precaución: ¡el sistemade impresión de su máquina podría almacenar los datos y hacerlos accesiblesa otras personas!El certificado de revocación generado por GPG contiene la información necesaria para revocar un par de claves de forma oficial. Este certificado está delimitado por las etiquetas:—–BEGIN PGP PUBLIC KEY BLOCK—– … —–END PGP PUBLIC KEY BLOCK—–2. Exporta tu clave pública al servidor pgp.rediris.esPara compartir nuestra clave pública con otros usuarios, podemos exportarla a un servidor de claves públicas, lo que permite que cualquiera pueda buscarla y utilizarla para cifrar mensajes destinados a nosotros.Para exportar la clave pública, utilizaremos la opción --keyserver para especificar el servidor al cual queremos enviar la clave y --send-key para indicar el identificador (ID) de la clave pública. En este caso, se utilizará el servidor pgp.rediris.es, y el ID será el fingerprint de la clave, que consta de 40 dígitos. También es posible usar únicamente los últimos 8 dígitos del fingerprint. El comando sería:pavlo@debian:~()$ gpg --keyserver pgp.rediris.es --send-key F0BCAC25DBEF1413DA96DFE02F56104F90EDEC18gpg: enviando clave 2F56104F90EDEC18 a hkp://pgp.rediris.esPara confirmar que la clave ha sido subida correctamente, se puede acceder al servidor de claves públicas mediante un navegador web. En este caso, al visitar la página de búsqueda de claves de pgp.rediris.es, es posible introducir un identificador como el nombre o la dirección de correo electrónico en el campo de búsqueda.Por ejemplo, al introducir el correo electrónico en el campo de búsqueda y pulsar “Search for a key”, aparecerán los resultados que coincidan con la búsqueda realizada.Si todo ha funcionado correctamente, debería verse la clave pública entre los resultados, lo que confirma que la subida al servidor de claves públicas se ha completado de manera satisfactoria. Exportar claves públicas a servidores como pgp.rediris.es facilita el intercambio de claves y asegura que otras personas puedan comunicarse de forma segura.3. Borra la clave pública de alguno de tus compañeros de clase e impórtala ahora del servidor público de redirisTal y como hemos visto en uno de los ejercicios anteriores, para eliminar una clave pública de nuestro keyring, utilizaremos la opción --delete-key seguida del nombre asociado a la clave. En este caso, el nombre que debemos introducir es el de Jose.pavlo@debian:~()$ gpg --delete-key \"jose antonio canalo gonzalez\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa3072/5DD99C6F8D4E1C65 2024-12-12 jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;¿Eliminar esta clave del anillo? (s/N) sY listo, la clave pública de Jose ya se encuentra borrada:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      F0BCAC25DBEF1413DA96DFE02F56104F90EDEC18uid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Una vez que la clave pública ha sido totalmente eliminada, es momento de volver a importarla desde el servidor de claves públicas. Para ello, utilizaremos la opción --keyserver para especificar el servidor del que queremos descargar la clave y --recv-keys para indicar el identificador (fingerprint) de la clave pública.En este caso, el servidor a utilizar será pgp.rediris.es, y el ID será el fingerprint de 40 dígitos de la clave de Alejandro. También se pueden usar los últimos 8 dígitos del fingerprint.pavlo@debian:~()$ gpg --keyserver pgp.rediris.es --recv-keys 5D55680Cgpg: clave A93FC51D5D55680C: clave pública \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Como vemos, la clave pública de Jose ha sido importada de nuevo:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      F0BCAC25DBEF1413DA96DFE02F56104F90EDEC18uid        [  absoluta ] Pablo Martín Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      B93E1746A5B533527796FC9DA93FC51D5D55680Cuid        [desconocida] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Tarea 5: Cifrado asimétrico con openssl1. Genera un par de claves (pública y privada)Para generar el par de claves utilizando el algoritmo RSA, emplearemos la opción genrsa. Además, configuraremos una frase de paso para proteger la clave privada, utilizando el algoritmo AES128, lo que requiere incluir la opción -aes128. Este par de claves se almacenará en un único archivo con extensión .pem, y para especificar dicho archivo de salida usaremos la opción -out &lt;fichero&gt;. En este caso, el archivo de salida se llamará key.pem. Finalmente, indicaremos el tamaño de la clave, siendo recomendable un mínimo de 2048 bits.pavlo@debian:~()$ sudo openssl genrsa -aes128 -out clave.pem 2048[sudo] contraseña para pavlo: Enter PEM pass phrase:Verifying - Enter PEM pass phrase:Tras habernos preguntado dos veces la frase de paso, el par de claves se habrá generado en un fichero .pem.2. Envía tu clave pública a un compañeroDado que openssl genera tanto la clave privada como la pública en un único archivo, es necesario extraer la clave pública para enviársela al compañero. Esto se debe a que no es seguro compartir el archivo que contiene ambas claves. Para realizar esta extracción, utilizaremos la opción -in &lt;pardeclaves&gt; para especificar el archivo que contiene el par de claves, junto con la opción -pubout para indicar que se extraiga únicamente la clave pública. Además, emplearemos la opción -out &lt;ficherosalida&gt; para guardar la clave pública en un archivo separado con la extensión .public.pem. Por último, indicaremos el algoritmo RSA, que es el que estamos utilizando.En este caso, el archivo del par de claves es clave.pem y el archivo de salida para la clave pública será clave-publica.pem.pavlo@debian:~()$ sudo openssl rsa -in clave.pem -pubout -out clave-publica.pemEnter pass phrase for clave.pem:writing RSA keyNos ha solicitado la frase de paso y justo después ha generado el fichero con la clave pública:pavlo@debian:~()$ cat clave-publica.pem -----BEGIN PUBLIC KEY-----MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwTaSZx2rgZxL8H0XoU48Orzus0tpPn64xw/ftf0Sk5sh6MMnkVgbdug1Iydxun28rs8L1iULPoGDZUUZARMc6oa4CuW6gu6gsfvul4bktpSps9NjJmHA0Vd2Gehp7PMncxzXFPokwwinetSZi85J9uL2/RSJes2AxxRVxBIonOurpuBxWuaAB50ptDL2v6h0B3+A/1dtOdsSY1KmSuTqQFKVYry3sYKvPOJMy4JX78GSCzy5E/SPwnv3f6oD22Ual7MqIcDgNZsQ6tHjCZXPz/4VRA9SAkQ5yTIcSkb5IT/NxxkuiItHp1rwEnkfbxP2tymaUj5udVp5uQ6YT1/SsQIDAQAB-----END PUBLIC KEY-----Ahora, Jose y yo nos pasamos nuestra clave pública:3. Utilizando la clave pública cifra un fichero de texto y envíalo a tu compañeroLo primero que haremos será generar un fichero de texto con el contenido que deseemos:pavlo@debian:~()$ echo \"Hoy pierde el Betis\" &gt; archivo.txtTras la extracción de la clave pública, podremos proceder a cifrar un archivo utilizando la clave pública del destinatario. Esto se logra mediante el uso de las opciones de openssl. Específicamente:  La opción -encrypt indica que deseamos cifrar el archivo.  La opción -in &lt;fichero&gt; especifica el archivo de entrada que se desea cifrar.  La opción -out &lt;ficherosalida&gt; define el archivo de salida que contendrá los datos cifrados, con una extensión habitual como .enc.  La opción -inkey &lt;clavepublica&gt; especifica la clave pública que se usará para el cifrado.  La opción -pubin se utiliza para señalar que estamos trabajando con una clave pública.  Finalmente, el comando pkeyutl se emplea para realizar operaciones de firma, verificación, cifrado o descifrado con RSA.En este caso, el archivo de entrada será archivo.txt, el archivo de salida será mensaje_encriptado.enc, y la clave pública utilizada será la de Jose, contenida en clave_publica.pem.pavlo@debian:~()$ openssl pkeyutl -encrypt -in archivo.txt -out mensaje_encriptado.enc -inkey clave_publica.pem -pubinComo vemos, el mensaje encriptado utiliza carácteres no reconocidos:pavlo@debian:~()$ cat mensaje_encriptado.enc ��h�u*�3�ݔL��;\"v��T������_f.VH4�C��y!                                     �ei�0dKs   �����T������'&gt;�����Dd�F��-�^}�\t��t�p���j@ݓ�Dg�P�a3N�bE��I�Ҝ��U����cL�@�FKa�2e��z[?3�l���4De nuevo, yo le paso mi mensaje cifrado para que lo averigüe y yo me descargo el suyo:4. Tu compañero te ha mandado un fichero cifrado, muestra el proceso para el descifradoPara descifrar un archivo previamente cifrado, utilizamos la herramienta openssl con las siguientes opciones:  La opción -decrypt indica que queremos realizar la operación de descifrado.  La opción -in &lt;fichero&gt; especifica el archivo cifrado que deseamos descifrar.  La opción -out &lt;ficherosalida&gt; define el archivo donde se guardará el contenido descifrado.  La opción -inkey &lt;claveprivada&gt; señala la clave privada que se utilizará para descifrar el archivo.  Al igual que en el cifrado, la opción pkeyutl se usa para realizar operaciones de firma, verificación, cifrado o descifrado con el algoritmo RSA.En este caso, el archivo de entrada será mensajenuevo_cifrado.enc, el archivo de salida será documento.txt, y la clave privada utilizada será clave.pem, la cual generamos previamente.pavlo@debian:~()$ sudo openssl pkeyutl -decrypt -in mensajenuevo_cifrado.enc -out documento.txt -inkey clave.pemY como vemos, podemos visualizar el contenido:pavlo@debian:~()$ cat documento.txt ojala eliminen al betis"
  },
  
  {
    "title": "Escenario en OpenStack",
    "url": "/posts/openstack/",
    "categories": "Servicios, Cloud",
    "tags": "Cloud",
    "date": "2024-12-11 18:15:00 +0100",
    





    
    "snippet": "Práctica (1 / 2): Escenario en OpenStackPara nombrar las máquinas se van a utilizar los siguientes nombres: luffy, zoro, nami, sanji. Estos nombres pertenecen la serie manga One Piece.Además el dom...",
    "content": "Práctica (1 / 2): Escenario en OpenStackPara nombrar las máquinas se van a utilizar los siguientes nombres: luffy, zoro, nami, sanji. Estos nombres pertenecen la serie manga One Piece.Además el dominio será un subdominio de la forma tunombre.gonzalonazareno.org. De esta forma tendremos:  Máquina 1: Instancia en OpenStack con Debian 12 Bookworm que se llama luffy.tunombre.gonzalonazareno.org.  Máquina 2: Instancia en OpenStack con Rocky Linux 9 que se llama zoro.tunombre.gonzalonazareno.org.  Máquina 3: Contenedor LXC con Ubuntu 22.04 que se llama nami.tunombre.gonzalonazareno.org.  Máquina 4: Contenedor LXC con Ubuntu 22.04 que se llama sanji.tunombre.gonzalonazareno.org.Todas las operaciones que realices sobre recursos de OpenStack lo tienes que hacer usando OSC.Creación de la infraestructura de red  Crea un nuevo router llamado RouterPractica conectado a la red externa.Para crear el router ejecutamos el siguiente comando:(os) pavlo@debian:~/OpenStack()$ openstack router create RouterPractica+---------------------------+--------------------------------------+| Field                     | Value                                |+---------------------------+--------------------------------------+| admin_state_up            | UP                                   || availability_zone_hints   |                                      || availability_zones        |                                      || created_at                | 2024-12-11T17:32:26Z                 || description               |                                      || enable_default_route_bfd  | False                                || enable_default_route_ecmp | False                                || enable_ndp_proxy          | None                                 || external_gateway_info     | null                                 || external_gateways         | []                                   || flavor_id                 | None                                 || id                        | c94e22f0-5551-4842-9628-a9d3929b5539 || name                      | RouterPractica                       || project_id                | 07df99f775d343a58e702b5c99adcbad     || revision_number           | 1                                    || routes                    |                                      || status                    | ACTIVE                               || tags                      |                                      || tenant_id                 | 07df99f775d343a58e702b5c99adcbad     || updated_at                | 2024-12-11T17:32:26Z                 |+---------------------------+--------------------------------------+Luego, lo añadimos a la red pública que por lo general suele ser public, aunque en este caso es ext-net:(os) pavlo@debian:~/OpenStack()$ openstack router set RouterPractica --external-gateway ext-net      Crea una red interna que se llame Red Intra de tu_usuario, con las siguientes características:                  Está conectada al router que has creado en el punto anterior.                    Direccionamiento: 10.0.200.0/24                    Con DHCP y DNS (172.22.0.1).                    La puerta de enlace de los dispositivos conectados a esta red será el 10.0.200.1.            Para este paso debemos crear una red:(os) pavlo@debian:~/OpenStack()$ openstack network create red-intra-pablo+---------------------------+--------------------------------------+| Field                     | Value                                |+---------------------------+--------------------------------------+| admin_state_up            | UP                                   || availability_zone_hints   |                                      || availability_zones        |                                      || created_at                | 2024-12-11T17:33:53Z                 || description               |                                      || dns_domain                | None                                 || id                        | 260d2b52-38e8-449f-a368-a68824d2474f || ipv4_address_scope        | None                                 || ipv6_address_scope        | None                                 || is_default                | False                                || is_vlan_transparent       | None                                 || mtu                       | 1442                                 || name                      | red-intra-pablo                      || port_security_enabled     | True                                 || project_id                | 07df99f775d343a58e702b5c99adcbad     || provider:network_type     | None                                 || provider:physical_network | None                                 || provider:segmentation_id  | None                                 || qos_policy_id             | None                                 || revision_number           | 1                                    || router:external           | Internal                             || segments                  | None                                 || shared                    | False                                || status                    | ACTIVE                               || subnets                   |                                      || tags                      |                                      || updated_at                | 2024-12-11T17:33:53Z                 |+---------------------------+--------------------------------------+Luego, crear la subred con las especificaciones:(os) pavlo@debian:~/OpenStack()$ openstack subnet create red-intra-pablo-subnet \\&gt; --network red-intra-pablo \\&gt; --subnet-range 10.0.200.0/24 \\&gt; --dhcp \\&gt; --gateway 10.0.200.1 \\&gt; --dns-nameserver 172.22.0.1+----------------------+--------------------------------------+| Field                | Value                                |+----------------------+--------------------------------------+| allocation_pools     | 10.0.200.2-10.0.200.254              || cidr                 | 10.0.200.0/24                        || created_at           | 2024-12-11T17:35:40Z                 || description          |                                      || dns_nameservers      | 172.22.0.1                           || dns_publish_fixed_ip | None                                 || enable_dhcp          | True                                 || gateway_ip           | 10.0.200.1                           || host_routes          |                                      || id                   | 7ef74cd9-63bf-4b2e-8479-69250a4a087b || ip_version           | 4                                    || ipv6_address_mode    | None                                 || ipv6_ra_mode         | None                                 || name                 | red-intra-pablo-subnet               || network_id           | 260d2b52-38e8-449f-a368-a68824d2474f || project_id           | 07df99f775d343a58e702b5c99adcbad     || revision_number      | 0                                    || segment_id           | None                                 || service_types        |                                      || subnetpool_id        | None                                 || tags                 |                                      || updated_at           | 2024-12-11T17:35:40Z                 |+----------------------+--------------------------------------+Por último añadimos la subnet creada en el paso anterior al router creado al principio:(os) pavlo@debian:~/OpenStack()$ openstack router add subnet RouterPractica red-intra-pablo-subnet      Crea una red interna que se llame Red DMZ de tu_usuario, con las siguientes características:                  Direccionamiento: 172.16.0.0/16                    Sin DHCP.                    Deshabilitamos la puerta de enlace. Esto es para que cloud-init no configure la puerta de enlace en las instancias conectada a esta red.                    La puerta de enlace de los dispositivos conectados a esta red será el 172.16.0.1.            Para crear esta red hacemos lo mismo que antes:(os) pavlo@debian:~/OpenStack()$ openstack network create red-dmz-pablo+---------------------------+--------------------------------------+| Field                     | Value                                |+---------------------------+--------------------------------------+| admin_state_up            | UP                                   || availability_zone_hints   |                                      || availability_zones        |                                      || created_at                | 2024-12-11T17:41:36Z                 || description               |                                      || dns_domain                | None                                 || id                        | b6ae55f9-e6fb-4509-bd3b-fd627a3da1d8 || ipv4_address_scope        | None                                 || ipv6_address_scope        | None                                 || is_default                | False                                || is_vlan_transparent       | None                                 || mtu                       | 1442                                 || name                      | red-dmz-pablo                        || port_security_enabled     | True                                 || project_id                | 07df99f775d343a58e702b5c99adcbad     || provider:network_type     | None                                 || provider:physical_network | None                                 || provider:segmentation_id  | None                                 || qos_policy_id             | None                                 || revision_number           | 1                                    || router:external           | Internal                             || segments                  | None                                 || shared                    | False                                || status                    | ACTIVE                               || subnets                   |                                      || tags                      |                                      || updated_at                | 2024-12-11T17:41:36Z                 |+---------------------------+--------------------------------------+Luego creamos la subnet indicando que no queremos dhcp ni puerta de enlace:(os) pavlo@debian:~/OpenStack()$ openstack subnet create red-dmz-pablo-subnet \\&gt; --network red-dmz-pablo \\&gt; --subnet-range 172.16.0.0/16 \\&gt; --no-dhcp \\&gt; --gateway none+----------------------+--------------------------------------+| Field                | Value                                |+----------------------+--------------------------------------+| allocation_pools     | 172.16.0.1-172.16.255.254            || cidr                 | 172.16.0.0/16                        || created_at           | 2024-12-11T17:44:05Z                 || description          |                                      || dns_nameservers      |                                      || dns_publish_fixed_ip | None                                 || enable_dhcp          | False                                || gateway_ip           | None                                 || host_routes          |                                      || id                   | 450496f9-646a-42a4-9a8e-b07b5b3a992d || ip_version           | 4                                    || ipv6_address_mode    | None                                 || ipv6_ra_mode         | None                                 || name                 | red-dmz-pablo-subnet                 || network_id           | b6ae55f9-e6fb-4509-bd3b-fd627a3da1d8 || project_id           | 07df99f775d343a58e702b5c99adcbad     || revision_number      | 0                                    || segment_id           | None                                 || service_types        |                                      || subnetpool_id        | None                                 || tags                 |                                      || updated_at           | 2024-12-11T17:44:05Z                 |+----------------------+--------------------------------------+Aunque no configuramos la puerta de enlace en la red (para evitar que cloud-init lo haga automáticamente), las instancias se pueden configurar manualmente si es necesario.La dirección 172.16.0.1 será la puerta de enlace predeterminada que los dispositivos pueden usar.Instalación de las instancias de OpenStackConfiguración de las instanciasLas dos instancias que vamos a crear se van a configurar con cloud-init de la siguiente manera:      Deben actualizar los paquetes de la distribución de la instancia.        El dominio utilizado será del tipo tunombre.gonzalonazareno.org. Por lo tanto en la configuración con cloud-init habrá que indicar el hostname y el FQDN.        Se crearán dos usuarios:                  Un usuario sin privilegios. Se puede llamar como quieras (pero el nombre será el mismo en todas las máquinas) y accederás a las máquinas usando tu clave ssh privada.                    Un usuario profesor, que puede utilizar sudo sin contraseña. Copia de las claves públicas de todos los profesores en las instancias para que puedan acceder con el usuario profesor.                  Cambia la contraseña al usuario root.  Bueno pues para ello debemos crear el fichero cloud-init-luffy.yaml en donde añadiremos las configuraciones que se pide:#cloud-configpackage_update: truepackage_upgrade: truehostname: luffyfqdn: luffy.pablo.gonzalonazareno.orgusers:  - name: pablo    shell: /bin/bash    sudo: ['ALL=(ALL) NOPASSWD:ALL']    ssh_authorized_keys:      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQClFcnIhYd1oaEpvGi/f4psQc4+DaAZvSNIxVRRJHtRoJui8wbJybi3Om8yTOflgEcmBaUrJLkfmzmWqVq1j6MpESq72p7J2hdq2lXnvzdt3huYv5evFwyd0p/r72RfpVZzr3ILi/BS//SJqfVKlDEVbZRaOE5MU2XuElmFFY4EO7NiiZAkbatVqUOT8H/nrfXcad0mjZVxroVqHhsHV+06rxiB0xifG0xZv204Qj4zRura8uqZlEVAAwU+NO/SIGdRwpLY7n7xbQGe1DbjHgPUeVPjJX6HpMK41a43eGj4XYdYtZBLugaU8Mq1y6Kl3tE6cvYkQ9WFTYTLLNy3bvNRZpP2p6qAy5qn03ZLFICiXBNXPmrl5+KVrKaSipNaPHkmInvczbYJjXpfyVBsfEabt+0Y1629M+eEKkkl+iZmVr2ySDSS1gHxMC7zlJRaUhG27o26agpNPYPHH3mVXVjqdGg0ryH0YHZk1V8+Gt1Z9hZ7UYWE1UX8DCgFfecqdX0= pavlo@debian\"  - name: profesor    shell: /bin/bash    sudo: ['ALL=(ALL) NOPASSWD:ALL']    ssh_authorized_keys:      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCmjoVIoZCx4QFXvljqozXGqxxlSvO7V2aizqyPgMfGqnyl0J9YXo6zrcWYwyWMnMdRdwYZgHqfiiFCUn2QDm6ZuzC4Lcx0K3ZwO2lgL4XaATykVLneHR1ib6RNroFcClN69cxWsdwQW6dpjpiBDXf8m6/qxVP3EHwUTsP8XaOV7WkcCAqfYAMvpWLISqYme6e+6ZGJUIPkDTxavu5JTagDLwY+py1WB53eoDWsG99gmvyit2O1Eo+jRWN+mgRHIxJTrFtLS6o4iWeshPZ6LvCZ/Pum12Oj4B4bjGSHzrKjHZgTwhVJ/LDq3v71/PP4zaI3gVB9ZalemSxqomgbTlnT jose@debian\"      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDf9lnBH2nCT2ezpDZnqSBeDuSsVGGFD1Kzqa4KyIVkzkrD7pNHHkkpSuO4isKcCsUcopYOcA38QtG7wB0v/qn8Jsq731N8bjaKOdQN25vqLjwVj8DpYtvGc+ZA0uaChe7TS+QBzlMC9ypwj4wf15Q/z3v/ip4FF2cORT0cQC04cNRQDgUg4p1rlOs8+ma7OPh3P3UvzlPfLhi2H1yl+/mo4XLOcAMNr/jiZCwYxom6OEOYVBNk8MZX/Zn+qRi71D0RPiKg27AcXSD/FPWdQW9hBH1Zq5xGicUFS4C9yXvHKru7cMmmxV2G80p/ArRscKWq92UT5jIJQpccmHxsxdIi6o25LhcxH1dOnZy6kHcJ2yP24CnBHK5Y3SsovCD0Th6MN1VlTySbl8Ar0ypmY+GYO+oVd4bM3ioHzL0AMqYnS29m0UtEDvFEUUoSkOoLK4uSlcvej+OIVp7X5G7oZ56nZZf+qHEgodv++a6vPmhH2ZSgoOj1sE39DK7InuKSqCE= rafa@eco\"      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDASDwvkY5SbIgM+/j14mNQluPV+/HGcM3ZgXrYDWt7zhQKq8KAXqJLs1vw1HcRv5PRV071caZQxV2ssfrNqIDofjSzWM1I1JkVIqIj4NCOsRFsQQFN8HwfkE9ic/X6vRaV+NfkEF+t3VmX2YgBd02ZbmGt53qjDaGMQRS/qxw3MPS+ynf2Fj8ZibT6DZeWnyjEGhFcyrggFWiPDqw77MNaiDr+31SO0TaP1WeIWFMrSwPVMVG1zvSxAQ9L13SQ5XzwK0Xs2A8kBPiZmPuUFRqYlBWeffhUnRPSg4TdOsWqJjEwFb5OwpQmTDCT5z0MSFCNVLV5GGwvvqCrw5jd1Xfdswdqazc8mCaIPIrCmhsiwz7uZvQDYr1HDrKxJ1L8LLo3usp4FM5cCCM5jptK+XffhmIyJSkMrcg6tYawBeNuAiY3dwPRIyKeV1Ku3UUctkN+kbuOpMQ4nSvAK0DyhUiTakc8qMJDNLD8oHhSEp49G2bzsLwFOmaEgb8falVMLyk= javji@Javier\"  - name: root    passwd: \"root\"final_message: \"Instancia configurada correctamente.\"Este fichero está destinado a la configuración de la instancia luffy.A continuación, crearé el archivo cloud-init-zoro.yaml para la posterior creación de la instancia zoro.#cloud-configpackage_update: truepackage_upgrade: truehostname: zorofqdn: zoro.pablo.gonzalonazareno.orgusers:  - name: pablo    gecos: Usuario sin privilegios    groups: []    shell: /bin/bash    sudo: ['ALL=(ALL) NOPASSWD:ALL']    ssh_authorized_keys:      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQClFcnIhYd1oaEpvGi/f4psQc4+DaAZvSNIxVRRJHtRoJui8wbJybi3Om8yTOflgEcmBaUrJLkfmzmWqVq1j6MpESq72p7J2hdq2lXnvzdt3huYv5evFwyd0p/r72RfpVZzr3ILi/BS//SJqfVKlDEVbZRaOE5MU2XuElmFFY4EO7NiiZAkbatVqUOT8H/nrfXcad0mjZVxroVqHhsHV+06rxiB0xifG0xZv204Qj4zRura8uqZlEVAAwU+NO/SIGdRwpLY7n7xbQGe1DbjHgPUeVPjJX6HpMK41a43eGj4XYdYtZBLugaU8Mq1y6Kl3tE6cvYkQ9WFTYTLLNy3bvNRZpP2p6qAy5qn03ZLFICiXBNXPmrl5+KVrKaSipNaPHkmInvczbYJjXpfyVBsfEabt+0Y1629M+eEKkkl+iZmVr2ySDSS1gHxMC7zlJRaUhG27o26agpNPYPHH3mVXVjqdGg0ryH0YHZk1V8+Gt1Z9hZ7UYWE1UX8DCgFfecqdX0= pavlo@debian\"  - name: profesor    gecos: Usuario Profesor    groups: sudo    shell: /bin/bash    sudo: ['ALL=(ALL) NOPASSWD:ALL']    ssh_authorized_keys:      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCmjoVIoZCx4QFXvljqozXGqxxlSvO7V2aizqyPgMfGqnyl0J9YXo6zrcWYwyWMnMdRdwYZgHqfiiFCUn2QDm6ZuzC4Lcx0K3ZwO2lgL4XaATykVLneHR1ib6RNroFcClN69cxWsdwQW6dpjpiBDXf8m6/qxVP3EHwUTsP8XaOV7WkcCAqfYAMvpWLISqYme6e+6ZGJUIPkDTxavu5JTagDLwY+py1WB53eoDWsG99gmvyit2O1Eo+jRWN+mgRHIxJTrFtLS6o4iWeshPZ6LvCZ/Pum12Oj4B4bjGSHzrKjHZgTwhVJ/LDq3v71/PP4zaI3gVB9ZalemSxqomgbTlnT jose@debian\"      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDf9lnBH2nCT2ezpDZnqSBeDuSsVGGFD1Kzqa4KyIVkzkrD7pNHHkkpSuO4isKcCsUcopYOcA38QtG7wB0v/qn8Jsq731N8bjaKOdQN25vqLjwVj8DpYtvGc+ZA0uaChe7TS+QBzlMC9ypwj4wf15Q/z3v/ip4FF2cORT0cQC04cNRQDgUg4p1rlOs8+ma7OPh3P3UvzlPfLhi2H1yl+/mo4XLOcAMNr/jiZCwYxom6OEOYVBNk8MZX/Zn+qRi71D0RPiKg27AcXSD/FPWdQW9hBH1Zq5xGicUFS4C9yXvHKru7cMmmxV2G80p/ArRscKWq92UT5jIJQpccmHxsxdIi6o25LhcxH1dOnZy6kHcJ2yP24CnBHK5Y3SsovCD0Th6MN1VlTySbl8Ar0ypmY+GYO+oVd4bM3ioHzL0AMqYnS29m0UtEDvFEUUoSkOoLK4uSlcvej+OIVp7X5G7oZ56nZZf+qHEgodv++a6vPmhH2ZSgoOj1sE39DK7InuKSqCE= rafa@eco\"      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDASDwvkY5SbIgM+/j14mNQluPV+/HGcM3ZgXrYDWt7zhQKq8KAXqJLs1vw1HcRv5PRV071caZQxV2ssfrNqIDofjSzWM1I1JkVIqIj4NCOsRFsQQFN8HwfkE9ic/X6vRaV+NfkEF+t3VmX2YgBd02ZbmGt53qjDaGMQRS/qxw3MPS+ynf2Fj8ZibT6DZeWnyjEGhFcyrggFWiPDqw77MNaiDr+31SO0TaP1WeIWFMrSwPVMVG1zvSxAQ9L13SQ5XzwK0Xs2A8kBPiZmPuUFRqYlBWeffhUnRPSg4TdOsWqJjEwFb5OwpQmTDCT5z0MSFCNVLV5GGwvvqCrw5jd1Xfdswdqazc8mCaIPIrCmhsiwz7uZvQDYr1HDrKxJ1L8LLo3usp4FM5cCCM5jptK+XffhmIyJSkMrcg6tYawBeNuAiY3dwPRIyKeV1Ku3UUctkN+kbuOpMQ4nSvAK0DyhUiTakc8qMJDNLD8oHhSEp49G2bzsLwFOmaEgb8falVMLyk= javji@Javier\"chpasswd:  list: |    root:root  expire: FalseCreación de las instanciasmáquina1 (luffy)      Crea una instancia sobre un volumen de 15Gb (el volumen se crea durante la creación de la instancia), usando una imagen de Debian 12 Bookworm. Elige el sabor vol.medium. Y configuralá con cloud-init como se ha indicado anteriormente.        Está instancia estará conectada a las dos redes. Recuerda que en la red Red DMZ debe tomar la dirección 172.16.0.1 (puerta de enlace las máquinas conectadas a esta red). Asigna a la instancia una IP flotante.        Deshabilita la seguridad de los puertos en las dos interfaces de red para que funcione de manera adecuada el NAT.        Configura de forma permanente la regla SNAT para que las máquinas de la Red DMZ tengan acceso a internet.  En primer lugar debemos crear la instancia:(os) pavlo@debian:~/OpenStack()$ openstack server create luffy \\&gt; --flavor vol.medium \\&gt; --image \"Debian 12 Bookworm\" \\&gt; --network red-intra-pablo \\&gt; --network red-dmz-pablo \\&gt; --user-data cloud-init-luffy.yaml \\&gt; --boot-from-volume 15 \\&gt; --security-group defaultLuego, le asignamos una IP flotante, para ello:(os) pavlo@debian:~/OpenStack()$ openstack server add floating ip luffy 172.22.200.100Comprobamos que se hayan añadido las interfaces correctamente:(os) pavlo@debian:~/OpenStack()$ openstack server list+--------------------------------------+-------+--------+--------------------------------------------------------------------------+--------------------------+------------+| ID                                   | Name  | Status | Networks                                                                 | Image                    | Flavor     |+--------------------------------------+-------+--------+--------------------------------------------------------------------------+--------------------------+------------+| 91e29177-4a4f-4529-8594-4f867d2dd6bd | luffy | ACTIVE | red-dmz-pablo=172.16.3.142; red-intra-pablo=10.0.200.181, 172.22.200.100 | N/A (booted from volume) | vol.medium |+--------------------------------------+-------+--------+--------------------------------------------------------------------------+--------------------------+------------+Ahora debemos deshabilitar la seguridad de los puertos en las dos interfaces de red, para ello primero obtenemos las IDs de los puertos:(os) pavlo@debian:~/OpenStack()$ openstack port list --server luffy+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+| ID                                   | Name | MAC Address       | Fixed IP Addresses                                                          | Status |+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+| 1505f6e0-7c0f-47d3-b865-1a5420c69246 |      | fa:16:3e:d9:cb:6a | ip_address='172.16.3.142', subnet_id='450496f9-646a-42a4-9a8e-b07b5b3a992d' | ACTIVE || 3168307f-1878-4306-a1c3-81256a9dd85a |      | fa:16:3e:ff:1e:6d | ip_address='10.0.200.181', subnet_id='7ef74cd9-63bf-4b2e-8479-69250a4a087b' | ACTIVE |+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+Y una vez sabemos las IDs ya podemos deshabilitarlos:(os) pavlo@debian:~/OpenStack()$ openstack port set 1505f6e0-7c0f-47d3-b865-1a5420c69246 --no-security-group --disable-port-security(os) pavlo@debian:~/OpenStack()$ openstack port set 3168307f-1878-4306-a1c3-81256a9dd85a --no-security-group --disable-port-securityAntes de aceder al router (luffy) y realizar el SNAT voy a añadir en el ~/.ssh/config la máquina para poder conectarme de forma más sencilla:Host luffy  HostName 172.22.200.100  User pablo  ForwardAgent yesDe forma que ya puedo acceder a la instancia:(os) pavlo@debian:~/OpenStack()$ ssh luffy Linux luffy 6.1.0-28-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.119-1 (2024-11-22) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Wed Dec 11 22:48:14 2024 from 172.29.0.34pablo@luffy:~$Una vez accedido a luffy habilitamos el bit de forwarding en el fichero /etc/sysctl.conf, en donde descomentamos la siguiente línea:net.ipv4.ip_forward=1Aplicamos los cambios:pablo@luffy:~$ sudo sysctl -pnet.ipv4.ip_forward = 1Ahora debemos configurar la reglas SNAT con iptables, pero antes miramos las direcciones IP de las interfaces:pablo@luffy:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:8c:07:52 brd ff:ff:ff:ff:ff:ff    altname enp0s3    inet 10.0.200.231/24 metric 100 brd 10.0.200.255 scope global dynamic ens3       valid_lft 42718sec preferred_lft 42718sec    inet6 fe80::f816:3eff:fe8c:752/64 scope link        valid_lft forever preferred_lft forever3: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:67:5a:49 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 172.16.0.16/16 brd 172.16.255.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::f816:3eff:fe67:5a49/64 scope link        valid_lft forever preferred_lft foreverEn base a esta configuración de interfaces de red:  ens3: Interfaz conectada a la red interna (red-intra-pablo, 10.0.200.0/24).  ens4: Interfaz conectada a la red DMZ (red-dmz-pablo, 172.16.0.0/16).Dado esto, necesitamos configurar las reglas SNAT para que el tráfico desde Red DMZ pueda salir a Internet a través de ens3. Para ello:sudo iptables -t nat -A POSTROUTING -o ens3 -s 172.16.0.0/16 -j MASQUERADEDe forma que quede así:pablo@luffy:~$ sudo iptables -t nat -L -vChain PREROUTING (policy ACCEPT 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source               destination         Chain INPUT (policy ACCEPT 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source               destination         Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source               destination         Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source               destination             0     0 MASQUERADE  all  --  any    ens3    172.16.0.0/16        anywherePara hacer las reglas persistentes instalamos el siguiente paquete:sudo apt install iptables-persistentEn la misma instalación si detecta reglas existentes las guarda automáticamente, aunque si añadimos otras reglas debemos hacerlo manualmente.Con esto, ya habríamos terminado la instalación y configuración al completo del router luffy.maquina2 (zoro)      Crea un volumen de 15Gb con la imagen Rocky Linux 9.        Crea la instancia a partir de este volumen. Elige el sabor vol.medium. Y configúrala con cloud-init como se ha indicado anteriormente.        En un primer momento, para que la instancia se configure mediante cloud-init conecta esta instancia a un red con DHCP.        Posteriormente, desconecta la interfaz de red de esa red y conéctala a la red Red DMZ a la dirección 172.16.0.200.        Recuerda, que esa configuración no se hará de forma automática por lo que deberas, de forma manual, configurar la red en esta máquina. recuerda que Rocky Linux tiene instalado por defecto NetwokManager.        Deshabilita la seguridad de los puertos en la interfaz de red para que funcione de manera adecuada el NAT.        Comprueba que tiene acceso a internet.  Empezamos creando el volumen a partir de la imagen:(os) pavlo@debian:~/OpenStack()$ openstack volume create --size 15 --image \"Rocky Linux 9\" volumen-zoro+---------------------+------------------------------------------------------------------+| Field               | Value                                                            |+---------------------+------------------------------------------------------------------+| attachments         | []                                                               || availability_zone   | nova                                                             || bootable            | false                                                            || consistencygroup_id | None                                                             || created_at          | 2024-12-12T07:44:39.479661                                       || description         | None                                                             || encrypted           | False                                                            || id                  | 786b9400-013c-4bf3-9986-1896891628bf                             || multiattach         | False                                                            || name                | volumen-zoro                                                     || properties          |                                                                  || replication_status  | None                                                             || size                | 15                                                               || snapshot_id         | None                                                             || source_volid        | None                                                             || status              | creating                                                         || type                | lvmdriver-1                                                      || updated_at          | None                                                             || user_id             | a74499e28f7622936621adb74c2b02fe4a18a1f6964a32bdbb23af09b776065f |+---------------------+------------------------------------------------------------------+Seguidamente creamos la instancia a partir del volumen, conectándola en un principio a una red con DHCP como red-intra-pablo.(os) pavlo@debian:~/OpenStack()$ openstack server create zoro \\    --flavor vol.medium \\    --volume volumen-zoro \\    --network red-intra-pablo \\    --user-data cloud-init-zoro.yaml \\    --security-group defaultComprobamos que se haya creado correctamente:(os) pavlo@debian:~/OpenStack()$ openstack server list+--------------------------------------+-------+--------+-------------------------------------------------------------------------+--------------------------+------------+| ID                                   | Name  | Status | Networks                                                                | Image                    | Flavor     |+--------------------------------------+-------+--------+-------------------------------------------------------------------------+--------------------------+------------+| 82692c6d-9d36-4bdd-86b6-46e90bea1892 | zoro  | ACTIVE | red-intra-pablo=10.0.200.132                                            | N/A (booted from volume) | vol.medium || 9c9e8c12-7712-404e-aa3b-2e2bf566ca0c | luffy | ACTIVE | red-dmz-pablo=172.16.0.16; red-intra-pablo=10.0.200.231, 172.22.200.100 | N/A (booted from volume) | vol.medium |+--------------------------------------+-------+--------+-------------------------------------------------------------------------+--------------------------+------------+Ya que se ha creado la instancia y el cloud-init se ha configurado correctamente, añadimos en el fichero ~/.ssh/config la nueva configuración temporal:Host luffy  HostName 172.22.200.100  User pablo  ForwardAgent yesHost zoro  HostName 10.0.200.244  User pablo  ForwardAgent yes  ProxyJump luffyAdemás, añadimos la nueva interfaz que estará conectada a la Red DMZ con la dirección 172.16.0.200, la que posteriormente vamos a configurar manualmente:(os) pavlo@debian:~/OpenStack()$ openstack server add port zoro \\&gt; $(openstack port create --network red-dmz-pablo --fixed-ip subnet=red-dmz-pablo-subnet,ip-address=172.16.0.200 puerto-zoro -f value -c id)Accedemos a la instancia:(os) pavlo@debian:~/OpenStack()$ ssh zoro The authenticity of host '10.0.200.244 (&lt;no hostip for proxy command&gt;)' can't be established.ED25519 key fingerprint is SHA256:JrbuXBRRZ4JoLGdRCCiKNThDEKWqINQtX2NVLKP7Gvo.This host key is known by the following other names/addresses:    ~/.ssh/known_hosts:421: [hashed name]Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.200.244' (ED25519) to the list of known hosts.Last login: Thu Dec 12 07:52:34 2024 from 10.0.200.231Y hacemos algunas comprobaciones:[pablo@zoro ~]$ hostname -fzoro.pablo.gonzalonazareno.org[pablo@zoro ~]$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:78:8b:9e brd ff:ff:ff:ff:ff:ff    altname enp0s3    altname ens33: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:87:ca:cd brd ff:ff:ff:ff:ff:ff    altname enp0s7    altname ens7    inet 10.0.200.244/24 brd 10.0.200.255 scope global dynamic noprefixroute eth1       valid_lft 43120sec preferred_lft 43120sec    inet6 fe80::7f34:f482:b58c:edcc/64 scope link noprefixroute        valid_lft forever preferred_lft foreverComo vemos la interfaz eth0 está sin direccionamiento, por lo que vamos a añadir la IP para luego poder eliminar la red-intra-pablo.Para ello, creamos el fichero /etc/NetworkManager/system-connections/dmz.nmconnection con la siguiente configuración:[connection]id=dmztype=ethernetinterface-name=eth0[ipv4]method=manualaddresses=172.16.0.200/16gateway=172.16.0.16dns=8.8.8.8;1.1.1.1[ipv6]method=ignoreSeguidamente reiniciamos los servicios:[pablo@zoro ~]$ sudo nmcli connection reload[pablo@zoro ~]$ sudo systemctl restart NetworkManager[pablo@zoro ~]$ sudo nmcli connection up dmzConnection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)Y ya tenemos dirección IP:[pablo@zoro ~]$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:78:8b:9e brd ff:ff:ff:ff:ff:ff    altname enp0s3    altname ens3    inet 172.16.0.200/16 brd 172.16.255.255 scope global noprefixroute eth0       valid_lft forever preferred_lft forever    inet6 fe80::f816:3eff:fe78:8b9e/64 scope link        valid_lft forever preferred_lft forever3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:87:ca:cd brd ff:ff:ff:ff:ff:ff    altname enp0s7    altname ens7    inet 10.0.200.244/24 brd 10.0.200.255 scope global dynamic noprefixroute eth1       valid_lft 43193sec preferred_lft 43193sec    inet6 fe80::7f34:f482:b58c:edcc/64 scope link noprefixroute        valid_lft forever preferred_lft foreverAhora, nos salimos de la instancia y revocamos la red-intra-pablo:pavlo@debian:~/OpenStack()$ openstack server remove network zoro red-intra-pabloMás tarde, modificamos el fichero ~/.ssh/config para que acceda con la nueva IP:Host luffy  HostName 172.22.200.100  User pablo  ForwardAgent yesHost zoro  HostName 172.16.0.200  User pablo  ForwardAgent yes  ProxyJump luffyY ya nos dejaría acceder:pavlo@debian:~/OpenStack()$ ssh zoro The authenticity of host '172.16.0.200 (&lt;no hostip for proxy command&gt;)' can't be established.ED25519 key fingerprint is SHA256:JrbuXBRRZ4JoLGdRCCiKNThDEKWqINQtX2NVLKP7Gvo.This host key is known by the following other names/addresses:    ~/.ssh/known_hosts:421: [hashed name]    ~/.ssh/known_hosts:424: [hashed name]Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '172.16.0.200' (ED25519) to the list of known hosts.Last login: Thu Dec 12 08:30:57 2024 from 10.0.200.231[pablo@zoro ~]$Antes de probar la conexión a Internet debemos deshabilitar la seguridad de los puertos para que el NAT funcione correctamente:pavlo@debian:~/OpenStack()$ openstack port list --server zoro+--------------------------------------+-------------+-------------------+-----------------------------------------------------------------------------+--------+| ID                                   | Name        | MAC Address       | Fixed IP Addresses                                                          | Status |+--------------------------------------+-------------+-------------------+-----------------------------------------------------------------------------+--------+| 3dd6bcc3-0c30-4f37-ae10-3d70767efff1 | puerto-zoro | fa:16:3e:78:8b:9e | ip_address='172.16.0.200', subnet_id='450496f9-646a-42a4-9a8e-b07b5b3a992d' | ACTIVE |+--------------------------------------+-------------+-------------------+-----------------------------------------------------------------------------+--------+pavlo@debian:~/OpenStack()$ openstack port set 3dd6bcc3-0c30-4f37-ae10-3d70767efff1 --no-security-group --disable-port-securityPudiendo de esta forma acceder a Internet:[pablo@zoro ~]$ ping -c 4 8.8.8.8PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.64 bytes from 8.8.8.8: icmp_seq=1 ttl=103 time=18.0 ms64 bytes from 8.8.8.8: icmp_seq=2 ttl=103 time=17.8 ms64 bytes from 8.8.8.8: icmp_seq=3 ttl=103 time=17.6 ms64 bytes from 8.8.8.8: icmp_seq=4 ttl=103 time=17.1 ms--- 8.8.8.8 ping statistics ---4 packets transmitted, 4 received, 0% packet loss, time 3005msrtt min/avg/max/mdev = 17.086/17.607/17.958/0.325 msYa habríamos terminado la primera parte del escenario de OpenStack, quedando la topología de la siguiente forma:Si queremos hacer algunas comprobaciones como por ejemplo acceder a los FQDN del otro, tendremos que configurar los /etc/hosts:pablo@luffy:~$ cat /etc/hosts127.0.0.1\tlocalhost::1\t\tlocalhost ip6-localhost ip6-loopbackff02::1\t\tip6-allnodesff02::2\t\tip6-allrouters172.16.0.16 luffy.pablo.gonzalonazareno.org luffy172.16.0.200 zoro.pablo.gonzalonazareno.org zoro[pablo@zoro ~]$ cat /etc/hosts127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4::1         localhost localhost.localdomain localhost6 localhost6.localdomain6172.16.0.16 luffy.pablo.gonzalonazareno.org luffy172.16.0.200 zoro.pablo.gonzalonazareno.org zoroDe forma que tenemos conectividad entre ambos:pablo@luffy:~$ ping -c 2 zoro.pablo.gonzalonazareno.org PING zoro.pablo.gonzalonazareno.org (172.16.0.200) 56(84) bytes of data.64 bytes from zoro.pablo.gonzalonazareno.org (172.16.0.200): icmp_seq=1 ttl=64 time=2.40 ms64 bytes from zoro.pablo.gonzalonazareno.org (172.16.0.200): icmp_seq=2 ttl=64 time=0.510 ms--- zoro.pablo.gonzalonazareno.org ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 0.510/1.457/2.404/0.947 ms[pablo@zoro ~]$ ping -c 2 luffy.pablo.gonzalonazareno.orgPING luffy.pablo.gonzalonazareno.org (172.16.0.16) 56(84) bytes of data.64 bytes from luffy.pablo.gonzalonazareno.org (172.16.0.16): icmp_seq=1 ttl=64 time=0.218 ms64 bytes from luffy.pablo.gonzalonazareno.org (172.16.0.16): icmp_seq=2 ttl=64 time=0.441 ms--- luffy.pablo.gonzalonazareno.org ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1026msrtt min/avg/max/mdev = 0.218/0.329/0.441/0.111 msPor último, podemos ver que tenemos conectividad a Internet en ambas máquinas:pablo@luffy:~$ ping -c 2 google.comPING google.com (142.250.186.78) 56(84) bytes of data.64 bytes from fra24s05-in-f14.1e100.net (142.250.186.78): icmp_seq=1 ttl=101 time=40.0 ms64 bytes from fra24s05-in-f14.1e100.net (142.250.186.78): icmp_seq=2 ttl=101 time=38.2 ms--- google.com ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 38.183/39.114/40.045/0.931 ms[pablo@zoro ~]$ ping -c 2 google.comPING google.com (142.250.186.78) 56(84) bytes of data.64 bytes from fra24s05-in-f14.1e100.net (142.250.186.78): icmp_seq=1 ttl=100 time=40.4 ms64 bytes from fra24s05-in-f14.1e100.net (142.250.186.78): icmp_seq=2 ttl=100 time=37.1 ms--- google.com ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1001msrtt min/avg/max/mdev = 37.124/38.739/40.355/1.615 msPráctica (2 / 2): Escenario en OpenStackInstalación de los contenedoresEn máquina1 (luffy) vamos a crear dos contenedores en un red interna, para ello:  Crea en máquina1 (luffy) un linux bridge llamado br-intra (no lo hagas con virsh ya que se configura una reglas de cortafuego muy estrictas) y asigna una dirección IP estática 192.168.0.1. Esta será la IP de máquina1 (luffy) conectada a este switch virtual y será la puerta de enlace de los contenedores. Tienes que tener en cuenta que la imagen de Debian 12 Bookworm de OpenStack tiene netplan para la configuración de las redes, por lo tanto tienes que configurar el bridge usando el fichero de configuración de netplan, para ello te puede ser útil esta página. No olvides poner la mtu a 1442 al crear el bridge.Para crear el puente tendremos que modificar la configuración del fichero netplan, en donde añadiremos las siguientes líneas:bridges:      br-intra:        addresses: [192.168.0.1/24]        mtu: 1442        dhcp4: no        dhcp6: no        nameservers:          addresses: [172.22.0.1]Una vez añadido, aplicamos los cambios:pablo@luffy:~$ sudo netplan generatepablo@luffy:~$ sudo netplan apply  Instala LXC y crea dos contenedores con la distribución Ubuntu 22.04. Estos contenedores serán la máquina3 (nami) y la máquina4 (sanji).Para instalar LXC ejecutamos el siguiente comando:pablo@luffy:~$ sudo apt install lxcUna vez instalado, pasamos a instalar los contenedores:  Namipablo@luffy:~$ sudo lxc-create -n nami -t ubuntu -- -r jammy  Sanjipablo@luffy:~$ sudo lxc-create -n sanji -t ubuntu -- -r jammy  Configura de forma permanente la regla SNAT para que los contenedores tengan acceso a internet.Para ello es tan simple como añadir la siguiente regla:pablo@luffy:~$ sudo iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o ens3 -j MASQUERADEImportante hacer las reglas persistentes para posibles futuros reinicios:pablo@luffy:~$ sudo -iroot@luffy:~# iptables-save &gt; /etc/iptables/rules.v4root@luffy:~# exitlogout  Conecta los contenedores al bridge br-intra y configúralo de forma estática con las siguientes direcciones: máquina3 (nami) la 192.168.0.2 y máquina4 (sanji) la 192.168.0.3. Su DNS será el 172.22.0.1.Para la configuración de red modificaremos el fichero /var/lib/lxc/nombrecontenedor/config, quedando de la siguiente forma:pablo@luffy:~$ sudo cat /var/lib/lxc/nami/config# Template used to create this container: /usr/share/lxc/templates/lxc-ubuntu# Parameters passed to the template: -r jammy# For additional config options, please look at lxc.container.conf(5)# Uncomment the following line to support nesting containers:#lxc.include = /usr/share/lxc/config/nesting.conf# (Be aware this has security implications)# Common configurationlxc.include = /usr/share/lxc/config/ubuntu.common.conf# Container specific configurationlxc.apparmor.profile = generatedlxc.apparmor.allow_nesting = 1lxc.rootfs.path = dir:/var/lib/lxc/nami/rootfslxc.uts.name = namilxc.arch = amd64# Network configurationlxc.net.0.type = vethlxc.net.0.hwaddr = 00:16:3e:40:e4:dalxc.net.0.link = br-intralxc.net.0.flags = uplxc.net.0.ipv4.address = 192.168.0.2/24lxc.net.0.ipv4.gateway = 192.168.0.1Los DNS debemos configurarlos dentro del contenedor, para ello:root@nami:/# rm /etc/resolv.confroot@nami:/# echo -e \"nameserver 172.22.0.1\\nnameserver 8.8.8.8\" &gt; /etc/resolv.confroot@nami:/# cat /etc/resolv.conf nameserver 172.22.0.1nameserver 8.8.8.8En sanji añadimos prácticamente la misma configuración:# Network configurationlxc.net.0.type = vethlxc.net.0.hwaddr = 00:16:3e:c5:5c:70lxc.net.0.link = br-intralxc.net.0.flags = uplxc.net.0.ipv4.address = 192.168.0.3/24lxc.net.0.ipv4.gateway = 192.168.0.1Antes de acceder tenemos que iniciar los contenedores:pablo@luffy:~$ sudo lxc-start namipablo@luffy:~$ sudo lxc-start sanji  Para que la red de OpenStack funcione de forma adecuada las imágenes que usamos tienen configurado la mtu (Unidad máxima de transferencia) a 1442 bytes. Tenemos que adecuar los contenedores a este tamaño de trama. Para ello introduce en la configuración de los contenedores la línea: lxc.net.0.mtu = 1442.Para ello tendremos que modificar el fichero config de ambos contenedores en donde añadimos esta línea:lxc.net.0.mtu = 1442Para aplicar los cambios apagamos y encendemos el contenedor:pablo@luffy:~$ sudo lxc-stop -n namipablo@luffy:~$ sudo lxc-start -n namipablo@luffy:~$ sudo lxc-stop -n sanjipablo@luffy:~$ sudo lxc-start -n sanji  Configura los contenedores para que se auto inicien al reiniciar la instancia.Para ello añadimos en el archivo config mencionado anteriormente la siguiente línea:lxc.start.auto = 1      Los contenedores tendrán características parecidas a las instancias anteriormente:          Debes actualizar los paquetes de la distribución instalada.        root@nami:/# apt update        root@sanji:/# apt update              El dominio utilizado será del tipo tunombre.gonzalonazareno.org. Por lo tanto configura de manera adecuada el hostname y el FQDN.        Nami    root@nami:/# cat /etc/hosts127.0.0.1   localhost127.0.1.1   nami.pablo.gonzalonazareno.org nami# The following lines are desirable for IPv6 capable hosts::1     ip6-localhost ip6-loopbackfe00::0 ip6-localnetff00::0 ip6-mcastprefixff02::1 ip6-allnodesff02::2 ip6-allrouters        Comprobamos:    root@nami:/# hostnamenamiroot@nami:/# hostname -fnami.pablo.gonzalonazareno.org        Sanji    root@sanji:/# cat /etc/hosts127.0.0.1   localhost127.0.1.1   sanji.pablo.gonzalonazareno.org sanji# The following lines are desirable for IPv6 capable hosts::1     ip6-localhost ip6-loopbackfe00::0 ip6-localnetff00::0 ip6-mcastprefixff02::1 ip6-allnodesff02::2 ip6-allrouters        Comprobamos:    root@sanji:/# hostnamesanjiroot@sanji:/# hostname -fsanji.pablo.gonzalonazareno.org                      Para acceder a los contenedores vamos a usar ssh.                    Crea dos usuarios:                  Un usuario sin privilegios. Se puede llamar como quieras (el nombre de usuario que usaste en las instancias) y accederás a los contenedores usando tu clave ssh privada.                root@nami:/# useradd -m -s /bin/bash pablo                root@sanji:/# useradd -m -s /bin/bash pablo                Luego, en ambos contenedores añadimos nuestra clave pública dentro del authorized_keys:        root@sanji:/# su - pablopablo@sanji:~$ mkdir -p /home/pablo/.sshpablo@sanji:~$ echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQClFcnIhYd1oaEpvGi/f4psQc4+DaAZvSNIxVRRJHtRoJui8wbJybi3Om8yTOflgEcmBaUrJLkfmzmWqVq1j6MpESq72p7J2hdq2lXnvzdt3huYv5evFwyd0p/r72RfpVZzr3ILi/BS//SJqfVKlDEVbZRaOE5MU2XuElmFFY4EO7NiiZAkbatVqUOT8H/nrfXcad0mjZVxroVqHhsHV+06rxiB0xifG0xZv204Qj4zRura8uqZlEVAAwU+NO/SIGdRwpLY7n7xbQGe1DbjHgPUeVPjJX6HpMK41a43eGj4XYdYtZBLugaU8Mq1y6Kl3tE6cvYkQ9WFTYTLLNy3bvNRZpP2p6qAy5qn03ZLFICiXBNXPmrl5+KVrKaSipNaPHkmInvczbYJjXpfyVBsfEabt+0Y1629M+eEKkkl+iZmVr2ySDSS1gHxMC7zlJRaUhG27o26agpNPYPHH3mVXVjqdGg0ryH0YHZk1V8+Gt1Z9hZ7UYWE1UX8DCgFfecqdX0= pavlo@debian &gt; /home/pablo/.ssh/authorized_keyspablo@sanji:~$ chown -R pablo:pablo /home/pablo/.sshpablo@sanji:~$ chmod 700 /home/pablo/.sshpablo@sanji:~$ chmod 600 /home/pablo/.ssh/authorized_keys                Modificamos también el fichero /etc/sudoers para que no pida contraseña a mi usuario pablo:        # User privilege specificationroot    ALL=(ALL:ALL) ALLpablo   ALL=(ALL) NOPASSWD:ALL                          Un usuario profesor, que puede utilizar sudo sin contraseña. Copia de las claves públicas de todos los profesores en los contenedores para que puedan acceder con el usuario profesor.                Añadimos el usuario en ambos contenedores:        root@nami:~# useradd -m -s /bin/bash profesor                root@sanji:~# useradd -m -s /bin/bash profesor                Y repetimos el mismo proceso que anteriormente.                  Cambia la contraseña al usuario root.  root@nami:~# passwd rootNew password: Retype new password: passwd: password updated successfullyYa está todo configurado, solo nos quedaría crear los accesos por ssh, para ello en el fichero ~/.ssh/config añadimos lo siguiente:pavlo@debian:~()$ cat .ssh/config Host luffy  HostName 172.22.200.100  User pablo  ForwardAgent yesHost zoro  HostName 172.16.0.200  User pablo  ForwardAgent yes  ProxyJump luffyHost nami  HostName 192.168.0.2  User pablo  ForwardAgent yes  ProxyJump luffyHost sanji  HostName 192.168.0.3  User pablo  ForwardAgent yes  ProxyJump luffyDe esta forma, desde nuestro host principal podemos acceder a todas las máquinas, incluyendo los contenedores:pavlo@debian:~()$ ssh namiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 10:54:43 2024 from 192.168.0.1pablo@nami:~$ logoutConnection to 192.168.0.2 closed.pavlo@debian:~()$ ssh sanjiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 10:49:30 2024 from 192.168.0.1pablo@sanji:~$Otras comprobaciones que podemos hacer:  La salida del comando sudo lxc-ls -f.pablo@luffy:~$ sudo lxc-ls -fNAME  STATE   AUTOSTART GROUPS IPV4        IPV6 UNPRIVILEGED nami  RUNNING 0         -      192.168.0.2 -    false        sanji RUNNING 1         -      192.168.0.3 -    false  Prueba de funcionamiento de que los contenedores tienen acceso a internet accediendo a un nombre de dominio, para comprobar que funciona el DNS.pavlo@debian:~()$ ssh namiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 10:57:54 2024 from 192.168.0.1pablo@nami:~$ ping -c 2 www.google.esPING www.google.es (142.250.186.163) 56(84) bytes of data.64 bytes from fra24s08-in-f3.1e100.net (142.250.186.163): icmp_seq=1 ttl=100 time=51.8 ms64 bytes from fra24s08-in-f3.1e100.net (142.250.186.163): icmp_seq=2 ttl=100 time=38.7 ms--- www.google.es ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1001msrtt min/avg/max/mdev = 38.722/45.277/51.832/6.555 mspavlo@debian:~()$ ssh sanjiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 10:57:59 2024 from 192.168.0.1pablo@sanji:~$ ping -c 2 www.youtube.comPING youtube-ui.l.google.com (216.58.206.78) 56(84) bytes of data.64 bytes from lhr35s11-in-f14.1e100.net (216.58.206.78): icmp_seq=1 ttl=99 time=43.6 ms64 bytes from tzfraa-aa-in-f14.1e100.net (216.58.206.78): icmp_seq=2 ttl=99 time=42.9 ms--- youtube-ui.l.google.com ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 42.871/43.247/43.624/0.376 msFinalmente comprueba que todo el escenario está funcionando después de reiniciar la máquina1 (luffy):pablo@luffy:~$ sudo rebootBroadcast message from root@luffy on pts/1 (Mon 2024-12-16 11:15:21 UTC):The system will reboot now!pablo@luffy:~$ Connection to 172.22.200.100 closed by remote host.Connection to 172.22.200.100 closed.pavlo@debian:~()$ ssh namiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 11:01:53 2024 from 192.168.0.1pablo@nami:~$ logoutConnection to 192.168.0.2 closed.pavlo@debian:~()$ ssh sanjiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 11:13:31 2024 from 192.168.0.1pablo@sanji:~$ logoutConnection to 192.168.0.3 closed."
  },
  
  {
    "title": "Instalación de Oracle 19c en Debian 12",
    "url": "/posts/instalacion-oracle19c/",
    "categories": "Base de Datos, Instalación",
    "tags": "Instalación",
    "date": "2024-11-15 18:15:00 +0100",
    





    
    "snippet": "IntroducciónEn este post, voy a detallar el proceso de instalación de Oracle 19c en una máquina virtual con Debian 12, utilizando QEMU/KVM como plataforma de virtualización. Para este tipo de insta...",
    "content": "IntroducciónEn este post, voy a detallar el proceso de instalación de Oracle 19c en una máquina virtual con Debian 12, utilizando QEMU/KVM como plataforma de virtualización. Para este tipo de instalación, es fundamental asegurarse de que la máquina virtual tenga recursos suficientes para que Oracle funcione correctamente. En este caso, se recomienda asignar al menos 4096 MB de memoria RAM, 4 núcleos de procesador (cores) y 40 GB de almacenamiento. Estos recursos permitirán que la base de datos funcione de manera estable, incluso en entornos de prueba o desarrollo.La máquina virtual se configurará con la red “default”, lo que le asignará automáticamente una dirección IP dentro del rango 192.168.122.x/24. Esta configuración de red es ideal para comunicaciones internas entre la máquina virtual y el sistema host, así como para facilitar la instalación y acceso remoto, si es necesario, sin complicaciones adicionales en cuanto a configuraciones de red. A continuación, explicaré detalladamente cómo configurar todo el entorno y proceder con la instalación de Oracle 19c paso a paso.InstalaciónEn este caso, se está configurando una red estática en la máquina virtual que va a hospedar Oracle 19c. Esta configuración es importante porque permite tener un control más preciso sobre la dirección IP de la máquina virtual, lo cual es crucial para garantizar que el sistema sea accesible y que la comunicación con otros dispositivos de la red no se vea interrumpida, especialmente cuando se trabaja con bases de datos como Oracle, que requieren un acceso constante y estable.Configuración de la interfaz de red estáticaEl archivo /etc/network/interfaces en Debian es el encargado de definir cómo se gestionan las interfaces de red. En este caso, se está configurando la interfaz de red enp1s0 con una dirección IP estática:pablo@oracle-server:~$ cat /etc/network/interfaces# This file describes the network interfaces available on your system# and how to activate them. For more information, see interfaces(5).source /etc/network/interfaces.d/*# The loopback network interfaceauto loiface lo inet loopback# The primary network interface#allow-hotplug enp1s0#iface enp1s0 inet dhcpauto enp1s0iface enp1s0 inet static\taddress 192.168.122.126\tnetmask 255.255.255.0\tgateway 192.168.122.1Configuración del archivo /etc/hostsEl archivo /etc/hosts se utiliza para mapear direcciones IP a nombres de host. En este caso, se ha añadido una entrada para la dirección IP estática que se configuró en el paso anterior, asociándola al nombre oracle-server:pablo@oracle-server:~$ cat /etc/hosts127.0.0.1\tlocalhost127.0.1.1\toracle-server# The following lines are desirable for IPv6 capable hosts::1     localhost ip6-localhost ip6-loopbackff02::1 ip6-allnodesff02::2 ip6-allrouters192.168.122.126\toracle-serverLa combinación de una red estática con la entrada en /etc/hosts garantiza que la máquina virtual siempre tendrá la misma dirección IP en la red y que será posible referenciarla mediante un nombre fácil de recordar, como oracle-server, tanto en la máquina virtual como en otros dispositivos o aplicaciones que necesiten comunicarse con ella.Cuando realizas una instalación de Oracle 19c en Debian 12, uno de los primeros pasos que debes hacer es asegurarte de que el sistema esté completamente actualizado y tenga todas las dependencias necesarias para que Oracle funcione sin problemas. Para ello, realizarás dos comandos importantes que explico a continuación:pablo@oracle-server:~$ sudo apt update &amp;&amp; sudo apt upgrade -yObj:1 http://deb.debian.org/debian bookworm InReleaseObj:2 http://security.debian.org/debian-security bookworm-security InReleaseObj:3 http://deb.debian.org/debian bookworm-updates InReleaseLeyendo lista de paquetes... HechoCreando árbol de dependencias... HechoLeyendo la información de estado... HechoTodos los paquetes están actualizados.Leyendo lista de paquetes... HechoCreando árbol de dependencias... HechoLeyendo la información de estado... HechoCalculando la actualización... Hecho0 actualizados, 0 nuevos se instalarán, 0 para eliminar y 0 no actualizados.E instalamos las dependencias necesarias:pablo@oracle-server:~$ sudo apt install libaio1 unixodbc bc ksh gawk -yEste comando instala una serie de paquetes necesarios para el funcionamiento de Oracle 19c. Cada uno de estos paquetes cumple una función específica dentro del entorno de Oracle y en la configuración del sistema:      libaio1: Este paquete instala las bibliotecas de entrada/salida asíncrona (AIO) necesarias para Oracle. Oracle utiliza AIO para realizar operaciones de lectura y escritura sin bloquear el proceso, lo que mejora el rendimiento de la base de datos. Este es un requisito fundamental para que Oracle funcione correctamente en el sistema.        unixodbc: Este paquete proporciona las bibliotecas y herramientas necesarias para gestionar la conectividad con bases de datos mediante ODBC (Open Database Connectivity). Aunque Oracle no siempre utiliza ODBC para la conectividad por defecto, algunas herramientas o configuraciones de Oracle pueden requerir este paquete para establecer conexiones a otras bases de datos o para ciertos procesos internos.        bc: Este paquete instala una calculadora de precisión arbitraria, que es útil en muchos scripts y procesos de Oracle. Se usa, por ejemplo, para realizar cálculos matemáticos en la configuración o en la ejecución de scripts de mantenimiento y automatización de la base de datos.        ksh: Este es el KornShell, un intérprete de comandos compatible con muchos de los scripts utilizados por Oracle. Aunque Oracle puede funcionar con otros shells, como bash, ciertos scripts y herramientas de Oracle requieren específicamente el KornShell para funcionar correctamente.        gawk: Este paquete instala la versión GNU de AWK, que es un potente lenguaje de programación utilizado para procesamiento de texto y manipulación de datos. Oracle utiliza AWK en muchos de sus scripts de configuración y mantenimiento, por lo que es necesario tenerlo instalado para que los scripts internos de Oracle se ejecuten correctamente.  Oracle utiliza un enfoque de administración basado en roles, por lo que es importante crear un grupo y un usuario específico para garantizar que el sistema esté organizado y que las tareas administrativas puedan realizarse de manera controlada. Para ello:pablo@oracle-server:~$ sudo groupadd dbapablo@oracle-server:~$ sudo adduser --ingroup dba --home /home/oracle --shell /bin/bash oracleAñadiendo el usuario `oracle' ...Adding new user `oracle' (1001) with group `dba (1001)' ...Creando el directorio personal `/home/oracle' ...Copiando los ficheros desde `/etc/skel' ...Nueva contraseña: Vuelva a escribir la nueva contraseña: passwd: contraseña actualizada correctamenteCambiando la información de usuario para oracleIntroduzca el nuevo valor, o pulse INTRO para usar el valor predeterminado\tNombre completo []: \tNúmero de habitación []: \tTeléfono del trabajo []: \tTeléfono de casa []: \tOtro []: ¿Es correcta la información? [S/n] Adding new user `oracle' to supplemental / extra groups `users' ...Añadiendo al usuario `oracle' al grupo `users' ...En este paso del proceso de instalación de Oracle 19c, es importante mencionar que, aunque Oracle ofrece soporte para varias distribuciones de Linux, no proporciona soporte oficial para Debian. Esto significa que no existe un paquete .deb directamente disponible para instalar Oracle en Debian. Sin embargo, existen formas de sortear este inconveniente.Obtención del fichero de instalaciónEl primer paso es descargar el archivo de instalación desde la página oficial de Oracle. Para ello, tendrás que acceder a la sección de descargas de Oracle en su sitio web, donde podrás encontrar el instalador correspondiente para Oracle 19c. Generalmente, Oracle proporciona el instalador en formato .rpm para sistemas basados en Red Hat, como CentOS o RHEL, pero no ofrece un paquete .deb directamente para Debian. Esto se debe a que Debian y sus derivados (como Ubuntu) utilizan un sistema de gestión de paquetes diferente, basado en el formato .deb.Conversión del paquete .rpm a .deb usando alienDado que Oracle no ofrece un paquete nativo de Debian, una de las opciones es utilizar una herramienta llamada alien para convertir el paquete .rpm (Red Hat Package Manager) a un formato .deb compatible con Debian.alien es una herramienta que permite convertir entre diferentes formatos de paquetes de Linux, incluyendo .rpm a .deb. Aunque la conversión no es perfecta en todos los casos, generalmente funciona bien para muchos paquetes.Para realizar la conversión, primero necesitas instalar alien en tu sistema Debian:sudo apt install alienUna vez instalado alien, puedes convertir el archivo .rpm a .deb con el siguiente comando:sudo alien -d oracle-database-ee-19c-1.0-1.x86_64.rpm  El parámetro -d le indica a alien que cree un paquete .deb. Este proceso generará un archivo .deb que podrás instalar de manera estándar en tu sistema Debian utilizando dpkg.Proceso ya realizadoComo ya he realizado esta conversión previamente, para aligerar el proceso, he subido el paquete .deb a un servicio de almacenamiento en la nube, como Mega, para que puedas descargarlo directamente sin necesidad de hacer la conversión tú mismo.Dejaré el link de descarga de este paquete .deb para que puedas instalar Oracle 19c sin complicaciones adicionales. Solo tendrás que descargar el archivo:MegaUna vez que hayas descargado el archivo .deb de Oracle 19c, el siguiente paso es transferir este fichero a la máquina virtual donde realizarás la instalación. Para ello, utilizaremos el comando scp (Secure Copy), que es una herramienta segura para transferir archivos entre sistemas a través de SSH.El comando que he utilizado es el siguiente:pavlo@debian:~()$ scp /home/pavlo/iso/oracle-database-ee-19c_1.0-2_amd64.deb pablo@192.168.122.126:/home/pablopablo@192.168.122.126's password: oracle-database-ee-19c_1.0-2_amd64.deb                                                                                                     100% 2409MB 101.4MB/s   00:23Y como podemos ver ya lo tenemos en nuestra máquina virtual:pablo@oracle-server:~$ lsoracle-database-ee-19c_1.0-2_amd64.debUna vez que hemos transferido el archivo .deb de Oracle Database 19c a nuestra máquina virtual, es hora de proceder con la instalación. Para ello, usaremos el comando dpkg, que es el gestor de paquetes estándar en Debian. Aquí te dejo cómo hacerlo.pablo@oracle-server:~$ sudo dpkg -i oracle-database-ee-19c_1.0-2_amd64.deb [sudo] contraseña para pablo: Seleccionando el paquete oracle-database-ee-19c previamente no seleccionado.(Leyendo la base de datos ... 34459 ficheros o directorios instalados actualmente.)Preparando para desempaquetar oracle-database-ee-19c_1.0-2_amd64.deb ...ln: fallo al crear el enlace simbólico '/bin/awk': El fichero ya existeDesempaquetando oracle-database-ee-19c (1.0-2) ...Configurando oracle-database-ee-19c (1.0-2) ...[INFO] Executing post installation scripts...[INFO] Oracle home installed successfully and ready to be configured.To configure a sample Oracle Database you can execute the following service configuration script as root: /etc/init.d/oracledb_ORCLCDB-19c configureProcesando disparadores para libc-bin (2.36-9+deb12u9) ...Una vez hecho esto, ya es hora de comenzar la instalación, pero antes recomiendo borrar el contenido del fichero /etc/init.d/oracledb_ORCLCDB-19c y añadir el siguiente contenido modificado:#!/bin/bash## chkconfig: 2345 80 05# Description: This script is responsible for taking care of configuring the Oracle Database and its associated services.## processname: oracledb_ORCLCDB-19c# Red Hat or SuSE config: /etc/sysconfig/oracledb_ORCLCDB-19c## Set path if path not setcase $PATH in    \"\") PATH=/bin:/usr/bin:/sbin:/etc         export PATH ;;esac# Check if the root user is running this scriptif [ $(id -u) != \"0\" ]then    echo \"You must be root user to run the configurations script. Login as root user and try again.\"    exit 1fi# Setting the required environment variablesexport ORACLE_HOME=/opt/oracle/product/19c/dbhome_1export ORACLE_VERSION=19c export ORACLE_SID=ORCLCDBexport TEMPLATE_NAME=General_Purpose.dbcexport CHARSET=AL32UTF8export PDB_NAME=ORCLPDB1export LISTENER_NAME=LISTENERexport NUMBER_OF_PDBS=1export CREATE_AS_CDB=true# General exports and varsexport PATH=$ORACLE_HOME/bin:$PATHLSNR=$ORACLE_HOME/bin/lsnrctlSQLPLUS=$ORACLE_HOME/bin/sqlplusDBCA=$ORACLE_HOME/bin/dbcaNETCA=$ORACLE_HOME/bin/netcaORACLE_OWNER=oracleRETVAL=0CONFIG_NAME=\"oracledb_$ORACLE_SID-$ORACLE_VERSION.conf\"CONFIGURATION=\"/etc/sysconfig/$CONFIG_NAME\"# Commandsif [ -z \"$SU\" ];then SU=/bin/su; fiif [ -z \"$GREP\" ]; then GREP=/usr/bin/grep; fiif [ ! -f \"$GREP\" ]; then GREP=/bin/grep; fi# To start the DBstart(){    check_for_configuration    RETVAL=$?    if [ $RETVAL -eq 1 ]    then        echo \"The Oracle Database is not configured. You must run '/etc/init.d/oracledb_$ORACLE_SID-$ORACLE_VERSION configure' as the root user to configure the database.\"        exit    fi    # Check if the DB is already started    pmon=ps -ef | egrep pmon_$ORACLE_SID'\\&gt;' | $GREP -v grep    if [ \"$pmon\" = \"\" ];    then        # Unset the proxy env vars before calling sqlplus        unset_proxy_vars        echo \"Starting Oracle Net Listener.\"        $SU -s /bin/bash $ORACLE_OWNER -c \"$LSNR  start $LISTENER_NAME\" &gt; /dev/null 2&gt;&amp;1        RETVAL=$?        if [ $RETVAL -eq 0 ]        then            echo \"Oracle Net Listener started.\"        fi        echo \"Starting Oracle Database instance $ORACLE_SID.\"        $SU -s /bin/bash  $ORACLE_OWNER -c \"$SQLPLUS -s /nolog &lt;&lt; EOF                                                                connect / as sysdba                                                                startup                                                                alter pluggable database all open                                                                exit;                                                                EOF\" &gt; /dev/null 2&gt;&amp;1        RETVAL1=$?        if [ $RETVAL1 -eq 0 ]        then            echo \"Oracle Database instance $ORACLE_SID started.\"        fi    else        echo \"The Oracle Database instance $ORACLE_SID is already started.\"        exit 0    fi    echo    if [ $RETVAL -eq 0 ] &amp;&amp; [ $RETVAL1 -eq 0 ]    then        return 0     else        echo \"Failed to start Oracle Net Listener using $ORACLE_HOME/bin/tnslsnr and Oracle Database using $ORACLE_HOME/bin/sqlplus.\"        exit 1    fi}# To stop the DBstop(){    check_for_configuration    RETVAL=$?    if [ $RETVAL -eq 1 ]    then        echo \"The Oracle Database is not configured. You must run '/etc/init.d/oracledb_$ORACLE_SID-$ORACLE_VERSION configure' as the root user to configure the database.\"        exit 1    fi    # Check if the DB is already stopped    pmon=ps -ef | egrep pmon_$ORACLE_SID'\\&gt;' | $GREP -v grep    if [ \"$pmon\" = \"\" ]    then        echo \"Oracle Database instance $ORACLE_SID is already stopped.\"        exit 1    else        # Unset the proxy env vars before calling sqlplus        unset_proxy_vars        echo \"Shutting down Oracle Database instance $ORACLE_SID.\"        $SU -s /bin/bash $ORACLE_OWNER -c \"$SQLPLUS -s /nolog &lt;&lt; EOF                                                                connect / as sysdba                                                                shutdown immediate                                                                exit;                                                                EOF\" &gt; /dev/null 2&gt;&amp;1        RETVAL=$?        if [ $RETVAL -eq 0 ]        then            echo \"Oracle Database instance $ORACLE_SID shut down.\"        fi        echo \"Stopping Oracle Net Listener.\"        $SU -s /bin/bash  $ORACLE_OWNER -c \"$LSNR stop $LISTENER_NAME\" &gt; /dev/null 2&gt;&amp;1        RETVAL1=$?        if [ $RETVAL1 -eq 0 ]        then            echo \"Oracle Net Listener stopped.\"        fi    fi    echo    if [ $RETVAL -eq 0 ] &amp;&amp; [ $RETVAL1 -eq 0 ]    then        return 0    else        echo \"Failed to stop Oracle Net Listener using $ORACLE_HOME/bin/tnslsnr and Oracle Database using $ORACLE_HOME/bin/sqlplus.\"        exit 1    fi}# To call DBCA to configure the DBconfigure_perform(){    # Unset the proxy env vars before calling dbca    unset_proxy_vars    echo \"Configuring Oracle Database $ORACLE_SID.\"    # Add the -J-Doracle.assistants.dbca.validate.ConfigurationParams=false to bypass the memory validation error    $SU -s /bin/bash  $ORACLE_OWNER -c \"$DBCA -silent -createDatabase -gdbName $ORACLE_SID -templateName $TEMPLATE_NAME -characterSet $CHARSET -createAsContainerDatabase $CREATE_AS_CDB -numberOfPDBs $NUMBER_OF_PDBS -pdbName $PDB_NAME -createListener $LISTENER_NAME:$LISTENER_PORT -datafileDestination $ORACLE_DATA_LOCATION -sid $ORACLE_SID -autoGeneratePasswords -emConfiguration DBEXPRESS -emExpressPort $EM_EXPRESS_PORT -J-Doracle.assistants.dbca.validate.ConfigurationParams=false\"    RETVAL=$?    echo    if [ $RETVAL -eq 0 ]    then        echo \"Database configuration completed successfully. The passwords were auto generated, you must change them by connecting to the database using 'sqlplus / as sysdba' as the oracle user.\"        return 0    else        echo \"Database configuration failed.\"        exit 1    fi}# Enh 27965939 - Unsets the proxy env variablesunset_proxy_vars(){    if [ \"$http_proxy\" != \"\" ]    then        unset http_proxy    fi    if [ \"$HTTP_PROXY\" != \"\" ]    then        unset HTTP_PROXY    fi    if [ \"$https_proxy\" != \"\" ]    then        unset https_proxy    fi    if [ \"$HTTPS_PROXY\" != \"\" ]    then        unset HTTPS_PROXY    fi}# Check if the DB is already configuredcheck_for_configuration(){    configfile=$GREP --no-messages $ORACLE_SID:$ORACLE_HOME /etc/oratab &gt; /dev/null 2&gt;&amp;1    if [ \"$configfile\" = \"\" ]    then        return 1    fi    return 0}read_config_file(){    if [ -f \"$CONFIGURATION\" ]    then        . \"$CONFIGURATION\"    else        echo \"The Oracle Database is not configured. Unable to read the configuration file '$CONFIGURATION'\"        exit 1;    fi}# Entry point to configure the DBconfigure(){    check_for_configuration    RETVAL=$?    if [ $RETVAL -eq 0 ]    then        echo \"Oracle Database instance $ORACLE_SID is already configured.\"        exit 1    fi    read_config_file    check_port_availability    check_em_express_port_availability    configure_perform}check_port_availability(){    port=netstat -n --tcp --listen | $GREP :$LISTENER_PORT    if [ \"$port\" != \"\" ]    then        echo \"Port $LISTENER_PORT appears to be in use by another application. Specify a different port in the configuration file.\"        exit 1    fi}check_em_express_port_availability(){    port=netstat -n --tcp --listen | $GREP :$EM_EXPRESS_PORT    if [ \"$port\" != \"\" ]    then        echo \"Port $EM_EXPRESS_PORT appears to be in use by another application. Specify a different port in the configuration file.\"        exit 1    fi}case \"$1\" in    start)        start        ;;    stop)        stop        ;;    restart)        stop        start        ;;    configure)        configure        ;;    *)        echo \"Usage: $0 {start|stop|restart|configure}\"        exit 1esacEsto es porque por defecto el contenido del script del fichero configure me daba problemas, por lo que con estas modificaciones me funciona correctamente.Ahora, ya solo nos queda ejecutar el comando de la instalación y esperar. Este proceso puede tardar varios minutos.pablo@oracle-server:~$ sudo /etc/init.d/oracledb_ORCLCDB-19c configure/etc/init.d/oracledb_ORCLCDB-19c: línea 243: -n: orden no encontrada/etc/init.d/oracledb_ORCLCDB-19c: línea 253: -n: orden no encontradaConfiguring Oracle Database ORCLCDB.Preparar para funcionamiento de base de datos8% finalizadoCopiando archivos de base de datos31% finalizadoCreando e iniciando instancia Oracle32% finalizado36% finalizado40% finalizado43% finalizado46% finalizadoTerminando creación de base de datos51% finalizado54% finalizadoCreando Bases de Datos de Conexión58% finalizado77% finalizadoEjecutando acciones posteriores a la configuración100% finalizadoCreación de la base de datos terminada. Consulte los archivos log de /opt/oracle/cfgtoollogs/dbca/ORCLCDB para obtener más información.Información de Base de Datos:Nombre de la Base de Datos Global:ORCLCDBIdentificador del Sistema (SID):ORCLCDBPara obtener información detallada, consulte el archivo log \"/opt/oracle/cfgtoollogs/dbca/ORCLCDB/ORCLCDB.log\".Database configuration completed successfully. The passwords were auto generated, you must change them by connecting to the database using 'sqlplus / as sysdba' as the oracle user.ConfiguraciónAl finalizar la ejecución del script de configuración de Oracle Database, se indica que la base de datos ha sido configurada exitosamente. Sin embargo, antes de poder usar Oracle como el usuario oracle, es necesario configurar las variables de entorno adecuadas para garantizar que el sistema pueda encontrar las herramientas y archivos correctos de Oracle. Estas variables definen el entorno en el que Oracle se ejecuta, y se deben configurar correctamente para que los comandos de Oracle funcionen sin problemas. Por lo tanto, nos cambiamos al usuario oracle y en el fichero ~/.bashrc añadimos las variables al final:pablo@oracle-server:~$ sudo su - oracleoracle@oracle-server:~$ tail -6 ~/.bashrc #Oracle environmentsexport ORACLE_HOME=/opt/oracle/product/19c/dbhome_1export ORACLE_SID=ORCLCDBexport ORACLE_BASE=/opt/oracleexport PATH=$ORACLE_HOME/bin:$PATHexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATHoracle@oracle-server:~$ source ~/.bashrcUna vez que hemos añadido las variables de entorno necesarias en el archivo .bashrc del usuario oracle y hemos recargado dicho archivo, las herramientas de Oracle deberían estar completamente configuradas para su uso. Esto nos permite acceder a la base de datos utilizando comandos como sqlplus, que es la herramienta de línea de comandos de Oracle para interactuar con la base de datos.oracle@oracle-server:~$ sqlplus / as sysdbaSQL*Plus: Release 19.0.0.0.0 - Production on Tue Nov 19 13:33:37 2024Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0SQL&gt;💡 Tip: El comando rlwrap es una herramienta muy útil que mejora la experiencia de uso de programas de línea de comandos que no tienen soporte nativo para edición de texto o historial de comandos. En el contexto de Oracle y herramientas como SQL*Plus, rlwrap puede ser un gran aliado al proporcionar características de edición y autocompletado que, de otra manera, no estarían disponibles.Primero de todo lo instalamos:oracle@oracle-server:~$ sudo apt install rlwrapPara aprovechar la funcionalidad de rlwrap de manera automática cada vez que iniciemos SQLPlus, podemos añadir el comando rlwrap a las variables de entorno del usuario oracle. Esto hará que SQLPlus siempre se ejecute con las ventajas de rlwrap, sin tener que escribir el comando completo cada vez. Por lo tanto, en el ~/.bashrc añadimos la siguiente línea:alias sqlplus='rlwrap sqlplus'Recargamos:oracle@oracle-server:~$ source ~/.bashrcY ahora cada vez que accedamos a la terminal de sqlplus lo tendremos a modo terminal, donde podremos recuperar comandos, hacer Ctrl + l, etc.Añadir usuario principalEn el proceso de configuración de la base de datos Oracle, hemos visto que podemos acceder a la base de datos desde el usuario oracle, dado que previamente le otorgamos los permisos necesarios. Sin embargo, generalmente no vamos a querer realizar todas las tareas administrativas directamente desde el usuario oracle, ya que este es un usuario dedicado principalmente a gestionar Oracle, y preferimos usar nuestro propio usuario principal para interactuar con el sistema, a menos que se nos indique lo contrario.Para poder administrar la base de datos desde nuestro usuario principal, necesitamos agregarlo al grupo dba que creamos anteriormente. Esto nos permitirá tener acceso a las herramientas y permisos necesarios para gestionar Oracle como si fuéramos administradores, sin tener que cambiar de usuario constantemente.Además, debemos asegurarnos de que las variables de entorno relacionadas con Oracle estén configuradas correctamente en nuestro usuario principal, de manera que podamos acceder a las herramientas de Oracle (como SQL*Plus) y ejecutar comandos administrativos desde nuestro propio entorno de usuario.pablo@oracle-server:~$ sudo usermod -a -G dba pablo[sudo] contraseña para pablo: pablo@oracle-server:~$ sudo nano ~/.bashrcpablo@oracle-server:~$ source ~/.bashrcpablo@oracle-server:~$ sqlplus / as sysdbaSQL*Plus: Release 19.0.0.0.0 - Production on Tue Nov 19 13:49:52 2024Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0SQL&gt; Creación de un usuario en Oracle 19cAl trabajar con Oracle Database, una de las tareas más comunes es la creación de usuarios. Sin embargo, en algunas configuraciones recientes, como la que estamos utilizando en Oracle 19c, puede surgir un error relacionado con el parámetro _ORACLE_SCRIPT. Aquí te explicamos cómo crear un usuario y cómo resolver este problema si aparece.Creación de un usuario en OraclePara crear un usuario en Oracle Database, seguimos estos pasos:Accedemos a la base de datos con privilegios de administrador utilizando SQL*Plus:pablo@oracle-server:~$ sqlplus / as sysdbaSQL*Plus: Release 19.0.0.0.0 - Production on Tue Nov 19 13:58:52 2024Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0Y creamos el nuevo usuario:SQL&gt; CREATE USER pablo IDENTIFIED BY password;CREATE USER pablo IDENTIFIED BY password            *ERROR en linea 1:ORA-65096: nombre de usuario o rol comun no validoPero como podemos ver nos ha dado error. Este error ocurre porque Oracle 12c y versiones posteriores introdujeron el concepto de bases de datos multitenant, donde una única instancia puede contener múltiples bases de datos “pluggable” (PDB). De forma predeterminada, Oracle espera que los nombres de usuario sigan ciertas convenciones especiales para usuarios “comunes” que se compartan entre las bases de datos contenedoras (CDB) y las bases de datos pluggable (PDB).Si no estamos configurando un usuario común, sino uno específico para nuestra base de datos pluggable, necesitamos desactivar temporalmente esta restricción.Para solucionarlo tendremos que ejecutar el siguiente comando:ALTER SESSION SET \"_ORACLE_SCRIPT\"=TRUE;Y ya nos dejará crear el usuario sin problemas:SQL&gt; ALTER SESSION SET \"_ORACLE_SCRIPT\"=TRUE;Sesion modificada.SQL&gt; CREATE USER pablo IDENTIFIED BY password;Usuario creado.Le damos permisos para conectarnos:SQL&gt; GRANT CONNECT, RESOURCE TO pablo;Concesion terminada correctamente.Y probamos a conectarnos con el nuevo usuario:pablo@oracle-server:~$ sqlplus pablo/passwordSQL*Plus: Release 19.0.0.0.0 - Production on Tue Nov 19 14:05:34 2024Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0SQL&gt;Con esto concluimos la instalación y configuración de Oracle Database 19c sobre una máquina virtual con Debian 12, utilizando QEMU/KVM como hipervisor. A lo largo de este proceso, hemos cubierto todos los aspectos necesarios para poner en marcha la base de datos, desde la configuración inicial del sistema operativo hasta los pasos específicos para preparar y personalizar el entorno de Oracle.Hemos abordado detalles importantes como la instalación de dependencias, la creación de usuarios y grupos, la gestión de variables de entorno y la resolución de errores comunes. Además, vimos cómo realizar tareas básicas de administración, como el acceso a SQL*Plus, la adición de usuarios y el uso de herramientas útiles como rlwrap para mejorar la experiencia en la línea de comandos."
  },
  
  {
    "title": "Instalación de WordPress en un servidor LEMP",
    "url": "/posts/instalacion-wordpress/",
    "categories": "Implantación Web, Aplicaciones",
    "tags": "Aplicaciones",
    "date": "2024-11-15 18:15:00 +0100",
    





    
    "snippet": "¿Qué vas a aprender en este taller?  Realizar la instalación de un servidor LEMP.  Configurar nginx como proxy inverso para pasar las peticiones PHP al servidor de aplicación fpm-php.  Realizar la ...",
    "content": "¿Qué vas a aprender en este taller?  Realizar la instalación de un servidor LEMP.  Configurar nginx como proxy inverso para pasar las peticiones PHP al servidor de aplicación fpm-php.  Realizar la instalación de un CMS PHP WordPress.Instalación de la pila LEMPEn este taller configuraremos una máquina virtual con Debian 12 y un servidor LEMP.¿Qué es LEMP?LEMP es un conjunto de software diseñado para alojar aplicaciones web dinámicas. A continuación, desglosamos sus componentes:  L: Linux, el sistema operativo base.  E: Nginx, el servidor web, conocido por su rendimiento y eficiencia. (Se pronuncia “Engine-X”)  M: MySQL o MariaDB, sistemas de gestión de bases de datos utilizados para almacenar información.  P: PHP, un lenguaje de programación para generar contenido dinámico en páginas web.Es una alternativa moderna al stack LAMP (que utiliza Apache como servidor web).Pasos para instalar la pila LEMP:Ejecuta el siguiente comando para instalar Nginx:pablo@debian:~$ sudo apt install nginx -yInstala MariaDB para gestionar las bases de datos necesarias:pablo@debian:~$ sudo apt install mariadb-server mariadb-client -yAgrega PHP y los módulos imprescindibles para que WordPress funcione correctamente:pablo@debian:~$ sudo apt install php-fpm php-mysql php-xml php-mbstring php-curl php-gd -yY listo, con estos pasos ya tendrás instalada y configurada la pila LEMP.Creación de la base de datosEn este paso, configuraremos la base de datos necesaria para WordPress. Esto incluye crear una base de datos específica, un usuario asociado y otorgarle los permisos necesarios. A continuación, te explico el proceso:1. Accede a la consola de MariaDB como usuario root, para ello ejecuta el siguiente comando en tu terminal:pablo@debian:~$ sudo mysql -u root -pIngresa la contraseña de root cuando se te solicite. Esto te llevará al monitor de MariaDB.2. Una vez dentro de MariaDB, ejecuta:CREATE DATABASE wordpress_db;Esto crea una base de datos llamada wordpress_db donde se almacenarán los datos de WordPress.3. Define un nuevo usuario y una contraseña para gestionar la base de datos. Por ejemplo:GRANT ALL PRIVILEGES ON wordpress_db.* TO 'user'@'localhost';  user: Nombre del usuario.  password: Contraseña asociada al usuario.4. Otorga todos los privilegios al usuario sobre la base de datos:GRANT ALL PRIVILEGES ON wordpress_db.* TO 'user'@'localhost';Permite al usuario user gestionar completamente la base de datos wordpress_db:5. Finalmente, actualiza los privilegios para asegurarte de que se registren correctamente:FLUSH PRIVILEGES;6. Sal del monitor de MariaDB:EXIT;Ahora tienes una base de datos llamada wordpress_db y un usuario user con todos los privilegios sobre ella. Estos datos serán utilizados durante la configuración de WordPress.Configurar un VirtualHost para WordPressEn este paso, crearemos y configuraremos un virtualhost en nginx para que el sitio web de WordPress sea accesible a través de un dominio local como wordpress.pablo.beer. A continuación, los pasos detallados:1. Crear el archivo de configuración del virtualhostEdita o crea un nuevo archivo de configuración en /etc/nginx/sites-available/ con el nombre del dominio deseado:pablo@debian:~$ sudo nano /etc/nginx/sites-available/wordpress.pablo.beerDentro del archivo, agrega la configuración:server {    listen 80;    server_name wordpress.pablo.beer;    root /var/www/wordpress;    index index.php index.html index.htm;    location / {        try_files $uri $uri/ /index.php?$args;    }    location ~ \\.php$ {        include snippets/fastcgi-php.conf;        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;    }    location ~ /\\.ht {        deny all;    }}2. Activar el VirtualHostCrea un enlace simbólico en el directorio sites-enabled para que nginx cargue esta configuración:pablo@debian:~$ sudo ln -s /etc/nginx/sites-available/wordpress.pablo.beer /etc/nginx/sites-enabled/3. Verificar la configuración de nginxAntes de reiniciar nginx, verifica que la configuración sea válida:pablo@debian:~$ sudo nginx -tSi todo está correcto, verás un mensaje indicando que la configuración es válida.4. Descargar WordPresspablo@debian:~$ cd /tmppablo@debian:/tmp$ wget https://wordpress.org/latest.zipDescomprime el archivo descargado:pablo@debian:/tmp$ sudo apt install unzippablo@debian:/tmp$ unzip latest.zip5. Mover WordPress a la ruta del servidor webMueve los archivos de WordPress al directorio especificado en la configuración del virtualhost (/var/www/wordpress):pablo@debian:/tmp$ sudo mv wordpress /var/www/wordpress6. Asignar permisos correctosAsegúrate de que los archivos y directorios tengan los permisos correctos:pablo@debian:~$ sudo chown -R www-data:www-data /var/www/wordpresspablo@debian:~$ sudo chmod -R 755 /var/www/wordpress7. Configurar el archivo hostsAñade el dominio local wordpress.pablo.beer en el archivo /etc/hosts de tu host principal (tu máquina física) para que el navegador lo reconozca. Edita el archivo de la siguiente manera:pavlo@debian:~()$ sudo nano /etc/hostsAgrega la línea:&lt;IP_Máquina_Virtual&gt;\twordpress.pablo.beer8. Reiniciar nginxReinicia el servicio para aplicar los cambios:pablo@debian:~$ sudo systemctl restart nginxAhora deberías poder acceder a WordPress escribiendo http://wordpress.pablo.beer en tu navegador. Desde ahí podrás completar la instalación de WordPress en el navegador.Instalación de WordPressUna vez configurado el servidor, el virtualhost y los permisos, es momento de acceder a la interfaz de instalación de WordPress y configurar el sitio. Aquí tienes los pasos detallados:Accede a la URL de instalaciónAbre tu navegador web y accede al dominio configurado en tu archivo /etc/hosts:http://wordpress.pablo.beerDeberías ver la pantalla inicial de configuración de WordPress:El instalador nos pide que elijamos un idioma para el sitio. Selecciona el deseado (por ejemplo, Español) y haz clic en Continuar.Configura la conexión con la base de datosEn la siguiente pantalla, deberás proporcionar los datos de conexión a la base de datos:  Nombre de la base de datos: wordpress_db (la base de datos que creaste).  Nombre de usuario: user (el usuario que configuraste).  Contraseña: La contraseña asignada al usuario.  Servidor de la base de datos: localhost.  Prefijo de tabla: Por defecto es wp_. Puedes cambiarlo si lo deseas, pero no es obligatorio.Haz clic en Enviar.Configura los datos del sitio webRellena el formulario con la información básica del sitio:  Título del sitio: El nombre de tu blog o página.  Nombre de usuario: El nombre para el administrador del sitio.  Contraseña: Una contraseña segura para el usuario administrador.  Correo electrónico: Un correo asociado al administrador.  Privacidad: Puedes elegir si deseas que los motores de búsqueda indexen tu sitio (puedes cambiar esto más adelante).Haz clic en Instalar WordPress.Accede al panel de administraciónCuando la instalación se complete, WordPress te redirigirá a la pantalla de inicio de sesión.Si queremos acceder al panel de administración lo haremos desde http://wordpress.pablo.beer/wp-admin. Ingresa tu nombre de usuario y contraseña creados en el paso anterior y ya estaríamos dentro.Primer blogUna vez dentro del panel de administración:  En el menú de la izquierda, haz clic en Entradas.  Luego, selecciona Añadir nueva.En la pantalla de creación de la entrada escribe el contenido de tu blog:  Título: Escribe un título para tu entrada, como por ejemplo Mi primera entrada en el blog.  Contenido: En el editor, puedes escribir el cuerpo de tu entrada. Puedes incluir texto, imágenes, enlaces, videos, etc.El editor de WordPress es muy intuitivo y funciona mediante bloques:  Haz clic en el botón + para añadir bloques como párrafos, encabezados, imágenes, etc.  Arrastra y organiza los bloques según necesites.Antes de publicar, puedes ajustar algunos parámetros:  Estado: Puedes guardar como borrador si no estás listo para publicarla.  Visibilidad: Define si la entrada será pública, privada o protegida con contraseña.  Publicación programada: Puedes programar la publicación para una fecha y hora futura.Cuando estés listo:  Haz clic en el botón Publicar en la parte superior derecha.  Confirma la publicación en el cuadro de diálogo que aparece.Tu entrada estará disponible en el blog y visible para los visitantes.Después de publicar, haz clic en el enlace Ver entrada para ver cómo se ve en tu sitio.Configurar URL amigables en WordPressLas URL amigables (también conocidas como “permalinks”) son direcciones web fáciles de leer y entender, lo que mejora la experiencia del usuario y también el SEO (posicionamiento en buscadores). En lugar de tener URLs como http://tu-sitio.com/?p=123, con URL amigables, las URLs serán algo como http://tu-sitio.com/mi-primera-entrada.Pasos para configurar URL amigables en WordPress1. Accede al panel de administración de WordPress. Abre tu navegador y accede a tu sitio de WordPress (por ejemplo: http://wordpress.tunombre.algo/wp-admin).2. Configura los enlaces permanentes.      En el menú lateral izquierdo, ve a Ajustes &gt; Enlaces permanentes.        Aquí verás diferentes opciones para configurar cómo se verán las URLs de tus entradas. Puedes elegir entre varias opciones como:                  Predeterminado: http://tu-sitio.com/?p=123                    Día y nombre: http://tu-sitio.com/2024/11/15/mi-primera-entrada                    Mes y nombre: http://tu-sitio.com/2024/11/mi-primera-entrada                    Nombre de la entrada: http://tu-sitio.com/mi-primera-entrada (más recomendado)                  Selecciona la opción Nombre de la entrada si deseas tener URLs amigables, y luego haz clic en Guardar cambios.  ¡Y eso es todo! Ahora tu sitio WordPress debería estar configurado para usar URL amigables, mejorando tanto la accesibilidad para los usuarios como el SEO. Con esta configuración, podrás disfrutar de una navegación más fluida y profesional.🚀"
  },
  
  {
    "title": "Comandos para programación de tareas",
    "url": "/posts/comandos-programacion/",
    "categories": "Sistemas, Automatización",
    "tags": "Automatización",
    "date": "2024-09-02 20:00:00 +0200",
    





    
    "snippet": "IntroducciónEn el entorno Linux, la programación de tareas es una habilidad fundamental que permite a los usuarios automatizar la ejecución de comandos y scripts en momentos específicos o en interv...",
    "content": "IntroducciónEn el entorno Linux, la programación de tareas es una habilidad fundamental que permite a los usuarios automatizar la ejecución de comandos y scripts en momentos específicos o en intervalos regulares. Esta capacidad no solo mejora la eficiencia, sino que también asegura que las tareas críticas se realicen sin intervención manual, lo que es especialmente útil para mantenimiento del sistema, copias de seguridad y actualizaciones programadas.Este post explorará los comandos más utilizados para programar tareas en Linux, tales como cron, at y systemd timers. Aprenderemos cómo configurarlos y utilizarlos de manera efectiva, proporcionando ejemplos prácticos que facilitarán la comprensión de su funcionamiento. Al final, tendrás las herramientas necesarias para automatizar tareas y optimizar tu flujo de trabajo en el sistema operativo Linux.1. SleepEl comando sleep en Linux se utiliza para pausar la ejecución de un proceso o script durante un período de tiempo especificado por el usuario. Este comando está disponible en todas las distribuciones de Linux, incluyendo Debian, y no requiere instalación adicional.Opciones y ParámetrosLas opciones más comunes para el comando sleep son:  -h o –help: Muestra información de ayuda sobre el comando sleep.  -v o –version: Muestra información sobre la versión del comando y detalles relacionados con su desarrollo.Los parámetros que se pueden utilizar con sleep para especificar el tiempo de pausa son:  s: Segundos (por defecto).  m: Minutos.  h: Horas.  d: Días.Es posible utilizar números enteros o decimales para especificar el tiempo de pausa.Ejemplos de UsoAquí hay algunos ejemplos de cómo se puede utilizar el comando sleep:  Pausar un proceso durante 10 segundos:  Pausar un proceso durante 2 minutos:  Pausar un proceso durante 1 hora y media:  Pausar un proceso durante 3 días:                             Pausar un proceso durante una combinación de tiempos (1 día, 2 horas, 3 minutos y 4 segundos):  Pausar un proceso durante 0.5 segundos (usando un número decimal):  Ejecutar varios comandos sleep de forma consecutiva o utilizar el operador &amp;&amp; para ejecutar otro comando después de sleep:  Este script se ejecutará en un bucle infinito, pero se pausará durante 10 minutos en cada iteración utilizando sleep.    echo \"Este script se ejecutará cada 10 minutos.\"while true; do# Comandos que deseas ejecutarsleep 10mdone      El comando sleep es especialmente útil en scripts de shell para introducir retrasosentre la ejecución de diferentes comandos, para reintentar operaciones fallidas después de un tiempo, o para esperar a que se cumplan ciertas condiciones, como la disponibilidad de una conexión de red.En resumen, sleep es una herramienta simple pero poderosa para controlar el flujode ejecución en scripts y procesos en sistemas operativos basados en Linux.2. WatchEl comando watch en Linux es una herramienta que permite a los usuariosmonitorizar continuamente los cambios en un archivo o el resultado de un comando en tiempo real. Este comando ejecuta otros comandos de forma repetitiva y muestra los resultados en tiempo real. Por defecto, watch ejecuta el comando especificado cada 2 segundos y muestra los resultados en la terminal.Opciones y ParámetrosLas opciones más comunes para el comando watch son:  -n segundos: Esta opción permite especificar el intervalo de tiempo en segundos entre cada ejecución del comando.  -d: Esta opción es usada para destacar las diferencias entre las actualizaciones  -t: Esta opción elimina el encabezado que muestra el intervalo, el comando y la hora actual  -g o –chgexit: Esta opción permite que watch termine la ejecución en el caso de que se haya modificado la salidaEjemplos de UsoAquí hay algunos ejemplos de cómo se puede utilizar el comando watch:  Monitorizar el uso de la memoria del servidor cada segundo:  Ejecutar el comando ls cada 5 segundos:  Resaltar las diferencias entre las actualizaciones al ejecutar el comando date:  Eliminar el encabezado al ejecutar el comando free:  Terminar la ejecución si el uso de memoria ha cambiado:  Observar el estado de la memoria con free, refrescando cada décima de segundo:  Observar las conexiones de red con netstat cada segundo:El comando watch es una herramienta muy útil para realizar monitorización en tiempo real en Linux, especialmente para observar la disponibilidad de recursos de red, CPU, memoria, entre otros.3. AtEl comando at en Linux es una herramienta que permite programar tareas únicas para que se ejecuten en un momento específico. Este comando es útil para programar tareas como apagar el sistema a una hora específica, realizar una copia de seguridad única, enviar un correo electrónico como recordatorio a la hora especificada, entre otras cosas.Opciones y ParámetrosLas opciones más comunes para el comando at son:  atq: Lista los trabajos programados.  atrm: Elimina trabajos programados. Se utiliza seguido del número detrabajo, por ejemplo, atrm.  at [hora] [fecha]: Programa una tarea para que se ejecute en la hora y fechaespecificadas.Ejemplos de UsoAquí hay algunos ejemplos de cómo se puede utilizar el comando at:  Programar una tarea para que se ejecute a las 10:00 PM:  Programar una tarea para que se ejecute a las 04:00 AM, copiando unarchivo, eliminándolo del directorio original y apagando el PC:    at 04:00cp /home/usuario/Escritorio/imagen.iso /home/usuario/isosrm /home/usuario/Escritorio/imagen.isoshutdown -h now        Luego presionar Ctrl + D para terminar de ingresar las instrucciones.    Listar los trabajos programados:                               Eliminar un trabajo programado, por ejemplo, el trabajo número 3:  Programar una tarea para que se ejecute a las 11:40 del 26 de febrero de 2023, listando los archivos en la ruta /tmp:    at 11:40 2023-02-26ls -ltr /tmp &gt; \"~/prueba_comando_at.txt\"echo 'finalizado ' &gt;&gt; \"~/prueba_comando_at.txt\"        Luego presionar ctrl + D para terminar de ingresar las instrucciones.  Ten en cuenta que para que el comando at funcione correctamente, lo tendremos que instalar con un sudo apt install at y debe estar corriendo el servicio atd (at daemon). Para habilitarlo en sistemas que usan systemd, puedes ejecutar: sudo systemctl enable –now atd.4. CrontabEl comando crontab en Linux es una herramienta que permite programar tareas para que se ejecuten automáticamente a intervalos regulares. Este comando es útil para automatizar tareas como realizar copias de seguridad, enviar correos electrónicos, limpiar directorios, entre otras cosas.Opciones y ParámetrosLas opciones más comunes para el comando crontab son:  crontab -e: Permite editar el archivo crontab del usuario actual.  crontab -l: Muestra la lista de trabajos programados para el usuario actual.  crontab -r: Elimina todos los trabajos programados para el usuario actual.  crontab -u [usuario] -e: Permite editar el archivo crontab de otro usuario (requiere privilegios de superusuario).Ejemplos de UsoAquí hay algunos ejemplos de cómo se puede utilizar el comando crontab:  Programar una tarea para que se ejecute todos los días a las 5:00 PM:    crontab -e0 17 * * * /ruta/del/script.sh        Luego presionar ctrl + X y luego Y para guardar y salir (si estás utilizando el editor nano).    Listar los trabajos programados:                               Eliminar todos los trabajos programados:  Programar una tarea para que se ejecute cada minuto:    crontab -e* * * * * /ruta/del/comando        Programar una tarea para que se ejecute cada lunes a las 6:30 AM:    crontab -e30 6 * * 1 /ruta/del/comando      En los ejemplos anteriores, la sintaxis de los cinco asteriscos en las entradas de crontab representa minuto (0-59), hora (0-23), día del mes (1-31), mes (1-12) y día de la semana (0-7, donde tanto 0 como 7 representan el domingo), respectivamente.5. ConclusiónEn resumen, los comandos sleep, watch, at y crontab son herramientas esenciales en sistemas operativos basados en Linux, como Debian, para la gestión del tiempo y la automatización de tareas.Estas herramientas proporcionan a los usuarios y administradores de sistemas unagran flexibilidad para programar y automatizar tareas, optimizando así el flujo detrabajo y la eficiencia del sistema.6. BibliografíaIONOSMontblanczoneHostgator"
  },
  
  {
    "title": "Creación de máquina virtual en VirtualBox con arranque dual",
    "url": "/posts/dual-boot/",
    "categories": "Sistemas, Virtualización",
    "tags": "Virtualización",
    "date": "2024-09-02 14:09:00 +0200",
    





    
    "snippet": "IntroducciónEn esta práctica, aprenderemos a crear una máquina virtual en VirtualBox que permita ejecutar dos sistemas operativos en modo de arranque dual: Windows y Debian Bookworm. El arranque du...",
    "content": "IntroducciónEn esta práctica, aprenderemos a crear una máquina virtual en VirtualBox que permita ejecutar dos sistemas operativos en modo de arranque dual: Windows y Debian Bookworm. El arranque dual es una técnica que nos permite elegir entre dos sistemas operativos al iniciar la máquina, lo que resulta muy útil para tener un entorno flexible y adaptable a diferentes necesidades de trabajo o pruebas. Exploraremos los pasos necesarios para instalar y configurar ambos sistemas operativos en la misma máquina virtual, asegurándonos de que puedan coexistir de manera eficiente y sin problemas de compatibilidad. ¡Comencemos!Requisitos Mínimos y RecomendadosLos requisitos específicos pueden variar según la versión de Windows yDebian que elijas, pero aquí tienes algunos requisitos generales:Para Windows (por ejemplo, Windows 10):  Mínimos: Procesador de 1 GHz, 1 GB de RAM (32 bits) o 2 GB deRAM (64 bits), 16 GB de espacio en disco duro, tarjeta gráficacompatible con DirectX 9.  Recomendados: Procesador de 2 GHz o superior, 4 GB de RAM omás, 64 GB de espacio en disco duro o más, tarjeta gráficacompatible con DirectX 11.Para Debian Bookworm (versión actualizada):  Mínimos: Procesador de 1 GHz, 1 GB de RAM, 10 GB de espacio endisco duro.  Recomendados: Procesador de 2 GHz o superior, 2 GB de RAM omás, 20 GB de espacio en disco duro o más.Requisitos Previos  Tener instalado Oracle VirtualBox en el equipo anfitrión.  Descargar las imágenes ISO de Windows y Debian Bookworm.Instalación1. Creación de la Máquina Virtual:  Abre VirtualBox.  Haga clic en “Nueva” para crear una nueva máquina virtual.  Ingresa un nombre para la máquina virtual (ejemplo: “DualBoot”).  Introduce la ISO de Windows descargada anteriormente y selecciona la versión adecuada (por ejemplo, “Windows 10 Pro de 64 bits”).  Configure la cantidad de memoria RAM asignada según los requisitos del sistema operativo Windows (en mi caso le asignaré 4096MB) y la cantidad de CPUs (en mi caso le pondré 4).  Crea un disco duro virtual y asigna un tamaño suficiente para ambos sistemas operativos (por ejemplo, 50 GB).Una vez creada la máquina, nos dirigimos a “Configuración” y en la pestaña “Sistema” deseleccionamos el disquete y dejamos seleccionadas la unidad óptica y el disco duro.Después de esto ya podemos iniciar la máquina virtual y empezar elproceso de instalación de Windows 10.2. Instalación de Windows  Seguimos las instrucciones de instalación de Windows  En la pestaña en la que nos pregunta que tipo de instalaciónqueremos elegimos “Personalizada: instalar solo Windows(avanzado)”, esto lo haremos para indicar en que parte del discoinstalaremos el sistema operativo.  Configure las opciones de idioma, zona horaria y cuenta de usuario.Después de esto ya lo deberíamos tener instalado.3. Liberación de discoTendremos que particionar el disco desde Windows para darle espacio mástarde en la instalación de Debian. Para ello seguiremos los estos pasos:  Nos dirigimos al apartado “Desfragmentar y optimizar unidades”Ahí analizaremos y optimizaremos el disco (C:) para seguidamentepoder desfragmentar el disco. Esto nos servirá a la hora de reducir elvolumen del disco principal.  Luego nos iremos al apartado “Crear y formatear particiones deldisco duro”Aquí haremos botón derecho sobre el disco duro (C:) y le daremos a“reducir volumen”, en este caso le asignaremos 20GB a la segundapartición en la cual instalaremos Debian 12.Una vez liberado y particionado el disco para darle espacio a Debian,apagamos la máquina virtual.4. Instalación de Debian Bookworm  Nos dirigimos a “Configuración” y en la pestaña de“Almacenamiento” sustituimos la imagen ISO de Windows por la deDebian 12 ya descargada anteriormente.  Seguimos las instrucciones de instalación de Debian como ya hemosvisto anteriormente, en la que configuraremos el nombre del host,crearemos una cuenta de usuario, idioma, etc.  Una vez llegamos a la configuración del particionado de disco,seleccionamos el método “Manual”, y seleccionamos el espacio libreque hemos dejado anteriormente, aquí nos dejará elegir entre crearuna partición nueva manualmente o particionar el espacio libre demanera automática, esta segunda opción es la que nos interesa. Nosdebe de quedar algo como esto:  En el apartado de selección de entorno gráfico podremos instalar elentorno que deseemos, en mi caso no instalaré ninguno. De todasformas, luego en la línea de comandos puedo instalar cualquierentorno con el comando “tasksel”.5.Configuración del Gestor de Arranque GRUB  Durante la instalación de Debian, se instalará GRUB, el gestor dearranque.  Asegúrese de que GRUB detecte automáticamente ambos sistemasoperativos (Windows y Debian) durante la instalación. Nos deberíasaltar un mensaje como este:  Esto permitirá que al iniciar la máquina virtual, puedas elegir entrelos dos sistemas operativos desde el menú de GRUB.6. Finalización de la Instalación  Reinicia la máquina virtual.  Deberías ver el menú de GRUB que te permite seleccionar entreWindows y Debian al iniciar.Y con esto ya habríamos terminado la creación de máquina virtual enVirtualBox con arranque dual."
  },
  
  {
    "title": "Compartición de carpetas",
    "url": "/posts/comparticion-carpetas/",
    "categories": "Redes, Compartición de archivos",
    "tags": "Compartición de archivos",
    "date": "2024-09-01 15:30:00 +0200",
    





    
    "snippet": "1. IntroducciónEn esta práctica se abordará la configuración y gestión de la compartición de carpetas entre diferentes sistemas operativos en una red local. La compartición de archivos es una tarea...",
    "content": "1. IntroducciónEn esta práctica se abordará la configuración y gestión de la compartición de carpetas entre diferentes sistemas operativos en una red local. La compartición de archivos es una tarea esencial en redes empresariales y domésticas, ya que permite a los usuarios acceder y gestionar recursos compartidos de manera eficiente, independientemente del sistema operativo que utilicen.El objetivo de esta práctica es demostrar cómo configurar la compartición de carpetas en diversas combinaciones de sistemas: de Windows a Windows, de Windows a Debian, de Debian a Windows, etc. Se utilizarán herramientas nativas y protocolos como Samba para garantizar la interoperabilidad entre estos sistemas.Al finalizar, se habrá aprendido a configurar adecuadamente permisos de acceso, seguridad y las mejores prácticas para la compartición de recursos en un entorno de red mixto.2. Windows a WindowsPara compartir carpetas entre dos máquinas físicas con Windows10, podemos utilizar la funcionalidad de red compartida de Windows.A continuación, te proporciono los pasos generales para hacerlo:2.1. Conexión de redAsegúrate de que ambas máquinas estén conectadas a lamisma red, ya sea mediante Wi-Fi o Ethernet. Esto es esencialpara que las computadoras se vean entre sí. En mi caso,realizaré la compartición de carpetas entre dos máquinasfísicas conectadas a una misma red Wi-Fi. Para saber nuestraIP nos dirigimos al “Cmd” y utilizamos el comando “ipconfig”.Aquí veremos diferentes IPv4, pero a mi me interesa eladaptador de LAN inalámbrica Wi-Fi:2.2. Habilitar el descubrimiento de redEn ambas máquinas, debes asegurarte de que la función de“Descubrimiento de red” esté habilitada. Para hacerlo: Ve al “Panel de control” &gt; “Redes y recursos compartidos”.En la parte izquierda, haz clic en “Cambiar la configuración deuso compartido avanzado”.Asegúrate de que la opción “Activar el uso compartido dearchivos e impresoras” esté habilitada y que la opción “Activarel descubrimiento de red” también esté habilitada.2.3. Compartir carpetasEn la máquina desde la cual deseas compartir carpetas, sigueestos pasos:  Navega a la carpeta que deseas compartir  Haz clic derecho en la carpeta y selecciona “Propiedades”.  Ve a la pestaña “Uso compartido” y haz clic en “Compartir”.  Elige a quién deseas compartir la carpeta. Puedes seleccionar “Todos” para que sea accesible para todos en la red o agregar usuarios específicos.  Define los permisos de acceso (lectura, escritura, etc.) según tus necesidades.  Haz clic en “Compartir” y luego en “Listo”.2.4. Acceso a la carpeta compartidaEn la otra máquina, para acceder a la carpeta compartida:  Abre el Explorador de Windows.  En la barra de direcciones, escribe \\”IP” (reemplaza “IP” por la ruta de la máquina desde la cual estás compartiendo la carpeta).  Deberías ver la carpeta compartida. Haz doble clic en ella y podrás acceder a su contenido.Es importante que ambas máquinas tengan configurado un grupo detrabajo común. Puedes verificar esto y cambiarlo en la configuración de redde cada máquina si es necesario. Además, asegúrate de que las cuentas deusuario en ambas máquinas tengan permisos para acceder a las carpetascompartidas si estás utilizando autenticación basada en cuentas de usuario.Ten en cuenta que estos son pasos generales y pueden variar según laconfiguración específica de tu red y tu sistema. Además, para acceder a lascarpetas compartidas en una red local, ambas máquinas deben estarencendidas y conectadas a la red al mismo tiempo.3. Windows a DebianPara compartir carpetas entre una máquina física con Windows 10 y unamáquina virtual Debian 11 se pueden utilizar diferentes métodos, pero en mi caso utilizaré Samba, en los que seguiré estos pasos:3.1. Configuración de la Máquina Virtual Debian 11Asegúrese de que la máquina virtual Debian 11 esté funcionandocorrectamente y tenga acceso a la red. Para ello tendremos quecambiar el adaptador de red en la configuración de la máquinavirtual, en este caso un adaptador puente.Después de esto, tendremos que comprobar que nuestras máquinashacen ping entre sí:Ping de Windows a DebianPing de Debian a WindowsInstale el paquete de Samba en Debian 11 si aún no está instalado.Puedes hacerlo ejecutando el siguiente comando en la terminal:Creamos la carpeta donde vamos a compartir los archivos.mkdir /home/pavlo/compartidachmod 777 /home/pavlo/compartidaEditamos el archivo de configuración de samba:nano /etc/samba/smb.confAl final del archivo insertamos el siguiente texto correspondiente a laconfiguración de nuestra carpeta compartida:[compartida]path = /home/pavlo/compartidacomment = Compartidaguest ok = yespublic = yeswritable = yesGuardamos los cambios y después reiniciamos el servicio con elcomando:service smbd restartDespués de esto creamos un documento de prueba y ya tendremoscreada una carpeta lista para compartir:En nuestro equipo con Windows nos dirigimos al apartado de red yen el navegador de archivos escribimos la IP que tengamos asignadaen Debian:Si se le solicita un nombre de usuario y una contraseña, ingrese lascredenciales de inicio de sesión de su máquina virtual Debian 11.Con esto realizado, ya podremos empezar a compartir archivos entre losdos sistemas operativos.Mencionar, que en este ejemplo hemos utilizado unos permisos para lacarpeta muy permisivos en el que cualquiera puede leer y escribir en eldirectorio.4. Debian a WindowsPara compartir carpetas de Debian a Windows tenemos que seguirexactamente los mismos pasos ya explicados en el apartado anterior.5. Debian a DebianPara compartir carpetas entre Debian y Debian hay que seguirprácticamente los mismos pasos ya explicados anteriormente. En mi casolo haré con dos máquinas virtuales entre sí. Para ello tendremos que seguir una serie de pasos:      En primer lugar y muy importante, comprobar que haya conectividad(ping) entre nuestras máquinas, en donde tendremos que configurarlas IPs para que ambas tengan coherencia. Después de ellorealizaremos la prueba y comprobamos si funciona:        Seguidamente tendremos que instalar Samba en ambas máquinas ycreamos la carpeta donde vamos a compartir los archivos.  mkdir /home/pavlo/compartidadebianchmod 777 /home/pavlo/compartidadebian  Editamos el archivo de configuración de samba:    nano /etc/samba/smb.conf      Al final del archivo insertamos el siguiente texto correspondiente a laconfiguración de nuestra carpeta compartida:[compartidadebian]path = /home/pavlo/compartidadebiancomment = Comparticion entre Debian y Debianguest ok = yespublic = yeswritable = yesGuardamos los cambios y después reiniciamos el servicio con elcomando:service smbd restart      Después de esto creamos un documento de prueba y ya tendremoscreada una carpeta lista para compartir:        Una vez configurado todo se seguirán los mismos sencillos pasos queen Windows estando en la misma red y utilizando el comandosmb://111.111.1.11  Y con esto ya habríamos hecho la compartición de carpetas entre Debian y Debian a través de Samba.6. Windows a AndroidUtilizando una aplicación llamada “fx file explorer” nos resultará muysencillo compartir carpetas entre Windows y Android.Como en todos los apartados anteriores tendremos que estar conectados ala misma red para que ambos dispositivos puedan realizar conectividadentre sí. En mi caso estarán conectados tanto mi portátil como mi teléfono a la red Wi-Fi de mi casa.Una vez instalada la aplicación y comprobado que ambos dispositivos están en la misma red, creamos una carpeta compartida en Windows dando los permisos que queramos como ya he explicado anteriormente. Despuésaccedemos al apartado de “Network” y agregamos un nuevo dispositivo enel que tendremos que poner la IP de nuestro dispositivo Windows.Una vez realizado todo esto lo único que queda es abrir la carpetacompartida con permisos y crear un archivo desde Android comprobandoque todo vaya bien.7. Debian y AndroidQuizás la forma más fácil de compartir archivos entre Android y Linux de forma inalámbrica sea descargando una aplicación FTP en un dispositivo Android. Ya que nos permite alojar rápidamente un servidor FTP improvisado en nuestro dispositivo Android, que luego puede aceptarconexiones remotas de forma inalámbrica.Antes de que podamos hablar sobre la configuración del servidor, deberáinstalar la aplicación WiFi FTP Server en su dispositivo Android. Parahacer esto, abra la aplicación Google Play Store en Android, busque“Servidor FTP WiFi” e instálalo.Después de estado tendremos que instalar Filezilla en Debian con elsiguiente comando:apt install FilezillaDentro de la aplicación de Android crearemos un servidor con la ubicación de donde queremos crear los archivos.Una vez creamos el servidor dentro de Filezilla ponemos los datos que nos da la aplicación para crear una conexión directa entre ambos dispositivos.Seguidamente le damos a “Subir” en el archivo o carpeta que queramoscompartir y así respectivamente con cualquier cosa que queramoscompartir entre ambos dispositivos."
  }
  
]

