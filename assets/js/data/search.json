[
  
  {
    "title": "Configuraci√≥n/activaci√≥n de SELinux",
    "url": "/posts/selinux/",
    "categories": "Sistemas, SELinux",
    "tags": "SELinux",
    "date": "2025-01-29 20:00:00 +0100",
    





    
    "snippet": "Hoy nos adentramos en la configuraci√≥n de un servidor basado en Rocky Linux con SELinux activado en modo enforcing. Nuestro objetivo es asegurar que los servicios SSHFS, Samba y NFS funcionen corre...",
    "content": "Hoy nos adentramos en la configuraci√≥n de un servidor basado en Rocky Linux con SELinux activado en modo enforcing. Nuestro objetivo es asegurar que los servicios SSHFS, Samba y NFS funcionen correctamente bajo una configuraci√≥n estricta y segura de SELinux. Adem√°s, habilitaremos el inicio de sesi√≥n remoto como root y cambiaremos el puerto de acceso SSH por uno no habitual.Preparaci√≥n del entornoAntes de empezar, verificamos el estado de SELinux para asegurarnos de que est√° activado y en modo enforcing:[rocky@rocky ~]$ sestatus SELinux status:                 enabledSELinuxfs mount:                /sys/fs/selinuxSELinux root directory:         /etc/selinuxLoaded policy name:             targetedCurrent mode:                   enforcingMode from config file:          enforcingPolicy MLS status:              enabledPolicy deny_unknown status:     allowedMemory protection checking:     actual (secure)Max kernel policy version:      33Perfecto, SELinux est√° activado y en modo enforcing. Ahora actualizamos el sistema e instalamos los paquetes necesarios:[rocky@rocky ~]$ sudo dnf update -y[rocky@rocky ~]$ sudo dnf install samba samba-common samba-client nfs-utils -ySSHFSSAMBASamba es un servicio cr√≠tico para compartir archivos en redes mixtas (Linux/Windows). Vamos a configurarlo paso a paso.En primer lugar realizamos una copia de ‚Äúseguridad‚Äù del archivo de configuraci√≥n por si acaso necesitamos volver a ella:[rocky@rocky ~]$ sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backupCreamos el directorio compartido con los permisos necesarios:[rocky@rocky ~]$ sudo mkdir -p /mnt/samba/share[rocky@rocky ~]$ sudo chmod -R 0755 /mnt/samba/share/[rocky@rocky ~]$ sudo chown -R rocky:rocky /mnt/samba/share/[rocky@rocky ~]$ sudo chcon -t samba_share_t /mnt/samba/share/Aqu√≠, chcon cambia el contexto de seguridad de SELinux para que el directorio sea accesible por Samba.Editamos /etc/samba/smb.conf y a√±adimos la siguiente secci√≥n:[Anonymous]path = /mnt/samba/sharebrowsable = yeswritable = yesguest ok = yesread only = novalid users = rockyY para realizar la comprobaci√≥n de que la configuraci√≥n es correcta ejecutamos el siguiente comando:[rocky@rocky ~]$ testparmLoad smb config files from /etc/samba/smb.confLoaded services file OK.Weak crypto is allowed by GnuTLS (e.g. NTLM as a compatibility fallback)Server role: ROLE_STANDALONEPress enter to see a dump of your service definitions# Global parameters[global]\tprintcap name = cups\tsecurity = USER\tworkgroup = SAMBA\tidmap config * : backend = tdb\tcups options = raw[homes]\tbrowseable = No\tcomment = Home Directories\tinherit acls = Yes\tread only = No\tvalid users = %S %D%w%S[printers]\tbrowseable = No\tcomment = All Printers\tcreate mask = 0600\tpath = /var/tmp\tprintable = Yes[print$]\tcomment = Printer Drivers\tcreate mask = 0664\tdirectory mask = 0775\tforce group = @printadmin\tpath = /var/lib/samba/drivers\twrite list = @printadmin root[Anonymous]\tguest ok = Yes\tpath = /mnt/samba/share\tread only = No\tvalid users = rocky[rocky@rocky ~]$ sudo firewall-cmd ‚Äìadd-service=samba ‚Äìzone=public ‚Äìpermanentsuccess[rocky@rocky ~]$ sudo firewall-cmd ‚Äìreloadsuccess[rocky@rocky ~]$ sudo systemctl start smb[rocky@rocky ~]$ sudo systemctl enable smbCreated symlink /etc/systemd/system/multi-user.target.wants/smb.service ‚Üí /usr/lib/systemd/system/smb.service.[rocky@rocky ~]$ sudo systemctl start nmb[rocky@rocky ~]$ sudo systemctl enable nmbCreated symlink /etc/systemd/system/multi-user.target.wants/nmb.service ‚Üí /usr/lib/systemd/system/nmb.service.[rocky@rocky ~]$ sudo smbpasswd -a rockyNew SMB password:Retype new SMB password:Added user rocky.[rocky@cliente-rocky ~]$ sudo dnf install samba-client -y[rocky@cliente-rocky ~]$ smbclient ‚Äìuser=rocky -L //10.0.0.175Password for [SAMBA\\rocky]:Sharename       Type      Comment---------       ----      -------print$          Disk      Printer DriversAnonymous       Disk      IPC$            IPC       IPC Service (Samba 4.20.2)rocky           Disk      Home Directories SMB1 disabled -- no workgroup available[rocky@cliente-rocky ~]$ sudo mount -t cifs -o username=rocky,password=messi,rw,vers=2.1,file_mode=0777,dir_mode=0777 //10.0.0.175/Anonymous /home/rocky/montaje/[rocky@cliente-rocky ~]$ df -hFilesystem              Size  Used Avail Use% Mounted ondevtmpfs                4.0M     0  4.0M   0% /devtmpfs                   385M     0  385M   0% /dev/shmtmpfs                   154M  532K  154M   1% /run/dev/vda4               8.9G  1.1G  7.8G  13% //dev/vda3               936M  257M  680M  28% /boot/dev/vda2               100M  7.0M   93M   8% /boot/efitmpfs                    77M     0   77M   0% /run/user/100010.0.0.175:/mnt/nfs/kk  8.9G  1.3G  7.7G  14% /mnt/nfs//10.0.0.175/Anonymous  8.9G  1.3G  7.7G  14% /home/rocky/montajeNFS[rocky@rocky ~]$ sudo systemctl start nfs-server.service[rocky@rocky ~]$ sudo systemctl enable nfs-server.serviceCreated symlink /etc/systemd/system/multi-user.target.wants/nfs-server.service ‚Üí /usr/lib/systemd/system/nfs-server.service.[rocky@rocky ~]$ sudo mkdir -p /mnt/nfs/kk[rocky@rocky ~]$ sudo nano /etc/exports[rocky@rocky ~]$ cat /etc/exports/mnt/nfs/kk  10.0.0.0/24(rw,sync,no_all_squash,no_root_squash)[rocky@rocky ~]$ sudo exportfs -arvexporting 10.0.0.0/24:/mnt/nfs/kk[rocky@rocky ~]$ sudo exportfs -s/mnt/nfs/kk  10.0.0.0/24(sync,wdelay,hide,no_subtree_check,sec=sys,rw,secure,no_root_squash,no_all_squash)[rocky@rocky ~]$ sudo dnf install firewalld -y[rocky@rocky ~]$ sudo systemctl start firewalld[rocky@rocky ~]$ sudo systemctl enable firewalld[rocky@rocky ~]$ sudo systemctl status firewalld‚óè firewalld.service - firewalld - dynamic firewall daemon     Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; preset: enabled)     Active: active (running) since Thu 2025-02-06 19:26:09 UTC; 6s ago       Docs: man:firewalld(1)   Main PID: 34890 (firewalld)      Tasks: 2 (limit: 4450)     Memory: 26.7M        CPU: 471ms     CGroup: /system.slice/firewalld.service             ‚îî‚îÄ34890 /usr/bin/python3 -s /usr/sbin/firewalld ‚Äìnofork ‚ÄìnopidFeb 06 19:26:09 rocky.novalocal systemd[1]: Starting firewalld - dynamic firewall daemon‚Ä¶Feb 06 19:26:09 rocky.novalocal systemd[1]: Started firewalld - dynamic firewall daemon.[rocky@rocky ~]$ sudo firewall-cmd ‚Äìpermanent ‚Äìadd-service=nfssuccess[rocky@rocky ~]$ sudo firewall-cmd ‚Äìpermanent ‚Äìadd-service=rpc-bindsuccess[rocky@rocky ~]$ sudo firewall-cmd ‚Äìpermanent ‚Äìadd-service=mountdsuccess[rocky@rocky ~]$ sudo firewall-cmd ‚Äìreloadsuccess[rocky@cliente-rocky ~]$ sudo dnf install nfs-utils nfs4-acl-tools[rocky@cliente-rocky ~]$ showmount -e 10.0.0.175Export list for 10.0.0.175:/mnt/nfs/kk 10.0.0.0/24[rocky@rocky ~]$ echo ‚ÄòHola desde el servidor‚Äô | sudo tee /mnt/nfs/kk/hola.txtHola desde el servidor[rocky@rocky ~]$ ls -l /mnt/nfs/kk/hola.txt -rw-r‚Äìr‚Äì. 1 root root 22 Feb  6 19:37 /mnt/nfs/kk/hola.txt[rocky@cliente-rocky ~]$ ls -l /mnt/nfs/hola.txt -rw-r‚Äìr‚Äì. 1 root root 22 Feb  6 19:37 /mnt/nfs/hola.txt[rocky@cliente-rocky ~]$ ls -l /mnt/nfs/hola.txt -rw-r‚Äìr‚Äì. 1 root root 22 Feb  6 19:37 /mnt/nfs/hola.txt[rocky@cliente-rocky ~]$ df -hFilesystem              Size  Used Avail Use% Mounted ondevtmpfs                4.0M     0  4.0M   0% /devtmpfs                   385M     0  385M   0% /dev/shmtmpfs                   154M  532K  154M   1% /run/dev/vda4               8.9G  1.1G  7.9G  12% //dev/vda3               936M  257M  680M  28% /boot/dev/vda2               100M  7.0M   93M   8% /boot/efitmpfs                    77M     0   77M   0% /run/user/100010.0.0.175:/mnt/nfs/kk  8.9G  1.3G  7.7G  14% /mnt/nfs[rocky@rocky ~]$ echo ‚ÄòHola desde el servidor‚Äô | sudo tee /mnt/samba/share/hola.txtHola desde el servidor[rocky@cliente-rocky ~]$ ls -l montaje/total 4-rwxrwxrwx. 1 root root 23 Feb  6 20:16 hola.txt[rocky@cliente-rocky ~]$ cat montaje/hola.txt Hola desde el servidor"
  },
  
  {
    "title": "VPN sitio a sitio con WireGuard",
    "url": "/posts/site_to_site_wireguard/",
    "categories": "Seguridad, VPN",
    "tags": "VPN",
    "date": "2025-01-29 20:00:00 +0100",
    





    
    "snippet": "EscenarioPara la realizaci√≥n de esta pr√°ctica reutilizar√© el escenario creado en el ejercicio B, solo que esta vez haciendo uso de WireGuard.Configuraci√≥n ServidorCasaComenzamos actualizando el sis...",
    "content": "EscenarioPara la realizaci√≥n de esta pr√°ctica reutilizar√© el escenario creado en el ejercicio B, solo que esta vez haciendo uso de WireGuard.Configuraci√≥n ServidorCasaComenzamos actualizando el sistema e instalando WireGuard:debian@ServidorCasa:~$ sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt install wireguard -yActivamos el bit de forwarding que nos permitir√° dejar pasar los paquetes a trav√©s de las m√°quinas para as√≠ permitir la conexi√≥n entre los dos clientes.debian@ServidorCasa:~$ sudo sysctl -pnet.ipv4.ip_forward = 1Nos hemos movido al directorio de WireGuard y generado las claves:debian@ServidorCasa:~$ sudo suroot@ServidorCasa:/home/debian# cd /etc/wireguard/root@ServidorCasa:/etc/wireguard# wg genkey | tee clave_priv_servidor | wg pubkey &gt; clave_pub_servidorVerificamos la creaci√≥n de las claves:root@ServidorCasa:/etc/wireguard# ls -ltotal 8-rw-r--r-- 1 root root 45 Jan 29 18:37 clave_priv_servidor-rw-r--r-- 1 root root 45 Jan 29 18:37 clave_pub_servidorVemos las claves generadas:root@ServidorCasa:/etc/wireguard# cat clave_priv_servidor KCsoaA/EFnFZTHPvy+LLwhS7pzOi8ZZ7XnOWsVFR60E=root@ServidorCasa:/etc/wireguard# cat clave_pub_servidor Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=Ahora pasamos a la configuraci√≥n inicial del t√∫nel:root@ServidorCasa:/etc/wireguard# cat wg0.conf [Interface]Address = 10.99.99.1PrivateKey = KCsoaA/EFnFZTHPvy+LLwhS7pzOi8ZZ7XnOWsVFR60E=ListenPort = 51820Donde:  Address: Define la direcci√≥n IP del t√∫nel.  PrivateKey: Clave privada del mismo Servidor que sirve para descifrar el tr√°fico entrante.  ListenPort: Puerto UDP para conexiones WireGuard.Despu√©s de crear el archivo de configuraci√≥n, levantamos la interfaz del t√∫nel:root@ServidorCasa:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[  567.662716] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[  567.663520] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0Y comprobamos que funciones:root@ServidorCasa:/etc/wireguard# wginterface: wg0  public key: Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=  private key: (hidden)  listening port: 51820ServidorInstiSeguimos los mismos pasos de actualizaci√≥n e instalaci√≥n:debian@ServidorInsti:~$ sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt install wireguard -yHabilitamos el bit de forwarding:debian@ServidorInsti:~$ sudo sysctl -pnet.ipv4.ip_forward = 1Generamos las claves, tanto privada como p√∫blica:debian@ServidorInsti:~$ sudo suroot@ServidorInsti:/home/debian# cd /etc/wireguard/root@ServidorInsti:/etc/wireguard# wg genkey | tee clave_priv_servidor | wg pubkey &gt; clave_pub_servidorComprobamos que se hayan creado:root@ServidorInsti:/etc/wireguard# ls -ltotal 8-rw-r--r-- 1 root root 45 Jan 29 18:43 clave_priv_servidor-rw-r--r-- 1 root root 45 Jan 29 18:43 clave_pub_servidorY vemos su contenido:root@ServidorInsti:/etc/wireguard# cat clave_priv_servidor kBOZ9Y2KQov8MG1abu/GlPAV1zVf+BroKJ0Y11+B+1U=root@ServidorInsti:/etc/wireguard# cat clave_pub_servidor /XRNDwaFmadC4eCe+KtjoxPg4q9nJZnBCVZymBqJBXE=Creamos el fichero de configuraci√≥n wg0.conf:root@ServidorInsti:/etc/wireguard# cat wg0.conf [Interface]Address = 10.99.99.2PrivateKey = kBOZ9Y2KQov8MG1abu/GlPAV1zVf+BroKJ0Y11+B+1U=ListenPort = 51820[Peer]PublicKey = Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=AllowedIPs = 10.99.99.1/32, 192.168.1.0/24Endpoint = 10.10.10.33:51820Donde:  PublicKey: Clave p√∫blica del ServidorCasa  AllowedIPs:          10.99.99.1/32: IP del t√∫nel del peer      192.168.1.0/24: Red remota accesible        Endpoint: Direcci√≥n IP y puerto del ServidorCasaSeguidamente levantamos la interfaz del t√∫nel:root@ServidorInsti:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[ 1183.306337] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[ 1183.307164] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.2 dev wg0[#] ip link set mtu 1420 up dev wg0[#] ip -4 route add 10.99.99.1/32 dev wg0[#] ip -4 route add 192.168.1.0/24 dev wg0Y compobamos:root@ServidorInsti:/etc/wireguard# wginterface: wg0  public key: /XRNDwaFmadC4eCe+KtjoxPg4q9nJZnBCVZymBqJBXE=  private key: (hidden)  listening port: 51820peer: Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=  endpoint: 10.10.10.33:51820  allowed ips: 10.99.99.1/32, 192.168.1.0/24Tambi√©n podemos ver que se ha a√±adido la interfaz del t√∫nel correctamente:root@ServidorInsti:/etc/wireguard# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:a7:2a:ff:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 10.10.10.44/24 brd 10.10.10.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::ea7:2aff:feff:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:a7:2a:ff:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 172.22.0.1/24 brd 172.22.0.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::ea7:2aff:feff:1/64 scope link        valid_lft forever preferred_lft forever4: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000    link/none     inet 10.99.99.2/32 scope global wg0       valid_lft forever preferred_lft foreverUna vez terminado en ServidorInsti debemos volver al fichero de configuraci√≥n del t√∫nel de ServidorCasaroot@ServidorCasa:/etc/wireguard# cat wg0.conf [Interface]Address = 10.99.99.1PrivateKey = KCsoaA/EFnFZTHPvy+LLwhS7pzOi8ZZ7XnOWsVFR60E=ListenPort = 51820[Peer]PublicKey = /XRNDwaFmadC4eCe+KtjoxPg4q9nJZnBCVZymBqJBXE=AllowedIPs = 10.99.99.2/32, 172.22.0.0/24Endpoint = 10.10.10.44:51820En donde hemos a√±adido los par√°metros necesarios para la conectividad con el otro servidor.De forma que reiniciamos:root@ServidorCasa:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0[#] ip -4 route add 10.99.99.2/32 dev wg0[#] ip -4 route add 172.22.0.0/24 dev wg0Comprobamos de nuevo:root@ServidorCasa:/etc/wireguard# wginterface: wg0  public key: Rateb4vQZBBr1mTkUcAECpcIPEuHWbMnJA5FWRYrpBA=  private key: (hidden)  listening port: 51820peer: /XRNDwaFmadC4eCe+KtjoxPg4q9nJZnBCVZymBqJBXE=  endpoint: 10.10.10.44:51820  allowed ips: 10.99.99.2/32, 172.22.0.0/24Y nos damos cuenta que se ha a√±adido la interfaz del t√∫nel:root@ServidorCasa:/etc/wireguard# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:aa:df:00:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::eaa:dfff:fe00:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:aa:df:00:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 10.10.10.33/24 brd 10.10.10.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::eaa:dfff:fe00:1/64 scope link        valid_lft forever preferred_lft forever5: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000    link/none     inet 10.99.99.1/32 scope global wg0       valid_lft forever preferred_lft foreverPruebas de funcionamientoPara verificar que la VPN est√° funcionando correctamente y que los paquetes est√°n siendo enrutados entre ambas redes, realizamos pruebas de traceroute desde ClienteCasa hacia ClienteInsti y al rev√©s.De ClienteCasa a ClienteInsti:debian@ClienteCasa:~$ ping -c 2 172.22.0.2PING 172.22.0.2 (172.22.0.2) 56(84) bytes of data.64 bytes from 172.22.0.2: icmp_seq=1 ttl=62 time=6.40 ms64 bytes from 172.22.0.2: icmp_seq=2 ttl=62 time=4.77 ms--- 172.22.0.2 ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 4.770/5.584/6.399/0.814 msdebian@ClienteCasa:~$ traceroute 172.22.0.2traceroute to 172.22.0.2 (172.22.0.2), 30 hops max, 60 byte packets 1  _gateway (192.168.1.1)  1.157 ms  1.100 ms  1.085 ms 2  10.99.99.2 (10.99.99.2)  2.813 ms  2.817 ms  2.803 ms 3  172.22.0.2 (172.22.0.2)  4.195 ms  4.183 ms  4.171 msDe ClienteInsti a ClienteCasa:debian@ClienteInsti:~$ ping -c 2 192.168.1.2PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data.64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=1.27 ms64 bytes from 192.168.1.2: icmp_seq=2 ttl=62 time=4.47 ms--- 192.168.1.2 ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 1.274/2.873/4.472/1.599 msdebian@ClienteInsti:~$ traceroute 192.168.1.2traceroute to 192.168.1.2 (192.168.1.2), 30 hops max, 60 byte packets 1  _gateway (172.22.0.1)  0.325 ms  0.300 ms  0.295 ms 2  10.99.99.1 (10.99.99.1)  0.713 ms  0.700 ms  0.697 ms 3  192.168.1.2 (192.168.1.2)  1.264 ms  1.260 ms  1.255 msConclusi√≥nAl igual que dije en el apartado anterior, definitivamente WireGuard me parece mucho m√°s c√≥modo y f√°cil de usar. Adem√°s, es m√°s r√°pido ya que no tienes que tratar con certificados, tan solo con el intercambio de claves para que funcione el t√∫nel."
  },
  
  {
    "title": "VPN de acceso remoto con WireGuard",
    "url": "/posts/acceso_remoto_wireguard/",
    "categories": "Seguridad, VPN",
    "tags": "VPN",
    "date": "2025-01-27 21:00:00 +0100",
    





    
    "snippet": "El objetivo de esta pr√°ctica es configurar una red privada virtual (VPN) de acceso remoto mediante la implementaci√≥n de WireGuard en un entorno simulado con GNS3. Esta pr√°ctica tiene como fin propo...",
    "content": "El objetivo de esta pr√°ctica es configurar una red privada virtual (VPN) de acceso remoto mediante la implementaci√≥n de WireGuard en un entorno simulado con GNS3. Esta pr√°ctica tiene como fin proporcionar una soluci√≥n de conectividad segura y eficiente, permitiendo la comunicaci√≥n remota y cifrada entre los clientes y el servidor VPN.EscenarioEl escenario consta de lo siguiente:  Dispositivos Cliente:  Cliente-Windows (172.22.0.2/24)  Cliente-Android (172.22.0.3/24)  Cliente-Linux (172.22.0.4/24)      Un Servidor que dispone de dos redes diferentes, la que conecta con los clientes (172.22.0.1/24) y la que conecta con el PC-Local (192.168.1.1/24).        Un PC-Local (192.168.1.2/24)        Cuatro nubes NAT (NAT1, NAT2, NAT3 y NAT4) que proporcionan traducci√≥n de direcciones de red        Un Switch central que interconecta todos los clientes con el servidor  La topolog√≠a est√° organizada de la siguiente manera:  Los tres clientes (Windows, Android y Linux) se conectan al Switch1 a trav√©s de diferentes puertos (e0, e1, e2)  Cada cliente tiene su propia nube NAT conectada a trav√©s de interfaces nat0  El servidor est√° conectado al Switch1 a trav√©s del puerto e3  El servidor tambi√©n tiene una conexi√≥n directa a la PC local a trav√©s de una red separada (192.168.1.0/24)  Hay una cuarta nube NAT (NAT4) conectada directamente al servidorPodemos verlo en imagen:IMPORTANTE ‚ö†Ô∏èEl cliente Android, como se ve en la imagen, est√° conectado a dos interfaces de red. Sin embargo, esto no significa que pueda usarlas simult√°neamente, ya que Android no permite tener activas dos conexiones de red al mismo tiempo cuando una de ellas no es Wi-Fi.Inicialmente, utilizaremos la red proporcionada por la nube NAT para descargar e instalar las aplicaciones necesarias. Sin embargo, cuando llegue el momento de realizar las pruebas de conectividad con la VPN, ser√° necesario cambiar manualmente a la interfaz que tiene la direcci√≥n 172.22.0.3/24, ya que es la que permite la comunicaci√≥n con el servidor y el resto de la red en el escenario de GNS3.Configuraci√≥n del ServidorPrimero, actualizamos los paquetes de nuestro sistema e instalamos WireGuard con los siguientes comandos:debian@Servidor:~$ sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt install wireguard -yPara que los dispositivos conectados a la VPN puedan comunicarse con otras redes, debemos habilitar el reenv√≠o de paquetes en el kernel. Para que sea persistente, lo agregamos en el archivo /etc/sysctl.conf:debian@Servidor:~$ sudo sysctl -pnet.ipv4.ip_forward = 1WireGuard utiliza criptograf√≠a de clave p√∫blica-privada para la autenticaci√≥n entre los pares. Cada nodo de la VPN necesita generar su propio par de claves.Nos dirigimos al directorio de configuraci√≥n de WireGuard:debian@Servidor:~$ sudo suroot@Servidor:/home/debian# cd /etc/wireguard/Generamos la clave privada y la almacenamos en un archivo llamado clave_priv_servidor. Simult√°neamente, generamos la clave p√∫blica derivada de la privada y la almacenamos en clave_pub_servidor:root@Servidor:/etc/wireguard# wg genkey | tee clave_priv_servidor | wg pubkey &gt; clave_pub_servidorVerificamos que los archivos se han generado correctamente:root@Servidor:/etc/wireguard# ls -ltotal 8-rw-r--r-- 1 root root 45 Jan 28 22:13 clave_priv_servidor-rw-r--r-- 1 root root 45 Jan 28 22:13 clave_pub_servidorMostramos el contenido de las claves para asegurarnos de que est√°n bien creadas:root@Servidor:/etc/wireguard# cat clave_priv_servidor oOWo8ekqChcY31za9QsNHu75NqioypbFqZgFcTc9WEQ=root@Servidor:/etc/wireguard# cat clave_pub_servidor 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=La clave privada nunca debe ser compartida, ya que es la que permite el acceso seguro al servidor.WireGuard utiliza archivos de configuraci√≥n en formato INI para definir la interfaz de red VPN y sus par√°metros.Creamos el archivo de configuraci√≥n con:nano /etc/wireguard/wg0.confA√±adimos el siguiente contenido:root@Servidor:/etc/wireguard# cat wg0.conf [Interface]# Direcci√≥n IP que tendr√° el servidor dentro de la VPNAddress = 10.99.99.1# Clave privada generada anteriormentePrivateKey = oOWo8ekqChcY31za9QsNHu75NqioypbFqZgFcTc9WEQ=# Puerto de escucha del servidor (por defecto WireGuard usa el 51820)ListenPort = 51820Este archivo define la interfaz wg0, que ser√° utilizada por WireGuard para la comunicaci√≥n VPN.Para levantar la VPN, utilizamos el comando wg-quick:root@Servidor:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[ 9304.006929] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[ 9304.007862] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0Para verificar el estado de la interfaz WireGuard y confirmar que est√° activa, usamos:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820Esto indica que la interfaz wg0 est√° en funcionamiento, tiene la clave p√∫blica correcta y est√° escuchando en el puerto 51820.Vamos a listar todas las interfaces de red disponibles, donde deber√≠amos ver algo similar a esto:root@Servidor:/etc/wireguard# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:40:52:9a:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::e40:52ff:fe9a:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:40:52:9a:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 172.22.0.1/24 brd 172.22.0.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::e40:52ff:fe9a:1/64 scope link        valid_lft forever preferred_lft forever4: ens6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:40:52:9a:00:02 brd ff:ff:ff:ff:ff:ff    altname enp0s6    inet 192.168.122.51/24 brd 192.168.122.255 scope global dynamic ens6       valid_lft 2744sec preferred_lft 2744sec    inet6 fe80::e40:52ff:fe9a:2/64 scope link        valid_lft forever preferred_lft forever5: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000    link/none     inet 10.99.99.1/32 scope global wg0       valid_lft forever preferred_lft foreverAqu√≠ podemos confirmar que la interfaz wg0 est√° activa y que tiene asignada la direcci√≥n 10.99.99.1/32, la cual servir√° como puerta de enlace VPN.Configuraci√≥n del Cliente-LinuxPara configurar el cliente Linux en nuestra VPN con WireGuard, primero aseguramos que el sistema est√© actualizado e instalamos el paquete necesario. Ejecutamos:debian@Cliente-Linux:~$ sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt install wireguard -yLuego, cambiamos al usuario root y nos desplazamos al directorio de configuraci√≥n de WireGuard:debian@Cliente-Linux:~$ sudo suroot@Cliente-Linux:/home/debian# cd /etc/wireguard/Generamos la clave privada del cliente y a partir de ella obtenemos la clave p√∫blica:root@Cliente-Linux:/etc/wireguard# wg genkey | tee clave_priv_cliente | wg pubkey &gt; clave_pub_clienteVerificamos que los archivos de claves se han generado correctamente:root@Cliente-Linux:/etc/wireguard# ls -ltotal 8-rw-r--r-- 1 root root 45 Jan 28 22:33 clave_priv_cliente-rw-r--r-- 1 root root 45 Jan 28 22:33 clave_pub_clienteConsultamos el contenido de las claves para asegurarnos de que se han creado correctamente:root@Cliente-Linux:/etc/wireguard# cat clave_priv_cliente  kKnEefJbY6wvEwS0Gkj9nPKUDyol6VnguYik11U4AkQ=root@Cliente-Linux:/etc/wireguard# cat clave_pub_cliente F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=A continuaci√≥n, creamos el archivo de configuraci√≥n wg0.conf con los siguientes par√°metros:root@Cliente-Linux:/etc/wireguard# cat wg0.conf[Interface]# IP que tomar√° el cliente en el t√∫nelAddress = 10.99.99.2/24 # Clave privada del clientePrivateKey = kKnEefJbY6wvEwS0Gkj9nPKUDyol6VnguYik11U4AkQ=# Puerto escucha y por defecto de WireguardListenPort = 51820[Peer]# Clave p√∫blica del servidorPublicKey = 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=# Rango de direcciones permitidas en el t√∫nel.AllowedIPs = 0.0.0.0/0#Punto de acceso del servidorEndpoint = 172.22.0.1:51820#Tiempo de espera de la conexi√≥nPersistentKeepalive = 25Levantamos la interfaz de WireGuard con:root@Cliente-Linux:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[ 2154.668085] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[ 2154.670429] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.2/24 dev wg0[#] ip link set mtu 1420 up dev wg0[#] wg set wg0 fwmark 51820[#] ip -4 route add 0.0.0.0/0 dev wg0 table 51820[#] ip -4 rule add not fwmark 51820 table 51820[#] ip -4 rule add table main suppress_prefixlength 0[#] sysctl -q net.ipv4.conf.all.src_valid_mark=1[#] iptables-restore -nSi todo funciona correctamente, deber√≠amos ver mensajes indicando que la interfaz se ha creado y configurado con √©xito. Podemos verificar el estado de la conexi√≥n ejecutando:root@Cliente-Linux:/etc/wireguard# wginterface: wg0  public key: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  private key: (hidden)  listening port: 51820  fwmark: 0xca6cpeer: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  endpoint: 172.22.0.1:51820  allowed ips: 0.0.0.0/0  transfer: 0 B received, 296 B sent  persistent keepalive: every 25 secondsY confirmamos que la interfaz wg0 ha sido a√±adida correctamente al sistema:root@Cliente-Linux:/etc/wireguard# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:89:3b:46:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 172.22.0.4/24 brd 172.22.0.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::e89:3bff:fe46:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:89:3b:46:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 192.168.122.208/24 brd 192.168.122.255 scope global dynamic ens5       valid_lft 1416sec preferred_lft 1416sec    inet6 fe80::e89:3bff:fe46:1/64 scope link        valid_lft forever preferred_lft forever4: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000    link/none     inet 10.99.99.2/24 scope global wg0       valid_lft forever preferred_lft foreverAhora volvemos al servidor para a√±adir la configuraci√≥n del cliente. En el archivo wg0.conf del servidor agregamos la informaci√≥n correspondiente al cliente:root@Servidor:/etc/wireguard# cat wg0.conf # SERVIDOR[Interface]# Aqu√≠ ponemos la IP virtual que tomar√° el t√∫nelAddress = 10.99.99.1# Clave privada del servidor creada hace momentosPrivateKey = oOWo8ekqChcY31za9QsNHu75NqioypbFqZgFcTc9WEQ=# Puerto escucha y por defecto de WireguardListenPort = 51820# CLIENTE[Peer]# Clave p√∫blica del clientePublickey = F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=# IP t√∫nel del clienteAllowedIPs = 10.99.99.2/32#Tiempo de espera de respuestaPersistentKeepAlive = 25Para aplicar los cambios, reiniciamos la interfaz en el servidor:root@Servidor:/etc/wireguard# wg-quick down wg0[#] ip link delete dev wg0root@Servidor:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0[#] ip -4 route add 10.99.99.2/32 dev wg0Verificamos el estado de la VPN en el servidor con:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820peer: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  allowed ips: 10.99.99.2/32  persistent keepalive: every 25 secondsComprobaci√≥n funcionamientoPara comprobar la conexi√≥n desde el cliente, utilizamos traceroute para ver si el tr√°fico se est√° enviando correctamente a trav√©s del t√∫nel VPN:Si todo est√° configurado correctamente, veremos que los paquetes viajan por la interfaz wg0, confirmando que la VPN est√° funcionando de manera √≥ptima.Configuraci√≥n Cliente-WindowsPara configurar WireGuard en un cliente Windows, comenzamos descargando e instalando el cliente oficial desde su p√°gina de descargas.Una vez completada la instalaci√≥n, ejecutamos la aplicaci√≥n y procedemos a agregar un nuevo t√∫nel vac√≠o. Esto nos permitir√° definir manualmente la configuraci√≥n de nuestra conexi√≥n VPN:Al crear el t√∫nel, editamos el archivo de configuraci√≥n con los siguientes par√°metros:[Interface]PrivateKey = wHLqf5MSCuBHQ+Gi0kBFCjqIYZVlQC540JtAywT4K04=ListenPort = 51820Address = 10.99.99.3/32[Peer]PublicKey = 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=AllowedIPs = 0.0.0.0/1EndPoint = 172.22.0.1:51820Analizando esta configuraci√≥n, observamos que en la secci√≥n [Interface] se especifica la clave privada del cliente, el puerto en el que escuchar√° y la direcci√≥n IP asignada dentro de la VPN. En la secci√≥n [Peer], se define el servidor al que nos conectaremos, incluyendo su clave p√∫blica, las IPs permitidas en la VPN y la direcci√≥n del endpoint, que corresponde al servidor WireGuard.Despu√©s de guardar la configuraci√≥n, activamos el t√∫nel y verificamos que la conexi√≥n se haya establecido correctamente mediante el handshake:Tambi√©n podemos observar que se ha creado una nueva interfaz de red asociada a WireGuard:A continuaci√≥n, nos dirigimos al servidor y a√±adimos la informaci√≥n del nuevo cliente Windows en su archivo de configuraci√≥n (/etc/wireguard/wg0.conf):root@Servidor:/etc/wireguard# cat wg0.conf # SERVIDOR[Interface]# Aqu√≠ ponemos la IP virtual que tomar√° el t√∫nelAddress = 10.99.99.1# Clave privada del servidor creada hace momentosPrivateKey = oOWo8ekqChcY31za9QsNHu75NqioypbFqZgFcTc9WEQ=# Puerto escucha y por defecto de WireguardListenPort = 51820# CLIENTE LINUX[Peer]# Clave p√∫blica del clientePublickey = F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=# IP t√∫nel del clienteAllowedIPs = 10.99.99.2/32#Tiempo de espera de respuestaPersistentKeepAlive = 25# CLIENTE WINDOWS[Peer]Publickey = Gw9vvlbUvr/Q2t2poFA1R53Y9mYlP718EKPCaWvsTns=AllowedIPs = 10.99.99.3/32PersistentKeepAlive = 25Para aplicar los cambios, reiniciamos la interfaz de WireGuard en el servidor:root@Servidor:/etc/wireguard# wg-quick up wg0[#] ip link add wg0 type wireguard[ 1439.522887] wireguard: WireGuard 1.0.0 loaded. See www.wireguard.com for information.[ 1439.524019] wireguard: Copyright (C) 2015-2019 Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;. All Rights Reserved.[#] wg setconf wg0 /dev/fd/63[#] ip -4 address add 10.99.99.1 dev wg0[#] ip link set mtu 1420 up dev wg0[#] ip -4 route add 10.99.99.3/32 dev wg0[#] ip -4 route add 10.99.99.2/32 dev wg0Si ejecutamos wg, podemos comprobar que ambos clientes (Linux y Windows) est√°n conectados correctamente, ya que se observa el handshake reciente y tr√°fico intercambiado con el servidor:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820peer: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  endpoint: 172.22.0.4:51820  allowed ips: 10.99.99.2/32  latest handshake: 26 seconds ago  transfer: 2.20 KiB received, 1.46 KiB sent  persistent keepalive: every 25 secondspeer: Gw9vvlbUvr/Q2t2poFA1R53Y9mYlP718EKPCaWvsTns=  endpoint: 172.22.0.2:51820  allowed ips: 10.99.99.3/32  latest handshake: 1 minute, 11 seconds ago  transfer: 61.41 KiB received, 632 B sent  persistent keepalive: every 25 secondsComprobaci√≥n funcionamientoPara finalizar, realizamos una prueba de conectividad ejecutando un traceroute desde el cliente Windows hacia el dispositivo que tenemos en la red local. Esto nos confirmar√° que el tr√°fico est√° siendo correctamente enrutado a trav√©s de la VPN.Y como podemos ver funciona correctamente. Este proceso garantiza que el cliente Windows pueda comunicarse con el servidor y con otros clientes conectados a la VPN de WireGuard, proporcionando una conexi√≥n segura y estable.Configuraci√≥n AndroidPara comenzar nuestra configuraci√≥n en Android, necesitaremos instalar dos aplicaciones fundamentales desde la Play Store. La primera es WireGuard, que nos permitir√° crear y gestionar nuestro t√∫nel VPN. La segunda es Termius, un vers√°til cliente SSH que adem√°s nos proporciona una terminal integrada, esta ser√° esencial para realizar nuestras pruebas de conectividad y verificar la correcta creaci√≥n del t√∫nel.Una vez que hayamos completado la instalaci√≥n de ambas aplicaciones, debemos proceder a configurar nuestra conexi√≥n Wi-Fi. En este caso, necesitaremos modificar la configuraci√≥n de red para utilizar la direcci√≥n IP 172.22.0.3/24. Para realizar este cambio, nos dirigiremos a los Ajustes de nuestro dispositivo, donde tendremos que a√±adir manualmente la configuraci√≥n:Con la red correctamente configurada, procedemos a crear nuestro t√∫nel VPN mediante la aplicaci√≥n WireGuard. La configuraci√≥n que utilizaremos sigue el mismo patr√≥n que hemos venido utilizando en nuestras configuraciones anteriores:Podemos observar que el handshake est√° funcionando correctamente, lo cual nos indica que el intercambio inicial de claves se ha realizado con √©xito.Para verificar la creaci√≥n del t√∫nel, abrimos nuestra terminal en Termius y ejecutamos el comando ip a. Este nos mostrar√° todas las interfaces de red, donde podremos confirmar la presencia de nuestro t√∫nel WireGuard:El siguiente paso nos lleva de vuelta a nuestro Servidor, donde necesitamos actualizar el archivo wg0.conf con los par√°metros correspondientes a nuestro cliente Android:# CLIENTE ANDROID[Peer]Publickey = YlKnopzZ1myt29MnP6rZ1WwMgLm1QVSOY+t0vyngtD8=AllowedIPs = 10.99.99.4/32PersistentKeepAlive = 25Tras a√±adir esta configuraci√≥n, debemos reiniciar la interfaz del t√∫nel para que los cambios surtan efecto. Podemos verificar el estado actual de nuestras conexiones mediante el comando wg:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820peer: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  endpoint: 172.22.0.4:51820  allowed ips: 10.99.99.2/32  latest handshake: 26 seconds ago  transfer: 2.20 KiB received, 1.46 KiB sent  persistent keepalive: every 25 secondspeer: Gw9vvlbUvr/Q2t2poFA1R53Y9mYlP718EKPCaWvsTns=  endpoint: 172.22.0.2:51820  allowed ips: 10.99.99.3/32  latest handshake: 1 minute, 11 seconds ago  transfer: 61.41 KiB received, 632 B sent  persistent keepalive: every 25 secondspeer: YlKnopzZ1myt29MnP6rZ1WwMgLm1QVSOY+t0vyngtD8=  allowed ips: 10.99.99.4/32  persistent keepalive: every 25 secondsComprobaci√≥n funcionamientoPara asegurarnos de que todo est√° funcionando correctamente, realizaremos una prueba de conectividad utilizando la terminal de Termius. Ejecutamos un traceroute para visualizar la ruta que siguen nuestros paquetes:Como podemos ver, el t√∫nel est√° funcionando a la perfecci√≥n.Para tener una visi√≥n completa del funcionamiento de nuestra red, podemos ver el estado del tr√°fico entre todos los clientes conectados:root@Servidor:/etc/wireguard# wginterface: wg0  public key: 7+qFaDTqy/WIHiPrucnpTdCJRNbqFvlANVQdwsmITCo=  private key: (hidden)  listening port: 51820peer: YlKnopzZ1myt29MnP6rZ1WwMgLm1QVSOY+t0vyngtD8=  endpoint: 172.22.0.3:51820  allowed ips: 10.99.99.4/32  latest handshake: 45 seconds ago  transfer: 3.62 KiB received, 8.24 KiB sent  persistent keepalive: every 25 secondspeer: Gw9vvlbUvr/Q2t2poFA1R53Y9mYlP718EKPCaWvsTns=  endpoint: 172.22.0.2:51820  allowed ips: 10.99.99.3/32  latest handshake: 1 minute, 15 seconds ago  transfer: 205.21 KiB received, 11.40 KiB sent  persistent keepalive: every 25 secondspeer: F/eZilIdeYh1iY2Fx6GHfVRlAM0AoVvBamiZ/Zbf+Aw=  endpoint: 172.22.0.4:51820  allowed ips: 10.99.99.2/32  latest handshake: 2 minutes, 8 seconds ago  transfer: 14.00 KiB received, 6.36 KiB sent  persistent keepalive: every 25 secondsConclusi√≥nSin ning√∫n tipo de duda me ha parecido mucho mejor y m√°s pr√°ctico esta forma de hacerlo con WireGuard que con OpenVPN. De la otra forma pienso que es m√°s lioso ya que tienes que estar creando y moviendo ficheros de certificado con lo que ello conlleva. Esta forma es mucho m√°s intuitiva y f√°cil de entender en mi opini√≥n."
  },
  
  {
    "title": "VPN sitio a sitio con OpenVPN y certificados x509",
    "url": "/posts/site_to_site_openvpn/",
    "categories": "Seguridad, VPN",
    "tags": "VPN",
    "date": "2025-01-26 18:00:00 +0100",
    





    
    "snippet": "Configura una conexi√≥n VPN sitio a sitio entre dos equipos del cloud:  Cada equipo estar√° conectado a dos redes, una de ellas en com√∫n          Para la autenticaci√≥n de los extremos se usar√°n oblig...",
    "content": "Configura una conexi√≥n VPN sitio a sitio entre dos equipos del cloud:  Cada equipo estar√° conectado a dos redes, una de ellas en com√∫n          Para la autenticaci√≥n de los extremos se usar√°n obligatoriamente certificados digitales, que se generar√°n utilizando openssl y se almacenar√°n en el directorio /etc/openvpn, junto con con los par√°metros Diffie-Helman y el certificado de la propia Autoridad de Certificaci√≥n.      Se utilizar√°n direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN.      Tras el establecimiento de la VPN, una m√°quina de cada red detr√°s de cada servidor VPN debe ser capaz de acceder a una m√°quina del otro extremo.      EscenarioComentar que antes de montar el escenario, conectamos una nube a las m√°quinas para que tengan acceso a Internet y as√≠ poder instalar openvpn.Ya instalado, el escenario tendr√° la siguiente forma:      ClienteCasa: interfaz ens4 con la direcci√≥n 192.168.1.2/24 conectada con la interfaz ens4 de ServidorCasa.        ServidorCasa: interfaz ens4 con la direcci√≥n 192.168.1.1/24 conectada con la interfaz ens4 de ClienteCasa. Por otro lado, la interfaz ens5 con la direcci√≥n 10.10.10.33/24 que conecta con la interfaz ens4 de ServidorInsti.        ServidorInsti: interfaz ens4 con la direcci√≥n 10.10.10.44/24 conectada con la interfaz ens5 de ServidorCasa. Por otro lado, la interfaz ens5 con la direcci√≥n 172.22.0.1/24 conectada con la interfaz ens4 de ClienteInsti.        ClienteInsti: interfaz ens4 con la direcci√≥n 172.22.0.2/24 conectada con la interfaz ens5 de ServidorInsti.  üîó Red de interconexi√≥n VPN: 10.99.99.0/24üñß Objetivo: Tras establecer la VPN, ClienteCasa podr√° comunicarse con ClienteInsti y viceversa.Antes de comenzar, cada m√°quina debe tener acceso a Internet para instalar OpenVPN:sudo apt update &amp;&amp; sudo apt install openvpn easy-rsa -yUna vez instalado estos dos paquetes en las m√°quinas que nos permitir√°n realizar la conexi√≥n VPN, tendremos que activar el bit de forwarding que nos permitir√° dejar pasar los paquetes a trav√©s de las m√°quinas (tanto la m√°quina ServidorCasa como la m√°quina ServidorInsti) para as√≠ permitir la conexi√≥n entre los dos clientes.debian@ServidorCasa:~$ sudo sysctl -pnet.ipv4.ip_forward = 1debian@ServidorInsti:~$ sudo sysctl -pnet.ipv4.ip_forward = 1Configuraci√≥n del ServidorCasaPara establecer la VPN con autenticaci√≥n basada en certificados, necesitamos generar:  Una Autoridad de Certificaci√≥n (CA), que firmar√° los certificados utilizados por los servidores y clientes de OpenVPN.  Un certificado y una clave privada para cada servidor (ServidorCasa y ServidorInsti).  Un conjunto de par√°metros Diffie-Hellman, necesarios para establecer un canal de comunicaci√≥n seguro.Para esto, utilizaremos Easy-RSA, una herramienta que facilita la generaci√≥n y administraci√≥n de certificados.En primer lugar, copiamos el archivo de configuraci√≥n base de Easy-RSA:debian@ServidorCasa:~$ sudo cp /usr/share/easy-rsa/vars.example /usr/share/easy-rsa/varsLuego, editamos el archivo vars para definir los valores predeterminados de los certificados, donde configuramos los siguientes par√°metros:debian@ServidorCasa:~$ sudo cat /usr/share/easy-rsa/varsset_var EASYRSA_REQ_COUNTRY     \"ES\"set_var EASYRSA_REQ_PROVINCE    \"Sevilla\"set_var EASYRSA_REQ_CITY        \"Dos Hermanas\"set_var EASYRSA_REQ_ORG         \"PabloMartin SL\"set_var EASYRSA_REQ_EMAIL       \"pmartinhidalgo19@gmail.com\"set_var EASYRSA_REQ_OU          \"Site to site OpenVPN\"Una vez guardados los cambios, inicializamos la infraestructura de claves p√∫blica (PKI):debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa init-pki* Notice:  init-pki complete; you may now create a CA or requests.  Your newly created PKI dir is:  * /usr/share/easy-rsa/pkiA continuaci√≥n, generamos los par√°metros Diffie-Hellman, que se utilizar√°n para establecer un canal seguro entre los servidores OpenVPN:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa gen-dhPara generar nuestra CA, ejecutamos:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa build-ca* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.13 30 Jan 2024 (Library: OpenSSL 3.0.13 30 Jan 2024)Enter New CA Key Passphrase: Re-Enter New CA Key Passphrase: Using configuration from /usr/share/easy-rsa/pki/be063ba2/temp.83878b4b.+......+......+..+.+.....+.+......+.....+...............+...+...............+........................+..........+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+...+...+.........+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+..+..........+..................+...+...+.....................+...............+.....+.+..+...+....+......+..............+.+...+.........+...........+.+......+..+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++...+.....+...+....+........+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+.+...+.....+.+..+.......+..+....+.....+......+...+...+...+............+.......+.....................+..+.......+.....+.+............+............+.....+.+......+.........+.....+...............+......+.+...+..............+.......+...+......+..+....+...........+.......+.....+.+...........+....+..+...+.........+...+.........+.+.....+...+....+...+.........+...+..+......+...+..........+.....+..........+.....+.......+..............+.+....................+..........+..+.......+...+......+..+....+........+.+.....+.+...+...+........+.......+..+.+...........+...+......+....+..+.+...............+............+...............+...+..+.+..+.............+......+.....+.+.................+......+....+...........+....+..+.+.....+....+...+........+...+.+...+.....+.+..+....+.....+.+...............+..+.+...........+.+.........+...........+...+......+.+.........+........+...+...+.........+.+......+...+..+.....................+.......+...+.....+.........+.+...+.....+....+......+..............+..........+...+........+....+...+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++Enter PEM pass phrase:Verifying - Enter PEM pass phrase:-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:pavlo* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtDurante este proceso, se nos pedir√° que introduzcamos un nombre com√∫n (Common Name) para la CA. Tambi√©n se nos solicitar√° una contrase√±a para proteger la clave de la CA.Ahora generamos la clave privada y la solicitud de certificado para el servidor OpenVPN en ServidorCasa:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa gen-req server* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.13 30 Jan 2024 (Library: OpenSSL 3.0.13 30 Jan 2024)....+.......+............+....................+...+...+.+......+..+.+..+.......+..+....+.....+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...........+.......+..+.+...+..+.........+...+..........+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+..+.............+...........+......+...+.+............+............+..+...+................+..+...+...................+.....+...+...+.+......+..+.+.....+.+..............+.+......+..+......+....+...+..+................+...........+.+...+......+...+...........+...............+.+...+..+.........+............+.......+...+..+...+....+...+..+.........+............+............+.+..+.......+...+..+......+.+.....+....+..............+.+......+...........+....+...........+.........+.+............+..+.........+.+........+......+......+.+..+.+...........+......+.......+...........+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++........+...+....+...+..+.+.......................+....+..+.+..+.......+...+..+.............+..+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+........+...+..........+...+.....+.+.....+...+..........+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++Enter PEM pass phrase:Verifying - Enter PEM pass phrase:-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Common Name (eg: your user, host, or server name) [server]:* Notice:Keypair and certificate request completed. Your files are:req: /usr/share/easy-rsa/pki/reqs/server.reqkey: /usr/share/easy-rsa/pki/private/server.keyLuego, firmamos la solicitud con nuestra CA:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server server* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.13 30 Jan 2024 (Library: OpenSSL 3.0.13 30 Jan 2024)You are about to sign the following certificate.Please check over the details shown below for accuracy. Note that this requesthas not been cryptographically verified. Please be sure it came from a trustedsource or that you have verified the request checksum with the sender.Request subject, to be signed as a server certificate for 825 days:subject=    commonName                = serverType the word 'yes' to continue, or any other input to abort.  Confirm request details: yesUsing configuration from /usr/share/easy-rsa/pki/b5cd863e/temp.ff729ff0Enter pass phrase for /usr/share/easy-rsa/pki/private/ca.key:Check that the request matches the signatureSignature okThe Subject's Distinguished Name is as followscommonName            :ASN.1 12:'server'Certificate is to be certified until May  1 17:12:31 2027 GMT (825 days)Write out database with 1 new entriesDatabase updated* Notice:Certificate created at: /usr/share/easy-rsa/pki/issued/server.crtSe nos pedir√° que confirmemos la firma y que ingresemos la contrase√±a de la CA.Repetimos el proceso para generar la clave privada y la solicitud de certificado en ServidorInsti:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa gen-req server2Luego, firmamos la solicitud:debian@ServidorCasa:/usr/share/easy-rsa$ sudo ./easyrsa sign-req client server2Una vez generados los certificados y claves, los copiamos a los directorios correspondientes en ServidorCasa:root@ServidorCasa:/usr/share/easy-rsa/pki# cp ca.crt dh.pem issued/server.crt private/server.key /etc/openvpn/server/Verificamos que los archivos se copiaron correctamente:debian@ServidorCasa:~$ ls -l /etc/openvpn/server/total 20-rw------- 1 root root 1180 Jan 26 17:16 ca.crt-rw------- 1 root root  424 Jan 26 17:16 dh.pem-rw------- 1 root root 4580 Jan 26 17:16 server.crt-rw------- 1 root root 1854 Jan 26 17:16 server.keyLuego, copiamos los certificados de ServidorInsti:root@ServidorCasa:/usr/share/easy-rsa/pki# cp ca.crt issued/server2.crt private/server2.key /home/debian/ServidorInsti/Y verificamos la copia:debian@ServidorCasa:~$ ls -l ServidorInsti/total 16-rw------- 1 root root 1180 Jan 26 17:18 ca.crt-rw------- 1 root root 4466 Jan 26 17:18 server2.crt-rw------- 1 root root 1854 Jan 26 17:18 server2.keyPara garantizar una conexi√≥n cifrada y autenticada entre los servidores, primero generamos los certificados y claves necesarias en ServidorCasa y luego los transferimos a ServidorInsti:debian@ServidorCasa:~$ scp -r ServidorInsti/ debian@10.10.10.44:/home/debianThe authenticity of host '10.10.10.44 (10.10.10.44)' can't be established.ED25519 key fingerprint is SHA256:Gojcktfl97qAXF9KaBhKTK93gIYeN/574t8Ph9Zl2D0.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.10.44' (ED25519) to the list of known hosts.debian@10.10.10.44's password: server2.crt                                   100% 4466     2.9MB/s   00:00    ca.crt                                        100% 1180     1.0MB/s   00:00    server2.key                                   100% 1854     1.7MB/s   00:00Al realizar la conexi√≥n por primera vez, se nos solicita verificar la autenticidad del host remoto mediante su huella ED25519. Aceptamos la conexi√≥n y procedemos a ingresar la contrase√±a del usuario remoto. La transferencia de archivos se completa con √©xito.Verificamos que los archivos han sido transferidos correctamente en ServidorInsti:debian@ServidorInsti:~$ cd ServidorInsti/debian@ServidorInsti:~/ServidorInsti$ ls -ltotal 16-rw------- 1 debian debian 1180 Jan 26 17:34 ca.crt-rw------- 1 debian debian 4466 Jan 26 17:34 server2.crt-rw------- 1 debian debian 1854 Jan 26 17:34 server2.keyEn ServidorCasa, configuramos el servicio OpenVPN con el siguiente archivo /etc/openvpn/server/servidor.conf:debian@ServidorCasa:~$ sudo cat /etc/openvpn/server/servidor.confdev tunifconfig 10.99.99.1 10.99.99.2route 172.22.0.0 255.255.255.0tls-serverca ca.crtcert server.crtkey server.keydh dh.pemcomp-lzokeepalive 10 120log /var/log/openvpn/server.logverb 3askpass clavepaso.txtDonde:  Modo TUN (dev tun), creando un t√∫nel IP punto a punto.  Asignaci√≥n de IPs (ifconfig 10.99.99.1 10.99.99.2).  Ruta est√°tica (route 172.22.0.0 255.255.255.0) para permitir acceso a la red interna.  Seguridad TLS (tls-server), autenticaci√≥n con certificados (ca.crt, server.crt, server.key) y clave Diffie-Hellman (dh.pem).  Compresi√≥n LZO (comp-lzo), keepalive (keepalive 10 120), y nivel de logs (verb 3).  Registro de eventos en /var/log/openvpn/server.log.  Askpass: aqu√≠ debemos declarar el fichero .txt donde guardaremos la clave de paso para que no nos la pida m√°s.Verificamos que los archivos de configuraci√≥n y certificados est√°n correctamente ubicados en /etc/openvpn/server/:debian@ServidorCasa:~$ ls -l /etc/openvpn/server/total 28-rw------- 1 root root 1180 Jan 26 17:16 ca.crt-rw-r--r-- 1 root root    6 Jan 26 17:42 clavepaso.txt-rw------- 1 root root  424 Jan 26 17:16 dh.pem-rw------- 1 root root 4580 Jan 26 17:16 server.crt-rw------- 1 root root 1854 Jan 26 17:16 server.key-rw-r--r-- 1 root root  219 Jan 26 17:41 servidor.confHabilitamos y arrancamos el servicio OpenVPN en ServidorCasa:debian@ServidorCasa:~$ sudo systemctl enable --now openvpn-server@servidorCreated symlink /etc/systemd/system/multi-user.target.wants/openvpn-server@servidor.service ‚Üí /lib/systemd/system/openvpn-server@.service.debian@ServidorCasa:~$ [ 5609.481659] tun: Universal TUN/TAP device driver, 1.6Verificamos el estado del servicio para asegurarnos de que est√° corriendo correctamente:debian@ServidorCasa:~$ sudo systemctl status openvpn-server@servidorTambi√©n comprobamos que la interfaz de t√∫nel tun0 ha sido creada correctamente:debian@ServidorCasa:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:d5:bf:e7:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::ed5:bfff:fee7:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:d5:bf:e7:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 10.10.10.33/24 brd 10.10.10.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::ed5:bfff:fee7:1/64 scope link        valid_lft forever preferred_lft forever4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500    link/none     inet 10.99.99.1 peer 10.99.99.2/32 scope global tun0       valid_lft forever preferred_lft forever    inet6 fe80::c25e:9b6e:e6a7:3651/64 scope link stable-privacy        valid_lft forever preferred_lft foreverConfiguraci√≥n del ServidorInstiEn ServidorInsti, aseguramos que los certificados y claves tengan los permisos correctos y sean propiedad de root:debian@ServidorInsti:~$ sudo chown -R root:root ServidorInsti/debian@ServidorInsti:~$ ls -l ServidorInsti/total 16-rw------- 1 root root 1180 Jan 26 17:34 ca.crt-rw------- 1 root root 4466 Jan 26 17:34 server2.crt-rw------- 1 root root 1854 Jan 26 17:34 server2.keydebian@ServidorInsti:~$ sudo mv ServidorInsti/* /etc/openvpn/client/Verificamos los archivos en /etc/openvpn/client/:debian@ServidorInsti:~$ ls -l /etc/openvpn/client/total 20-rw------- 1 root root 1180 Jan 26 17:34 ca.crt-rw-r--r-- 1 root root    6 Jan 26 18:07 clavepaso.txt-rw------- 1 root root 4466 Jan 26 17:34 server2.crt-rw------- 1 root root 1854 Jan 26 17:34 server2.keyConfiguramos el cliente OpenVPN con /etc/openvpn/client/client.conf:debian@ServidorInsti:~$ sudo cat /etc/openvpn/client/client.confdev tunremote 10.10.10.33ifconfig 10.99.99.2 10.99.99.1route 192.168.1.0 255.255.255.0tls-clientca ca.crtcert server2.crtkey server2.keycomp-lzokeepalive 10 60verb 3askpass clavepaso.txtHabilitamos y arrancamos el cliente OpenVPN:debian@ServidorInsti:~$ sudo systemctl enable --now openvpn-client@clientCreated symlink /etc/systemd/system/multi-user.target.wants/openvpn-client@client.service ‚Üí /lib/systemd/system/openvpn-client@.service.debian@ServidorInsti:~$ [ 7208.575935] tun: Universal TUN/TAP device driver, 1.6Comprobamos que la interfaz tun0 en el cliente se haya creado correctamente:debian@ServidorInsti:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:83:0e:cf:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 10.10.10.44/24 brd 10.10.10.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::e83:eff:fecf:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:83:0e:cf:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 172.22.0.1/24 brd 172.22.0.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::e83:eff:fecf:1/64 scope link        valid_lft forever preferred_lft forever4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500    link/none     inet 10.99.99.2 peer 10.99.99.1/32 scope global tun0       valid_lft forever preferred_lft forever    inet6 fe80::d8c0:e10c:3d:44f3/64 scope link stable-privacy        valid_lft forever preferred_lft foreverVerificamos que la conexi√≥n se ha establecido correctamente:debian@ServidorInsti:~$ sudo systemctl status openvpn-client@client.service Pruebas de conectividadPara verificar que la VPN est√° funcionando correctamente y que los paquetes est√°n siendo enrutados entre ambas redes, realizamos pruebas de traceroute desde ClienteCasa hacia ClienteInsti y al rev√©s.Desde ClienteCasa a ClienteInsti:Desde ClienteInsti a ClienteCasa:"
  },
  
  {
    "title": "VPN de acceso remoto con OpenVPN y certificados x509",
    "url": "/posts/acceso_remoto_openvpn/",
    "categories": "Seguridad, VPN",
    "tags": "VPN",
    "date": "2025-01-23 13:00:00 +0100",
    





    
    "snippet": "Configura una conexi√≥n VPN de acceso remoto entre dos equipos del cloud:  Uno de los dos equipos (el que actuar√° como servidor) estar√° conectado a dos redes          Para la autenticaci√≥n de los ex...",
    "content": "Configura una conexi√≥n VPN de acceso remoto entre dos equipos del cloud:  Uno de los dos equipos (el que actuar√° como servidor) estar√° conectado a dos redes          Para la autenticaci√≥n de los extremos se usar√°n obligatoriamente certificados digitales, que se generar√°n utilizando openssl y se almacenar√°n en el directorio /etc/openvpn, junto con  los par√°metros Diffie-Helman y el certificado de la propia Autoridad de Certificaci√≥n.      Se utilizar√°n direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN. La direcci√≥n 10.99.99.1 se asignar√° al servidor VPN.      Los ficheros de configuraci√≥n del servidor y del cliente se crear√°n en el directorio /etc/openvpn de cada m√°quina, y se llamar√°n servidor.conf y cliente.conf respectivamente.      Tras el establecimiento de la VPN, la m√°quina cliente debe ser capaz de acceder a una m√°quina que est√© en la otra red a la que est√° conectado el servidor.      EscenarioMontaremos el peque√±o escenario en GNS3 con tres m√°quinas Debian 12 y una nube NAT que nos proporcionar√° Internet para instalaciones necesarias:      Servidor: contar√° con tres interfaces, ens4 que conectar√° con Cliente1 en la red 192.168.1.0/24, la interfaz ens5 que conectar√° con Cliente2 en la red 192.168.2.0/24 y la interfaz ens6 que estar√° conectada a la nube NAT.        Cliente1: conectado a la red 192.168.1.0/24 a trav√©s de la interfaz ens4.        Cliente2: conectado a la red 192.168.2.0/24 a trav√©s de la interfaz ens4.        NAT: conectada al Servidor.  Quedando de la siguiente forma:Configuraci√≥n del servidorPara configurar el servidor OpenVPN, lo primero que debemos hacer es asegurarnos de que las interfaces de red est√°n activas para tener conexi√≥n a Internet. Esto es fundamental, ya que necesitaremos instalar el paquete openvpn en nuestro sistema. Para ello, ejecutamos los siguientes comandos en la terminal:debian@servidor:~$ sudo apt updatedebian@servidor:~$ sudo apt install openvpn -yUna vez instalado OpenVPN, es necesario habilitar el reenv√≠o de paquetes en el sistema para permitir que el tr√°fico fluya correctamente a trav√©s de la VPN. Esto se hace modificando el archivo de configuraci√≥n del kernel /etc/sysctl.conf. Para aplicar el cambio inmediatamente, ejecutamos:debian@servidor:~$ sudo sysctl -pEste comando verificar√° y aplicar√° la configuraci√≥n, asegurando que el tr√°fico IP pueda ser reenviado entre las interfaces de red. La salida del comando deber√≠a incluir la siguiente l√≠nea:net.ipv4.ip_forward = 1Ahora procederemos a copiar los archivos de configuraci√≥n de easy-rsa desde su ubicaci√≥n predeterminada en /usr/share/easy-rsa al directorio de configuraci√≥n de OpenVPN en /etc/openvpn. Este paso es importante porque nos aseguramos de que futuras actualizaciones del paquete no sobrescriban nuestros archivos personalizados:debian@servidor:~$ sudo cp -r /usr/share/easy-rsa /etc/openvpnPodemos verificar que la copia se ha realizado correctamente listando el contenido del directorio /etc/openvpn:debian@servidor:~$ ls -l /etc/openvpn/Lo que nos devolver√° algo similar a:total 16drwxr-xr-x 2 root root 4096 Nov 11  2023 clientdrwxr-xr-x 3 root root 4096 Jan 23 18:28 easy-rsadrwxr-xr-x 2 root root 4096 Nov 11  2023 server-rwxr-xr-x 1 root root 1468 Nov 11  2023 update-resolv-confA partir de este momento, trabajaremos dentro del directorio /etc/openvpn/easy-rsa, ya que este ser√° el entorno donde generaremos los certificados y claves necesarios para nuestra infraestructura de clave p√∫blica (PKI).EasyRSA es una herramienta de l√≠nea de comandos dise√±ada para simplificar la creaci√≥n y gesti√≥n de una PKI (Infraestructura de Clave P√∫blica) utilizada en OpenVPN. Tambi√©n nos permite generar par√°metros de Diffie-Hellman, que son esenciales para establecer un canal seguro de comunicaci√≥n en OpenVPN.El siguiente paso en la configuraci√≥n ser√° inicializar la infraestructura PKI dentro del directorio de trabajo. Para ello, ejecutamos:debian@servidor:~$ cd /etc/openvpn/easy-rsa/debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa init-pki* Notice:  init-pki complete; you may now create a CA or requests.  Your newly created PKI dir is:  * /etc/openvpn/easy-rsa/pki* Notice:  IMPORTANT: Easy-RSA 'vars' file has now been moved to your PKI above.Este comando crear√° la estructura de archivos y directorios necesaria para la gesti√≥n de certificados en OpenVPN.El siguiente paso en la configuraci√≥n de OpenVPN es la creaci√≥n de una Autoridad Certificadora (CA, por sus siglas en ingl√©s). La CA es responsable de firmar los certificados de los clientes y del servidor, asegurando la autenticidad de las conexiones dentro de la VPN.Para iniciar este proceso, ejecutamos el siguiente comando dentro del directorio /etc/openvpn/easy-rsa:debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa build-ca* Notice:Using Easy-RSA configuration from: /etc/openvpn/easy-rsa/pki/vars* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)Enter New CA Key Passphrase: Re-Enter New CA Key Passphrase: Using configuration from /etc/openvpn/easy-rsa/pki/563317df/temp.f856c430...+..+......+.+.........+.....+..........+..+....+...............+..............+......+....+.................+..........+...+.........+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+.............+..+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*....+.....+...+...+....+..................+.....+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++...+.+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+.........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+..........+.....+.+.....+.........+.+.....+.+......+.....+.......+.....+...+..........+..............+....+...........+..........+...+........+...+......+...+......+......+.+...+..+.......+..+.........+...............+......+....+..+....+...+...........+.......+...+..+.........+...+...............+.+..+.........+.+.....+.............+..............+.+......+...+..+....+..+...+.+.....................+.........+.....+.+..+.+.....+.......+..............+......+...+................+.....+......+...+..........+..+.......+...+...+..............+...+...+............+....+...+..+.............+.....+...+..................+............+.......+...........+.......+..+...............+...+....+......+...+..............+.+......+........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++Enter PEM pass phrase:Verifying - Enter PEM pass phrase:-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:pavlo* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/etc/openvpn/easy-rsa/pki/ca.crtDurante el proceso de generaci√≥n de la Autoridad Certificadora (CA), se nos pedir√° establecer una frase de paso para proteger la clave privada. Esta contrase√±a ser√° requerida cada vez que firmemos certificados nuevos. Como resultado del comando, se han generado dos archivos importantes:      El certificado de la CA, ubicado en /etc/openvpn/easy-rsa/pki/ca.crt, el cual ser√° compartido con los clientes y el servidor OpenVPN para validar la autenticidad de los certificados.        La clave privada de la CA, almacenada en /etc/openvpn/easy-rsa/pki/private/ca.key, que debe mantenerse segura y no compartirse, ya que con ella se firman los certificados dentro de la infraestructura VPN.  El siguiente paso en la configuraci√≥n ser√° la generaci√≥n de los par√°metros Diffie-Hellman (DH), que OpenVPN utilizar√° en el proceso de establecimiento de sesi√≥n segura entre los nodos de la VPN.El intercambio de claves Diffie-Hellman es un protocolo criptogr√°fico que permite a dos partes comunicarse de manera segura sobre un canal no confiable, acordando una clave de cifrado com√∫n sin necesidad de enviarla expl√≠citamente. Esto proporciona una capa adicional de seguridad en el cifrado de la conexi√≥n VPN.Para generar el certificado y la clave del servidor OpenVPN, utilizamos el siguiente comando dentro del directorio de trabajo de EasyRSA:debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa build-server-full server nopass* Notice:Using Easy-RSA configuration from: /etc/openvpn/easy-rsa/pki/vars* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..........+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+..........+.....+.......+......+..............+......+....+...+...+...........+....+.........+........+...+....+..+......+.........+....+..+....+.....+...+...+....+...+.....+...+...+......+...+.......+.........+.....+.+...+.....+...+.......+...........+............+.............+......+...............+.....+...+.............+..+...+...+.+.....+.+.........+...+.................+....+..+.......+...........+.......+..+.+..+...+....+..................+..+...+....+......+..+..........+......+.....+......+...+.......+...+.....+.+.........+...+..+..........+.................+.+.......................+............+.......+...+...+...........+....+.....+.......+..+............+.........+.+...........+...+....+............+.....+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++........+...+.+......+............+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+...+...+.........+....+.....+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.......+.....+.......+.....+...+.......+........+....+..+...............+..........+...+..+....+......+......+..............+....+.....+.+........+...+....+.....+...+...+...+....+...........................+...+..+...+......+.+...+......+.....+.......+..+...............+.+.....+.+...+..+.+..+...+.............+.................+....+...............+...+.....+.+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----* Notice:Keypair and certificate request completed. Your files are:req: /etc/openvpn/easy-rsa/pki/reqs/server.reqkey: /etc/openvpn/easy-rsa/pki/private/server.keyYou are about to sign the following certificate.Please check over the details shown below for accuracy. Note that this requesthas not been cryptographically verified. Please be sure it came from a trustedsource or that you have verified the request checksum with the sender.Request subject, to be signed as a server certificate for 825 days:subject=    commonName                = serverType the word 'yes' to continue, or any other input to abort.  Confirm request details: yesUsing configuration from /etc/openvpn/easy-rsa/pki/086ccb9e/temp.95232f12Enter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:Check that the request matches the signatureSignature okThe Subject's Distinguished Name is as followscommonName            :ASN.1 12:'server'Certificate is to be certified until Apr 28 18:52:24 2027 GMT (825 days)Write out database with 1 new entriesDatabase updated* Notice:Certificate created at: /etc/openvpn/easy-rsa/pki/issued/server.crtEste comando realiza dos acciones principales:      Genera la clave privada del servidor, que se almacena en:     /etc/openvpn/easy-rsa/pki/private/server.key        Esta clave debe mantenerse segura, ya que se utilizar√° para cifrar las comunicaciones del servidor VPN.        Crea y firma el certificado del servidor, que se guarda en:     /etc/openvpn/easy-rsa/pki/issued/server.crt        Este certificado ser√° utilizado por el servidor OpenVPN para autenticarse ante los clientes VPN.  Como hemos ejecutado el comando con la opci√≥n nopass, el certificado no requiere una frase de paso para su uso, lo que facilita la automatizaci√≥n del arranque del servidor VPN sin intervenci√≥n manual.Una vez generado el certificado del servidor, el siguiente paso es la creaci√≥n de los par√°metros Diffie-Hellman (DH), esenciales para el cifrado seguro durante el proceso de establecimiento de sesi√≥n. Esto se hace con el siguiente comando:debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa gen-dh* Notice:Using Easy-RSA configuration from: /etc/openvpn/easy-rsa/pki/vars* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)Generating DH parameters, 2048 bit long safe prime.......+...................................................................................................................................+.............................................................+...............................................................................................................................................................................................................................................................+.............+...................................+.......................................................+...............................................................................................................................................................................................................................................................................................................................................................................................................................+....................................................................................+.......................................................................................................+..........................................................................................................................................................+.............................................................................+...........................................................+...............................................................................+.............................................................................................................................................................................................................+...................................................................................................................................+...................................................................................+...........................+................................................................................................................+...........................................................................++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++*++** Notice:DH parameters of size 2048 created at /etc/openvpn/easy-rsa/pki/dh.pemEste proceso puede tardar varios minutos, ya que se generan n√∫meros primos grandes que ser√°n utilizados en el protocolo de intercambio de claves. Una vez completado, los par√°metros DH se guardan en:/etc/openvpn/easy-rsa/pki/dh.pemPara que un cliente pueda autenticarse en la VPN, necesita un certificado y una clave privada, que deben ser generados en el servidor OpenVPN utilizando Easy-RSA. Esto se realiza con el siguiente comando:debian@servidor:/etc/openvpn/easy-rsa$ sudo ./easyrsa build-client-full cliente1 nopassAqu√≠, cliente1 es el nombre del cliente y la opci√≥n nopass indica que la clave privada del cliente no tendr√° contrase√±a.Una vez generados, los archivos necesarios para la autenticaci√≥n del cliente son:  ca.crt: Certificado de la Autoridad Certificadora (CA), que permite verificar la autenticidad de los certificados emitidos.  cliente1.crt: Certificado espec√≠fico del cliente.  cliente1.key: Clave privada del cliente.Ahora, copiamos los ficheros necesarios a una carpeta temporal que nos servir√° para transferir a la m√°quina Cliente1:root@servidor:~# cp /etc/openvpn/easy-rsa/pki/ca.crt /home/debian/cliente1/root@servidor:~# cp /etc/openvpn/easy-rsa/pki/issued/cliente1.crt /home/debian/cliente1/root@servidor:~# cp /etc/openvpn/easy-rsa/pki/private/cliente1.key /home/debian/cliente1/Cambiamos los permisos para que el usuario debian pueda acceder a ellos:debian@servidor:~$ sudo chown -R debian:debian cliente1/Y verificamos que los archivos han sido copiados correctamente:debian@servidor:~$ ls -l cliente1/total 16-rw------- 1 debian debian 1180 Jan 23 19:22 ca.crt-rw------- 1 debian debian 4471 Jan 23 19:23 cliente1.crt-rw------- 1 debian debian 1704 Jan 23 19:23 cliente1.keyPara transferir estos archivos al cliente, usaremos scp (Secure Copy Protocol), copi√°ndolos a la IP 192.168.1.2:debian@servidor:~$ cd cliente1/debian@servidor:~/cliente1$ scp * debian@192.168.1.2:/home/debianThe authenticity of host '192.168.1.2 (192.168.1.2)' can't be established.ED25519 key fingerprint is SHA256:Gojcktfl97qAXF9KaBhKTK93gIYeN/574t8Ph9Zl2D0.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '192.168.1.2' (ED25519) to the list of known hosts.debian@192.168.1.2's password: ca.crt                                        100% 1180   486.0KB/s   00:00    cliente1.crt                                  100% 4471     2.7MB/s   00:00    cliente1.key                                  100% 1704   763.9KB/s   00:00 El servidor OpenVPN est√° configurado en /etc/openvpn/server/servidor.conf con los siguientes par√°metros clave:debian@servidor:~$ sudo cat /etc/openvpn/server/servidor.confport 1194proto udpdev tunca /etc/openvpn/easy-rsa/pki/ca.crtcert /etc/openvpn/easy-rsa/pki/issued/server.crtkey /etc/openvpn/easy-rsa/pki/private/server.keydh /etc/openvpn/easy-rsa/pki/dh.pemtopology subnetserver 10.99.99.0 255.255.255.0ifconfig-pool-persist /var/log/openvpn/ipp.txtpush \"route 192.168.2.0 255.255.255.0\"keepalive 10 120cipher AES-256-CBCpersist-keypersist-tunstatus /var/log/openvpn/openvpn-status.logverb 3explicit-exit-notify 1Donde:  Puertos y protocolo: OpenVPN escucha en el puerto 1194 utilizando UDP.  Configuraci√≥n de certificados: Se especifican el certificado de la CA, el certificado del servidor y su clave privada.  Topolog√≠a de red: Se usa topology subnet, lo que permite asignar direcciones IP individuales dentro de la subred VPN.  Direcciones IP de la VPN: Se define la subred 10.99.99.0/24 con ifconfig-pool-persist para asignar direcciones IP fijas a clientes recurrentes.  Enrutamiento: Se usa push \"route 192.168.2.0 255.255.255.0\" para permitir a los clientes acceder a la red 192.168.2.0/24.  Seguridad: Se especifica el cifrado AES-256-CBC y par√°metros como persist-key y persist-tun para mantener la sesi√≥n en caso de reinicios.  Registro y verbosidad: Se habilita el registro de estado en /var/log/openvpn/openvpn-status.log y verb 3 para obtener informaci√≥n de depuraci√≥n.Ahora, habilitamos el servicio OpenVPN para poner en marcha el t√∫nel:debian@servidor:~$ sudo systemctl enable --now openvpn-server@servidorCreated symlink /etc/systemd/system/multi-user.target.wants/openvpn-server@servidor.service ‚Üí /lib/systemd/system/openvpn-server@.service.debian@servidor:~$ [ 8384.381168] tun: Universal TUN/TAP device driver, 1.6Verificamos su estado y vemos que est√° funcionando correctamente:debian@servidor:~$ sudo systemctl status openvpn-server@servidor‚óè openvpn-server@servidor.service - OpenVPN service for servidor     Loaded: loaded (/lib/systemd/system/openvpn-server@.service; enabled; pres&gt;     Active: active (running) since Thu 2025-01-23 20:44:51 UTC; 1min 53s ago       Docs: man:openvpn(8)             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage             https://community.openvpn.net/openvpn/wiki/HOWTO   Main PID: 1024 (openvpn)     Status: \"Initialization Sequence Completed\"      Tasks: 1 (limit: 2348)     Memory: 1.7M        CPU: 35ms     CGroup: /system.slice/system-openvpn\\x2dserver.slice/openvpn-server@servid&gt;             ‚îî‚îÄ1024 /usr/sbin/openvpn --status /run/openvpn-server/status-servi&gt;Si mostramos las interfaces con sus respectivos direccionamientos nos damos cuenta que la interfaz de t√∫nel tun0 se crea correctamente con la direcci√≥n 10.99.99.1, confirmando que OpenVPN est√° activo.debian@servidor:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:fe:ae:66:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::efe:aeff:fe66:0/64 scope link        valid_lft forever preferred_lft forever3: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:fe:ae:66:00:01 brd ff:ff:ff:ff:ff:ff    altname enp0s5    inet 192.168.2.1/24 brd 192.168.2.255 scope global ens5       valid_lft forever preferred_lft forever    inet6 fe80::efe:aeff:fe66:1/64 scope link        valid_lft forever preferred_lft forever4: ens6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:fe:ae:66:00:02 brd ff:ff:ff:ff:ff:ff    altname enp0s6    inet 192.168.122.222/24 brd 192.168.122.255 scope global dynamic ens6       valid_lft 2320sec preferred_lft 2320sec    inet6 fe80::efe:aeff:fe66:2/64 scope link        valid_lft forever preferred_lft forever5: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500    link/none     inet 10.99.99.1/24 scope global tun0       valid_lft forever preferred_lft forever    inet6 fe80::774f:979b:9e65:1c85/64 scope link stable-privacy        valid_lft forever preferred_lft foreverConfiguraci√≥n del Cliente1En la m√°quina cliente Cliente1, instalamos OpenVPN:sudo apt updatesudo apt install openvpn -yLos archivos de certificado y clave los movemos a /etc/openvpn/client/ y le cambiamos los permisos a root:debian@cliente1:~$ sudo mv cliente/* /etc/openvpn/client/debian@cliente1:~$ sudo chown -R root:root /etc/openvpn/client/Verificamos que tengan los permisos correctos:debian@cliente1:~$ ls -l /etc/openvpn/client/total 16-rw------- 1 root root 1180 Jan 23 20:37 ca.crt-rw------- 1 root root 4471 Jan 23 20:37 cliente1.crt-rw------- 1 root root 1704 Jan 23 20:37 cliente1.keyY pasamos a la configuraci√≥n del cliente, el cual se encuentra en /etc/openvpn/client/client.conf:debian@cliente1:~$ sudo cat /etc/openvpn/client/client.confclientdev tunproto udpremote 192.168.1.1 1194resolv-retry infinitenobindpersist-keypersist-tunca /etc/openvpn/client/ca.crtcert /etc/openvpn/client/cliente1.crtkey /etc/openvpn/client/cliente1.keyremote-cert-tls servercipher AES-256-CBCverb 3Donde:  Modo cliente: client  Interfaz virtual: dev tun  Protocolo y puerto: proto udp en el puerto 1194  Direcci√≥n del servidor: remote 192.168.1.1 1194  Persistencia: persist-key y persist-tun para mantener la sesi√≥n  Seguridad: Se especifican los archivos ca.crt, cliente1.crt y cliente1.key, adem√°s del cifrado AES-256-CBC.  Verbosidad: verb 3 para registros detallados.Conectamos el cliente a la VPN y verificamos su estado:debian@cliente1:~$ sudo systemctl enable --now openvpn-client@clientdebian@cliente1:~$ sudo systemctl status openvpn-client@client‚óè openvpn-client@client.service - OpenVPN tunnel for client     Loaded: loaded (/lib/systemd/system/openvpn-client@.service; enabled; pres     Active: active (running) since Thu 2025-01-23 21:41:41 UTC; 1min 25s ago       Docs: man:openvpn(8)             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage             https://community.openvpn.net/openvpn/wiki/HOWTO   Main PID: 713 (openvpn)     Status: \"Initialization Sequence Completed\"      Tasks: 1 (limit: 2349)     Memory: 1.9M        CPU: 39ms     CGroup: /system.slice/system-openvpn\\x2dclient.slice/openvpn-client@client             ‚îî‚îÄ713 /usr/sbin/openvpn --suppress-timestamps --nobind --config clY si la conexi√≥n es exitosa, la interfaz tun0 aparecer√° con la IP 10.99.99.2, lo que indica que el cliente est√° dentro de la red VPN:debian@cliente1:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 0c:3a:24:e0:00:00 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 192.168.1.2/24 brd 192.168.1.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::e3a:24ff:fee0:0/64 scope link        valid_lft forever preferred_lft forever3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500    link/none     inet 10.99.99.2/24 scope global tun0       valid_lft forever preferred_lft forever    inet6 fe80::d9f3:6eaa:7b14:2952/64 scope link stable-privacy        valid_lft forever preferred_lft foreverComprobaci√≥nPara comprobar que el cliente puede alcanzar la red remota 192.168.2.0/24 a trav√©s del servidor VPN, se usa traceroute:debian@cliente1:~$ traceroute 192.168.2.2traceroute to 192.168.2.2 (192.168.2.2), 30 hops max, 60 byte packets 1  10.99.99.1 (10.99.99.1)  1.910 ms  1.824 ms  1.814 ms 2  192.168.2.2 (192.168.2.2)  2.734 ms  2.755 ms  2.755 msSi el tr√°fico sigue el camino esperado a trav√©s de la VPN, significa que la configuraci√≥n ha sido exitosa."
  },
  
  {
    "title": "Recolecci√≥n centralizada de logs de sistema, mediante journald",
    "url": "/posts/journald/",
    "categories": "Sistemas, Monitoreo y Gesti√≥n de Logs",
    "tags": "Monitoreo y Gesti√≥n de Logs",
    "date": "2025-01-21 14:00:00 +0100",
    





    
    "snippet": "Implementa en tu escenario de trabajo de Openstack, un sistema de recolecci√≥n de log mediante journald. Para ello debes, implementar un sistema de recolecci√≥n de log mediante el paquete systemd-jou...",
    "content": "Implementa en tu escenario de trabajo de Openstack, un sistema de recolecci√≥n de log mediante journald. Para ello debes, implementar un sistema de recolecci√≥n de log mediante el paquete systemd-journal-remote, o similares.Instalaci√≥n de systemd-journal-remoteEn nuestro entorno, el primer paso ser√° instalar el paquete systemd-journal-remote, que nos brindar√° la posibilidad de acceder a estas m√°quinas de manera remota. Para llevar a cabo la instalaci√≥n en las m√°quinas de nuestro escenario, emplearemos el gestor de paquetes apt en Luffy, que est√° basado en Debian 12. Adem√°s, instalaremos el mismo paquete en los contenedores Nami y Sanji, que est√°n alojados dentro de Luffy. Por otro lado, en Zoro, que ejecuta Rocky, utilizaremos el gestor de paquetes dnf para realizar la instalaci√≥n.pablo@luffy:~$ sudo apt install systemd-journal-remote -y[pablo@zoro ~]$ sudo dnf install systemd-journal-remote -ypablo@sanji:~$ sudo apt install systemd-journal-remote -ypablo@nami:~$ sudo apt install systemd-journal-remote -yEn el servidor, habilitaremos y activaremos los dos componentes de systemd necesarios para recibir los mensajes de registro con el siguiente comando:pablo@luffy:~$ sudo systemctl enable --now systemd-journal-remote.socketCreated symlink /etc/systemd/system/sockets.target.wants/systemd-journal-remote.socket ‚Üí /lib/systemd/system/systemd-journal-remote.socket.pablo@luffy:~$ sudo systemctl enable systemd-journal-remote.serviceEn el cliente, habilitaremos el componente que systemd usa para enviar los mensajes de registro al servidor:[pablo@zoro ~]$ sudo systemctl enable systemd-journal-upload.serviceCreated symlink /etc/systemd/system/multi-user.target.wants/systemd-journal-upload.service ‚Üí /usr/lib/systemd/system/systemd-journal-upload.service.Luego, en el servidor, abriremos los puertos 19532 y 80 en el firewall. Esto permitir√° que el servidor reciba los mensajes de registro del cliente. El puerto 80 ser√° utilizado por certbot para generar el certificado TLS. Sin embargo, en nuestro caso no tenemos ning√∫n cortafuegos, por lo que no ser√° necesario realizar esta configuraci√≥n.Generaci√≥n de claves y certificadosDado que utilizaremos el servicio con cifrado para asegurar que nuestros registros est√©n protegidos, procederemos a generar los certificados utilizando OpenSSL. Aunque podemos generar los certificados manualmente, existe una herramienta llamada Easy RSA que facilita este proceso de forma automatizada. Yo me encargar√© de generar todos los certificados en Luffy y luego los transferir√© a las m√°quinas correspondientes.Para comenzar, en Luffy ejecutaremos el siguiente comando para instalar Easy RSA y OpenSSL:pablo@luffy:~$ sudo apt install easy-rsa openssl -yEsta utilidad incluye un archivo de ejemplo que nos ayudar√° a generar los certificados. Primero, copiaremos el archivo de ejemplo y luego editaremos los valores necesarios para personalizar la configuraci√≥n:pablo@luffy:/usr/share/easy-rsa$ sudo cp vars.example varspablo@luffy:/usr/share/easy-rsa$ sudo nano varspablo@luffy:/usr/share/easy-rsa$ cat varsset_var EASYRSA_REQ_COUNTRY     \"ES\"set_var EASYRSA_REQ_PROVINCE    \"Sevilla\"set_var EASYRSA_REQ_CITY        \"Dos Hermanas\"set_var EASYRSA_REQ_ORG         \"PabloMartin SL\"set_var EASYRSA_REQ_EMAIL       \"pmartinhidalgo19@gmail.com\"set_var EASYRSA_REQ_OU          \"Informatica\"A continuaci√≥n, vamos a crear la estructura de directorios junto a los archivos necesarios para poder comenzar a trabajar con easyRSA:pablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa init-pki* Notice:  init-pki complete; you may now create a CA or requests.  Your newly created PKI dir is:  * /usr/share/easy-rsa/pkiSeguidamente, construimos nuestra CA:pablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa build-ca nopass* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)Using configuration from /usr/share/easy-rsa/pki/eff500c6/temp.8849e576...+..............+...+.........+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+..+...+...+....+......+.....+......+....+......+...+.....+..........+...+..+.+......+........+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+..+.............+..+.+......+.........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++...+......+.+...+........+...+....+.....+......+.......+........+.+......+.........+.....+.+.....+.........+...+...+.........+...+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+....+......+........+....+........+.......+...+..+.+..+............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+...+......+......+...+....+.....+...+.............+..+...+.+...+...+.....+.......+.....+.............+..............+...............+...............+.+..+.+......+.........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:luffy.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtAhora vamos a generar la clave privada de todas las m√°quina, adem√°s, generaremos a la vez una solicitud de firma del certificado:pablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa gen-req zoro nopass-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:zoro.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtpablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa gen-req nami nopass-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:nami.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtpablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa gen-req sanji nopass-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:sanji.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtpablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa gen-req luffy nopass-----Common Name (eg: your user, host, or server name) [Easy-RSA CA]:luffy.pablo.gonzalonazareno.org* Notice:CA creation complete and you may now import and sign cert requests.Your new CA certificate file for publishing is at:/usr/share/easy-rsa/pki/ca.crtUna vez generadas las claves privadas y las solicitudes de firma de los certificados, procederemos a firmarlas. Para evitar repetir el proceso en cada m√°quina, mostraremos c√≥mo firmar el certificado de Luffy, ya que los dem√°s se firman de la misma manera.En primer lugar, ejecutaremos el siguiente comando en Luffy para firmar la solicitud de certificado:pablo@luffy:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server luffy* Notice:Using Easy-RSA configuration from: /usr/share/easy-rsa/vars* WARNING:  Move your vars file to your PKI folder, where it is safe!* Notice:Using SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)You are about to sign the following certificate.Please check over the details shown below for accuracy. Note that this requesthas not been cryptographically verified. Please be sure it came from a trustedsource or that you have verified the request checksum with the sender.Request subject, to be signed as a server certificate for 825 days:subject=    commonName                = luffy.pablo.gonzalonazareno.orgType the word 'yes' to continue, or any other input to abort.  Confirm request details: yesUsing configuration from /usr/share/easy-rsa/pki/732b7266/temp.39f65a14Check that the request matches the signatureSignature okThe Subject's Distinguished Name is as followscommonName            :ASN.1 12:'luffy.pablo.gonzalonazareno.org'Certificate is to be certified until Apr 27 07:27:31 2027 GMT (825 days)Write out database with 1 new entriesDatabase updated* Notice:Certificate created at: /usr/share/easy-rsa/pki/issued/luffy.crtDurante el proceso, EasyRSA nos pedir√° que confirmemos la firma y que verifiquemos los datos de la solicitud. Aceptaremos escribiendo yes y luego se generar√° el certificado firmado correspondiente.Tras firmar el certificado de Luffy, repetiremos el mismo procedimiento para las dem√°s m√°quinas, sustituyendo luffy por el nombre correspondiente de cada una. Esto asegurar√° que todas las m√°quinas tengan su certificado firmado correctamente.Mover los certificados a las m√°quinas correspondientesAhora debemos transferir los certificados y claves privadas a las m√°quinas correspondientes utilizando el m√©todo para compartir que queramos, en mi caso, a trav√©s de un servidor python3 temporal. Para cada una de ellas, copiaremos el certificado firmado, ubicado en /usr/share/easy-rsa/pki/issued/, junto con su clave privada, que se encuentra en /usr/share/easy-rsa/pki/private/.root@luffy:/usr/share/easy-rsa/pki/issued# ls -ltotal 32-rw------- 1 root root 4821 Jan 22 07:27 luffy.crt-rw------- 1 root root 4815 Jan 22 07:28 nami.crt-rw------- 1 root root 4821 Jan 22 07:28 sanji.crt-rw------- 1 root root 4815 Jan 22 07:28 zoro.crtroot@luffy:/usr/share/easy-rsa/pki/private# ls -ltotal 20-rw------- 1 root root 1704 Jan 21 12:54 ca.key-rw------- 1 root root 1704 Jan 22 07:24 luffy.key-rw------- 1 root root 1704 Jan 21 13:04 nami.key-rw------- 1 root root 1708 Jan 21 13:05 sanji.key-rw------- 1 root root 1704 Jan 21 13:01 zoro.keyAdem√°s, en el caso de los clientes, ser√° necesario enviarles tambi√©n el certificado de la Autoridad Certificadora (CA), almacenado en /usr/share/easy-rsa/pki/ca.crt.root@luffy:/usr/share/easy-rsa/pki# ls -ltotal 76-rw------- 1 root root 1285 Jan 21 12:54 ca.crtdrwx------ 2 root root 4096 Jan 22 07:28 certs_by_serial-rw------- 1 root root  374 Jan 22 07:28 index.txt-rw------- 1 root root   20 Jan 22 07:28 index.txt.attr-rw------- 1 root root   20 Jan 22 07:28 index.txt.attr.old-rw------- 1 root root  280 Jan 22 07:28 index.txt.olddrwx------ 2 root root 4096 Jan 22 07:28 issued-rw------- 1 root root 4935 Jan 21 11:57 openssl-easyrsa.cnfdrwx------ 2 root root 4096 Jan 22 07:25 privatedrwx------ 2 root root 4096 Jan 22 07:25 reqsdrwx------ 5 root root 4096 Jan 21 12:54 revoked-rw------- 1 root root 4927 Jan 22 07:28 safessl-easyrsa.cnf-rw------- 1 root root   33 Jan 22 07:28 serial-rw------- 1 root root   33 Jan 22 07:28 serial.old-rw------- 1 root root 9425 Jan 21 11:57 vars.exampleNos transferimos todos los archivos:root@luffy:/usr/share/easy-rsa/pki/issued# python3 -m http.serverServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...172.16.0.200 - - [22/Jan/2025 07:42:44] \"GET /zoro.crt HTTP/1.1\" 200 -192.168.0.3 - - [22/Jan/2025 07:46:12] \"GET /sanji.crt HTTP/1.1\" 200 -192.168.0.2 - - [22/Jan/2025 07:46:30] \"GET /nami.crt HTTP/1.1\" 200 -root@luffy:/usr/share/easy-rsa/pki# python3 -m http.serverServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...172.16.0.200 - - [22/Jan/2025 07:49:54] \"GET /ca.crt HTTP/1.1\" 200 -192.168.0.3 - - [22/Jan/2025 07:50:02] \"GET /ca.crt HTTP/1.1\" 200 -192.168.0.2 - - [22/Jan/2025 07:50:04] \"GET /ca.crt HTTP/1.1\" 200 -root@luffy:/usr/share/easy-rsa/pki/private# python3 -m http.serverServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...172.16.0.200 - - [22/Jan/2025 07:50:45] \"GET /zoro.key HTTP/1.1\" 200 -192.168.0.3 - - [22/Jan/2025 07:50:55] \"GET /sanji.key HTTP/1.1\" 200 -192.168.0.2 - - [22/Jan/2025 07:51:01] \"GET /nami.key HTTP/1.1\" 200 -El comando para transferir los archivos desde el cliente es el siguiente:wget http://&lt;IP_servidor&gt;:8000/ruta_al_archivoEl directorio /etc/letsencrypt/live/ es utilizado por Let‚Äôs Encrypt para almacenar certificados generados mediante certbot, pero como en este caso estamos generando los certificados manualmente con EasyRSA, ese directorio no existe por defecto. Por lo tanto, debemos crearlo para posteriormente mover los archivos all√≠:root@luffy:~# sudo mkdir -p /etc/letsencrypt/live/pablomh.esroot@luffy:~# sudo mv /usr/share/easy-rsa/pki/issued/luffy.crt /etc/letsencrypt/live/pablomh.es/root@luffy:~# sudo mv /usr/share/easy-rsa/pki/private/luffy.key /etc/letsencrypt/live/pablomh.es/Adem√°s, debemos generar un fichero combined.pem solamente en luffy, para realizar esto debemos concatenar nuestro certificado con la clave privada en un solo archivo:root@luffy:~# cat /etc/letsencrypt/live/pablomh.es/luffy.crt /etc/letsencrypt/live/pablomh.es/luffy.key &gt; /etc/letsencrypt/live/pablomh.es/combined.pemCambiamos los permisos:root@luffy:~# chown root:systemd-journal-remote /etc/letsencrypt/live/pablomh.es/*root@luffy:~# chmod 640 /etc/letsencrypt/live/pablomh.es/luffy.crtroot@luffy:~# chmod 640 /etc/letsencrypt/live/pablomh.es/luffy.keyQuedando luffy de la siguiente forma:root@luffy:~# ls -l /etc/letsencrypt/live/pablomh.es/total 20-rw-r--r-- 1 root systemd-journal-remote 6525 Jan 22 08:02 combined.pem-rw-r----- 1 root systemd-journal-remote 4821 Jan 22 07:27 luffy.crt-rw-r----- 1 root systemd-journal-remote 1704 Jan 22 07:24 luffy.keyAhora, en las dem√°s m√°quinas realizamos lo requerido para que queden las m√°quinas de la siguiente forma:Zoro:[pablo@zoro ~]$ ls -l /etc/letsencrypt/live/zoro.pablomh.es/total 16-rw-r-----. 1 systemd-journal-upload systemd-journal-upload 1285 Jan 21 12:54 ca.crt-rw-r-----. 1 systemd-journal-upload systemd-journal-upload 4815 Jan 22 07:28 zoro.crt-rw-r-----. 1 systemd-journal-upload systemd-journal-upload 1704 Jan 21 13:01 zoro.keySanji:pablo@sanji:~$ sudo ls -l /etc/letsencrypt/live/sanji.pablomh.es/total 16-rw-r----- 1 systemd-journal-upload systemd-journal-upload 1285 Jan 21 12:54 ca.crt-rw-r----- 1 systemd-journal-upload systemd-journal-upload 4821 Jan 22 07:28 sanji.crt-rw-r----- 1 systemd-journal-upload systemd-journal-upload 1708 Jan 21 13:05 sanji.keyNami:pablo@nami:~$ sudo ls -l /etc/letsencrypt/live/nami.pablomh.es/total 16-rw-r----- 1 systemd-journal-upload systemd-journal-upload 1285 Jan 21 12:54 ca.crt-rw-r----- 1 systemd-journal-upload systemd-journal-upload 4815 Jan 22 07:28 nami.crt-rw-r----- 1 systemd-journal-upload systemd-journal-upload 1704 Jan 21 13:04 nami.keyAunque he empleado el directorio destinado a los certificados de Let‚Äôs Encrypt, no ha sido posible utilizarlos debido a la falta de control sobre el dominio gonzalonazareno.org. Por esta raz√≥n, los certificados fueron generados manualmente con anterioridad. Es importante destacar que la ubicaci√≥n donde se almacenen no es relevante, siempre y cuando se configuren con los permisos adecuados.Configuraci√≥n del servidorYa solamente nos quedar√≠a indicar la configuraci√≥n del servicio, donde tendremos que cambiar las rutas correspondientes a nuestros ficheros:pablo@luffy:~$ sudo cat /etc/systemd/journal-remote.conf[Remote]Seal=falseSplitMode=hostServerKeyFile=/etc/letsencrypt/live/pablomh.es/luffy.keyServerCertificateFile=/etc/letsencrypt/live/pablomh.es/luffy.crtTrustedCertificateFile=/etc/letsencrypt/live/pablomh.es/combined.pemUna vez configurado, reiniciamos el servicio y comprobamos que se haya levantado:pablo@luffy:~$ sudo systemctl restart systemd-journal-remote.servicepablo@luffy:~$ sudo systemctl status systemd-journal-remote.service‚óè systemd-journal-remote.service - Journal Remote Sink Service     Loaded: loaded (/lib/systemd/system/systemd-journal-remote.service; indirect; preset: disabled)     Active: active (running) since Wed 2025-01-22 08:18:34 UTC; 3s agoTriggeredBy: ‚óè systemd-journal-remote.socket       Docs: man:systemd-journal-remote(8)             man:journal-remote.conf(5)   Main PID: 40106 (systemd-journal)     Status: \"Processing requests...\"      Tasks: 1 (limit: 2314)     Memory: 2.0M        CPU: 78ms     CGroup: /system.slice/systemd-journal-remote.service             ‚îî‚îÄ40106 /lib/systemd/systemd-journal-remote --listen-https=-3 --output=/var/log/journal/remote/Configuraci√≥n del clienteLo que se debe hacer es agregar los archivos necesarios para la configuraci√≥n, incluyendo tu clave privada y el certificado que te corresponde, as√≠ como el certificado de la Autoridad Certificadora (CA) que utilizaste para generar esos archivos.[pablo@zoro ~]$ sudo cat /etc/systemd/journal-upload.conf [Upload]URL=https://luffy.pablo.gonzalonazareno.org:19532ServerKeyFile=/etc/letsencrypt/live/zoro.pablomh.es/luffy.keyServerCertificateFile=/etc/letsencrypt/live/zoro.pablomh.es/luffy.crtTrustedCertificateFile=/etc/letsencrypt/live/zoro.pablomh.es/ca.crtReiniciamos el servicio y comprobamos el estado:[pablo@zoro ~]$ sudo systemctl restart systemd-journal-upload.service[pablo@zoro ~]$ sudo systemctl status systemd-journal-upload.service‚óè systemd-journal-upload.service - Journal Remote Upload Service     Loaded: loaded (/usr/lib/systemd/system/systemd-journal-upload.service; enabled; preset: disabled)     Active: active (running) since Wed 2025-01-22 09:44:31 UTC; 3s ago       Docs: man:systemd-journal-upload(8)   Main PID: 2251 (systemd-journal)     Status: \"Processing input...\"      Tasks: 1 (limit: 10890)     Memory: 4.2M        CPU: 71ms     CGroup: /system.slice/systemd-journal-upload.service             ‚îî‚îÄ2251 /usr/lib/systemd/systemd-journal-upload --save-stateJan 22 09:44:31 zoro systemd[1]: Started Journal Remote Upload Service.Comprobaci√≥n de funcionamientoUna vez que ambos servicios est√©n en funcionamiento, se almacenar√° en el servidor un archivo que contendr√° los registros (logs) generados por el cliente.root@luffy:~# ls -la /var/log/journal/remote/total 16396drwxr-xr-x  2 systemd-journal-remote systemd-journal-remote     4096 Jan 22 09:35 .drwxr-sr-x+ 4 root                   systemd-journal            4096 Jan 22 08:18 ..-rw-r-----  1 systemd-journal-remote systemd-journal-remote 16777216 Jan 22 09:39 remote-172.16.0.200.journalPodemos ver los logs de los diferentes servicios, por ejemplo realizaremos el filtro por httpd:root@luffy:~# journalctl -u httpd --file=/var/log/journal/remote/remote-172.16.0.200.journalJan 22 09:42:27 zoro systemd[1]: Starting The Apache HTTP Server...Jan 22 09:42:27 zoro httpd[2021]: Server configured, listening on: port 80Jan 22 09:42:27 zoro systemd[1]: Started The Apache HTTP Server."
  },
  
  {
    "title": "Systemd-Boot",
    "url": "/posts/systemd-boot/",
    "categories": "Sistemas, Systemd",
    "tags": "Systemd",
    "date": "2025-01-14 14:30:00 +0100",
    





    
    "snippet": "Los desarrolladores de Debian han propuesto el uso de systemd-boot para instalaciones UEFI de Debian Trixie, que se lanzar√° en 2025. Opci√≥n disponible, de momento, en instalaciones debian 13 en mod...",
    "content": "Los desarrolladores de Debian han propuesto el uso de systemd-boot para instalaciones UEFI de Debian Trixie, que se lanzar√° en 2025. Opci√≥n disponible, de momento, en instalaciones debian 13 en modo experto. El objetivo es agregar soporte de arranque seguro firmado a Debian para intentar resolver el problema relacionado con UEFI y Secure Boot con sistemas Debian. Proponen utilizar un gestor de arranque llamado ‚Äúsystemd-boot‚Äù para mejorar el proceso de arranque de Debian en sistemas UEFI.1. Instala en m√°quina virtual, debian 13 con systemd-boot, y familiar√≠zate con este nuevo gestor de arranque.En esta parte del art√≠culo, aprenderemos a instalar Debian 13 (Trixie) con el gestor de arranque systemd-boot en un sistema UEFI.Comenzamos descargando la ISO de Debian 13 Trixie desde la p√°gina oficial del proyecto Debian. En esta secci√≥n elegiremos la opci√≥n que m√°s nos convenga, en mi caso la netinst.En esta instalaci√≥n utilizaremos QEMU/KVM como plataforma de virtualizaci√≥n para crear la m√°quina virtual. Es fundamental configurar correctamente UEFI antes de comenzar la instalaci√≥n, ya que Debian 13 utiliza este modo de arranque junto con systemd-boot.Para asegurarnos de que systemd-boot se instale correctamente en Debian 13, es imprescindible seleccionar la instalaci√≥n en modo experto. Esto nos permitir√° elegir manualmente el gestor de arranque y realizar configuraciones avanzadas.En lugar de seleccionar la opci√≥n est√°ndar Install, elegimos ‚ÄúAdvanced options‚Äù y luego ‚ÄúExpert install‚Äù.Una vez elegida esta opci√≥n, seguimos con las instalaci√≥n en donde primero de todo debemos elegir el idioma:Durante la instalaci√≥n en modo experto de Debian 13, el instalador puede ofrecer una opci√≥n llamada ‚ÄúDetectar y montar el medio de instalaci√≥n‚Äù. Esta opci√≥n es especialmente √∫til si estamos utilizando una instalaci√≥n por red o un medio de instalaci√≥n que no es el disco duro local (por ejemplo, un USB o una ISO montada). Por lo tanto, seleccionamos la que nos muestra autom√°ticamente.Seguidamente nos mostrar√° una serie de componentes opcionales para descargarlos en caso de ser necesarios. Yo personalmente no he seleccionado ninguno, pues para el objetivo de esta pr√°ctica no nos har√° falta:Luego, nos pedir√° como queremos configurar la red, elegimos autom√°ticamente:Una vez seleccionado esto, seguiremos con la instalaci√≥n tal y como estamos acostumbrados. Pero llegados al punto del particionado de discos debemos pararnos.El particionado del disco es una de las etapas clave en la instalaci√≥n de Debian, especialmente cuando estamos configurando un sistema UEFI. Al seleccionar el particionado del disco, es importante configurar adecuadamente las particiones para que Debian se instale correctamente y utilice systemd-boot como gestor de arranque.Por lo tanto, debemos seleccionar que queremos un particionado manual, pues nos permite tener un control total sobre c√≥mo se organiza el disco.Luego, seleccionamos el disco donde realizaremos el particionado, en este caso solo disponemos de uno:Nos preguntar√° que si queremos particionar el disco y le diremos que ‚ÄúS√≠‚Äù, luego nos dar√° a elegir que tipo de tabla de partici√≥n vamos a utilizar. En este caso seleccionamos gpt:Ahora, debemos realizar el particionado, el cual yo har√© de la siguiente forma:  Partici√≥n EFI:  Tipo: EFI System Partition  Tama√±o recomendado: Al menos 100 MB, aunque se recomienda entre 300 MB y 500 MB para asegurar un arranque adecuado.  Punto de montaje: /boot/efi  Esta partici√≥n es crucial para UEFI, ya que contiene los archivos del cargador de arranque, como systemd-boot.  Partici√≥n ra√≠z (/):  Tipo: ext4  Tama√±o recomendado: Al menos 20 GB o m√°s  Punto de montaje: /  Esta partici√≥n contendr√° el sistema operativo y todos los archivos de configuraci√≥n.  √Årea de intercambio (swap):  Tipo: Linux swap  Tama√±o recomendado: el tama√±o ser√° el restante, en este caso 142MB.  Esta partici√≥n es utilizada como espacio de intercambio cuando la RAM se llena.De forma que el particionado quedar√≠a de la siguiente forma:Una vez que hayamos creado y configurado las particiones, el instalador nos pedir√° que confirmemos el esquema de particionado. Si todo es correcto, seleccionaremos ‚ÄúS√≠‚Äù para aplicar los cambios. Esto formatear√° el disco y crear√° las particiones seleccionadas.Bien, pues una vez realizado el particionado debemos instalar el sistema base, el cual nos dar√° a elegir que n√∫cleo queremos. Yo personalmente he seleccionado la segunda opci√≥n:Despu√©s, nos pedir√° que opci√≥n elegir en cuanto a los controladores se refiere. Yo elegir√© ‚Äúdirigido‚Äù, pues para esta pr√°ctica no me interesa cargar tantos drivers.Cuando lleguemos a la parte del proceso de instalaci√≥n donde el instalador te pregunta si deseas analizar medios de instalaci√≥n adicionales, es importante seleccionar ‚ÄúNo‚Äù.Esta opci√≥n permite al instalador buscar e instalar paquetes adicionales desde otros medios (por ejemplo, discos o dispositivos USB adicionales que contengan paquetes de instalaci√≥n). Sin embargo, en la mayor√≠a de los casos, no es necesario agregar m√°s medios de instalaci√≥n si ya estamos utilizando una imagen ISO completa o una instalaci√≥n por red.Cuando lleguemos a la opci√≥n de ‚Äú¬øDesea utilizar una r√©plica en red?‚Äù durante la instalaci√≥n, es importante seleccionar ‚ÄúS√≠‚Äù.En este paso, el instalador te da la opci√≥n de utilizar una r√©plica en red (mirror) para obtener paquetes adicionales y actualizaciones durante el proceso de instalaci√≥n. Dado que est√°s utilizando una imagen de instalaci√≥n m√≠nima (netinst), el sistema base que se instalar√° inicialmente ser√° bastante reducido. Al seleccionar ‚ÄúS√≠‚Äù, podr√°s acceder a una r√©plica en red que proporcionar√° los paquetes necesarios para completar la instalaci√≥n y actualizar el sistema.Al hacerlo, se descargar√° software adicional y se instalar√°n los paquetes que permiten completar un sistema Debian completamente funcional.Seguidamente seleccionamos HTTP como el protocolo para acceder a la r√©plica en red.En esta etapa del proceso de instalaci√≥n, nos preguntar√° si queremos usar firmware no libre para que ciertos componentes de hardware (como tarjetas Wi-Fi, chipsets de audio, etc.) funcionen correctamente.El firmware no libre es necesario para que algunos dispositivos de hardware funcionen, pero no es software libre. Sin embargo, Debian ofrece estos firmwares para garantizar la compatibilidad con una amplia variedad de hardware, aunque sus licencias restringen la libertad de usar, modificar o compartir el software.Seleccionar ‚ÄúS√≠‚Äù en esta opci√≥n permitir√° que el instalador cargue y use los firmwares no libres que puedan ser necesarios para que tu hardware funcione correctamente, especialmente si est√°s utilizando hardware espec√≠fico que requiere controladores no libres.En esta etapa, se te preguntar√° si deseas habilitar ciertos servicios de actualizaci√≥n para tu sistema Debian. Debian ofrece dos servicios principales relacionados con las actualizaciones: actualizaciones de seguridad y actualizaciones de la distribuci√≥n.      Actualizaciones de seguridad: Estas actualizaciones son fundamentales para mantener el sistema protegido contra vulnerabilidades de seguridad. Debian recomienda encarecidamente habilitar este servicio para recibir actualizaciones que solucionen posibles fallos de seguridad en el sistema.        Actualizaciones de la distribuci√≥n: Este servicio ofrece versiones m√°s recientes de los paquetes del sistema que contienen cambios importantes. Mantener este servicio habilitado asegura que el sistema se mantenga actualizado con las √∫ltimas versiones estables de los paquetes.        Programas migrados a nuevas versiones (opcional): Esta opci√≥n permite acceder a programas m√°s recientes que se encuentran en desarrollo o que han sido migrados a una nueva versi√≥n. Estos paquetes pueden no ser tan estables, ya que no han sido probados completamente, pero pueden ofrecer nuevas caracter√≠sticas.  Por lo tanto, dejamos marcadas las dos primeras opciones que vienen por defecto:En esta parte nos dir√° si queremos que se realicen actualizaciones autom√°ticas, aunque es una opci√≥n interesante, para esta pr√°ctica seleccionaremos que no:En la selecci√≥n de programas elegiremos a nuestro gusto:Despu√©s de varios minutos en los que el instalador descarga e instala los paquetes del sistema, llegamos a uno de los puntos m√°s importantes de la instalaci√≥n: la selecci√≥n del cargador de arranque.El cargador de arranque es un software esencial que permite iniciar el sistema operativo tras encender el equipo. Tradicionalmente, Debian utiliza GRUB como su gestor de arranque por defecto, pero en esta instalaci√≥n estamos configurando systemd-boot, un gestor m√°s ligero y moderno dise√±ado espec√≠ficamente para sistemas UEFI.Despu√©s de completar la instalaci√≥n del sistema y llegar al momento del reinicio, es necesario desactivar el ‚ÄúSecure Boot‚Äù en el firmware UEFI para que el cargador de arranque systemd-boot funcione correctamente.¬øPor qu√© desactivar Secure Boot?El Secure Boot es una caracter√≠stica de UEFI dise√±ada para evitar que se cargue software no firmado o malicioso al iniciar el sistema. Sin embargo, en algunos casos, como al instalar Debian con systemd-boot, el firmware puede bloquear el arranque si el sistema operativo no est√° firmado digitalmente o no es compatible con el Secure Boot.systemd-boot es un gestor de arranque que no siempre es compatible con Secure Boot de forma predeterminada, por lo que es necesario desactivarlo para permitir que el sistema se inicie correctamente.Para desactivarlo seguimos los pasos de las siguientes capturas:Guardamos los cambios con F10 y le damos a ‚ÄúContinue‚Äù, de esta forma ya se iniciar√° correctamente el sistema:Despu√©s de haber reiniciado el sistema con Secure Boot desactivado, es importante verificar que el cargador de arranque systemd-boot se ha instalado y configurado correctamente.Para hacerlo, utilizamos el siguiente comando en la terminal:root@debian:~# bootctl statusbootctl es una herramienta integrada en systemd que permite gestionar systemd-boot. El subcomando status muestra informaci√≥n sobre el estado actual del gestor de arranque.Como podemos observar en la imagen, systemd-boot est√° instalado y configurado correctamente.Por √∫ltimo, podemos ver la versi√≥n de Debian instalando Neofetch:Y como vemos nos sale la versi√≥n correcta:2. Cambiar el tradicional gestor de arranque grub por systemd boot en una m√°quina virtual con debian 12.1. Ventajas y Desventajassystemd-bootVentajas      Dise√±o Ligero y Sencillo:systemd-boot destaca por su enfoque minimalista, lo que lo hace m√°s liviano en comparaci√≥n con GRUB. Su simplicidad puede traducirse en tiempos de arranque m√°s √°giles y un menor consumo de recursos.        Integraci√≥n con Systemd:Al estar dise√±ado para trabajar de manera estrecha con systemd, este gestor de arranque facilita la administraci√≥n del sistema, especialmente en entornos donde systemd ya est√° implementado como parte esencial.        Inicio R√°pido:Debido a su dise√±o optimizado, systemd-boot suele arrancar el sistema m√°s r√°pido que GRUB, lo que puede ser una ventaja para quienes buscan reducir los tiempos de inicio.  Desventajas      Menos Opciones de Configuraci√≥n:Su enfoque simplificado significa que carece de algunas caracter√≠sticas avanzadas que GRUB s√≠ proporciona. Esto puede ser una limitaci√≥n para quienes requieren configuraciones detalladas y personalizadas. Adem√°s, solo es compatible con sistemas que utilizan EFI.        Compatibilidad con M√∫ltiples Sistemas Operativos:A diferencia de GRUB, que maneja de forma eficiente sistemas operativos m√∫ltiples en un solo men√∫ de arranque, systemd-boot puede necesitar configuraciones manuales adicionales para lograr lo mismo.  GRUBVentajas      Soporte para Arranque Dual y Multisistema:GRUB es ideal para aquellos que necesitan administrar varios sistemas operativos en una sola m√°quina, ya que facilita la selecci√≥n del sistema a iniciar desde un men√∫ de arranque.        Opciones de Configuraci√≥n Avanzadas:Proporciona una amplia gama de opciones para personalizar el proceso de arranque, lo que lo convierte en una herramienta poderosa para usuarios que requieren un control detallado sobre la configuraci√≥n del sistema.  Desventajas      Mayor Complejidad para Principiantes:Debido a sus m√∫ltiples opciones de configuraci√≥n, puede resultar dif√≠cil de manejar para usuarios con poca experiencia. Editar archivos de configuraci√≥n manualmente puede ser una tarea desafiante para quienes no est√°n familiarizados con su funcionamiento.        Tiempo de Arranque M√°s Lento:Comparado con gestores de arranque m√°s livianos como systemd-boot, GRUB puede tardar m√°s en cargar el sistema operativo, lo que podr√≠a ser un inconveniente para quienes buscan un arranque r√°pido.  2. Versiones de GNU/Linux que est√°n usando systemd boot como gestor de arranque por defectoEn mayo de 2011, Fedora se convirti√≥ en la primera distribuci√≥n principal de Linux en habilitar systemd por defecto.Distribuciones en las que systemd est√° habilitado de forma predeterminada:  Arch Linux, Clear Linux, Pop!_Os, Fedora y Antergos.3. Migraci√≥n de Grub a SystemdBootPara hacer la migraci√≥n del gestor de arranque grub a systemd-boot usar√© una m√°quina virtual con Debian 12.Tenemos el siguiente esquema de particiones:Como podemos comprobar,el sistema ha arrancado mediante grub, ya que tiene su partici√≥n correspondiente /boot/efi. Para hacer la instalaci√≥n de SystemdBoot es importante que la partici√≥n de arranque se encuentre en formato vfat, ya que SystemdBoot no reconoce otro sistema de de ficheros.Empezaremos instalando el paquete que contiene todos los binarios que usaremos para el cambio:sudo apt install systemd-bootPor defecto, en un sistema con UEFI (Unified Extensible Firmware Interface), la partici√≥n de arranque EFI (/boot/efi) ya deber√≠a estar formateada en FAT32. Esto se debe a que el sistema UEFI utiliza este formato para almacenar los cargadores de arranque (como systemd-boot o GRUB) y otros archivos necesarios para el arranque del sistema.Pero por error durante la instalaci√≥n, he tenido que modificar el formato de la partici√≥n de la siguiente forma:pablo@debian:~$ sudo gdisk /dev/vdaCommand (? for help): t Partition number (1-3): 1Current type is 700 (Microsoft basic data)Hex code or GUID (L to show codes, Enter = 700): EF00Changed type of partition to 'EFI system partition'Command (? for help): wFinal checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTINGPARTITIONS!!Do you want to proceed? (Y/N): YOK; writing new GUID partition table (GPT) to /dev/vda.Warning: The kernel is still using the old partition table.The new table will be used at the next reboot or after yourun partprobe(8) or kpartx(8)The operation has completed successfully.Esto formate√≥ la partici√≥n correctamente en FAT32. Despu√©s de formatear la partici√≥n, he ejecutado el comando bootctl para instalar el cargador de arranque, y esta vez se complet√≥ correctamente sin errores:pablo@debian:~$ sudo bootctl --path=/boot/efi installCreated \"/boot/efi/EFI/systemd\".Created \"/boot/efi/EFI/BOOT\".Created \"/boot/efi/loader\".Created \"/boot/efi/loader/entries\".Created \"/boot/efi/EFI/Linux\".Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi\" to \"/boot/efi/EFI/systemd/systemd-bootx64.efi\".Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi\" to \"/boot/efi/EFI/BOOT/BOOTX64.EFI\".Random seed file /boot/efi/loader/random-seed successfully written (32 bytes).Not installing system token, since we are running in a virtualized environment.Created EFI boot entry \"Linux Boot Manager\".Ahora, la instalaci√≥n se complet√≥ con √©xito, creando los archivos y directorios esperados en /boot/efi:A continuaci√≥n ejecutaremos el siguiente comando:pablo@debian:~$ sudo bootctl install Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi\" to \"/boot/efi/EFI/systemd/systemd-bootx64.efi\".Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi\" to \"/boot/efi/EFI/BOOT/BOOTX64.EFI\".Random seed file /boot/efi/loader/random-seed successfully written (32 bytes).Not installing system token, since we are running in a virtualized environment.Created EFI boot entry \"Linux Boot Manager\".Este comando instalar√° el cargador de inicializaci√≥n de SystemdBoot.Vamos a editar el fichero loader.conf el cual se encuentra en el directorio que hemos comentado antes. En este fichero definimos las opciones de arranque del cargador. Habr√° que insertar el siguiente contenido:pablo@debian:~$ sudo cat /boot/efi/loader/loader.conf timeout 3console-mode keepeditor yesdefault debian.confPodemos comprobar que hemos especificado el fichero debian.conf, este fichero habr√° que crearlo manualmente a continuaci√≥n y ser√° nuestra entrada por defecto. Todas las entradas del cargador de arranque ser√°n definidas en el directorio /boot/efi/loader/entries como ficheros .conf.El fichero debian.conf que crear√© contiene lo siguiente:pablo@debian:/boot/efi/loader/entries$ cat debian.conf title Debian pavlolinux /boot/vmlinuz-6.1.0-30-amd64initrd /boot/initrd.img-6.1.0-30-amd64options root=UUID=1b5bfe97-7afe-4adb-8230-a03707f63e2d rw  Title: T√≠tulo de la entrada que veremos en el arranque.  Linux: Ruta de la imagen del kernel que vamos a iniciar, partiendo del directorio /boot/efi.  Initrd: Ruta de la imagen initrd que vamos a iniciar, partiendo del directorio /boot/efi.  Options: Partici√≥n ra√≠z que se montar√°. En esta debemos especificar el UUID de la partici√≥n (Podemos obtenerlo con el comando blkid). Aqu√≠ tambi√©n podemos definir las opciones de montaje, en mi caso rw, para lectura y escritura.Tambi√©n crear√© otra entrada para la Shell EFI:pablo@debian:/boot/efi/loader/entries$ cat shellefi.conftitle EFI Shellefi /EFI/shellx64.efiEl firmware shellx64.efi podemos descargarlo desde el siguiente enlace:https://github.com/holoto/efi_shell_flash_bios/blob/master/Shellx64.efiEl cual moveremos a la ruta que hemos especificado:pablo@debian:~$ sudo mv Shellx64.efi /boot/efi/EFI/pablo@debian:~$ ls -l /boot/efi/EFI/total 948drwxr-xr-x 2 root root   4096 ene 16 14:20 BOOTdrwxr-xr-x 2 root root   4096 ene 16 13:46 debiandrwxr-xr-x 2 root root   4096 ene 16 14:11 Linux-rwxr-xr-x 1 root root 951744 ene 16 14:28 Shellx64.efidrwxr-xr-x 2 root root   4096 ene 16 14:20 systemdUna vez hecho esTo debemos desactivar el Secure Boot, podemos hacerlo desde la BIOS o bien ejecutando el comando:pablo@debian:~$ sudo mokutil --disable-validationpassword length: 8~16input password: input password again: Despu√©s, actualizaremos el gestor de arranque SystemdBoot:pablo@debian:~$ sudo bootctl updateSkipping \"/boot/efi/EFI/systemd/systemd-bootx64.efi\", since same boot loader version in place already.Skipping \"/boot/efi/EFI/BOOT/BOOTX64.EFI\", since same boot loader version in place already.Como √∫ltimo paso, podemos comprobar el orden de arranque con efibootmgr:pablo@debian:~$ efibootmgrBootCurrent: 0004Timeout: 0 secondsBootOrder: 0001,0004,0002,0000,0003Boot0000* UiAppBoot0001* Linux Boot ManagerBoot0002* UEFI Misc DeviceBoot0003* EFI Internal ShellBoot0004* debianEl primero debe ser Linux Boot Manager, podemos cambiar el orden con efibootmgr -o XXXXPodemos opcionalmente desintalar grub, aunque yo no lo har√© en esta ocasi√≥n. Finalmente reiniciamos el equipo y comprobamos si arranca con SystemdBoot.A mi me di√≥ fallo, y tras varias pruebas e investigando consegu√≠ solucionarlo de la siguiente forma:Elimin√© la entrada de debian.conf, la cual estaba rota ya que no reconoc√≠a bien los archivos:pablo@debian:~$ sudo rm /boot/efi/loader/entries/debian.confLuego, regener√© las entradas de systemd-boot para que apunten a los archivos correctos:pablo@debian:~$ sudo bootctl updateSkipping \"/boot/efi/EFI/systemd/systemd-bootx64.efi\", since same boot loader version in place already.Skipping \"/boot/efi/EFI/BOOT/BOOTX64.EFI\", since same boot loader version in place already.Y finalmente reinici√© el sistema y me apareci√≥ correctamente:Pudiendo acceder sin problemas tanto al sistema:Como a la shell EFI:"
  },
  
  {
    "title": "systemd/sshfs",
    "url": "/posts/systemd/",
    "categories": "Sistemas, Systemd",
    "tags": "Systemd",
    "date": "2024-12-19 18:30:00 +0100",
    





    
    "snippet": "EnunciadoCrea dos instancias en OpenStack, basadas en la distribuci√≥n de tu elecci√≥n, anexa un volumen de 2GB.Una de las instancias har√° de servidor, donde anexar√°s el volumen anterior. Deber√°s con...",
    "content": "EnunciadoCrea dos instancias en OpenStack, basadas en la distribuci√≥n de tu elecci√≥n, anexa un volumen de 2GB.Una de las instancias har√° de servidor, donde anexar√°s el volumen anterior. Deber√°s configurar sshfs en el escenario, de tal forma que el cliente pueda montar el sistema de archivos remoto usando sshfs y systemd. La validaci√≥n del usuario se realizar√° mediante clave p√∫blica/privada.      Monta manualmente el sistema de archivos remoto.        Monta el sistema de archivos remoto de forma autom√°tica, mediante fichero /etc/fstab.        Monta el sistema de archivos remoto de forma autom√°tica, mediante fichero unidad .mount        Mediante fichero unidad .mount creado en el punto 3 y crea un fichero unidad de automontaje. unidad.automount, para que se monte autom√°ticamente cuando detecte peticiones al sistema de archivos remoto y se desmonte autom√°ticamente transcurrido un tiempo.  Ejercicio 1Comenzamos creando el escenario necesario para la pr√°ctica, en donde utilizaremos dos instancias de OpenStack. Una de ellas actuar√° como servidor y otra como cliente.Luego, anexamos un volumen de 2GB a la instancia del servidor:Seguidamente accedemos a las m√°quinas y generamos un par de claves en ellas:debian@systemd-server:~$ ssh-keygenGenerating public/private rsa key pair.Enter file in which to save the key (/home/debian/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/debian/.ssh/id_rsaYour public key has been saved in /home/debian/.ssh/id_rsa.pubThe key fingerprint is:SHA256:nUOO1c1ppJFcV7DSmpBD3PUqjQkfIQttT7cf4k+F0Qw debian@systemd-serverThe key's randomart image is:+---[RSA 3072]----+|        .oooo+E=+||         o+==Oo=o||         .Oo=.B+.||         * *.@oo.||        S = O +.o||           . o ..||              o  ||               . ||                 |+----[SHA256]-----+debian@systemd-client:~$ ssh-keygen Generating public/private rsa key pair.Enter file in which to save the key (/home/debian/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/debian/.ssh/id_rsaYour public key has been saved in /home/debian/.ssh/id_rsa.pubThe key fingerprint is:SHA256:Mzy940zFH1GQxcXWT73pMETToeu9eVZ8yOP24PReETA debian@systemd-clientThe key's randomart image is:+---[RSA 3072]----+|            .EoBO||             .*oB||            ...++||       . . . o.+o||        S . oo=+ ||         + o..=o=||          +  o+o+||         + . ooo*||          o  ..*=|+----[SHA256]-----+Comprobamos que el volumen que hemos anexado anteriormente aparezca en la instancia:debian@systemd-server:~$ lsblkNAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTSvda     254:0    0   10G  0 disk ‚îú‚îÄvda1  254:1    0  9.9G  0 part /‚îú‚îÄvda14 254:14   0    3M  0 part ‚îî‚îÄvda15 254:15   0  124M  0 part /boot/efivdb     254:16   0    2G  0 disk Como vemos el volumen ha sido a√±adido, por lo que ahora vamos a usar fdisk para crear una nueva partici√≥n en el volumen vdb:debian@systemd-server:~$ sudo fdisk /dev/vdbWelcome to fdisk (util-linux 2.38.1).Changes will remain in memory only, until you decide to write them.Be careful before using the write command.The device contains 'ext4' signature and it will be removed by a write command. See fdisk(8) man page and --wipe option for more details.Device does not contain a recognized partition table.Created a new DOS (MBR) disklabel with disk identifier 0x954ead4c.Command (m for help): nPartition type   p   primary (0 primary, 0 extended, 4 free)   e   extended (container for logical partitions)Select (default p): pPartition number (1-4, default 1): 1First sector (2048-4194303, default 2048): Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-4194303, default 4194303): Created a new partition 1 of type 'Linux' and of size 2 GiB.Command (m for help): wThe partition table has been altered.Calling ioctl() to re-read partition table.Syncing disks.Volvemos a comprobar las particiones:debian@systemd-server:~$ lsblkNAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTSvda     254:0    0   10G  0 disk ‚îú‚îÄvda1  254:1    0  9.9G  0 part /‚îú‚îÄvda14 254:14   0    3M  0 part ‚îî‚îÄvda15 254:15   0  124M  0 part /boot/efivdb     254:16   0    2G  0 disk ‚îî‚îÄvdb1  254:17   0    2G  0 partFormateamos la partici√≥n que acabamos de crear con un sistema ext4:debian@systemd-server:~$ sudo mkfs.ext4 /dev/vdb1mke2fs 1.47.0 (5-Feb-2023)Discarding device blocks: done                            Creating filesystem with 524032 4k blocks and 131072 inodesFilesystem UUID: b891fbd6-085d-4d5b-88c6-dc6093301465Superblock backups stored on blocks: \t32768, 98304, 163840, 229376, 294912Allocating group tables: done                            Writing inode tables: done                            Creating journal (8192 blocks): doneWriting superblocks and filesystem accounting information: doneLuego creamos el punto de montaje de la particci√≥n y lo montamos en el directorio que hemos seleccionado:debian@systemd-server:~$ sudo mkdir -p /mountdebian@systemd-server:~$ sudo mount /dev/vdb1 /mountVolvemos a comprobar que la partici√≥n se ha montado correctamente en el directorio indicado:debian@systemd-server:~$ lsblkNAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTSvda     254:0    0   10G  0 disk ‚îú‚îÄvda1  254:1    0  9.9G  0 part /‚îú‚îÄvda14 254:14   0    3M  0 part ‚îî‚îÄvda15 254:15   0  124M  0 part /boot/efivdb     254:16   0    2G  0 disk ‚îî‚îÄvdb1  254:17   0    2G  0 part /mountCreamos un fichero de prueba que usaremos para comprobar m√°s tarde que el montaje ha funcionado correctamente:debian@systemd-server:/mount$ cat kk.txt Buenas tardes por la ma√±anadebian@systemd-server:/mount$ ls -ltotal 20-rw-r--r-- 1 root root    29 Jan  9 07:51 kk.txtdrwx------ 2 root root 16384 Jan  9 07:48 lost+foundInstalamos sshfs en ambas instancias:debian@systemd-server:~$ sudo apt install sshfsdebian@systemd-client:~$ sudo apt install sshfsImportante, necesitaremos tener la clave p√∫blica de la m√°quina cliente en el fichero authorized_keys de la m√°quina servidor para que el montaje funcione correctamente.Por √∫ltimo, montamos el sistema de ficheros creado en la m√°quina servidor en la m√°quina cliente, utilizando sshfs con las siguientes instrucciones:debian@systemd-client:~$ mkdir montajedebian@systemd-client:~$ sshfs debian@10.0.0.22:/mount /home/debian/montaje/ -o IdentityFile=/home/debian/.ssh/id_rsaThe authenticity of host '10.0.0.22 (10.0.0.22)' can't be established.ED25519 key fingerprint is SHA256:jA8NMNDhdcLCYkll2HrP9UHnwsoIXcb/ZdbBlaNMvfo.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesdebian@systemd-client:~$ ls -l montaje/total 20-rw-r--r-- 1 root root    29 Jan  9 07:51 kk.txtdrwx------ 1 root root 16384 Jan  9 07:48 lost+founddebian@systemd-client:~$ cat montaje/kk.txt Buenas tardes por la ma√±anaComo vemos, el montaje ha funcionado a la perfecci√≥n:debian@systemd-client:~$ df -hFilesystem               Size  Used Avail Use% Mounted onudev                     462M     0  462M   0% /devtmpfs                     97M  512K   96M   1% /run/dev/vda1                9.7G  1.2G  8.1G  13% /tmpfs                    481M     0  481M   0% /dev/shmtmpfs                    5.0M     0  5.0M   0% /run/lock/dev/vda15               124M   12M  113M  10% /boot/efitmpfs                     97M     0   97M   0% /run/user/1000debian@10.0.0.22:/mount  2.0G   28K  1.9G   1% /home/debian/montajeEjercicio 2Para la realizaci√≥n del montaje autom√°tico usaremos fstab, donde tendremos que a√±adir la siguiente l√≠nea al fichero /etc/fstab de la m√°quina cliente:sshfs#debian@10.0.0.22:/mount /mnt/sshfs fuse defaults,_netdev,identityfile=/home/debian/.ssh/id_rsa,allow_other 0 0Esta configuraci√≥n permite montar un sistema de archivos remoto a trav√©s de SSH en el directorio local /mnt/sshfs. Para ello, se utiliza un usuario espec√≠fico, una direcci√≥n IP, y se accede a la carpeta remota empleando el sistema de archivos FUSE. Adem√°s, el proceso de autenticaci√≥n se realiza mediante una clave privada ubicada en /home/debian/.ssh/id_rsa.En la m√°quina cliente, se crea previamente el punto de montaje especificado:debian@systemd-client:~$ sudo mkdir -p /mnt/sshfsdebian@systemd-client:~$ sudo chown debian:debian /mnt/sshfsTras realizar un reinicio, comprobamos que el montaje se ha realizado correctamente:debian@systemd-client:~$ df -hFilesystem               Size  Used Avail Use% Mounted onudev                     462M     0  462M   0% /devtmpfs                     97M  500K   96M   1% /run/dev/vda1                9.7G  1.2G  8.1G  13% /tmpfs                    481M     0  481M   0% /dev/shmtmpfs                    5.0M     0  5.0M   0% /run/lock/dev/vda15               124M   12M  113M  10% /boot/efidebian@10.0.0.22:/mount  2.0G   28K  1.9G   1% /mnt/sshfstmpfs                     97M     0   97M   0% /run/user/1000Comprobamos que podemos ver el contenido del fichero anteriormente montado:debian@systemd-client:~$ ls -l /mnt/sshfs/total 20-rw-r--r-- 1 root root    29 Jan  9 07:51 kk.txtdrwx------ 1 root root 16384 Jan  9 07:48 lost+founddebian@systemd-client:~$ cat /mnt/sshfs/kk.txt Buenas tardes por la ma√±anaEjercicio 3En lugar de utilizar el archivo /etc/fstab para el montaje autom√°tico del sistema de archivos remoto, podemos emplear una unidad de systemd en la m√°quina cliente. Esto nos permitir√° gestionar el montaje con systemd de forma eficiente, especificando los par√°metros necesarios.debian@systemd-client:~$ cat /etc/systemd/system/home-debian-sshfs.mount[Unit]Description=Montaje sistema de archivos remoto[Mount]What=debian@10.0.0.22:/mountWhere=/home/debian/sshfsType=fuse.sshfsOptions=_netdev,IdentityFile=/home/debian/.ssh/id_rsa,allow_other,default_permissions,reconnectHacemos un reinicio para que los cambios se ejecuten:debian@systemd-client:~$ sudo systemctl daemon-reloaddebian@systemd-client:~$ sudo systemctl enable home-debian-sshfs.mountThe unit files have no installation config (WantedBy=, RequiredBy=, Also=,Alias= settings in the [Install] section, and DefaultInstance= for templateunits). This means they are not meant to be enabled using systemctl. Possible reasons for having this kind of units are:‚Ä¢ A unit may be statically enabled by being symlinked from another unit's  .wants/ or .requires/ directory.‚Ä¢ A unit's purpose may be to act as a helper for some other unit which has  a requirement dependency on it.‚Ä¢ A unit may be started when needed via activation (socket, path, timer,  D-Bus, udev, scripted systemctl call, ...).‚Ä¢ In case of template units, the unit is meant to be enabled with some  instance name specified.debian@systemd-client:~$ sudo systemctl start home-debian-sshfs.mountComprobamos que el montaje haya salido correctamente:debian@systemd-client:~$ df -hFilesystem               Size  Used Avail Use% Mounted onudev                     462M     0  462M   0% /devtmpfs                     97M  500K   96M   1% /run/dev/vda1                9.7G  1.2G  8.1G  13% /tmpfs                    481M     0  481M   0% /dev/shmtmpfs                    5.0M     0  5.0M   0% /run/lock/dev/vda15               124M   12M  113M  10% /boot/efitmpfs                     97M     0   97M   0% /run/user/1000debian@10.0.0.22:/mount  2.0G   28K  1.9G   1% /home/debian/sshfsAdem√°s, podemos ver el contenido:debian@systemd-client:~$ ls -l sshfs/total 20-rw-r--r-- 1 root root    29 Jan  9 07:51 kk.txtdrwx------ 1 root root 16384 Jan  9 07:48 lost+founddebian@systemd-client:~$ cat sshfs/kk.txt Buenas tardes por la ma√±anaEjercicio 4Vamos a configurar una unidad de automontaje adicional que trabajar√° en conjunto con la unidad .mount creada anteriormente. En esta nueva unidad de automontaje, definiremos la unidad de montaje previamente configurada, el punto de montaje que utilizaremos y un tiempo de inactividad (en segundos) tras el cual se desmontar√° autom√°ticamente si no hay actividad. Esto permitir√° que el sistema gestione el montaje de forma din√°mica.debian@systemd-client:~$ cat /etc/systemd/system/home-debian-sshfs.automount[Unit]Description=Automontaje del sistema de archivos remoto[Automount]Where=/home/debian/sshfsTimeoutIdleSec=10[Install]WantedBy=multi-user.targetAntes de reiniciar y activar el servicio del .automont, debemos deshabilitar y parar el servicio anterior de .mount.Esto se debe a que de lo contrario, el nuevo servicio no podr√° automontar el directorio, pues este ya estar√≠a creado.debian@systemd-client:~$ sudo systemctl disable home-debian-sshfs.mountdebian@systemd-client:~$ sudo systemctl stop home-debian-sshfs.mountWarning: Stopping home-debian-sshfs.mount, but it can still be activated by:  home-debian-sshfs.automountAhora s√≠, reiniciamos los cambios e iniciamos la unidad que acabamos de crear.debian@systemd-client:~$ sudo systemctl daemon-reloaddebian@systemd-client:~$ sudo systemctl enable home-debian-sshfs.automountThe unit files have no installation config (WantedBy=, RequiredBy=, Also=,Alias= settings in the [Install] section, and DefaultInstance= for templateunits). This means they are not meant to be enabled using systemctl. Possible reasons for having this kind of units are:‚Ä¢ A unit may be statically enabled by being symlinked from another unit's  .wants/ or .requires/ directory.‚Ä¢ A unit's purpose may be to act as a helper for some other unit which has  a requirement dependency on it.‚Ä¢ A unit may be started when needed via activation (socket, path, timer,  D-Bus, udev, scripted systemctl call, ...).‚Ä¢ In case of template units, the unit is meant to be enabled with some  instance name specified.debian@systemd-client:~$ sudo systemctl start home-debian-sshfs.automountPara realizar las comprobaciones debemos ver que si estamos en /home, no debemos tener el directorio montado:debian@systemd-client:~$ df -hFilesystem                Size  Used Avail Use% Mounted onudev                      462M     0  462M   0% /devtmpfs                      97M  500K   96M   1% /run/dev/vda1                 9.7G  1.7G  7.7G  18% /tmpfs                     481M     0  481M   0% /dev/shmtmpfs                     5.0M     0  5.0M   0% /run/lock/dev/vda15                124M   12M  113M  10% /boot/efidebian@10.0.0.151:/mount  2.0G   28K  1.9G   1% /mnt/sshfstmpfs                      97M     0   97M   0% /run/user/1000En cambio, si accedemos al directorio /sshfs notar√° la actividad y lo montar√°:debian@systemd-client:~$ cd sshfs/debian@systemd-client:~/sshfs$ ls -ltotal 20-rw-r--r-- 1 root root    29 Feb  6 12:02 kk.txtdrwx------ 1 root root 16384 Feb  6 12:01 lost+founddebian@systemd-client:~/sshfs$ cat kk.txt Buenas tardes por la ma√±anadebian@systemd-client:~/sshfs$ df -hFilesystem                Size  Used Avail Use% Mounted onudev                      462M     0  462M   0% /devtmpfs                      97M  500K   96M   1% /run/dev/vda1                 9.7G  1.7G  7.7G  18% /tmpfs                     481M     0  481M   0% /dev/shmtmpfs                     5.0M     0  5.0M   0% /run/lock/dev/vda15                124M   12M  113M  10% /boot/efidebian@10.0.0.151:/mount  2.0G   28K  1.9G   1% /mnt/sshfstmpfs                      97M     0   97M   0% /run/user/1000debian@10.0.0.151:/mount  2.0G   28K  1.9G   1% /home/debian/sshfsY al igual que lo monta cuando estamos en el directorio especificado, si nos volvemos a mover al directorio /home y esperamos 10 segundos, nos daremos cuenta de que se ha vuelto a desmontar:debian@systemd-client:~$ df -hFilesystem                Size  Used Avail Use% Mounted onudev                      462M     0  462M   0% /devtmpfs                      97M  500K   96M   1% /run/dev/vda1                 9.7G  1.7G  7.7G  18% /tmpfs                     481M     0  481M   0% /dev/shmtmpfs                     5.0M     0  5.0M   0% /run/lock/dev/vda15                124M   12M  113M  10% /boot/efidebian@10.0.0.151:/mount  2.0G   28K  1.9G   1% /mnt/sshfstmpfs                      97M     0   97M   0% /run/user/1000"
  },
  
  {
    "title": "Certificados digitales. HTTPS",
    "url": "/posts/certificado/",
    "categories": "Seguridad, Criptograf√≠a",
    "tags": "Criptograf√≠a",
    "date": "2024-12-19 18:30:00 +0100",
    





    
    "snippet": "Certificado digital de persona f√≠sicaTarea 1: Instalaci√≥n del certificado1. Una vez que hayas obtenido tu certificado, explica brevemente como se instala en tu navegador favorito.Para la instalaci√≥...",
    "content": "Certificado digital de persona f√≠sicaTarea 1: Instalaci√≥n del certificado1. Una vez que hayas obtenido tu certificado, explica brevemente como se instala en tu navegador favorito.Para la instalaci√≥n del certificado digital en mi navegador (Firefox), debemos dirigirnos al correo que nos manda la F√°brica Nacional de Moneda y Timbre al realizar la solicitud:Pinchamos en el enlace de descarga he introducimos los datos para continuar con la descarga:Una vez que hayamos descargado el certificado digital desde la FNMT, normalmente estar√° en formato .p12. Este archivo contiene tanto la clave p√∫blica como la clave privada del certificado.Por lo que para la instalaci√≥n:      Abrimos Firefox y nos dirigimos al men√∫ principal (√≠cono de tres l√≠neas horizontales).        Hacemos clic en Ajustes y luego seleccionamos la secci√≥n Privacidad &amp; Seguridad.        Nos desplazamos hasta la opci√≥n Certificados y pulsamos el bot√≥n Ver Certificados.        En la pesta√±a Sus Certificados, seleccionamos Importar‚Ä¶ y buscamos el archivo .p12.        Durante la importaci√≥n, nos pedir√° la contrase√±a que asignamos al descargar el certificado.  Una vez completado, el certificado aparecer√° en la lista de certificados personales.2. Muestra una captura de pantalla donde se vea las preferencias del navegador donde se ve instalado tu certificado.3. ¬øC√≥mo puedes hacer una copia de tu certificado?, ¬øComo vas a realizar la copia de seguridad de tu certificado?. Razona la respuesta.  En el men√∫ de opciones: Preferencias &gt; Privacidad y seguridad &gt; Seguridad &gt; Certificados.  Selecciona Ver certificados.  En Sus Certificados selecciona Hacer copia.De esta forma se realiza una copia del certificado digital. Y se introduce en un dispositivo externo para tener la copia.El certificado digital es √∫nico y personal. Si perdemos el archivo o la clave privada, no podremos firmar documentos ni realizar tr√°mites online que requieran autenticaci√≥n. Adem√°s, una p√©rdida implicar√≠a solicitar de nuevo el certificado desde cero a la FNMT.4. Investiga como exportar la clave p√∫blica de tu certificado.En Preferencias &gt; Privacidad y seguridad &gt; Seguridad &gt; Certificados &gt; Ver certificados hacemos doble click sobre el certificado para que aparezca el visor de certificados. En la pesta√±a Detalles da la opci√≥n de Exportar‚Ä¶.Una vez descargado el .pem debemos extraer la clave p√∫blica, pues en un principio estar√° cifrado y no podremos ver el contenido. Para ello:pavlo@debian:~/certificado()$ ls -ltotal 12-rw-r--r-- 1 pavlo pavlo 7010 dic 20 20:39 MARTIN_HIDALGO_PABLO.p12-rw-r--r-- 1 pavlo pavlo 3012 dic 27 17:29 martin-hidalgo-pablo.pempavlo@debian:~/certificado()$ sudo openssl pkcs12 -in MARTIN_HIDALGO_PABLO.p12 -clcerts -nokeys -out martin-hidalgo-pablo.pemEnter Import Password:Donde:  -in MARTIN_HIDALGO_PABLO.p12: Especifica el archivo de entrada en formato .p12.  -clcerts: Indica que se extraiga √∫nicamente el certificado del archivo, excluyendo certificados de la cadena o intermedios.  -nokeys: Evita que se exporte la clave privada.  -out martin-hidalgo-pablo.pem: Especifica el nombre del archivo de salida que contendr√° la clave p√∫blica en formato PEM.Una vez hecho esto ya podremos ver la clave p√∫blica.Tarea 2: Validaci√≥n del certificado1. Instala en tu ordenador el software autofirma y desde la p√°gina de VALIDe valida tu certificado. Muestra capturas de pantalla donde se comprueba la validaci√≥n.Descargamos el software desde la p√°gina https://firmaelectronica.gob.es/Home/Descargas.html. El archivo es un .zip.Antes de descomprimirlo, es necesario un paquete de java, donde tenemos que instalar los siquientes paquetes:pavlo@debian:~()$ sudo apt-get install default-jrpavlo@debian:~()$ sudo apt-get install default-jdkUna vez instalados los paquetes y descargada la herramienta necesaria:pavlo@debian:~/Descargas()$ unzip AutoFirma_Linux_Debian.zippavlo@debian:~/Descargas()$ sudo apt install libnss3-toolspavlo@debian:~/Descargas()$ sudo dpkg -i AutoFirma_1_8_3.debDespu√©s de instalar el software de AutoFirma nos dirigimos a la p√°gina web VALIDe para verificar el certificado.En donde debemos seleccionar el certificado:E introducir el c√≥digo de seguridad del CAPTCHA. Y ya tendr√≠amos el certificado validado correctamente:Tarea 3: Firma electr√≥nica1. Utilizando la p√°gina VALIDe y el programa autofirma, firma un documento con tu certificado y env√≠alo por correo a un compa√±ero.Para esta apartado voy a crear dos ficheros para posteriormente firmarlos con nuestro certificado digital. Uno de ellos se llamar√° ficherovalide.txt y otro ficheroautofirma.txtpavlo@debian:~/certificado()$ echo 'Este fichero est√° firmado por VALIDe' &gt; ficherovalide.txtpavlo@debian:~/certificado()$ echo 'Este fichero est√° firmado por AutoFirma' &gt; ficheroautofirma.txtUna vez generados los ficheros vamos a proceder a firmar el primero de ellos a trav√©s de la p√°gina VALIDe. En este caso, pulsaremos en el apartado Realizar Firma.En el men√∫ correspondiente, seleccionaremos la opci√≥n de Firmar. A continuaci√≥n, el sistema nos solicitar√° que indiquemos el archivo que deseamos firmar. En este caso, ser√° necesario elegir ficherovalide.txt y, adem√°s, especificar el certificado que utilizaremos para llevar a cabo la firma.Si todo ha salido correctamente nos saldr√° el siguiente mensaje:Una vez completado el proceso, se confirma que la firma se ha realizado con √©xito. En este punto, procederemos a Guardar Firma para almacenar en nuestro equipo el archivo generado. En mi caso, he optado por nombrarlo ficherovalide.txt_firmado.csig con el fin de distinguirlo f√°cilmente.Con esto, ya hemos firmado el primer archivo. Ahora, repetiremos el procedimiento con el segundo. Abriremos nuevamente la aplicaci√≥n de escritorio AutoFirma y seleccionaremos, en esta ocasi√≥n, el archivo ficheroautofirma.txt. Al pulsar en Firmar, se nos solicitar√° el certificado a utilizar y, posteriormente, la ubicaci√≥n donde deseamos guardar el documento firmado. Para diferenciarlo, he decidido asignarle el nombre ficheroautofirma.txt_firmado.csig.Si todo ha funcionado correctamente obtendremos el siguiente mensaje informativo:2. Tu debes recibir otro documento firmado por un compa√±ero y utilizando las herramientas anteriores debes visualizar la firma (Visualizar Firma) y (Verificar Firma). ¬øPuedes verificar la firma aunque no tengas la clave p√∫blica de tu compa√±ero?, ¬øEs necesario estar conectado a internet para hacer la validaci√≥n de la firma?. Razona tus respuestas.Para verificar estas firmas, accederemos a la plataforma VALIDe y seleccionaremos la opci√≥n ‚ÄúValidar Firma‚Äù.En esta secci√≥n, elegiremos el archivo firmado que deseamos comprobar. En este caso, seleccionaremos el archivo hola.txt_signed.csig, completaremos el Captcha solicitado y haremos clic en ‚ÄúValidar‚Äù.Si el proceso se realiza correctamente, obtendremos un mensaje informativo que confirma que la validaci√≥n ha sido exitosa:Este mensaje indica que la firma ha sido validada correctamente, lo que certifica que el archivo ha sido firmado por mi compa√±ero, quien no puede negar haber realizado esta acci√≥n. Luego, repetiremos el mismo procedimiento con el archivo hola2.txt_firmado.csig y obtendremos el siguiente resultado:3. Entre dos compa√±eros, firmar los dos un documento, verificar la firma para comprobar que est√° firmado por los dos.Tarea 4: Autentificaci√≥nAccedemos a la web de la DGT para verificar el funcionamiento de nuestro certificado digital accediendo a nuestro historial de puntos.Podremos elegir entre los distintos tipos de acceso y elegimos Cl@ve. Seguidamente, pulsaremos en DNIe / Certificado electr√≥nico y se abrir√° una ventana emergente. En dicha ventana emergente tendremos que seleccionar aquel certificado que queremos utilizar para la autenticaci√≥n, as√≠ que en mi caso, seleccionar√© el √∫nico disponible, de manera que si no ha habido ning√∫n problema, nos habremos autenticado en la p√°gina de la Direcci√≥n General de Tr√°fico sin tener que introducir ning√∫n tipo de credenciales:HTTPS / SSLAntes de hacer esta pr√°ctica vamos a crear una p√°gina web (puedes usar una p√°gina est√°tica o instalar una aplicaci√≥n web) en un servidor web apache2 que se acceda con el nombre tunombre.iesgn.org.Preparaci√≥n del sitio webPara realizar este punto, instalaremos un servidor apache, y lo configuraremos para que nos sirva una p√°gina web con https. Para ello, deberemos seguir los siguientes pasos:  Instalamos el servidor:debian@https:~$ sudo apt install apache2  Deshabilitamos el VirtualHost que viene por defecto para que no nos d√© problemas:debian@https:~$ sudo a2dissite 000-default.confSite 000-default disabled.To activate the new configuration, you need to run:  systemctl reload apache2debian@https:~$ sudo systemctl reload apache2  Creamos un nuevo fichero de configuraci√≥n donde ir√° el contenido:debian@https:~$ sudo mkdir /var/www/html/pablo.iesgn.orgdebian@https:~$ sudo nano /var/www/html/pablo.iesgn.org/index.htmldebian@https:~$ cat /var/www/html/pablo.iesgn.org/index.html&lt;!DOCTYPE html&gt;            &lt;html&gt;                &lt;head&gt;                &lt;title&gt;pablo.iesgn.org&lt;/title&gt;                &lt;/head&gt;            &lt;body&gt;                &lt;h1&gt;pablo.iesgn.org&lt;/h1&gt;                &lt;p&gt;Pagina web sencilla para criptografia - HTTPS/SSL&lt;/p&gt;            &lt;/body&gt;        &lt;/html&gt;  Ahora creamos un archivo de configuraci√≥n para el dominio pablo.iesgn.orgdebian@https:~$ cat /etc/apache2/sites-available/pablo.iesgn.org.conf&lt;VirtualHost *:80&gt;    ServerName pablo.iesgn.org    DocumentRoot /var/www/html/pablo.iesgn.org    &lt;Directory /var/www/html/pablo.iesgn.org&gt;        Options Indexes FollowSymLinks        AllowOverride All        Require all granted    &lt;/Directory&gt;    ErrorLog ${APACHE_LOG_DIR}/pablo.iesgn.org_error.log    CustomLog ${APACHE_LOG_DIR}/pablo.iesgn.org_access.log combined&lt;/VirtualHost&gt;  Habilitamos el nuevo VirtualHost y reiniciamos el servicio de Apache.debian@https:~$ sudo a2ensite pablo.iesgn.org.confEnabling site pablo.iesgn.org.To activate the new configuration, you need to run:  systemctl reload apache2debian@https:~$ sudo systemctl reload apache2  Por √∫ltimo tenemos que realizar la resoluci√≥n est√°tica, pues la p√°gina web est√° en una instancia de OpenStack:debian@https:~$ cat /etc/hosts127.0.0.1\tlocalhost::1\t\tlocalhost ip6-localhost ip6-loopbackff02::1\t\tip6-allnodesff02::2\t\tip6-allrouters172.22.200.222\tpablo.iesgn.orgpavlo@debian:~()$ cat /etc/hosts127.0.0.1\tlocalhost127.0.1.1\tdebian172.22.203.178  django-pablo.com#172.22.7.9\twordpress.pablo.beer#172.22.9.234\tbiblioteca.pablo.org172.22.123.1\tproxmox.gonzalonazareno.org172.22.200.222\tpablo.iesgn.org# The following lines are desirable for IPv6 capable hosts::1     localhost ip6-localhost ip6-loopbackff02::1 ip6-allnodesff02::2 ip6-allroutersY como vemos la p√°gina ya se puede ver correctamente:Tarea 1: Certificado autofirmadoEsta pr√°ctica la vamos a realizar con un compa√±ero. En un primer momento un alumno crear√° una Autoridad Certficadora y firmar√° un certificado para la p√°gina del otro alumno. Posteriormente se volver√° a realizar la pr√°ctica con los roles cambiados.Para hacer esta pr√°ctica puedes buscar informaci√≥n en internet, algunos enlaces interesantes:Phil‚Äôs X509/SSL GuideHow to setup your own CA with OpenSSLEn esta ocasi√≥n voy a ser yo el que haga de autoridad certificadora, de manera que podremos firmar el certificado para que nuestro compa√±ero pueda implementar HTTPS en su servidor.Crear una autoridad certificadoraEl primer paso consiste en establecer un directorio base para la Autoridad Certificadora (CA), con subdirectorios dedicados a diferentes funciones. Esto ayudar√° a mantener la organizaci√≥n durante todo el proceso. En este ejemplo, el directorio principal ser√° CA/ y contendr√°:      certsdb: Almac√©n de certificados firmados.        certreqs: Almac√©n de solicitudes de firma de certificados (CSR).        crl: Almac√©n de la lista de certificados revocados (CRL).        private: Almac√©n para la clave privada de la autoridad certificadora.  Para crear esta estructura de directorios, ejecutaremos:debian@https:~$ mkdir -p CA/{certsdb,certreqs,crl,private}Una vez creados los directorios, accedemos al directorio principal y visualizamos la estructura:debian@https:~/CA$ tree.‚îú‚îÄ‚îÄ certreqs‚îú‚îÄ‚îÄ certsdb‚îú‚îÄ‚îÄ crl‚îî‚îÄ‚îÄ privateComo el directorio private contendr√° informaci√≥n sensible (la clave privada de la CA), es importante restringir su acceso √∫nicamente al propietario. Cambiamos sus permisos a 700:debian@https:~/CA$ chmod 700 ./privateLa CA necesitar√° un archivo que act√∫e como base de datos para registrar los certificados emitidos. Este archivo se crear√° con:debian@https:~/CA$ touch index.txtEn este paso, copiaremos el archivo de configuraci√≥n predeterminado de OpenSSL a nuestro directorio de trabajo y lo personalizaremos para adaptarlo a nuestra CA.  Buscamos el archivo de configuraci√≥n de OpenSSL en nuestro sistema. Las ubicaciones comunes son:      /usr/lib/ssl/openssl.cnf        /etc/openssl.cnf        /usr/share/ssl/openssl.cnf    Copiamos el archivo al directorio CA:debian@https:~/CA$ cp /usr/lib/ssl/openssl.cnf ./  Realizamos las siguientes modificaciones para que OpenSSL utilice los directorios creados anteriormente:dir             = /home/debian/CAcerts           = $dir/certsdbnew_certs_dir   = $certscountryName_default             = ESstateOrProvinceName_default     = SevillalocalityName                    = Dos Hermanas0.organizationName              = PabloMartin SLorganizationalUnitName          = Informatica#challengePassword              = A challenge password#challengePassword_min          = 4#challengePassword_max          = 20#unstructuredName               = An optional company nameImportante recalcar que estas solo son las modificaciones que yo he realizado, no es el fichero de configuraci√≥n al completo.Una vez completados estos pasos, estaremos preparados para generar nuestro par de claves junto con un archivo de solicitud de firma de certificado. Posteriormente, procederemos a su autofirma. Para ello, ejecutaremos el siguiente comando:debian@https:~/CA$ sudo openssl req -new -newkey rsa:2048 -keyout private/cakey.pem -out careq.pem -config ./openssl.cnf..+...+.+.....+.+.....+....+..+...+.......+.....+...+..........+.........+..+...+.+.................+...................+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+...........................+.+...+.........+..+..........+...+......+..+...+.......+..+.+.....+.........+....................................+.........+.+......+.....+..........+...+..................+.........+.....+...+.+..+...+....+...+.........+.........+.........+.....+.......+...+..................+...+..+....+......+...+...........+...+.......+...+.....+...+....+......+............+.................+................+..............+....+...........+........................+.+.....+......+..........+.....+....+...............+......+...+..+....+...+...+.........+........+.+.........+..+.+.........+...+..+....+..+...+....+........+.......+..+....+.....+............+...+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++....+.+........+....+..+....+.........+...............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+............+..+.......+.....+....+..+...+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++Enter PEM pass phrase:Verifying - Enter PEM pass phrase:-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Country Name (2 letter code) [ES]:State or Province Name (full name) [Sevilla]:Dos Hermanas []:PabloMartin SL [Internet Widgits Pty Ltd]:Informatica []:Common Name (e.g. server FQDN or YOUR name) []:pablo.debianEmail Address []:pmartinhidalgo19@gmail.comEl comando para crear un nuevo par de claves y una solicitud de firma de certificado (CSR) incluye estas opciones:  -new: Genera un par de claves nuevo.  -newkey: Define el tipo y tama√±o del par de claves, en este caso RSA de 2048 bits.  -keyout: Especifica la ubicaci√≥n donde se guardar√° la clave privada (por ejemplo, en private/cakey.pem).  -out: Define d√≥nde guardar el CSR (por ejemplo, careq.pem).  -config: Indica a OpenSSL usar un archivo de configuraci√≥n personalizado (openssl.cnf).Al ejecutar el comando, se solicita una frase de paso para proteger la clave privada. Tambi√©n se piden algunos datos b√°sicos que deben coincidir con la informaci√≥n previamente configurada en el archivo openssl.cnf.Despu√©s de crear el CSR, se puede autofirmar el certificado para usarlo como Autoridad Certificadora (CA). Esto se realiza con el comando:debian@https:~/CA$ sudo openssl ca -create_serial -out cacert.pem -days 365 -keyfile private/cakey.pem -selfsign -extensions v3_ca -config ./openssl.cnf -infiles careq.pemUsing configuration from ./openssl.cnfEnter pass phrase for private/cakey.pem:Check that the request matches the signatureSignature okCertificate Details:        Serial Number:            36:15:6a:51:89:82:f6:66:e0:d2:4a:5d:43:61:6f:7b:3b:87:c3:5b        Validity            Not Before: Jan 11 11:56:18 2025 GMT            Not After : Jan 11 11:56:18 2026 GMT        Subject:            countryName               = ES            stateOrProvinceName       = Sevilla            organizationName          = Internet Widgits Pty Ltd            commonName                = pablo.debian            emailAddress              = pmartinhidalgo19@gmail.com        X509v3 extensions:            X509v3 Subject Key Identifier:                 70:63:CD:8F:AD:5E:82:EF:B8:DB:43:10:03:24:CA:AE:EB:6D:2F:5F            X509v3 Authority Key Identifier:                 70:63:CD:8F:AD:5E:82:EF:B8:DB:43:10:03:24:CA:AE:EB:6D:2F:5F            X509v3 Basic Constraints: critical                CA:TRUECertificate is to be certified until Jan 11 11:56:18 2026 GMT (365 days)Sign the certificate? [y/n]:y1 out of 1 certificate requests certified, commit? [y/n]yWrite out database with 1 new entriesDatabase updatedPar√°metros clave:  -create_serial: Genera un n√∫mero de serie √∫nico de 128 bits para evitar conflictos si se reinicia el proceso.  -out: Especifica el archivo de salida del certificado firmado (por ejemplo, cacert.pem).  -days: Define la validez del certificado en d√≠as (en este caso, 365 d√≠as).  -keyfile: Utiliza la clave privada creada anteriormente (private/cakey.pem) para la firma.  -selfsign: Indica que el certificado ser√° autofirmado.  -extensions: Selecciona las extensiones configuradas en el archivo openssl.cnf (por ejemplo, v3_ca).  -config: Indica el archivo de configuraci√≥n de OpenSSL modificado.  -infiles: Especifica el CSR a firmar (en este caso, careq.pem).Durante la ejecuci√≥n, OpenSSL solicita:  La frase de paso configurada para la clave privada.  Confirmaci√≥n de la informaci√≥n del certificado antes de firmarlo.  Aprobaci√≥n final para guardar el certificado.Para asegurarnos de que el certificado de la autoridad certificadora est√° presente en el directorio actual, procederemos a listar su contenido utilizando el siguiente comando:debian@https:~/CA$ ls -ltotal 52-rw-r--r-- 1 root root  4614 Jan 11 11:56 cacert.pem-rw-r--r-- 1 root root  1045 Jan 11 11:51 careq.pemdrwxr-xr-x 2 root root  4096 Jan 11 11:30 certreqsdrwxr-xr-x 2 root root  4096 Jan 11 11:56 certsdbdrwxr-xr-x 2 root root  4096 Jan 11 11:30 crl-rw-r--r-- 1 root root   166 Jan 11 11:56 index.txt-rw-r--r-- 1 root root    21 Jan 11 11:56 index.txt.attr-rw-r--r-- 1 root root     0 Jan 11 11:37 index.txt.old-rw-r--r-- 1 root root 12279 Jan 11 11:46 openssl.cnfdrwx------ 2 root root  4096 Jan 11 11:50 private-rw-r--r-- 1 root root    41 Jan 11 11:56 serialComo vemos existe un fichero cacert.pem que es resultado de firmar el fichero de solicitud de firma de certificado careq.pem.Todo est√° preparado para firmar el certificado del servidor de mi compa√±ero. Por ello, he colocado su archivo de solicitud de firma dentro del directorio certreqs/, que es la ubicaci√≥n designada para estos casos.debian@https:~/CA$ ls -l certreqs/total 4-rw-r--r-- 1 root root 1074 Jan 11 12:10 joseantoniocgonzalez.csrYa podemos proceder a firmar usando el siguiente comando:debian@https:~/CA$ sudo openssl ca -config openssl.cnf -out certsdb/joseantoniocgonzalez.crt -infiles certreqs/joseantoniocgonzalez.csrUsing configuration from openssl.cnfEnter pass phrase for /home/debian/CA/private/cakey.pem:Check that the request matches the signatureSignature okCertificate Details:        Serial Number:            36:15:6a:51:89:82:f6:66:e0:d2:4a:5d:43:61:6f:7b:3b:87:c3:5d        Validity            Not Before: Jan 11 12:37:59 2025 GMT            Not After : Jan 11 12:37:59 2026 GMT        Subject:            countryName               = ES            stateOrProvinceName       = SEVILLA            localityName              = SEVILLA            organizationName          = ASIR            commonName                = joseantoniocgonzalez.iesgn.org            emailAddress              = joseantoniocgonzalez83@gmail.com        X509v3 extensions:            X509v3 Basic Constraints:                 CA:FALSE            X509v3 Subject Key Identifier:                 0C:95:B9:A0:01:E3:46:16:7D:FE:4D:E1:6B:54:A4:E0:AA:DC:05:80            X509v3 Authority Key Identifier:                 70:63:CD:8F:AD:5E:82:EF:B8:DB:43:10:03:24:CA:AE:EB:6D:2F:5FCertificate is to be certified until Jan 11 12:37:59 2026 GMT (365 days)Sign the certificate? [y/n]:y1 out of 1 certificate requests certified, commit? [y/n]yWrite out database with 1 new entriesDatabase updatedDonde:  -config: Indica a OpenSSL que utilice un archivo de configuraci√≥n personalizado, en este caso llamado openssl.cnf, en lugar del predeterminado.  -out: Especifica d√≥nde se guardar√° el certificado firmado. Aqu√≠, se almacenar√° en el directorio certsdb/ con el nombre joseantoniocgonzalez.crt.  -infiles: Se√±ala el archivo CSR que se desea firmar. En este caso, es el archivo joseantoniocgonzalez.csr, ubicado en el directorio certreqs/.Al ejecutar el comando, OpenSSL solicita la frase de paso configurada previamente para proteger la clave privada de la autoridad certificadora. Esto garantiza que, incluso si la clave privada cae en manos equivocadas, no puedan realizar firmas indebidas. Antes de proceder, OpenSSL tambi√©n muestra la informaci√≥n contenida en el certificado para confirmar que es correcta.Una vez firmado, el certificado se almacena en el directorio certsdb/. Para confirmar su creaci√≥n, listamos el contenido de dicho directorio con el comando:debian@https:~/CA$ ls -l certsdb/total 24-rw-r--r-- 1 root root 4614 Jan 11 11:56 36156A518982F666E0D24A5D43616F7B3B87C35B.pem-rw-r--r-- 1 root root 4643 Jan 11 12:38 36156A518982F666E0D24A5D43616F7B3B87C35D.pem-rw-r--r-- 1 root root 4643 Jan 11 12:38 joseantoniocgonzalez.crtEl resultado muestra tres archivos:  El certificado de la autoridad certificadora.  Dos archivos relacionados con el certificado del compa√±ero: uno identificado con un n√∫mero de serie y otro con un nombre descriptivo, facilitando su identificaci√≥n.El archivo que debe entregarse al compa√±ero es certsdb/joseantoniocgonzalez.crt, que contiene su certificado firmado. Adem√°s, debe recibir el archivo cacert.pem, que es el certificado de la autoridad certificadora, necesario para verificar la validez del certificado.El archivo index.txt funciona como una base de datos en texto plano que registra informaci√≥n sobre los certificados emitidos por la CA. Se puede visualizar con:debian@https:~/CA$ cat index.txtV\t260111115618Z\t\t36156A518982F666E0D24A5D43616F7B3B87C35B\tunknown\t/C=ES/ST=Sevilla/O=Internet Widgits Pty Ltd/CN=pablo.debian/emailAddress=pmartinhidalgo19@gmail.comV\t260111123759Z\t\t36156A518982F666E0D24A5D43616F7B3B87C35D\tunknown\t/C=ES/ST=SEVILLA/L=SEVILLA/O=ASIR/CN=joseantoniocgonzalez.iesgn.org/emailAddress=joseantoniocgonzalez83@gmail.comEn el contenido se puede observar:  Estado de los certificados: En este caso, ambos est√°n marcados como v√°lidos (V).  Fecha de expiraci√≥n: Indica hasta cu√°ndo es v√°lido cada certificado.  N√∫mero de serie: Identificador √∫nico de cada certificado.  Informaci√≥n del sujeto: Detalla los campos incluidos en el CSR, como el pa√≠s, la organizaci√≥n y el correo electr√≥nico.Configurar HTTPSAhora me toca hacerlo al rev√©s, lo primero ser√° generar una solicitud de firma de certificado (CSR, por sus siglas en ingl√©s). En este caso utilizaremos OpenSSL, aunque tambi√©n se podr√≠an emplear otras herramientas de software para lograrlo.Para crear la solicitud, primero necesitamos contar con una clave privada que estar√° vinculada al certificado. Por lo tanto, procederemos a generar una clave privada RSA de 4096 bits, la cual ser√° almacenada en el directorio /etc/ssl/private/. Esto se realiza mediante el siguiente comando:debian@https:~$ sudo openssl genrsa 4096 &gt; pablomh.keydebian@https:~$ sudo mv pablomh.key /etc/ssl/private/Despu√©s de generar la clave privada, ajustaremos sus permisos a 400, lo que restringir√° el acceso para que √∫nicamente el propietario pueda leer su contenido. Dado que se trata de informaci√≥n sensible, este paso, aunque no obligatorio, es altamente recomendable por razones de seguridad.debian@https:~$ sudo chmod 400 /etc/ssl/private/pablomh.keyA continuaci√≥n, procederemos a generar un archivo .csr, que ser√° la solicitud de firma de certificado destinada a ser validada por la autoridad certificadora (CA) configurada por nuestro compa√±ero. Este archivo no incluye informaci√≥n sensible, por lo que su ubicaci√≥n y los permisos asignados no son cr√≠ticos. Por lo tanto:debian@https:~$ sudo openssl req -new -key /etc/ssl/private/pablomh.key -out pablomh.csrYou are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter '.', the field will be left blank.-----Country Name (2 letter code) [AU]:ESState or Province Name (full name) [Some-State]:SevillaLocality Name (eg, city) []:Dos HermanasOrganization Name (eg, company) [Internet Widgits Pty Ltd]:ASIROrganizational Unit Name (eg, section) []:InformaticaCommon Name (e.g. server FQDN or YOUR name) []:pablo.debian   Email Address []:pmartinhidalgo19@gmail.comPlease enter the following 'extra' attributesto be sent with your certificate requestA challenge password []:An optional company name []:Durante la ejecuci√≥n, nos pedir√° una serie de valores para identificar al certificado, que tendremos que rellenar en base a la informaci√≥n que nos proporcionar√° la autoridad certificadora; excepto los dos √∫ltimos valores, los cuales pedir√°n una serie de valores cuya introducci√≥n es opcional.Para verificar que el fichero de solicitud de firma ha sido correctamente generado listaremos el contenido del directorio actual:debian@https:~$ ls -ltotal 16drwxr-xr-x 6 root   root   4096 Jan 11 12:38 CA-rw-r--r-- 1 root   root   1773 Jan 14 17:00 pablomh.csrEn el directorio podemos observar un archivo llamado pablomh.csr, el cual debemos enviar a nuestro compa√±ero para que sea firmado por la autoridad certificadora que ha creado. Junto con el certificado firmado, nuestro compa√±ero tambi√©n deber√° enviarnos la clave p√∫blica de la entidad certificadora, es decir, su certificado, ya que ser√° necesario para verificar la firma aplicada a nuestro certificado.Bien, pues Jose ya me ha enviado ambos ficheros, los cuales voy a almacenar en /etc/ssl/certs/.debian@https:~$ ls -l /etc/ssl/certs/ | grep 'pablomh'-rw-r--r-- 1 root root   2090 Jan 14 17:31 pablomh.crtdebian@https:~$ ls -l /etc/ssl/certs/ | grep 'cacert'-rw-r--r-- 1 root root   2244 Jan 14 17:31 cacert.pemDebe existir un fichero de nombre tunombre.crt que es el resultado de la firma de la solicitud de firma de certificado que previamente le hemos enviado, y otro de nombre cacert.pem, que es el certificado de la entidad certificadora, con el que posteriormente se comprobar√° la firma de la autoridad certificadora sobre dicho certificado del servidor.Al igual que Apache2 incluye un VirtualHost predeterminado para gestionar las solicitudes en el puerto 80 (HTTP), tambi√©n dispone de otro por defecto para las conexiones entrantes en el puerto 443 (HTTPS). Este VirtualHost, llamado default-ssl, viene deshabilitado por defecto, por lo que ser√° necesario activarlo y modificar su configuraci√≥n.Para ello, ajustaremos las siguientes directivas esenciales:  ServerName: Especifica el dominio a trav√©s del cual accederemos al servidor, manteni√©ndolo coherente con la configuraci√≥n del VirtualHost de HTTP.  SSLEngine: Habilita el motor SSL, requisito indispensable para el uso de HTTPS. Su valor debe establecerse en on.  SSLCertificateFile: Define la ruta del certificado del servidor firmado por la autoridad certificadora (CA). En este caso, el archivo se encuentra en /etc/ssl/certs/pablomh.crt.  SSLCertificateKeyFile: Indica la ubicaci√≥n de la clave privada correspondiente al certificado del servidor. Se encuentra en /etc/ssl/private/pablomh.key.  SSLCACertificateFile: Especifica la ruta del certificado de la autoridad certificadora, necesario para verificar la firma del certificado del servidor. En este caso, se ubica en /etc/ssl/certs/cacert.pem.Con estas configuraciones correctamente aplicadas, el VirtualHost estar√° listo para gestionar conexiones seguras mediante HTTPS.Quedando el archivo final de la siguiente forma:debian@https:~$ cat /etc/apache2/sites-available/default-ssl.conf&lt;VirtualHost *:80&gt;   ServerName pablo.iesgn.org  Redirect permanent / https://pablo.iesgn.org/&lt;/VirtualHost&gt;&lt;VirtualHost *:443&gt;\tServerAdmin webmaster@localhost\tServerName pablo.iesgn.org\tDocumentRoot /var/www/html\tErrorLog ${APACHE_LOG_DIR}/error.log\tCustomLog ${APACHE_LOG_DIR}/access.log combined\tSSLEngine on\t\tSSLCertificateFile      /etc/ssl/certs/pablomh.crt\tSSLCertificateKeyFile /etc/ssl/private/pablomh.key\tSSLCACertificateFile /etc/ssl/certs/cacert.pem&lt;/VirtualHost&gt;Como este VirtualHost no est√° habilitado de manera predeterminada, ser√° necesario activarlo manualmente. Para ello, utilizaremos las herramientas proporcionadas por Apache2 para gestionar la activaci√≥n de sitios y configuraciones:debian@https:~# sudo a2ensite default-sslEnabling site default-ssl.To activate the new configuration, you need to run:  systemctl reload apache2Para garantizar que el acceso a la p√°gina siempre se realice de forma segura a trav√©s de HTTPS (https://), deberemos establecer una redirecci√≥n permanente desde el VirtualHost que escucha en el puerto 80 (HTTP) hacia el VirtualHost en el puerto 443 (HTTPS). Esto impedir√° que los usuarios accedan al servidor utilizando HTTP y los forzar√° a usar HTTPS.En el archivo de configuraci√≥n del VirtualHost en el puerto 80, a√±adiremos una redirecci√≥n permanente utilizando la directiva Redirect. Deber√° quedar algo similar a lo siguiente:debian@https:~$ cat /etc/apache2/sites-available/000-default.conf&lt;VirtualHost *:80&gt;        ServerName pablo.iesgn.org        ServerAdmin webmaster@localhost        DocumentRoot /var/www/html        ErrorLog ${APACHE_LOG_DIR}/error.log        CustomLog ${APACHE_LOG_DIR}/access.log combined        Redirect 301 / https://pablo.iesgn.com/&lt;/VirtualHost&gt;Esta directiva Redirect permanent redirigir√° todas las peticiones que lleguen al servidor a trav√©s del puerto 80 hacia el mismo dominio pero utilizando el puerto 443, lo cual asegura que todas las conexiones se realicen de manera segura mediante HTTPS. Con esta configuraci√≥n, cualquier intento de acceso por HTTP ser√° autom√°ticamente redirigido a HTTPS.Reiniciamos:debian@https:~$ sudo systemctl restart apache2Podemos observar que se ha generado una advertencia de seguridad, lo que confirma que la redirecci√≥n de http:// a https:// se ha realizado con √©xito.Esta advertencia se debe a que el navegador no ha podido verificar la firma del certificado recibido desde el servidor, ya que no dispone de la clave p√∫blica o del certificado de la Autoridad Certificadora (CA). Para solucionar esto, es necesario importar manualmente dicho certificado en el navegador.En el caso de Firefox, para llevar a cabo esta importaci√≥n, primero debemos hacer clic en el icono de las tres barras ubicado en la parte superior del navegador. Luego, accedemos a Preferencias (o Ajustes) y buscamos la secci√≥n Privacidad &amp; Seguridad. Desplaz√°ndonos hasta la parte inferior, encontraremos el apartado Certificados, donde haremos clic en Ver certificados. A continuaci√≥n, en la pesta√±a Autoridades, seleccionamos la opci√≥n Importar, lo que nos permitir√° a√±adir el certificado de la CA.Una vez elegido el certificado a importar, aparecer√° un mensaje inform√°ndonos de que se nos solicita confiar en una nueva Autoridad Certificadora (CA). En este punto, simplemente confirmamos la acci√≥n haciendo clic en Aceptar.Despu√©s de completar estos pasos, podremos comprobar que el certificado ha sido importado correctamente.Una vez importado el certificado recargamos la p√°gina para mostrar el contenido:Como podemos notar, la advertencia de seguridad ha vuelto a aparecer. Si observamos junto a la barra de direcciones, veremos un icono de candado. Al hacer clic en √©l, se desplegar√° la informaci√≥n correspondiente.Adem√°s, si le damos a Ver Certificado nos mostrar√° informaci√≥n del mismo:¬øPor qu√© el sitio no es seguro a pesar de usar HTTPS?El navegador sigue indicando que el sitio no es seguro porque el certificado utilizado ha sido emitido por una Autoridad Certificadora (CA) que no es reconocida como confiable por los navegadores. Esto ocurre porque el certificado ha sido generado por la CA de mi compa√±ero, y aunque la conexi√≥n est√© cifrada mediante HTTPS, navegadores como Chrome o Firefox no confiar√°n en una entidad que no est√© validada a nivel internacional.Hemos verificado que con Apache2 hemos logrado que HTTPS funcione, aunque sin una certificaci√≥n oficial no ser√° reconocido como seguro. Ahora realizaremos la misma prueba con la otra alternativa: Nginx.El primer paso ser√° desinstalar apache2 para evitar posibles conflictos, y tras ello, instalar nginx.Despu√©s de esto, podemos proceder con la configuraci√≥n del nuevo servidor web. Este servicio tambi√©n incluye un VirtualHost por defecto, pero a diferencia de Apache2, permite unificar en un solo archivo la configuraci√≥n tanto del VirtualHost que opera en el puerto 80 como el del puerto 443. Este archivo se encuentra en la ruta /etc/nginx/sites-available/default.De forma que el fichero quedar√≠a de la siguiente forma:debian@https:~$ sudo cat /etc/nginx/sites-enabled/default server {        listen 80 default_server;        listen [::]:80 default_server;        server_name pablo.iesgn.org;        return 301 https://$host$request_uri;}server {        listen 443 ssl default_server;        listen [::]:443 ssl default_server;        ssl    on;        ssl_certificate    /etc/ssl/certs/pablomh.crt;        ssl_certificate_key    /etc/ssl/private/pablomh.key;        root /var/www/html/pablo.iesgn.org;        index index.html index.htm index.nginx-debian.html;        server_name pablo.iesgn.org;        location / {                try_files $uri $uri/ =404;        }}Reiniciamos para que se efect√∫en los cambios:debian@https:~$ sudo systemctl reload nginxTras ello, ya estar√° todo listo para acceder a pablo.iesgn.org desde el navegador.Y como podemos observar, el certificado de mi compa√±ero est√° funcionando correctamente."
  },
  
  {
    "title": "Integridad, firmas y autenticaci√≥n",
    "url": "/posts/integridad/",
    "categories": "Seguridad, Criptograf√≠a",
    "tags": "Criptograf√≠a",
    "date": "2024-12-19 18:30:00 +0100",
    





    
    "snippet": "Tarea 1: Firmas electr√≥nicasEn este primer apartado vamos a trabajar con las firmas el√©ctronicas, por lo que vamos a apoyarnos en los siguientes enlaces:  Intercambio de claves  Validaci√≥n de otras...",
    "content": "Tarea 1: Firmas electr√≥nicasEn este primer apartado vamos a trabajar con las firmas el√©ctronicas, por lo que vamos a apoyarnos en los siguientes enlaces:  Intercambio de claves  Validaci√≥n de otras claves en nuestro anillo de claves p√∫blicas  Firmado de claves (Debian)Manda un documento y la firma electr√≥nica del mismo a un compa√±ero. Verifica la firma que t√∫ has recibido.Antes de comenzar la pr√°ctica, voy a listar las claves existentes en mi keyring:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]Como podemos observar, en mi anillo de claves se encuentra mi clave personal. Por tanto, el siguiente paso ser√° subir esta clave a un servidor de claves, como puede ser keys.gnupg.net, utilizando el fingerprint para identificarla de forma precisa.pavlo@debian:~()$ gpg --keyserver keys.gnupg.net --send-key C2E235639EB3A2A420828C9DED45D8BE85D4DB1Agpg: enviando clave ED45D8BE85D4DB1A a hkp://pgp.surf.nlLa clave ha sido enviada al servidor de claves, lo que permitir√° que cualquier persona que reciba mi archivo firmado pueda descargarla e importarla para verificar la firma.Es posible elegir entre dos m√©todos al firmar un archivo: incluir la firma directamente dentro del archivo utilizando la opci√≥n --sign, o bien generar la firma en un archivo separado, dejando el original intacto. En este caso, optaremos por la segunda alternativa, usando la opci√≥n --detach-sign.Por lo tanto, procederemos a firmar un documento llamado UE-Empresa.pdf, separando la firma en un archivo distinto. Para lograrlo, ejecutaremos el comando correspondiente:pavlo@debian:~()$ gpg --detach-sign UE-Empresa.pdfDurante el proceso de firmado, el sistema solicitar√° la frase de paso asociada a nuestra clave privada. Una vez ingresada correctamente, el firmado se completar√°. A continuaci√≥n, procederemos a listar el documento firmado:pavlo@debian:~()$ ls -l | grep 'UE'-rw-r--r--  1 pavlo pavlo 33734 nov 22 12:09 UE-Empresa.pdf-rw-r--r--  1 pavlo pavlo   438 dic 18 17:28 UE-Empresa.pdf.sigPara verificar que est√° firmado por nosotros ejecutamos el siguiente comando:pavlo@debian:~()$ gpg --verify UE-Empresa.pdf.sig UE-Empresa.pdfgpg: Firmado el mi√© 18 dic 2024 17:28:53 CETgpg:                usando RSA clave C2E235639EB3A2A420828C9DED45D8BE85D4DB1Agpg: Firma correcta de \"Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\" [absoluta]Podemos observar que tanto el archivo original (UE-Empresa.pdf) como su firma (UE-Empresa.pdf.sig) est√°n en ficheros independientes. Esto nos permite enviarlos a otra persona, quien podr√° verificar la integridad del archivo utilizando nuestra clave p√∫blica.En este caso, mi compa√±ero tambi√©n ha seguido un procedimiento similar al nuestro. Por lo tanto, antes de proceder a verificar la firma de su archivo, es necesario importar su clave p√∫blica. Para realizar este paso, utilizar√© el siguiente comando:pavlo@debian:~()$ gpg --keyserver pgp.rediris.es --recv-keys DB72B640gpg: clave F78DAA71DB72B640: clave p√∫blica \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Como podemos observar a continuaci√≥n, la clave p√∫blica de mi compa√±ero Jose se ha importado correctamente:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]pub   rsa4096 2024-12-18 [SC] [caduca: 2025-12-18]      7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640uid        [desconocida] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa4096 2024-12-18 [E] [caduca: 2025-12-18]Jose me ha enviado dos ficheros, un fichero documento.txt que es el fichero original, y un fichero documento.txt.sig, que contiene la firma del mismo. Para verificar la firma, vamos a hacer uso de la opci√≥n --verify, pasando como par√°metros ambos ficheros:pavlo@debian:~()$ gpg --verify documento.txt.sig documento.txtgpg: Firmado el mi√© 18 dic 2024 18:42:03 CETgpg:                usando RSA clave 7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640gpg: Firma correcta de \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" [desconocido]gpg: ATENCI√ìN: ¬°Esta clave no est√° certificada por una firma de confianza!gpg:          No hay indicios de que la firma pertenezca al propietario.Huellas dactilares de la clave primaria: 7E7E CEAC 3D3D F6FD AF90  3497 F78D AA71 DB72 B640Como muestra la salida del comando, la firma es v√°lida. Sin embargo, tambi√©n aparece un mensaje indicando que la clave no est√° certificada por una firma confiable. Esto significa que no existen pruebas de que la firma pertenezca realmente al propietario declarado. Esto ocurre porque la clave p√∫blica que acabamos de importar carece de validez, ya que no la hemos firmado ni contamos con intermediarios confiables que puedan respaldarla de manera indirecta. M√°s adelante, explicaremos este concepto con mayor profundidad.Antes de continuar con el siguiente paso, he optado por eliminar la clave p√∫blica de mi anillo de claves. Esto me permitir√° empezar desde cero, asegur√°ndome de que no quede ninguna clave almacenada. Para realizar esta acci√≥n, utilizar√© la opci√≥n --delete-keys:pavlo@debian:~()$ gpg --delete-keys 7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa4096/F78DAA71DB72B640 2024-12-18 jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;¬øEliminar esta clave del anillo? (s/N) sYa he eliminado la clave p√∫blica de Jose de mi keyring.Crea un anillo de confianza entre los miembros de la clasePara garantizar la seguridad en el uso de claves GPG, es fundamental asegurarnos de que las claves p√∫blicas con las que interactuamos realmente pertenecen a sus supuestos due√±os. Sin esta verificaci√≥n, podr√≠amos estar cifrando informaci√≥n para un atacante en lugar del destinatario leg√≠timo o aceptando firmas falsas sin darnos cuenta. La confianza en las claves es, por tanto, un aspecto esencial en la criptograf√≠a.Una forma de establecer esta confianza es a trav√©s del anillo de confianza, un sistema basado en la validaci√≥n mutua entre personas que conf√≠an entre s√≠. Este mecanismo permite que los usuarios firmen la huella digital (fingerprint) de una clave p√∫blica utilizando su propia clave privada. Una vez firmada, la clave se devuelve a su propietario, quien puede compartirla con otros, demostrando as√≠ que ha sido validada por alguien de confianza.Este proceso no solo fortalece la credibilidad de una clave, sino que tambi√©n facilita la verificaci√≥n indirecta. Si confiamos en una persona y esta, a su vez, ha certificado la clave de otra, podemos asumir que dicha clave es confiable sin necesidad de validarla directamente. La efectividad de este modelo depende de c√≥mo se configuren las relaciones de confianza y de la fiabilidad de quienes participan en la red.Aunque puede parecer complicado al principio, este sistema es muy √∫til para garantizar la autenticidad de las claves en un entorno seguro. Un ejemplo pr√°ctico ayudar√° a comprender mejor su funcionamiento.Pasos para crear un anillo de confianzaEl primer paso es subir nuestra clave p√∫blica a un servidor de claves, en este caso lo subir√© a pgp.rediris.es:pavlo@debian:~()$ gpg --keyserver hkp://pgp.rediris.es --send-keys C2E235639EB3A2A420828C9DED45D8BE85D4DB1Agpg: enviando clave ED45D8BE85D4DB1A a hkp://pgp.rediris.esLuego, procedemos a descargarnos las claves p√∫blicas de mis compa√±eros, usando sus nombres o correos en la b√∫squeda de pgp.rediris.es, con el siguiente comando:pavlo@debian:~()$ gpg --keyserver pgp.rediris.es --recv-keys DB72B640gpg: clave F78DAA71DB72B640: clave p√∫blica \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1B√°sicamente cogemos los √∫ltimos d√≠gitos para importar la clave y repetimos el proceso con todos los compa√±eros.Seguidamente, tendremos que firmar las claves p√∫blicas descargadas para poder validarlas en nuestro anillo de confianza. Lo haremos de la siguiente forma:pavlo@debian:~()$ gpg --sign-key 7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640pub  rsa4096/F78DAA71DB72B640     creado: 2024-12-18  caduca: 2025-12-18  uso: SC       confianza: desconocido   validez: desconocidosub  rsa4096/C32521E4109A45D6     creado: 2024-12-18  caduca: 2025-12-18  uso: E   [desconocida] (1). jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;pub  rsa4096/F78DAA71DB72B640     creado: 2024-12-18  caduca: 2025-12-18  uso: SC       confianza: desconocido   validez: desconocido Huella clave primaria: 7E7E CEAC 3D3D F6FD AF90  3497 F78D AA71 DB72 B640     jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;Esta clave expirar√° el 2025-12-18.¬øEst√° realmente seguro de querer firmar esta clavecon su clave: \"Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\" (ED45D8BE85D4DB1A)?¬øFirmar de verdad? (s/N) sRepetimos el proceso con Alejandro Li√°√±ez y con Andr√©s Morales.A continuaci√≥n, ser√° necesario exportar las claves de nuestros compa√±eros con la firma que hemos generado recientemente. Este paso nos permitir√° distribuirlas manualmente a sus propietarios, quienes podr√°n importarlas en su sistema. Para este prop√≥sito, en mi caso, export√© las claves de tres compa√±eros utilizando los siguientes comandos:pavlo@debian:~()$ gpg --armor --export -a \"Andr√©s Morales Gonz√°lez\" &gt; andres123.ascpavlo@debian:~()$ gpg --armor --export -a \"jose antonio canalo gonzalez\" &gt; clave-canalo.ascpavlo@debian:~()$ gpg --armor --export -a \"Alejandro Li√°√±ez Frutos\" &gt; ale.ascY como vemos las claves han sido correctamente exportadas a los correspondientes ficheros:pavlo@debian:~()$ ls -l | grep '.asc'-rw-r--r--  1 pavlo pavlo  4260 dic 18 19:41 ale.asc-rw-r--r--  1 pavlo pavlo  3069 dic 18 17:48 andres123.asc-rw-r--r--  1 pavlo pavlo  3780 dic 18 19:34 clave-canalo.ascMis compa√±eros han seguido los mismos pasos, as√≠ que ellos tambi√©n me enviaron mi clave con las correspondientes firmas, que debemos importar:pavlo@debian:~/firma()$ ls -ltotal 12-rw-r--r-- 1 pavlo pavlo 3244 dic 18 19:37 pablo_firmada.asc-rw-r--r-- 1 pavlo pavlo 3663 dic 18 18:42 pmh19.asc-rw-r--r-- 1 pavlo pavlo 3069 dic 18 17:44 pmh.ascComo vemos hay 3 ficheros, pertenecientes a cada uno de los compa√±eros que han colaborado conmigo en este anillo de confianza, por lo que ahora tendremos que importarlas:pavlo@debian:~/firma()$ gpg --import pablo_firmada.asc gpg: clave ED45D8BE85D4DB1A: \"Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\" 1 firma nuevagpg: Cantidad total procesada: 1gpg:         nuevas firmas: 1gpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   1  firmada:   3  confianza: 0-, 0q, 0n, 0m, 0f, 1ugpg: nivel: 1  validez:   3  firmada:   0  confianza: 3-, 0q, 0n, 0m, 0f, 0ugpg: siguiente comprobaci√≥n de base de datos de confianza el: 2025-12-18Ahora, verificamos que mis compa√±eros hayan firmado mi clave:pavlo@debian:~/firma()$ gpg --list-sig \"Pablo Mart√≠n Hidalgo\"pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sig 3        ED45D8BE85D4DB1A 2024-12-13  Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sig          1B80812C7BB9EA86 2024-12-18  Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;sig          9E7BEEE532BE0469 2024-12-18  Alejandro Li√°√±ez Frutos &lt;alejandroliafru@gmail.com&gt;sig          F78DAA71DB72B640 2024-12-18  jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]sig          ED45D8BE85D4DB1A 2024-12-13  Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;Y como vemos a continuaci√≥n:pavlo@debian:~()$ gpg --list-keysgpg: comprobando base de datos de confianzagpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   1  firmada:   3  confianza: 0-, 0q, 0n, 0m, 0f, 1ugpg: nivel: 1  validez:   3  firmada:   0  confianza: 3-, 0q, 0n, 0m, 0f, 0ugpg: siguiente comprobaci√≥n de base de datos de confianza el: 2025-12-18/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      B39722468D0599C3B62F9AEA9E7BEEE532BE0469uid        [   total   ] Alejandro Li√°√±ez Frutos &lt;alejandroliafru@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]pub   rsa3072 2024-12-16 [SC] [caduca: 2026-12-16]      B7E822D8FB45BD8BAF2F31561B80812C7BB9EA86uid        [   total   ] Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;sub   rsa3072 2024-12-16 [E] [caduca: 2026-12-16]pub   rsa4096 2024-12-18 [SC] [caduca: 2025-12-18]      7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640uid        [   total   ] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa4096 2024-12-18 [E] [caduca: 2025-12-18]Todas las claves han sido ya firmadas (es posible que nos haya pedido la frase de paso de nuestra clave privada a la hora de llevar a cabo el proceso de firmado), su validez ha cambiado de desconocida a total, por lo que en caso de querer encriptar con dichas claves p√∫blicas o comprobar firmas, no se nos mostrar√° el mensaje de advertencia.Podemos verificar que todas las claves se encuentran firmadas por todos, por lo que todos hemos validado las claves de todos.Comprueba que ya puedes verificar sin ‚Äúproblemas‚Äù una firma recibida por una persona en la que conf√≠as.Como podemos observar, el documento firmado anteriormente ya nos muestra el mensaje de que la firma es correcta:pavlo@debian:~()$ gpg --verify documento.txt.sig gpg: asumiendo que los datos firmados est√°n en 'documento.txt'gpg: Firmado el mi√© 18 dic 2024 18:42:03 CETgpg:                usando RSA clave 7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640gpg: Firma correcta de \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" [total]Comprueba que puedes verificar con confianza una firma de una persona en las que no conf√≠as, pero sin embargo si conf√≠a otra persona en la que tu tienes confianza total.El primer paso es asignar un nivel de confianza absoluta a la clave de una persona (Andr√©s Morales Gonz√°lez en este caso), bajo el supuesto de que verificar√° correctamente las claves de otros usuarios. Esto se realiza con los comandos:pavlo@debian:~/firma()$ gpg --edit-key \"Andr√©s Morales Gonz√°lez\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa3072/1B80812C7BB9EA86     creado: 2024-12-16  caduca: 2026-12-16  uso: SC       confianza: desconocido   validez: totalsub  rsa3072/31278448B2A4EFCA     creado: 2024-12-16  caduca: 2026-12-16  uso: E   [   total   ] (1). Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;gpg&gt; trustpub  rsa3072/1B80812C7BB9EA86     creado: 2024-12-16  caduca: 2026-12-16  uso: SC       confianza: desconocido   validez: totalsub  rsa3072/31278448B2A4EFCA     creado: 2024-12-16  caduca: 2026-12-16  uso: E   [   total   ] (1). Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;Por favor, decida su nivel de confianza en que este usuarioverifique correctamente las claves de otros usuarios (mirandopasaportes, comprobando huellas dactilares en diferentes fuentes...)  1 = No lo s√© o prefiero no decirlo  2 = NO tengo confianza  3 = Conf√≠o un poco  4 = Conf√≠o totalmente  5 = conf√≠o absolutamente  m = volver al men√∫ principal¬øSu decisi√≥n? 5¬øDe verdad quiere asignar absoluta confianza a esta clave? (s/N) spub  rsa3072/1B80812C7BB9EA86     creado: 2024-12-16  caduca: 2026-12-16  uso: SC       confianza: absoluta      validez: totalsub  rsa3072/31278448B2A4EFCA     creado: 2024-12-16  caduca: 2026-12-16  uso: E   [   total   ] (1). Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;Ten en cuenta que la validez de clave mostrada no es necesariamentecorrecta a menos de que reinicies el programa.gpg&gt; quitSeleccionamos el nivel 5 (confianza absoluta) y confirmamos la acci√≥n. Esto marca la clave como confiable para firmar otras claves, lo que permite delegar la validaci√≥n.Luego, importamos la clave p√∫blica del firmante final, en este caso Juan Antonio Pineda Amador, utilizando su identificador:pavlo@debian:~/firma()$ gpg --keyserver keyserver.ubuntu.com --recv-keys d30d0b7e734fcf74gpg: clave D30D0B7E734FCF74: clave p√∫blica \"Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Esto descarga e importa la clave p√∫blica al anillo de claves.Luego, importamos una versi√≥n de la clave firmada por alguien en quien conf√≠o (como Andr√©s Morales Gonz√°lez):pavlo@debian:~/firma()$ gpg --import clave-firmada-pablo.asc gpg: clave ED45D8BE85D4DB1A: \"Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\" 1 firma nuevagpg: Cantidad total procesada: 1gpg:         nuevas firmas: 1gpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   2  firmada:   2  confianza: 0-, 0q, 0n, 0m, 0f, 2ugpg: nivel: 1  validez:   2  firmada:   0  confianza: 2-, 0q, 0n, 0m, 0f, 0ugpg: siguiente comprobaci√≥n de base de datos de confianza el: 2025-12-18Por √∫ltimo damos nuestra confianza absoluta en Juan Antonio Pineda:pavlo@debian:~/firma()$ gpg --edit-key \"Juan Antonio Pineda Amador\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa3072/D30D0B7E734FCF74     creado: 2024-12-13  caduca: 2026-12-13  uso: SC       confianza: desconocido   validez: desconocidosub  rsa3072/BC028BCC730037FF     creado: 2024-12-13  caduca: 2026-12-13  uso: E   [desconocida] (1). Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;gpg&gt; trustpub  rsa3072/D30D0B7E734FCF74     creado: 2024-12-13  caduca: 2026-12-13  uso: SC       confianza: desconocido   validez: desconocidosub  rsa3072/BC028BCC730037FF     creado: 2024-12-13  caduca: 2026-12-13  uso: E   [desconocida] (1). Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;Por favor, decida su nivel de confianza en que este usuarioverifique correctamente las claves de otros usuarios (mirandopasaportes, comprobando huellas dactilares en diferentes fuentes...)  1 = No lo s√© o prefiero no decirlo  2 = NO tengo confianza  3 = Conf√≠o un poco  4 = Conf√≠o totalmente  5 = conf√≠o absolutamente  m = volver al men√∫ principal¬øSu decisi√≥n? 5¬øDe verdad quiere asignar absoluta confianza a esta clave? (s/N) spub  rsa3072/D30D0B7E734FCF74     creado: 2024-12-13  caduca: 2026-12-13  uso: SC       confianza: absoluta      validez: desconocidosub  rsa3072/BC028BCC730037FF     creado: 2024-12-13  caduca: 2026-12-13  uso: E   [desconocida] (1). Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;Ten en cuenta que la validez de clave mostrada no es necesariamentecorrecta a menos de que reinicies el programa.gpg&gt; quitpavlo@debian:~/firma()$ gpg --list-siggpg: comprobando base de datos de confianzagpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   3  firmada:   2  confianza: 0-, 0q, 0n, 0m, 0f, 3ugpg: nivel: 1  validez:   2  firmada:   0  confianza: 2-, 0q, 0n, 0m, 0f, 0ugpg: siguiente comprobaci√≥n de base de datos de confianza el: 2025-12-18/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sig 3        ED45D8BE85D4DB1A 2024-12-13  Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sig          1B80812C7BB9EA86 2024-12-18  Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;sig          9E7BEEE532BE0469 2024-12-18  Alejandro Li√°√±ez Frutos &lt;alejandroliafru@gmail.com&gt;sig          F78DAA71DB72B640 2024-12-18  jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sig          D30D0B7E734FCF74 2024-12-19  Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]sig          ED45D8BE85D4DB1A 2024-12-13  Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      B39722468D0599C3B62F9AEA9E7BEEE532BE0469uid        [   total   ] Alejandro Li√°√±ez Frutos &lt;alejandroliafru@gmail.com&gt;sig 3        9E7BEEE532BE0469 2024-12-12  Alejandro Li√°√±ez Frutos &lt;alejandroliafru@gmail.com&gt;sig          1B80812C7BB9EA86 2024-12-17  Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;sig          EB11F07AEE22B444 2024-12-18  [ID de usuario no encontrado]sig          ED45D8BE85D4DB1A 2024-12-18  Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]sig          9E7BEEE532BE0469 2024-12-12  Alejandro Li√°√±ez Frutos &lt;alejandroliafru@gmail.com&gt;pub   rsa3072 2024-12-16 [SC] [caduca: 2026-12-16]      B7E822D8FB45BD8BAF2F31561B80812C7BB9EA86uid        [  absoluta ] Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;sig 3        1B80812C7BB9EA86 2024-12-16  Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;sig          ED45D8BE85D4DB1A 2024-12-18  Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-16 [E] [caduca: 2026-12-16]sig          1B80812C7BB9EA86 2024-12-16  Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;pub   rsa4096 2024-12-18 [SC] [caduca: 2025-12-18]      7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640uid        [   total   ] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sig 3        F78DAA71DB72B640 2024-12-18  jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sig          ED45D8BE85D4DB1A 2024-12-18  Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa4096 2024-12-18 [E] [caduca: 2025-12-18]sig          F78DAA71DB72B640 2024-12-18  jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;pub   rsa3072 2023-02-22 [SC] [caduca: 2025-02-21]      D6E21A8B6ED6E8EF9F7CE81686F55C1E2DA53D65uid        [desconocida] Ra√∫l Ruiz &lt;raulpruebas21@gmail.com&gt;sig 3        86F55C1E2DA53D65 2023-02-22  Ra√∫l Ruiz &lt;raulpruebas21@gmail.com&gt;sub   rsa3072 2023-02-22 [E] [caduca: 2025-02-21]sig          86F55C1E2DA53D65 2023-02-22  Ra√∫l Ruiz &lt;raulpruebas21@gmail.com&gt;pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      97AAB306BAF9F7A0600C9F7CD30D0B7E734FCF74uid        [  absoluta ] Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;sig 3        D30D0B7E734FCF74 2024-12-13  Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]sig          D30D0B7E734FCF74 2024-12-13  Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;Con ambas claves presentes (la del intermediario y la del firmante final), verificamos el archivo firmado y el archivo original para comprobar su autenticidad:pavlo@debian:~/firma()$ gpg --verify pinedadocumento.txt.sig pinedadocumento.txtgpg: Firmado el dom 15 dic 2024 18:36:36 CETgpg:                usando RSA clave 97AAB306BAF9F7A0600C9F7CD30D0B7E734FCF74gpg: Firma correcta de \"Juan Antonio Pineda Amador &lt;juanantpiama@gmail.com&gt;\" [absoluta]Y como vemos el sistema confirma la firma.Tarea 2: Correo seguro con evolution/thunderbirdAhora vamos a configurar nuestro cliente de correo electr√≥nico para poder mandar correos cifrados, para ello:Configura el cliente de correo evolution con tu cuenta de correo habitualPara este apartado lo que haremos ser√° instalar Thunderbird con el siguiente comando:pavlo@debian:~()$ sudo apt install thunderbird-l10n-es-esUna vez instalado ejecutamos Thunderbird y rellenamos los campos:Despu√©s de hacer la verificaci√≥n en dos pasos ya nos dejar√° entrar sin ning√∫n problema:A√±ade a la cuenta las opciones de seguridad para poder enviar correos firmados con tu clave privada o cifrar los mensajes para otros destinatariosPara este apartado debemos utilizar la clave privada, por lo que primero debemos listarla:pavlo@debian:~/firma()$ gpg --list-secret-keys/home/pavlo/.gnupg/pubring.kbx------------------------------sec   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;ssb   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]Ahora, utilizando el ID de nuestra clave, debemos exportarla en un fichero para m√°s tarde configurarlo en Thunderbird:pavlo@debian:~/firma()$ gpg --export-secret-keys --armor C2E235639EB3A2A420828C9DED45D8BE85D4DB1A &gt; clave-thunderbird.ascPosiblemente nos pida la frase de paso, la introducimos y ya deber√≠a generarse el fichero:pavlo@debian:~/firma()$ ls -l | grep 'clave'-rw-r--r-- 1 pavlo pavlo 7187 dic 19 11:57 clave-thunderbird.ascSeguidamente, debemos dirigirnos a la aplicaci√≥n de correos e importar la clave que acabamos de crear. Para ello nos dirigimos a Ajustes¬†¬ª Configuraci√≥n de la cuenta¬†¬ª Cifrado de extremo a extremo, le damos a a√±adir clave y seleccionamos la creada anteriormente:Y como vemos ya se ha importado correctamente la clave:Env√≠a y recibe varios mensajes con tus compa√±eros y comprueba el funcionamiento adecuado de GPGPara esta prueba, le he mandado un correo a Andr√©s Morales (asirandyglez@gmail.com) con su clave p√∫blica la cual me ha pasado:pavlo@debian:~/firma()$ ls -ltotal 28-rw-r--r-- 1 pavlo pavlo 4256 dic 19 12:10 andy-and1.asc-rw-r--r-- 1 pavlo pavlo 7187 dic 19 11:57 clave-thunderbird.asc-rw-r--r-- 1 pavlo pavlo 3244 dic 18 19:37 pablo_firmada.asc-rw-r--r-- 1 pavlo pavlo 3663 dic 18 18:42 pmh19.asc-rw-r--r-- 1 pavlo pavlo 3069 dic 18 17:44 pmh.ascPor lo tanto, enviamos un mensaje y seleccionamos el fichero de su clave para que se firme el correo:Por otro lado, Andr√©s me enviar√° un correo firmado con mi clave p√∫blica:Y como podemos observar, desde gmail no nos dejar√° ver el contenido:Enviar un correo electr√≥nico al profesor con un mensaje firmado por vosotros y que solo pueda descifrar yo.Para la realizaci√≥n de este apartado extra debemos importar la clave del profesor Ra√∫l en nuestro sistema. Para ello nos dirigimos a la p√°gina wiki y nos descargamos su clave:pavlo@debian:~/firma()$ gpg --keyserver keyserver.ubuntu.com --recv-keys 86f55c1e2da53d65gpg: clave 86F55C1E2DA53D65: clave p√∫blica \"Ra√∫l Ruiz &lt;raulpruebas21@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Como podemos observar, su clave se ha importado correctamente:pavlo@debian:~/firma()$ gpg --list-keys /home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-13 [SC] [caduca: 2026-12-13]      C2E235639EB3A2A420828C9DED45D8BE85D4DB1Auid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-13 [E] [caduca: 2026-12-13]pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      B39722468D0599C3B62F9AEA9E7BEEE532BE0469uid        [   total   ] Alejandro Li√°√±ez Frutos &lt;alejandroliafru@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]pub   rsa3072 2024-12-16 [SC] [caduca: 2026-12-16]      B7E822D8FB45BD8BAF2F31561B80812C7BB9EA86uid        [   total   ] Andr√©s Morales Gonz√°lez &lt;asirandyglez@gmail.com&gt;sub   rsa3072 2024-12-16 [E] [caduca: 2026-12-16]pub   rsa4096 2024-12-18 [SC] [caduca: 2025-12-18]      7E7ECEAC3D3DF6FDAF903497F78DAA71DB72B640uid        [   total   ] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa4096 2024-12-18 [E] [caduca: 2025-12-18]pub   rsa3072 2023-02-22 [SC] [caduca: 2025-02-21]      D6E21A8B6ED6E8EF9F7CE81686F55C1E2DA53D65uid        [desconocida] Ra√∫l Ruiz &lt;raulpruebas21@gmail.com&gt;sub   rsa3072 2023-02-22 [E] [caduca: 2025-02-21]Por lo que ahora debemos hacer lo mismo que antes, exportar la clave en un fichero .asc y a√±adirla en Thunderbird:pavlo@debian:~/firma()$ gpg --export --armor 86f55c1e2da53d65 &gt; clave-raul.ascVamos a enviar un nuevo correo a Ra√∫l a su correo y debemos darle arriba a la izquierda a ‚ÄúCifrar‚Äù. Una vez seleccionado esta opci√≥n nos saldr√° un mensaje abajo en amarillo, en donde debemos darle a ‚ÄúResolver‚Äù. Ah√≠ importamos la clave de Ra√∫l y ya estar√≠a:Y como podemos comprobar a continuaci√≥n, el correo ha sido enviado con OpenGPG:Tarea 3: Integridad de ficherosVamos a descargarnos la ISO de debian, y posteriormente vamos a comprobar su integridad.Puedes encontrar la ISO en la direcci√≥n: https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/.Para validar el contenido de la imagen CD, solo aseg√∫rese de usar la herramienta apropiada para sumas de verificaci√≥n. Para cada versi√≥n publicada existen archivos de suma de comprobaci√≥n con algoritmos fuertes (SHA256 y SHA512); deber√≠a usar las herramientas sha256sum o sha512sum para trabajar con ellosPues lo primero que debemos hacer es descargar la ISO de Debian 12 y el fichero de suma de comprobaci√≥n(SHA512):pavlo@debian:~/integridad()$ wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-12.8.0-amd64-netinst.isopavlo@debian:~/integridad()$ wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA512SUMSUtilizamos la herramienta sha512sum para generar el hash de la imagen ISO descargada y comparar el resultado con el hash proporcionado en los archivos de suma de comprobaci√≥n.pavlo@debian:~/integridad()$ ls -ltotal 646148-rw-r--r-- 1 pavlo pavlo 661651456 nov  9 13:46 debian-12.8.0-amd64-netinst.iso-rw-r--r-- 1 pavlo pavlo       494 nov  9 17:34 SHA512SUMSpavlo@debian:~/integridad()$ sha512sum --check --ignore-missing SHA512SUMSdebian-12.8.0-amd64-netinst.iso: La suma coincideY como vemos el contenido de la imagen CD coincide.Verifica que el contenido del hash que has utilizado no ha sido manipulado, usando la firma digital que encontrar√°s en el repositorio. Puedes encontrar una gu√≠a para realizarlo en este art√≠culo: How to verify an authenticity of downloaded Debian ISO imagesEste paso verifica que el archivo de suma de comprobaci√≥n no ha sido manipulado y que est√° firmado por una clave confiable. Por lo que debemos descargarnos la firma digital:pavlo@debian:~/integridad()$ wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA512SUMS.signVerificamos la firma y como vemos a continuaci√≥n nos saldr√° un mensaje de error de que es imposible comprobar la firma:pavlo@debian:~/integridad()$ gpg --verify SHA512SUMS.sign SHA512SUMSgpg: Firmado el s√°b 09 nov 2024 17:35:02 CETgpg:                usando RSA clave DF9B9C49EAA9298432589D76DA87E80D6294BE9Bgpg: Imposible comprobar la firma: No hay clave p√∫blicaEsto se debe a que no tenemos importada la clave p√∫blica de la persona que firm√≥ dicho fichero, por lo que para solucionar esto debemos importar la clave:pavlo@debian:~/integridad()$ gpg --keyserver keyserver.ubuntu.com --recv-keys DF9B9C49EAA9298432589D76DA87E80D6294BE9Bgpg: clave DA87E80D6294BE9B: clave p√∫blica \"Debian CD signing key &lt;debian-cd@lists.debian.org&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Volvemos a verificar la firma:pavlo@debian:~/integridad()$ gpg --verify SHA512SUMS.sign SHA512SUMSgpg: Firmado el s√°b 09 nov 2024 17:35:02 CETgpg:                usando RSA clave DF9B9C49EAA9298432589D76DA87E80D6294BE9Bgpg: Firma correcta de \"Debian CD signing key &lt;debian-cd@lists.debian.org&gt;\" [desconocido]gpg: ATENCI√ìN: ¬°Esta clave no est√° certificada por una firma de confianza!gpg:          No hay indicios de que la firma pertenezca al propietario.Huellas dactilares de la clave primaria: DF9B 9C49 EAA9 2984 3258  9D76 DA87 E80D 6294 BE9BY efectivamente, el hash del fichero resumen coincide con el hash del fichero resumen que Debian ha firmado, por lo que podemos concluir que no ha habido ninguna manipulaci√≥n y las im√°genes ISO est√°n totalmente limpias.Al no tener validada la clave de Debian nos ha mostrado la advertencia de seguridad, pero eso no tiene nada que ver, pues la firma ha sido correctamente verificada.Tarea 4: Integridad y autenticidad (apt secure)APT Secure es el mecanismo utilizado por Debian para garantizar que los paquetes instalados desde sus repositorios oficiales sean leg√≠timos y no hayan sido modificados. Este sistema utiliza criptograf√≠a asim√©trica para verificar la autenticidad de los paquetes.¬øQu√© software utiliza apt secure para realizar la criptograf√≠a asim√©trica?APT Secure utiliza GNU Privacy Guard (GPG) para realizar la criptograf√≠a asim√©trica, firmando digitalmente los paquetes y verificando las firmas de los mismos.¬øPara que sirve el comando apt-key? ¬øQu√© muestra el comando apt-key list?El comando apt-key es una herramienta que permite gestionar las claves utilizadas por APT para autenticar paquetes, considerando como confiables aquellos paquetes que han sido correctamente autenticados mediante estas claves. Las opciones m√°s comunes son:      add: A√±ade una nueva clave a la lista de claves de confianza desde un archivo que se pasa como par√°metro.        del: Elimina una clave de la lista de claves de confianza, especificando el fingerprint de la clave como par√°metro.        export: Muestra la clave a trav√©s de la salida est√°ndar, indicando el fingerprint de la misma como par√°metro.        exportall: Muestra todas las claves de confianza por la salida est√°ndar.        list: Muestra todas las claves de confianza.        finger: Muestra los fingerprints de todas las claves de confianza.  Por ejemplo, una salida del comando ser√≠a:pavlo@debian:~()$ apt-key listWarning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8))./etc/apt/trusted.gpg--------------------pub   rsa4096 2017-02-22 [SCEA]      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88uid        [desconocida] Docker Release (CE deb) &lt;docker@docker.com&gt;sub   rsa4096 2017-02-22 [S]pub   dsa1024 2004-09-12 [SC]      6302 39CC 130E 1A7F D81A  27B1 4097 6EAF 437D 05B5uid        [desconocida] Ubuntu Archive Automatic Signing Key &lt;ftpmaster@ubuntu.com&gt;sub   elg2048 2004-09-12 [E]pub   rsa4096 2024-05-03 [SC]      3648 37CF 91E0 7091 0231  C2FE 8219 B3A0 AEF3 D498uid        [desconocida] Launchpad PPA for elementary OS teampub   rsa1024 2011-10-01 [SC]      6C87 69CE DC20 F5E6 6C3B  7D37 BF36 996C 4E1F 8A59uid        [desconocida] Launchpad PPA for elementary OS team/etc/apt/trusted.gpg.d/debian-archive-bookworm-automatic.asc------------------------------------------------------------pub   rsa4096 2023-01-21 [SC] [caduca: 2031-01-19]      B8B8 0B5B 623E AB6A D877  5C45 B7C5 D7D6 3509 47F8uid        [desconocida] Debian Archive Automatic Signing Key (12/bookworm) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2023-01-21 [S] [caduca: 2031-01-19]/etc/apt/trusted.gpg.d/debian-archive-bookworm-security-automatic.asc---------------------------------------------------------------------pub   rsa4096 2023-01-21 [SC] [caduca: 2031-01-19]      05AB 9034 0C0C 5E79 7F44  A8C8 254C F3B5 AEC0 A8F0uid        [desconocida] Debian Security Archive Automatic Signing Key (12/bookworm) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2023-01-21 [S] [caduca: 2031-01-19]/etc/apt/trusted.gpg.d/debian-archive-bookworm-stable.asc---------------------------------------------------------pub   ed25519 2023-01-23 [SC] [caduca: 2031-01-21]      4D64 FEC1 19C2 0290 67D6  E791 F8D2 585B 8783 D481uid        [desconocida] Debian Stable Release Key (12/bookworm) &lt;debian-release@lists.debian.org&gt;/etc/apt/trusted.gpg.d/debian-archive-bullseye-automatic.asc------------------------------------------------------------pub   rsa4096 2021-01-17 [SC] [caduca: 2029-01-15]      1F89 983E 0081 FDE0 18F3  CC96 73A4 F27B 8DD4 7936uid        [desconocida] Debian Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2021-01-17 [S] [caduca: 2029-01-15]/etc/apt/trusted.gpg.d/debian-archive-bullseye-security-automatic.asc---------------------------------------------------------------------pub   rsa4096 2021-01-17 [SC] [caduca: 2029-01-15]      AC53 0D52 0F2F 3269 F5E9  8313 A484 4904 4AAD 5C5Duid        [desconocida] Debian Security Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2021-01-17 [S] [caduca: 2029-01-15]/etc/apt/trusted.gpg.d/debian-archive-bullseye-stable.asc---------------------------------------------------------pub   rsa4096 2021-02-13 [SC] [caduca: 2029-02-11]      A428 5295 FC7B 1A81 6000  62A9 605C 66F0 0D6C 9793uid        [desconocida] Debian Stable Release Key (11/bullseye) &lt;debian-release@lists.debian.org&gt;/etc/apt/trusted.gpg.d/debian-archive-buster-automatic.asc----------------------------------------------------------pub   rsa4096 2019-04-14 [SC] [caduca: 2027-04-12]      80D1 5823 B7FD 1561 F9F7  BCDD DC30 D7C2 3CBB ABEEuid        [desconocida] Debian Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2019-04-14 [S] [caduca: 2027-04-12]/etc/apt/trusted.gpg.d/debian-archive-buster-security-automatic.asc-------------------------------------------------------------------pub   rsa4096 2019-04-14 [SC] [caduca: 2027-04-12]      5E61 B217 265D A980 7A23  C5FF 4DFA B270 CAA9 6DFAuid        [desconocida] Debian Security Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org&gt;sub   rsa4096 2019-04-14 [S] [caduca: 2027-04-12]/etc/apt/trusted.gpg.d/debian-archive-buster-stable.asc-------------------------------------------------------pub   rsa4096 2019-02-05 [SC] [caduca: 2027-02-03]      6D33 866E DD8F FA41 C014  3AED DCC9 EFBF 77E1 1517uid        [desconocida] Debian Stable Release Key (10/buster) &lt;debian-release@lists.debian.org&gt;/etc/apt/trusted.gpg.d/deb-multimedia-keyring.gpg-------------------------------------------------pub   rsa4096 2014-03-05 [SC]      A401 FF99 368F A1F9 8152  DE75 5C80 8C2B 6555 8117uid        [desconocida] Christian Marillat &lt;marillat@debian.org&gt;uid        [desconocida] Christian Marillat &lt;marillat@free.fr&gt;uid        [desconocida] Christian Marillat &lt;marillat@deb-multimedia.org&gt;sub   rsa4096 2014-03-05 [E]/etc/apt/trusted.gpg.d/google-chrome.gpg----------------------------------------pub   rsa4096 2016-04-12 [SC]      EB4C 1BFD 4F04 2F6D DDCC  EC91 7721 F63B D38B 4796uid        [desconocida] Google Inc. (Linux Packages Signing Authority) &lt;linux-packages-keymaster@google.com&gt;sub   rsa4096 2023-02-15 [S] [caduca: 2026-02-14]sub   rsa4096 2024-01-30 [S] [caduca: 2027-01-29]/etc/apt/trusted.gpg.d/microsoft.gpg------------------------------------pub   rsa2048 2015-10-28 [SC]      BC52 8686 B50D 79E3 39D3  721C EB3E 94AD BE12 29CFuid        [desconocida] Microsoft (Release signing) &lt;gpgsecurity@microsoft.com&gt;¬øEn que fichero se guarda el anillo de claves que guarda la herramienta apt-key?El anillo de claves utilizado por apt-key se guarda en el fichero /etc/apt/trusted.gpg y en cualquier archivo .gpg dentro de /etc/apt/trusted.gpg.d/.¬øQu√© contiene el archivo Release de un repositorio de paquetes?. ¬øY el archivo Release.gpg?. Puedes ver estos archivos en el repositorio http://ftp.debian.org/debian/dists/Debian10.1/. Estos archivos se descargan cuando hacemos un apt update.El archivo Release contiene informaci√≥n sobre el repositorio, como la versi√≥n del sistema operativo, la arquitectura, la lista de componentes (main, contrib, non-free) y otra informaci√≥n relevante. Tambi√©n incluye firmas digitales (hashes criptogr√°ficos) para cada archivo de paquete (por ejemplo, Packages y Packages.gz) dentro del repositorio. Estos hashes se utilizan para verificar la integridad de los archivos descargados.El archivo Release.gpg contiene la firma digital asociada con el archivo Release. Esta firma es generada por la entidad que mantiene el repositorio y se utiliza para verificar la autenticidad del archivo Release. Esta firma digital se verifica durante el proceso de apt update, asegurando que el archivo Release no haya sido modificado y que realmente provenga del repositorio oficial.Explica el proceso por el cual el sistema nos asegura que los ficheros que estamos descargando son leg√≠timos.Este proceso implica el uso de criptograf√≠a asim√©trica y firmas digitales:      Descarga del archivo ‚ÄúRelease‚Äù y su firma (‚ÄúRelease.gpg‚Äù): cuando ejecutamos apt update, el sistema descarga el archivo Release y su firma asociada Release.gpg desde el repositorio Debian o el mirror especificado.        Verificaci√≥n de la firma digital: el archivo Release.gpg contiene la firma digital generada por la clave privada de la entidad que mantiene el repositorio. Utilizando la clave p√∫blica correspondiente a esa clave privada (que generalmente ya est√° instalada en el sistema), se verifica la autenticidad de la firma digital. Si la verificaci√≥n falla, el proceso se detendr√°, ya que indica que el archivo Release puede haber sido modificado.        Verificaci√≥n de la integridad del archivo ‚ÄúRelease‚Äù: si la firma digital es v√°lida, se procede a verificar la integridad del archivo Release. El archivo Release contiene hashes criptogr√°ficos (generalmente SHA256) de otros archivos importantes en el repositorio, como Packages y Packages.gz. Se recalcula el hash localmente y se compara con los hashes proporcionados en el archivo Release. Si hay alguna discrepancia, se asume que los archivos pueden haber sido modificados y el proceso se detiene.        Descarga de archivos de √≠ndice de paquetes (por ejemplo, Packages o Packages.gz): si la verificaci√≥n de firma y la integridad del archivo Release son exitosas, el sistema procede a descargar los archivos de √≠ndice de paquetes mencionados en el archivo Release.        Verificaci√≥n de la integridad de los archivos de paquetes: similar al paso anterior, se verifica la integridad de los archivos de paquetes utilizando los hashes proporcionados en los archivos de √≠ndice de paquetes.  A√±ade de forma correcta el repositorio de virtualbox a√±adiendo la clave p√∫blica de virtualbox como se indica en la documentaci√≥n.En primer lugar a√±adimos el repositorio con los siguientes comando:pavlo@debian:~()$ sudo echo \"deb [arch=amd64 signed-by=/usr/share/keyrings/oracle-virtualbox-2016.gpg] https://download.virtualbox.org/virtualbox/debian bookworm contrib\" | sudo tee /etc/apt/sources.list.d/virtualbox.listY ahora descargamos e importamos la clave p√∫blica de Oracle con el siguiente comando:pavlo@debian:~()$ wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo gpg --dearmor -o /usr/share/keyrings/oracle-virtualbox-2016.gpgHacemos un apt update y ya encontramos el repositorio listo para descargar Virtualbox:pavlo@debian:~()$ sudo apt updateObj:2 https://deb.nodesource.com/node_20.x nodistro InRelease                                                                                                               Obj:4 https://dl.google.com/linux/chrome/deb stable InRelease                                                                                                               Ign:3 https://ppa.launchpad.net/elementary-os/stable/ubuntu focal InRelease                                                                                                 Obj:1 https://deb-multimedia.org bookworm InRelease                                                                                                                         Des:8 https://packages.microsoft.com/repos/code stable InRelease [3.590 B]                                                                                        Obj:5 https://deb.debian.org/debian bookworm InRelease                                                                             Obj:6 https://security.debian.org/debian-security bookworm-security InRelease   Des:9 https://download.virtualbox.org/virtualbox/debian bookworm InRelease [4.434 B]Obj:7 https://deb.debian.org/debian bookworm-updates InRelease                           Des:10 https://packages.microsoft.com/repos/code stable/main armhf Packages [18,3 kB]Des:11 https://packages.microsoft.com/repos/code stable/main arm64 Packages [18,2 kB]Des:12 https://packages.microsoft.com/repos/code stable/main amd64 Packages [18,2 kB]Ign:3 https://ppa.launchpad.net/elementary-os/stable/ubuntu focal InReleaseDes:13 https://download.virtualbox.org/virtualbox/debian bookworm/contrib amd64 Packages [1.947 B]Des:14 https://download.virtualbox.org/virtualbox/debian bookworm/contrib amd64 Contents (deb) [4.375 B]Tarea 5: Autentificaci√≥n: ejemplo SSHExplica los pasos que se producen entre el cliente y el servidor para que el protocolo cifre la informaci√≥n que se transmite? ¬øPara qu√© se utiliza la criptograf√≠a sim√©trica? ¬øY la asim√©trica?El protocolo SSH utiliza tanto criptograf√≠a sim√©trica como asim√©trica para garantizar la seguridad en la comunicaci√≥n entre el cliente y el servidor. Estos son los pasos que se producen:      El cliente inicia la conexi√≥n al servidor SSH enviando una solicitud de conexi√≥n. Intercambio de identificaci√≥n y par√°metros:        El servidor y el cliente intercambian informaci√≥n sobre sus capacidades y par√°metros de configuraci√≥n.        Negociaci√≥n de algoritmos: se realiza una negociaci√≥n para seleccionar los algoritmos que se utilizar√°n en la conexi√≥n, incluyendo algoritmos para cifrado sim√©trico, funciones hash, intercambio de claves, etc.        Intercambio de claves de sesi√≥n (cripograf√≠a asim√©trica): el cliente y el servidor acuerdan sobre una clave de sesi√≥n utilizando criptograf√≠a asim√©trica. Usualmente, el algoritmo de intercambio de claves utilizado es Diffie-Hellman.        Autenticaci√≥n: en esta fase, se puede realizar la autenticaci√≥n de las partes. Esto puede involucrar la presentaci√≥n de credenciales por parte del cliente (como contrase√±as o certificados).        Generaci√≥n de la clave de sesi√≥n compartida (criptograf√≠a sim√©trica): a partir de la informaci√≥n intercambiada en el paso anterior, ambas partes generan de manera independiente una clave de sesi√≥n compartida. Esta clave de sesi√≥n ser√° utilizada para cifrar y descifrar los datos durante la sesi√≥n.        Cifrado de la sesi√≥n (criptograf√≠a sim√©trica): a partir de este punto, la conexi√≥n SSH utiliza la criptograf√≠a sim√©trica para cifrar los datos durante la transmisi√≥n. La clave de sesi√≥n compartida se utiliza para este prop√≥sito, proporcionando eficiencia y velocidad en el cifrado.        Intercambio de mensajes cifrados: Todos los mensajes intercambiados entre el cliente y el servidor, incluyendo comandos, respuestas y otros datos, se cifran utilizando la clave de sesi√≥n compartida.  La criptograf√≠a sim√©trica se utiliza para cifrar los datos durante la transmisi√≥n debido a su eficiencia. Es m√°s r√°pida que la criptograf√≠a asim√©trica, por lo que es ideal para cifrar grandes cantidades de datos. Sin embargo, la criptograf√≠a asim√©trica se utiliza en la fase de intercambio de claves para asegurar que las claves de sesi√≥n compartida se generen de forma segura y sin necesidad de intercambiar claves directamente, lo que ser√≠a menos seguro. La combinaci√≥n de ambos tipos de criptograf√≠a en SSH aprovecha las fortalezas de cada uno para proporcionar un entorno de comunicaci√≥n seguro y eficiente.Explica los dos m√©todos principales de autentificaci√≥n: por contrase√±a y utilizando un par de claves p√∫blicas y privadas.      Autenticaci√≥n por contrase√±a: el usuario inicia una conexi√≥n SSH proporcionando un nombre de usuario y contrase√±a, y son enviados al servidor. El servidor compara la contrase√±a ingresada con la almacenada para el usuario. Este m√©todo es sencillo aunque la seguridad depende de la complejidad y robustez de la contrase√±a, y puede ser vulnerable a ataques de fuerza bruta o de suplantaci√≥n de identidad si estas son d√©biles.        Autenticaci√≥n por par de claves: el usuario genera un par de claves. La clave p√∫blica se inyecta en el servidor SSH y se asocia con el nombre de usuario correspondiente. Al iniciarse la conexi√≥n SSH, el cliente debe hacerlo con su clave privada para demostrar la identidad. El servidor utiliza la clave p√∫blica asociada al usuario para verificar la autenticidad de la clave privada del cliente. Este m√©todo proporciona un alto nivel de seguridad, superior al m√©todo de autenticaci√≥n por contrase√±a (por ejemplo es resistente a los ataques por fuerza bruta). Adem√°s tambi√©n permite el acceso a un servidor sin necesidad de ingresar una contrase√±a cada vez que se establece la conexi√≥n.  En el cliente, ¬øpara que sirve el contenido que se guarda en el fichero ~/.ssh/know_hosts?Este archivo almacena los fingerprints de las claves p√∫blicas de los hosts remotos a los que el cliente se ha conectado anteriormente. Cuando el cliente se va a conectar a un host remoto, la clave p√∫blica de ese host se almacena en este archivo. Una vez almacenada en el cliente, en la pr√≥xima conexi√≥n se vuelve a calcular el fingerprint del host remoto y se compara con el que ya estaba almacenado de anteriores conexiones. Si la huella digital coincide con una entrada existente, se considera que el host es aut√©ntico y la conexi√≥n procede sin problemas. Si la huella digital no coincide, el cliente emite una advertencia de posible ataque de ‚Äúman-in-the-middle‚Äù (intermediario malicioso) porque la clave p√∫blica del host remoto ha cambiado.¬øQu√© significa este mensaje que aparece la primera vez que nos conectamos a un servidor?$ ssh debian@172.22.200.74 The authenticity of host '172.22.200.74 (172.22.200.74)' can't be established. ECDSA key fingerprint is SHA256:7ZoNZPCbQTnDso1meVSNoKszn38ZwUI4i6saebbfL4M. Are you sure you want to continue connecting (yes/no)? En este escenario, el usuario tiene la opci√≥n de continuar o no con la conexi√≥n, dependiendo de cu√°nto conf√≠e en el servidor. Si decide aceptar, la clave del servidor se guardar√° en el archivo situado en ~/.ssh/known_hosts. Esto asegura que, en futuras conexiones, no se le pedir√° nuevamente al cliente que confirme, ya que el sistema verificar√° si la clave ya est√° registrada en dicho archivo.En ocasiones cuando estamos trabajando en el cloud, y reutilizamos una ip flotante nos aparece este mensaje:$ ssh debian@172.22.200.74 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY! Someone could be eavesdropping on you right now (man-in-the-middle attack)! It is also possible that a host key has just been changed. The fingerprint for the ECDSA key sent by the remote host is SHA256:W05RrybmcnJxD3fbwJOgSNNWATkVftsQl7EzfeKJgNc. Please contact your system administrator. Add correct host key in /home/jose/.ssh/known_hosts to get rid of this message. Offending ECDSA key in /home/jose/.ssh/known_hosts:103   remove with:   ssh-keygen -f \"/home/jose/.ssh/known_hosts\" -R \"172.22.200.74\" ECDSA host key for 172.22.200.74 has changed and you have requested strict checking.Esto significa que nos estamos conectando a un host remoto que previamente ten√≠amos su fingerprint almacenada en este archivo, pero al comparar la actual del host remoto con la que ten√≠amos almacenada estas no coinciden, por lo que nos manda la alerta.¬øQu√© guardamos y para qu√© sirve el fichero en el servidor ~/.ssh/authorized_keys?En este archivo es donde se almacenan las claves p√∫blicas de los clientes remotos que desean acceder al servidor. Al realizarse la conexi√≥n a un usuario, la clave p√∫blica del cliente debe estar presente en el archivo authorized_keys del usuario para que tenga permisos de acceso a esa sesi√≥n. La seguridad de este archivo es importante, y sus permisos t√≠picos son 600: de lectura y escritura solo para el propietario."
  },
  
  {
    "title": "Cifrado asim√©trico con gpg y openssl",
    "url": "/posts/gpg-openssl/",
    "categories": "Seguridad, Criptograf√≠a",
    "tags": "Criptograf√≠a",
    "date": "2024-12-12 21:15:00 +0100",
    





    
    "snippet": "Tarea 1: Generaci√≥n de claves (gpg)1. Genera un par de claves (p√∫blica y privada). ¬øEn que directorio se guarda las claves de un usuario?Para generar el par de claves haremos uso de la opci√≥n --gen...",
    "content": "Tarea 1: Generaci√≥n de claves (gpg)1. Genera un par de claves (p√∫blica y privada). ¬øEn que directorio se guarda las claves de un usuario?Para generar el par de claves haremos uso de la opci√≥n --gen-key de gpg:pavlo@debian:~()$ gpg --gen-keygpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.Nota: Usa \"gpg --full-generate-key\" para el di√°logo completo de generaci√≥n de clave.GnuPG debe construir un ID de usuario para identificar su clave.Nombre y apellidos:Primero, se nos solicitar√° que ingresemos nuestro nombre completo, incluyendo los apellidos, con el objetivo de diferenciar nuestra clave de las dem√°s. Escribiremos esta informaci√≥n y procederemos al siguiente paso.Nombre y apellidos: Pablo Mart√≠n HidalgoDirecci√≥n de correo electr√≥nico: pmartinhidalgo19@gmail.comA continuaci√≥n, ser√° necesario proporcionar nuestra direcci√≥n de correo electr√≥nico. La ingresaremos y continuaremos con el proceso.Est√° usando el juego de caracteres 'utf-8'.Ha seleccionado este ID de usuario:    \"Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\"¬øCambia (N)ombre, (D)irecci√≥n o (V)ale/(S)alir?Cuando hayamos completado estos datos, se nos mostrar√° un resumen para confirmarlos. Si todo es correcto, seleccionaremos la opci√≥n ‚ÄúV‚Äù para confirmar.¬øCambia (N)ombre, (D)irecci√≥n o (V)ale/(S)alir? VEs necesario generar muchos bytes aleatorios. Es una buena idea realizaralguna otra tarea (trabajar en otra ventana/consola, mover el rat√≥n, usarla red y los discos) durante la generaci√≥n de n√∫meros primos. Esto da algenerador de n√∫meros aleatorios mayor oportunidad de recoger suficienteentrop√≠a.En este momento, se nos pedir√° que configuremos una frase de paso que proteger√° nuestra clave privada. Ser√° necesario ingresarla dos veces para confirmar y, una vez hecho esto, se iniciar√° el proceso de generaci√≥n del par de claves. Como se indica en el mensaje mostrado, es recomendable realizar alguna actividad en nuestro equipo durante este proceso para ayudar a generar entrop√≠a.gpg: creado el directorio '/home/pavlo/.gnupg/openpgp-revocs.d'gpg: certificado de revocaci√≥n guardado como '/home/pavlo/.gnupg/openpgp-revocs.d/9D0AB661A8C5977C20924020130D7BAF24114BE7.rev'claves p√∫blica y secreta creadas y firmadas.pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      9D0AB661A8C5977C20924020130D7BAF24114BE7uid                      Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Una vez completada la generaci√≥n, nuestro par de claves estar√° creado y a√±adido con total confianza a nuestro keyring pubring.kbx, que se encuentra ubicado en el directorio personal dentro de la carpeta .gnupg/. Adem√°s, de manera autom√°tica se habr√° generado un certificado de revocaci√≥n en .gnupg/openpgp-revocs.d/. Este certificado ser√° √∫til en caso de que nuestra clave privada sea comprometida o si decidimos dejar de usar este par de claves, permitiendo informar a otros usuarios que la clave p√∫blica asociada no debe ser utilizada m√°s para cifrar.2. Lista las claves p√∫blicas que tienes en tu almac√©n de claves. Explica los distintos datos que nos muestra. ¬øC√≥mo deber√≠as haber generado las claves para indicar, por ejemplo, que tenga un 1 mes de validez?Para listar las claves p√∫blicas haremos uso de la opci√≥n --list-keys de gpg:pavlo@debian:~()$ gpg --list-keysgpg: comprobando base de datos de confianzagpg: marginals needed: 3  completes needed: 1  trust model: pgpgpg: nivel: 0  validez:   1  firmada:   0  confianza: 0-, 0q, 0n, 0m, 0f, 1ugpg: siguiente comprobaci√≥n de base de datos de confianza el: 2026-12-12/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      9D0AB661A8C5977C20924020130D7BAF24114BE7uid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Si quisi√©ramos generar claves con un per√≠odo de validez espec√≠fico, podr√≠amos haber utilizado la opci√≥n ‚Äìfull-gen-key de GPG. Esto nos habr√≠a mostrado un mensaje donde se solicita configurar el tiempo de validez.pavlo@debian:~()$ gpg --full-generate-keygpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.Por favor seleccione tipo de clave deseado:   (1) RSA y RSA (por defecto)   (2) DSA y ElGamal   (3) DSA (s√≥lo firmar)   (4) RSA (s√≥lo firmar)  (14) Existing key from cardSu elecci√≥n: las claves RSA pueden tener entre 1024 y 4096 bits de longitud.¬øDe qu√© tama√±o quiere la clave? (3072) El tama√±o requerido es de 3072 bitsPor favor, especifique el per√≠odo de validez de la clave.         0 = la clave nunca caduca      &lt;n&gt;  = la clave caduca en n d√≠as      &lt;n&gt;w = la clave caduca en n semanas      &lt;n&gt;m = la clave caduca en n meses      &lt;n&gt;y = la clave caduca en n a√±os¬øValidez de la clave (0)?En este punto, podr√≠amos haber indicado la duraci√≥n deseada siguiendo las opciones que se nos presentan. Por ejemplo, para establecer una validez de un mes, podr√≠amos haber ingresado 30, 4w o 1m, ya que todas estas opciones representan el mismo intervalo de tiempo.3. Lista las claves privadas de tu almac√©n de clavesPara listar las claves privadas haremos uso de la opci√≥n --list-secret-keys de gpg:pavlo@debian:~()$ gpg --list-secret-keys/home/pavlo/.gnupg/pubring.kbx------------------------------sec   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      9D0AB661A8C5977C20924020130D7BAF24114BE7uid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;ssb   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Cuando listamos las claves p√∫blicas obtuvimos las siguientes abreviaturas:  pub: Clave primaria p√∫blica (public primary key).  uid: Identificador √∫nico (unique identifier).  sub: Clave secundaria p√∫blica (public sub-key).Al listar las claves privadas con gpg --list-secret-keys, las abreviaturas mostradas fueron:  sec: Clave primaria privada (secret primary key).  uid: Identificador √∫nico (unique identifier).  ssb: Clave secundaria privada (secret sub-key).En criptograf√≠a asim√©trica trabajamos con pares de claves: una clave p√∫blica para encriptar o comprobar firmas, y una clave privada (secreta) para desencriptar o firmar, respectivamente.Cuando generamos un par de claves OpenPGP con GnuPG, se crean por defecto:  Un par de claves primario o master key:          Contiene uno o m√°s identificadores de usuario (user-IDs), como nombre, apellidos y correo electr√≥nico.      Se utiliza para firmar o comprobar firmas, ya que es una prueba de identidad.      La clave privada de este par debe protegerse cuidadosamente.        Un par de claves secundario:          Est√° firmado por el par de claves primario, lo que garantiza que pertenece al user-ID.      Se utiliza exclusivamente para encriptar o desencriptar informaci√≥n.      La separaci√≥n entre pares de claves maestros y secundarios permite revocar estos √∫ltimos sin afectar a los primeros y almacenarlos por separado. En esencia, los pares de claves secundarios son independientes, pero est√°n vinculados al par maestro.Tarea 2: Importar/exportar clave p√∫blica (gpg)1. Exporta tu clave p√∫blica en formato ASCII, gu√°rdalo en un archivo ‚Äúnombre_apellido.asc‚Äù y env√≠alo al compa√±ero con el que vas a hacer esta pr√°ctica.Para exportar nuestras claves p√∫blicas, utilizaremos la opci√≥n --export de gpg junto con la opci√≥n -a &lt;nombre&gt;. Esto generar√° una salida en formato ASCII que puede ser redirigida a un archivo.El &lt;nombre&gt; que debemos especificar es el mismo que introdujimos al generar el par de claves (generalmente nuestro nombre o direcci√≥n de correo electr√≥nico).El comando a ejecutar es el siguiente:pavlo@debian:~()$ gpg --export -a \"Pablo Mart√≠n Hidalgo\" &gt; pablo_martin.ascpavlo@debian:~()$ ls -l pablo_martin.asc -rw-r--r-- 1 pavlo pavlo 2476 dic 12 18:33 pablo_martin.ascEsta pr√°ctica la he realizado junto a Jose Antonio Canalo, as√≠ que le he enviado mis claves p√∫blicas exportadas a trav√©s de Discord:2. Importa las claves p√∫blicas recibidas de vuestro compa√±eroAl igual que yo, Jose me ha pasado su clave p√∫blica por Discord y como vemos ya la tengo descargada:Para importar las claves p√∫blicas de otro usuario, utilizaremos la opci√≥n --import de gpg, seguida del nombre del archivo que contiene la clave p√∫blica. En este caso, el archivo a importar es el que hemos recibido, por ejemplo, joseantoniocanalo.asc.El comando a ejecutar ser√≠a:pavlo@debian:~()$ gpg --import joseantoniocanalo.asc gpg: clave 5DD99C6F8D4E1C65: clave p√∫blica \"jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Como vemos nos ha devuelto un mensaje por pantalla informando que las claves p√∫blicas de Jose han sido correctamente importadas.3. Comprueba que las claves se han incluido correctamente en vuestro keyringDe nuevo, volveremos a hacer uso de opci√≥n --list-keys de gpg para verificar que las claves p√∫blicas han sido correctamente importadas a nuestro keyring:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      9D0AB661A8C5977C20924020130D7BAF24114BE7uid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      279F1D439CE7DA18300BF21D5DD99C6F8D4E1C65uid        [desconocida] jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Y efectivamente, las claves p√∫blicas de Jose han sido correctamente importadas a nuestro keyring en .gnupg/pubring.kbx.Tarea 3: Cifrado asim√©trico con claves p√∫blicas (gpg)1. Cifraremos un archivo cualquiera y lo remitiremos por email a uno de nuestros compa√±eros que nos proporcion√≥ su clave p√∫blicaEn este ejemplo, tengo un archivo llamado mensaje_encriptado.txt, el cual quiero cifrar con la clave p√∫blica de Jose para envi√°rselo de forma segura. Para ello, utilizaremos la opci√≥n -e de gpg junto con:  -u &lt;remitente&gt;: Indica qui√©n es el remitente, especificando la clave privada que se usar√° para firmar, si es necesario.  -r &lt;destinatario&gt;: Especifica el destinatario, cuya clave p√∫blica ser√° usada para cifrar el archivo.El comando a ejecutar ser√≠a:pavlo@debian:~()$ gpg -e -u \"Pablo Mart√≠n Hidalgo\" -r \"jose antonio Canalo Gonzalez\" mensaje_encriptado.txtgpg: 6CB51A1718E6B9E9: No hay seguridad de que esta clave pertenezca realmenteal usuario que se nombrasub  rsa3072/6CB51A1718E6B9E9 2024-12-12 jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt; Huella clave primaria: 279F 1D43 9CE7 DA18 300B  F21D 5DD9 9C6F 8D4E 1C65      Huella de subclave: F8AF 9D20 076C 877E DDEF  DE6B 6CB5 1A17 18E6 B9E9No es seguro que la clave pertenezca a la persona que se nombra en elidentificador de usuario. Si *realmente* sabe lo que est√° haciendo,puede contestar s√≠ a la siguiente pregunta.¬øUsar esta clave de todas formas? (s/N) sAl listar los archivos en el directorio utilizando el comando:pavlo@debian:~()$ ls -l | egrep mensaje_encriptado-rw-r--r--  1 pavlo pavlo   25 dic 12 18:45 mensaje_encriptado.txt-rw-r--r--  1 pavlo pavlo  507 dic 12 18:46 mensaje_encriptado.txt.gpgComo podemos observar ahora tenemos dos archivos, el original (mensaje_encriptado.txt) y el encriptado (mensaje_encriptado.txt.gpg).Tras ello, le enviar√© dicho fichero a Jose por Discord:2. Nuestro compa√±ero, a su vez, nos remitir√° un archivo cifrado para que nosotros lo descifremos.Al igual que yo, Jose me ha pasado su mensaje cifrado por Discord:3. Tanto nosotros como nuestro compa√±ero comprobaremos que hemos podido descifrar los mensajes recibidos respectivamentePara descifrar un archivo que hemos recibido, utilizaremos la opci√≥n -d de gpg, seguida del nombre del archivo a descifrar. En este caso, el archivo que hemos recibido de Jose es mensaje_cifrado.gpg.El comando a ejecutar ser√≠a:pavlo@debian:~()$ gpg -d mensaje_cifrado.gpggpg: cifrado con clave de 3072 bits RSA, ID 8E63E9C3C10E3D32, creada el 2024-12-12      \"Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\"Espero que ganemos el s√°badoTras ejecutar el comando, se nos pedir√° la frase de paso para desbloquear la clave privada con la que vamos a descifrar el fichero (pues anteriormente fue cifrado con la clave p√∫blica asociada a dicha clave privada).Como se puede observar, el contenido del archivo descifrado no est√° en texto plano, sino que corresponde a un archivo .txt encriptado.pavlo@debian:~()$ cat mensaje_cifrado.gpg ÔøΩÔøΩÔøΩcÔøΩÔøΩÔøΩ=2         ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ42ÔøΩÊõÑ:ÔøΩ1ÔøΩJ;)ÔøΩ\t6ÔøΩ&gt;ÔøΩ),ÔøΩÔøΩ_ÔøΩ-gÔøΩg*ÔøΩÔøΩÔøΩp»Ü]8@ÔøΩxÔøΩ,KÔøΩÔøΩ“¨ÔøΩ,ÔøΩÔøΩgÔøΩW?ÔøΩmÔøΩ\"ÔøΩÔøΩdA0jbÔøΩÔøΩzÔøΩ\\ÔøΩÔøΩÔøΩÔøΩ›ëbÔøΩÔøΩaÔøΩ5mkÔøΩ6ÔøΩÔøΩ ÔøΩÔøΩcÔøΩÔøΩﬁò_=\"ÔøΩeÔøΩGÔøΩ÷Öb}+ÔøΩ3(A&amp;ÔøΩTÔøΩÔøΩuGÔøΩhÔøΩÔøΩ?ÔøΩÔøΩ/5ÔøΩ;DÔøΩ ÷ñBÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ. ÔøΩÔøΩÔøΩAlÔøΩBÔøΩ[_]ÔøΩTno7ÔøΩÔøΩ›ØÔøΩMÔøΩÔøΩITÔøΩÔøΩÔøΩ;BtLnÔøΩÔøΩÔøΩXqﬂµÔøΩ&gt;ÔøΩR-ÔøΩ[[ZÔøΩDÔøΩÔøΩÔøΩ-ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ.CÔøΩÔøΩzuÔøΩÔøΩÔøΩ|ÔøΩÔøΩÔøΩ/ÔøΩÀäÔøΩÔøΩ'5&amp;                                                                                                                                      ÔøΩ2rÔøΩÔøΩÔøΩÔøΩ&gt;VqÔøΩÔøΩÔøΩ[‘ôÔøΩÔøΩTK-ÔøΩÔøΩÔøΩÔøΩN~3Q=ÔøΩÔûòg0C:ÔøΩÔøΩÔøΩXEÔøΩÔøΩÔøΩU:ÔøΩ`VÔøΩ~\tÔøΩ0ÔøΩÔøΩÀ¥ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩE$ÔøΩjÔøΩ~}ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ2ÔøΩÔøΩÔøΩ‹çÔøΩL◊¥ÔøΩÔú∞ÔøΩkÔøΩÔøΩÔøΩd=-ÔøΩÔøΩÔøΩL1T'ÔøΩbpÔøΩÔøΩÔøΩÔøΩrBjqÔøΩBÔøΩÔøΩÔøΩÔøΩÔøΩad1:ÔøΩ'sÔøΩÔøΩM2ÔøΩ  ÔøΩtwÔøΩÔøΩi%ÔøΩ}A#%XhÔøΩY`ÔøΩÔøΩkÔøΩ,ÔøΩmt&gt;|~                              ÔøΩ]ÔøΩÔøΩ…ΩVV7b^ÔøΩÔøΩKPara visualizarlo correctamente, debemos redirigir la salida del archivo descifrado a un archivo de formato .txt.Para ello, volvemos a ejecutar el comando de descifrado, pero esta vez redirigiendo la salida a un archivo con extensi√≥n .txt, como por ejemplo descifrado.txt.El comando a ejecutar ser√≠a:pavlo@debian:~()$ gpg -d mensaje_cifrado.gpg &gt; descifrado.txtgpg: cifrado con clave de 3072 bits RSA, ID 8E63E9C3C10E3D32, creada el 2024-12-12      \"Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;\"Y como vemos el contenido es totalmente visible:pavlo@debian:~()$ cat descifrado.txt Espero que ganemos el s√°bado4. Por √∫ltimo, enviaremos el documento cifrado a alguien que no estaba en la lista de destinatarios y comprobaremos que este usuario no podr√° descifrar este archivoPara este punto hemos pedido ayuda a Andr√©s Morales, al cual le he enviado el fichero y ha comprobado si pod√≠a abrirlo o no. Y como podemos observar obtuvo el siguiente error:madandy@toyota-hilux:~/Descargas$ gpg -d mensaje_encriptado.txt.gpg gpg: cifrado con clave RSA, ID 6CB51A1718E6B9E9gpg: descifrado fallido: No secret keyComo se puede apreciar, el descifrado ha fallado dado que no ha encontrado ninguna clave privada para descifrar dicho fichero.5. Para terminar, indica los comandos necesarios para borrar las claves p√∫blicas y privadas que poseesEs importante seguir un orden espec√≠fico al eliminar un par de claves en GPG para evitar errores. Primero, debemos eliminar la clave privada asociada y, posteriormente, la clave p√∫blica.Para eliminar la clave privada, utilizaremos la opci√≥n --delete-secret-key de gpg, seguida del nombre asociado al par de claves (el mismo que introdujimos al generarlo). El comando ser√≠a:pavlo@debian:~()$ gpg --delete-secret-key \"Pablo Mart√≠n Hidalgo\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.sec  rsa3072/130D7BAF24114BE7 2024-12-12 Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;¬øEliminar esta clave del anillo? (s/N) s¬°Es una clave secreta! ¬øEliminar realmente? (s/N) sUna vez eliminada la clave privada, procedemos a eliminar la clave p√∫blica con la opci√≥n ‚Äìdelete-key:pavlo@debian:~()$ gpg --delete-key \"Pablo Mart√≠n Hidalgo\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa3072/130D7BAF24114BE7 2024-12-12 Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;¬øEliminar esta clave del anillo? (s/N) sAl completar ambos pasos, el par de claves (tanto p√∫blico como privado) habr√° sido eliminado de nuestro sistema.pavlo@debian:~()$ gpg --list-keysgpg: comprobando base de datos de confianzagpg: no se encuentran claves absolutamente fiables/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      279F1D439CE7DA18300BF21D5DD99C6F8D4E1C65uid        [desconocida] jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Tarea 4: Exportar clave a un servidor p√∫blico de claves PGP1. Genera la clave de revocaci√≥n de tu clave p√∫blica para utilizarla en caso de que haya problemasCuando generamos un par de claves con GPG, el programa crea autom√°ticamente una clave de revocaci√≥n. Sin embargo, para mostrar el proceso manual, generaremos una nueva clave de revocaci√≥n.Para generar una clave de revocaci√≥n, utilizaremos la opci√≥n --gen-revoke de gpg, seguida del identificador del par de claves (conocido como fingerprint). Este identificador es una secuencia de 40 d√≠gitos que podemos encontrar al listar nuestras claves p√∫blicas con el siguiente comando:pavlo@debian:~()$ gpg --gen-revoke F0BCAC25DBEF1413DA96DFE02F56104F90EDEC18sec  rsa3072/2F56104F90EDEC18 2024-12-12 Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;¬øCrear un certificado de revocaci√≥n para esta clave? (s/N) sPor favor elija una raz√≥n para la revocaci√≥n:  0 = No se dio ninguna raz√≥n  1 = La clave ha sido comprometida  2 = La clave ha sido reemplazada  3 = La clave ya no est√° en uso  Q = Cancelar(Probablemente quer√≠a seleccionar 1 aqu√≠)¬øSu decisi√≥n? 0Introduzca una descripci√≥n opcional; ac√°bela con una l√≠nea vac√≠a:&gt; Ejercicios de criptograf√≠a&gt; Raz√≥n para la revocaci√≥n: No se dio ninguna raz√≥nEjercicios de criptograf√≠a¬øEs correcto? (s/N) sse fuerza salida con armadura ASCII.-----BEGIN PGP PUBLIC KEY BLOCK-----Comment: This is a revocation certificateiQHRBCABCgA7FiEE8LysJdvvFBPalt/gL1YQT5Dt7BgFAmdbJhkdHQBFamVyY2ljaW9zIGRlIGNyaXB0b2dyYWbDrWEACgkQL1YQT5Dt7Bgkiwv7BLuEp9rUi3hgiYhJhCPyh9FqkD9UJByICZmdVf/wgP9BnKIy0SC9KEEjUF9Fko6N/nDz0EMVAwZ4WtCPflt3xq0ACJUfzGp9llP2iNujpcCbmdlwHDMwhCkvcI+ri4pb0fmZPRhw3BO9Ad4EcDMQ2LFffJ29zbBsWS1RqYZzTGEytjB3m5BaoIq+C5HAnM7dImfKbV5DBdCLsqCcwnwS1zvlHwFzpf9Ap6IhbmpN4Rf4H+ZBL8siVQrUDlOsbybwgBrzxLtLmaq0EZL+kZL7QHizTHaO9bUJd/PxumfiNiuq3wq5MxdUSnXNEg52bDg4AxPYlWm9IU87wAPB6fHFpwfzJh/VKyfZi7tD0CSb1fRN4qxg7abXRAS/4aRAprOaRFtbyvXiAswvD9oIY8LFxUe5P8OmvuzD9X7npsQX+H3ZbxTvJJZ9RVMn1Oxi1AHWiqqn2ae+jw7CPpgzy9C+FFWJTL/ME4vNeZ+y+EdRboRO+tx96Q453+jwo/tlLF7u=Oyi5-----END PGP PUBLIC KEY BLOCK-----Certificado de revocaci√≥n creado.Por favor cons√©rvelo en un medio que pueda esconder; si alguien consigueacceso a este certificado puede usarlo para inutilizar su clave.Es inteligente imprimir este certificado y guardarlo en otro lugar, porsi acaso su medio resulta imposible de leer. Pero precauci√≥n: ¬°el sistemade impresi√≥n de su m√°quina podr√≠a almacenar los datos y hacerlos accesiblesa otras personas!El certificado de revocaci√≥n generado por GPG contiene la informaci√≥n necesaria para revocar un par de claves de forma oficial. Este certificado est√° delimitado por las etiquetas:‚Äî‚ÄìBEGIN PGP PUBLIC KEY BLOCK‚Äî‚Äì ‚Ä¶ ‚Äî‚ÄìEND PGP PUBLIC KEY BLOCK‚Äî‚Äì2. Exporta tu clave p√∫blica al servidor pgp.rediris.esPara compartir nuestra clave p√∫blica con otros usuarios, podemos exportarla a un servidor de claves p√∫blicas, lo que permite que cualquiera pueda buscarla y utilizarla para cifrar mensajes destinados a nosotros.Para exportar la clave p√∫blica, utilizaremos la opci√≥n --keyserver para especificar el servidor al cual queremos enviar la clave y --send-key para indicar el identificador (ID) de la clave p√∫blica. En este caso, se utilizar√° el servidor pgp.rediris.es, y el ID ser√° el fingerprint de la clave, que consta de 40 d√≠gitos. Tambi√©n es posible usar √∫nicamente los √∫ltimos 8 d√≠gitos del fingerprint. El comando ser√≠a:pavlo@debian:~()$ gpg --keyserver pgp.rediris.es --send-key F0BCAC25DBEF1413DA96DFE02F56104F90EDEC18gpg: enviando clave 2F56104F90EDEC18 a hkp://pgp.rediris.esPara confirmar que la clave ha sido subida correctamente, se puede acceder al servidor de claves p√∫blicas mediante un navegador web. En este caso, al visitar la p√°gina de b√∫squeda de claves de pgp.rediris.es, es posible introducir un identificador como el nombre o la direcci√≥n de correo electr√≥nico en el campo de b√∫squeda.Por ejemplo, al introducir el correo electr√≥nico en el campo de b√∫squeda y pulsar ‚ÄúSearch for a key‚Äù, aparecer√°n los resultados que coincidan con la b√∫squeda realizada.Si todo ha funcionado correctamente, deber√≠a verse la clave p√∫blica entre los resultados, lo que confirma que la subida al servidor de claves p√∫blicas se ha completado de manera satisfactoria. Exportar claves p√∫blicas a servidores como pgp.rediris.es facilita el intercambio de claves y asegura que otras personas puedan comunicarse de forma segura.3. Borra la clave p√∫blica de alguno de tus compa√±eros de clase e imp√≥rtala ahora del servidor p√∫blico de redirisTal y como hemos visto en uno de los ejercicios anteriores, para eliminar una clave p√∫blica de nuestro keyring, utilizaremos la opci√≥n --delete-key seguida del nombre asociado a la clave. En este caso, el nombre que debemos introducir es el de Jose.pavlo@debian:~()$ gpg --delete-key \"jose antonio canalo gonzalez\"gpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbHThis is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.pub  rsa3072/5DD99C6F8D4E1C65 2024-12-12 jose antonio Canalo Gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;¬øEliminar esta clave del anillo? (s/N) sY listo, la clave p√∫blica de Jose ya se encuentra borrada:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      F0BCAC25DBEF1413DA96DFE02F56104F90EDEC18uid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Una vez que la clave p√∫blica ha sido totalmente eliminada, es momento de volver a importarla desde el servidor de claves p√∫blicas. Para ello, utilizaremos la opci√≥n --keyserver para especificar el servidor del que queremos descargar la clave y --recv-keys para indicar el identificador (fingerprint) de la clave p√∫blica.En este caso, el servidor a utilizar ser√° pgp.rediris.es, y el ID ser√° el fingerprint de 40 d√≠gitos de la clave de Alejandro. Tambi√©n se pueden usar los √∫ltimos 8 d√≠gitos del fingerprint.pavlo@debian:~()$ gpg --keyserver pgp.rediris.es --recv-keys 5D55680Cgpg: clave A93FC51D5D55680C: clave p√∫blica \"jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;\" importadagpg: Cantidad total procesada: 1gpg:               importadas: 1Como vemos, la clave p√∫blica de Jose ha sido importada de nuevo:pavlo@debian:~()$ gpg --list-keys/home/pavlo/.gnupg/pubring.kbx------------------------------pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      F0BCAC25DBEF1413DA96DFE02F56104F90EDEC18uid        [  absoluta ] Pablo Mart√≠n Hidalgo &lt;pmartinhidalgo19@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]pub   rsa3072 2024-12-12 [SC] [caduca: 2026-12-12]      B93E1746A5B533527796FC9DA93FC51D5D55680Cuid        [desconocida] jose antonio canalo gonzalez &lt;joseantoniocgonzalez83@gmail.com&gt;sub   rsa3072 2024-12-12 [E] [caduca: 2026-12-12]Tarea 5: Cifrado asim√©trico con openssl1. Genera un par de claves (p√∫blica y privada)Para generar el par de claves utilizando el algoritmo RSA, emplearemos la opci√≥n genrsa. Adem√°s, configuraremos una frase de paso para proteger la clave privada, utilizando el algoritmo AES128, lo que requiere incluir la opci√≥n -aes128. Este par de claves se almacenar√° en un √∫nico archivo con extensi√≥n .pem, y para especificar dicho archivo de salida usaremos la opci√≥n -out &lt;fichero&gt;. En este caso, el archivo de salida se llamar√° key.pem. Finalmente, indicaremos el tama√±o de la clave, siendo recomendable un m√≠nimo de 2048 bits.pavlo@debian:~()$ sudo openssl genrsa -aes128 -out clave.pem 2048[sudo] contrase√±a para pavlo: Enter PEM pass phrase:Verifying - Enter PEM pass phrase:Tras habernos preguntado dos veces la frase de paso, el par de claves se habr√° generado en un fichero .pem.2. Env√≠a tu clave p√∫blica a un compa√±eroDado que openssl genera tanto la clave privada como la p√∫blica en un √∫nico archivo, es necesario extraer la clave p√∫blica para envi√°rsela al compa√±ero. Esto se debe a que no es seguro compartir el archivo que contiene ambas claves. Para realizar esta extracci√≥n, utilizaremos la opci√≥n -in &lt;pardeclaves&gt; para especificar el archivo que contiene el par de claves, junto con la opci√≥n -pubout para indicar que se extraiga √∫nicamente la clave p√∫blica. Adem√°s, emplearemos la opci√≥n -out &lt;ficherosalida&gt; para guardar la clave p√∫blica en un archivo separado con la extensi√≥n .public.pem. Por √∫ltimo, indicaremos el algoritmo RSA, que es el que estamos utilizando.En este caso, el archivo del par de claves es clave.pem y el archivo de salida para la clave p√∫blica ser√° clave-publica.pem.pavlo@debian:~()$ sudo openssl rsa -in clave.pem -pubout -out clave-publica.pemEnter pass phrase for clave.pem:writing RSA keyNos ha solicitado la frase de paso y justo despu√©s ha generado el fichero con la clave p√∫blica:pavlo@debian:~()$ cat clave-publica.pem -----BEGIN PUBLIC KEY-----MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwTaSZx2rgZxL8H0XoU48Orzus0tpPn64xw/ftf0Sk5sh6MMnkVgbdug1Iydxun28rs8L1iULPoGDZUUZARMc6oa4CuW6gu6gsfvul4bktpSps9NjJmHA0Vd2Gehp7PMncxzXFPokwwinetSZi85J9uL2/RSJes2AxxRVxBIonOurpuBxWuaAB50ptDL2v6h0B3+A/1dtOdsSY1KmSuTqQFKVYry3sYKvPOJMy4JX78GSCzy5E/SPwnv3f6oD22Ual7MqIcDgNZsQ6tHjCZXPz/4VRA9SAkQ5yTIcSkb5IT/NxxkuiItHp1rwEnkfbxP2tymaUj5udVp5uQ6YT1/SsQIDAQAB-----END PUBLIC KEY-----Ahora, Jose y yo nos pasamos nuestra clave p√∫blica:3. Utilizando la clave p√∫blica cifra un fichero de texto y env√≠alo a tu compa√±eroLo primero que haremos ser√° generar un fichero de texto con el contenido que deseemos:pavlo@debian:~()$ echo \"Hoy pierde el Betis\" &gt; archivo.txtTras la extracci√≥n de la clave p√∫blica, podremos proceder a cifrar un archivo utilizando la clave p√∫blica del destinatario. Esto se logra mediante el uso de las opciones de openssl. Espec√≠ficamente:  La opci√≥n -encrypt indica que deseamos cifrar el archivo.  La opci√≥n -in &lt;fichero&gt; especifica el archivo de entrada que se desea cifrar.  La opci√≥n -out &lt;ficherosalida&gt; define el archivo de salida que contendr√° los datos cifrados, con una extensi√≥n habitual como .enc.  La opci√≥n -inkey &lt;clavepublica&gt; especifica la clave p√∫blica que se usar√° para el cifrado.  La opci√≥n -pubin se utiliza para se√±alar que estamos trabajando con una clave p√∫blica.  Finalmente, el comando pkeyutl se emplea para realizar operaciones de firma, verificaci√≥n, cifrado o descifrado con RSA.En este caso, el archivo de entrada ser√° archivo.txt, el archivo de salida ser√° mensaje_encriptado.enc, y la clave p√∫blica utilizada ser√° la de Jose, contenida en clave_publica.pem.pavlo@debian:~()$ openssl pkeyutl -encrypt -in archivo.txt -out mensaje_encriptado.enc -inkey clave_publica.pem -pubinComo vemos, el mensaje encriptado utiliza car√°cteres no reconocidos:pavlo@debian:~()$ cat mensaje_encriptado.enc ÔøΩÔøΩhÔøΩu*ÔøΩ3ÔøΩ›îLÔøΩÔøΩ;\"vÔøΩÔøΩTÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ_f.VH4ÔøΩCÔøΩÔøΩy!                                     ÔøΩeiÔøΩ0dKs   ÔøΩÔøΩÔøΩÔøΩÔøΩTÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ'&gt;ÔøΩÔøΩÔøΩÔøΩÔøΩDdÔøΩFÔøΩÔøΩ-ÔøΩ^}ÔøΩ\tÔøΩÔøΩtÔøΩpÔøΩÔøΩÔøΩj@›ìÔøΩDgÔøΩPÔøΩa3NÔøΩbEÔøΩÔøΩIÔøΩ“úÔøΩÔøΩUÔøΩÔøΩÔøΩÔøΩcLÔøΩ@ÔøΩFKaÔøΩ2eÔøΩÔøΩz[?3ÔøΩlÔøΩÔøΩÔøΩ4De nuevo, yo le paso mi mensaje cifrado para que lo averig√ºe y yo me descargo el suyo:4. Tu compa√±ero te ha mandado un fichero cifrado, muestra el proceso para el descifradoPara descifrar un archivo previamente cifrado, utilizamos la herramienta openssl con las siguientes opciones:  La opci√≥n -decrypt indica que queremos realizar la operaci√≥n de descifrado.  La opci√≥n -in &lt;fichero&gt; especifica el archivo cifrado que deseamos descifrar.  La opci√≥n -out &lt;ficherosalida&gt; define el archivo donde se guardar√° el contenido descifrado.  La opci√≥n -inkey &lt;claveprivada&gt; se√±ala la clave privada que se utilizar√° para descifrar el archivo.  Al igual que en el cifrado, la opci√≥n pkeyutl se usa para realizar operaciones de firma, verificaci√≥n, cifrado o descifrado con el algoritmo RSA.En este caso, el archivo de entrada ser√° mensajenuevo_cifrado.enc, el archivo de salida ser√° documento.txt, y la clave privada utilizada ser√° clave.pem, la cual generamos previamente.pavlo@debian:~()$ sudo openssl pkeyutl -decrypt -in mensajenuevo_cifrado.enc -out documento.txt -inkey clave.pemY como vemos, podemos visualizar el contenido:pavlo@debian:~()$ cat documento.txt ojala eliminen al betis"
  },
  
  {
    "title": "Escenario en OpenStack",
    "url": "/posts/openstack/",
    "categories": "Servicios, Cloud",
    "tags": "Cloud",
    "date": "2024-12-11 18:15:00 +0100",
    





    
    "snippet": "Pr√°ctica (1 / 2): Escenario en OpenStackPara nombrar las m√°quinas se van a utilizar los siguientes nombres: luffy, zoro, nami, sanji. Estos nombres pertenecen la serie manga One Piece.Adem√°s el dom...",
    "content": "Pr√°ctica (1 / 2): Escenario en OpenStackPara nombrar las m√°quinas se van a utilizar los siguientes nombres: luffy, zoro, nami, sanji. Estos nombres pertenecen la serie manga One Piece.Adem√°s el dominio ser√° un subdominio de la forma tunombre.gonzalonazareno.org. De esta forma tendremos:  M√°quina 1: Instancia en OpenStack con Debian 12 Bookworm que se llama luffy.tunombre.gonzalonazareno.org.  M√°quina 2: Instancia en OpenStack con Rocky Linux 9 que se llama zoro.tunombre.gonzalonazareno.org.  M√°quina 3: Contenedor LXC con Ubuntu 22.04 que se llama nami.tunombre.gonzalonazareno.org.  M√°quina 4: Contenedor LXC con Ubuntu 22.04 que se llama sanji.tunombre.gonzalonazareno.org.Todas las operaciones que realices sobre recursos de OpenStack lo tienes que hacer usando OSC.Creaci√≥n de la infraestructura de red  Crea un nuevo router llamado RouterPractica conectado a la red externa.Para crear el router ejecutamos el siguiente comando:(os) pavlo@debian:~/OpenStack()$ openstack router create RouterPractica+---------------------------+--------------------------------------+| Field                     | Value                                |+---------------------------+--------------------------------------+| admin_state_up            | UP                                   || availability_zone_hints   |                                      || availability_zones        |                                      || created_at                | 2024-12-11T17:32:26Z                 || description               |                                      || enable_default_route_bfd  | False                                || enable_default_route_ecmp | False                                || enable_ndp_proxy          | None                                 || external_gateway_info     | null                                 || external_gateways         | []                                   || flavor_id                 | None                                 || id                        | c94e22f0-5551-4842-9628-a9d3929b5539 || name                      | RouterPractica                       || project_id                | 07df99f775d343a58e702b5c99adcbad     || revision_number           | 1                                    || routes                    |                                      || status                    | ACTIVE                               || tags                      |                                      || tenant_id                 | 07df99f775d343a58e702b5c99adcbad     || updated_at                | 2024-12-11T17:32:26Z                 |+---------------------------+--------------------------------------+Luego, lo a√±adimos a la red p√∫blica que por lo general suele ser public, aunque en este caso es ext-net:(os) pavlo@debian:~/OpenStack()$ openstack router set RouterPractica --external-gateway ext-net      Crea una red interna que se llame Red Intra de tu_usuario, con las siguientes caracter√≠sticas:                  Est√° conectada al router que has creado en el punto anterior.                    Direccionamiento: 10.0.200.0/24                    Con DHCP y DNS (172.22.0.1).                    La puerta de enlace de los dispositivos conectados a esta red ser√° el 10.0.200.1.            Para este paso debemos crear una red:(os) pavlo@debian:~/OpenStack()$ openstack network create red-intra-pablo+---------------------------+--------------------------------------+| Field                     | Value                                |+---------------------------+--------------------------------------+| admin_state_up            | UP                                   || availability_zone_hints   |                                      || availability_zones        |                                      || created_at                | 2024-12-11T17:33:53Z                 || description               |                                      || dns_domain                | None                                 || id                        | 260d2b52-38e8-449f-a368-a68824d2474f || ipv4_address_scope        | None                                 || ipv6_address_scope        | None                                 || is_default                | False                                || is_vlan_transparent       | None                                 || mtu                       | 1442                                 || name                      | red-intra-pablo                      || port_security_enabled     | True                                 || project_id                | 07df99f775d343a58e702b5c99adcbad     || provider:network_type     | None                                 || provider:physical_network | None                                 || provider:segmentation_id  | None                                 || qos_policy_id             | None                                 || revision_number           | 1                                    || router:external           | Internal                             || segments                  | None                                 || shared                    | False                                || status                    | ACTIVE                               || subnets                   |                                      || tags                      |                                      || updated_at                | 2024-12-11T17:33:53Z                 |+---------------------------+--------------------------------------+Luego, crear la subred con las especificaciones:(os) pavlo@debian:~/OpenStack()$ openstack subnet create red-intra-pablo-subnet \\&gt; --network red-intra-pablo \\&gt; --subnet-range 10.0.200.0/24 \\&gt; --dhcp \\&gt; --gateway 10.0.200.1 \\&gt; --dns-nameserver 172.22.0.1+----------------------+--------------------------------------+| Field                | Value                                |+----------------------+--------------------------------------+| allocation_pools     | 10.0.200.2-10.0.200.254              || cidr                 | 10.0.200.0/24                        || created_at           | 2024-12-11T17:35:40Z                 || description          |                                      || dns_nameservers      | 172.22.0.1                           || dns_publish_fixed_ip | None                                 || enable_dhcp          | True                                 || gateway_ip           | 10.0.200.1                           || host_routes          |                                      || id                   | 7ef74cd9-63bf-4b2e-8479-69250a4a087b || ip_version           | 4                                    || ipv6_address_mode    | None                                 || ipv6_ra_mode         | None                                 || name                 | red-intra-pablo-subnet               || network_id           | 260d2b52-38e8-449f-a368-a68824d2474f || project_id           | 07df99f775d343a58e702b5c99adcbad     || revision_number      | 0                                    || segment_id           | None                                 || service_types        |                                      || subnetpool_id        | None                                 || tags                 |                                      || updated_at           | 2024-12-11T17:35:40Z                 |+----------------------+--------------------------------------+Por √∫ltimo a√±adimos la subnet creada en el paso anterior al router creado al principio:(os) pavlo@debian:~/OpenStack()$ openstack router add subnet RouterPractica red-intra-pablo-subnet      Crea una red interna que se llame Red DMZ de tu_usuario, con las siguientes caracter√≠sticas:                  Direccionamiento: 172.16.0.0/16                    Sin DHCP.                    Deshabilitamos la puerta de enlace. Esto es para que cloud-init no configure la puerta de enlace en las instancias conectada a esta red.                    La puerta de enlace de los dispositivos conectados a esta red ser√° el 172.16.0.1.            Para crear esta red hacemos lo mismo que antes:(os) pavlo@debian:~/OpenStack()$ openstack network create red-dmz-pablo+---------------------------+--------------------------------------+| Field                     | Value                                |+---------------------------+--------------------------------------+| admin_state_up            | UP                                   || availability_zone_hints   |                                      || availability_zones        |                                      || created_at                | 2024-12-11T17:41:36Z                 || description               |                                      || dns_domain                | None                                 || id                        | b6ae55f9-e6fb-4509-bd3b-fd627a3da1d8 || ipv4_address_scope        | None                                 || ipv6_address_scope        | None                                 || is_default                | False                                || is_vlan_transparent       | None                                 || mtu                       | 1442                                 || name                      | red-dmz-pablo                        || port_security_enabled     | True                                 || project_id                | 07df99f775d343a58e702b5c99adcbad     || provider:network_type     | None                                 || provider:physical_network | None                                 || provider:segmentation_id  | None                                 || qos_policy_id             | None                                 || revision_number           | 1                                    || router:external           | Internal                             || segments                  | None                                 || shared                    | False                                || status                    | ACTIVE                               || subnets                   |                                      || tags                      |                                      || updated_at                | 2024-12-11T17:41:36Z                 |+---------------------------+--------------------------------------+Luego creamos la subnet indicando que no queremos dhcp ni puerta de enlace:(os) pavlo@debian:~/OpenStack()$ openstack subnet create red-dmz-pablo-subnet \\&gt; --network red-dmz-pablo \\&gt; --subnet-range 172.16.0.0/16 \\&gt; --no-dhcp \\&gt; --gateway none+----------------------+--------------------------------------+| Field                | Value                                |+----------------------+--------------------------------------+| allocation_pools     | 172.16.0.1-172.16.255.254            || cidr                 | 172.16.0.0/16                        || created_at           | 2024-12-11T17:44:05Z                 || description          |                                      || dns_nameservers      |                                      || dns_publish_fixed_ip | None                                 || enable_dhcp          | False                                || gateway_ip           | None                                 || host_routes          |                                      || id                   | 450496f9-646a-42a4-9a8e-b07b5b3a992d || ip_version           | 4                                    || ipv6_address_mode    | None                                 || ipv6_ra_mode         | None                                 || name                 | red-dmz-pablo-subnet                 || network_id           | b6ae55f9-e6fb-4509-bd3b-fd627a3da1d8 || project_id           | 07df99f775d343a58e702b5c99adcbad     || revision_number      | 0                                    || segment_id           | None                                 || service_types        |                                      || subnetpool_id        | None                                 || tags                 |                                      || updated_at           | 2024-12-11T17:44:05Z                 |+----------------------+--------------------------------------+Aunque no configuramos la puerta de enlace en la red (para evitar que cloud-init lo haga autom√°ticamente), las instancias se pueden configurar manualmente si es necesario.La direcci√≥n 172.16.0.1 ser√° la puerta de enlace predeterminada que los dispositivos pueden usar.Instalaci√≥n de las instancias de OpenStackConfiguraci√≥n de las instanciasLas dos instancias que vamos a crear se van a configurar con cloud-init de la siguiente manera:      Deben actualizar los paquetes de la distribuci√≥n de la instancia.        El dominio utilizado ser√° del tipo tunombre.gonzalonazareno.org. Por lo tanto en la configuraci√≥n con cloud-init habr√° que indicar el hostname y el FQDN.        Se crear√°n dos usuarios:                  Un usuario sin privilegios. Se puede llamar como quieras (pero el nombre ser√° el mismo en todas las m√°quinas) y acceder√°s a las m√°quinas usando tu clave ssh privada.                    Un usuario profesor, que puede utilizar sudo sin contrase√±a. Copia de las claves p√∫blicas de todos los profesores en las instancias para que puedan acceder con el usuario profesor.                  Cambia la contrase√±a al usuario root.  Bueno pues para ello debemos crear el fichero cloud-init-luffy.yaml en donde a√±adiremos las configuraciones que se pide:#cloud-configpackage_update: truepackage_upgrade: truehostname: luffyfqdn: luffy.pablo.gonzalonazareno.orgusers:  - name: pablo    shell: /bin/bash    sudo: ['ALL=(ALL) NOPASSWD:ALL']    ssh_authorized_keys:      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQClFcnIhYd1oaEpvGi/f4psQc4+DaAZvSNIxVRRJHtRoJui8wbJybi3Om8yTOflgEcmBaUrJLkfmzmWqVq1j6MpESq72p7J2hdq2lXnvzdt3huYv5evFwyd0p/r72RfpVZzr3ILi/BS//SJqfVKlDEVbZRaOE5MU2XuElmFFY4EO7NiiZAkbatVqUOT8H/nrfXcad0mjZVxroVqHhsHV+06rxiB0xifG0xZv204Qj4zRura8uqZlEVAAwU+NO/SIGdRwpLY7n7xbQGe1DbjHgPUeVPjJX6HpMK41a43eGj4XYdYtZBLugaU8Mq1y6Kl3tE6cvYkQ9WFTYTLLNy3bvNRZpP2p6qAy5qn03ZLFICiXBNXPmrl5+KVrKaSipNaPHkmInvczbYJjXpfyVBsfEabt+0Y1629M+eEKkkl+iZmVr2ySDSS1gHxMC7zlJRaUhG27o26agpNPYPHH3mVXVjqdGg0ryH0YHZk1V8+Gt1Z9hZ7UYWE1UX8DCgFfecqdX0= pavlo@debian\"  - name: profesor    shell: /bin/bash    sudo: ['ALL=(ALL) NOPASSWD:ALL']    ssh_authorized_keys:      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCmjoVIoZCx4QFXvljqozXGqxxlSvO7V2aizqyPgMfGqnyl0J9YXo6zrcWYwyWMnMdRdwYZgHqfiiFCUn2QDm6ZuzC4Lcx0K3ZwO2lgL4XaATykVLneHR1ib6RNroFcClN69cxWsdwQW6dpjpiBDXf8m6/qxVP3EHwUTsP8XaOV7WkcCAqfYAMvpWLISqYme6e+6ZGJUIPkDTxavu5JTagDLwY+py1WB53eoDWsG99gmvyit2O1Eo+jRWN+mgRHIxJTrFtLS6o4iWeshPZ6LvCZ/Pum12Oj4B4bjGSHzrKjHZgTwhVJ/LDq3v71/PP4zaI3gVB9ZalemSxqomgbTlnT jose@debian\"      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDf9lnBH2nCT2ezpDZnqSBeDuSsVGGFD1Kzqa4KyIVkzkrD7pNHHkkpSuO4isKcCsUcopYOcA38QtG7wB0v/qn8Jsq731N8bjaKOdQN25vqLjwVj8DpYtvGc+ZA0uaChe7TS+QBzlMC9ypwj4wf15Q/z3v/ip4FF2cORT0cQC04cNRQDgUg4p1rlOs8+ma7OPh3P3UvzlPfLhi2H1yl+/mo4XLOcAMNr/jiZCwYxom6OEOYVBNk8MZX/Zn+qRi71D0RPiKg27AcXSD/FPWdQW9hBH1Zq5xGicUFS4C9yXvHKru7cMmmxV2G80p/ArRscKWq92UT5jIJQpccmHxsxdIi6o25LhcxH1dOnZy6kHcJ2yP24CnBHK5Y3SsovCD0Th6MN1VlTySbl8Ar0ypmY+GYO+oVd4bM3ioHzL0AMqYnS29m0UtEDvFEUUoSkOoLK4uSlcvej+OIVp7X5G7oZ56nZZf+qHEgodv++a6vPmhH2ZSgoOj1sE39DK7InuKSqCE= rafa@eco\"      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDASDwvkY5SbIgM+/j14mNQluPV+/HGcM3ZgXrYDWt7zhQKq8KAXqJLs1vw1HcRv5PRV071caZQxV2ssfrNqIDofjSzWM1I1JkVIqIj4NCOsRFsQQFN8HwfkE9ic/X6vRaV+NfkEF+t3VmX2YgBd02ZbmGt53qjDaGMQRS/qxw3MPS+ynf2Fj8ZibT6DZeWnyjEGhFcyrggFWiPDqw77MNaiDr+31SO0TaP1WeIWFMrSwPVMVG1zvSxAQ9L13SQ5XzwK0Xs2A8kBPiZmPuUFRqYlBWeffhUnRPSg4TdOsWqJjEwFb5OwpQmTDCT5z0MSFCNVLV5GGwvvqCrw5jd1Xfdswdqazc8mCaIPIrCmhsiwz7uZvQDYr1HDrKxJ1L8LLo3usp4FM5cCCM5jptK+XffhmIyJSkMrcg6tYawBeNuAiY3dwPRIyKeV1Ku3UUctkN+kbuOpMQ4nSvAK0DyhUiTakc8qMJDNLD8oHhSEp49G2bzsLwFOmaEgb8falVMLyk= javji@Javier\"  - name: root    passwd: \"root\"final_message: \"Instancia configurada correctamente.\"Este fichero est√° destinado a la configuraci√≥n de la instancia luffy.A continuaci√≥n, crear√© el archivo cloud-init-zoro.yaml para la posterior creaci√≥n de la instancia zoro.#cloud-configpackage_update: truepackage_upgrade: truehostname: zorofqdn: zoro.pablo.gonzalonazareno.orgusers:  - name: pablo    gecos: Usuario sin privilegios    groups: []    shell: /bin/bash    sudo: ['ALL=(ALL) NOPASSWD:ALL']    ssh_authorized_keys:      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQClFcnIhYd1oaEpvGi/f4psQc4+DaAZvSNIxVRRJHtRoJui8wbJybi3Om8yTOflgEcmBaUrJLkfmzmWqVq1j6MpESq72p7J2hdq2lXnvzdt3huYv5evFwyd0p/r72RfpVZzr3ILi/BS//SJqfVKlDEVbZRaOE5MU2XuElmFFY4EO7NiiZAkbatVqUOT8H/nrfXcad0mjZVxroVqHhsHV+06rxiB0xifG0xZv204Qj4zRura8uqZlEVAAwU+NO/SIGdRwpLY7n7xbQGe1DbjHgPUeVPjJX6HpMK41a43eGj4XYdYtZBLugaU8Mq1y6Kl3tE6cvYkQ9WFTYTLLNy3bvNRZpP2p6qAy5qn03ZLFICiXBNXPmrl5+KVrKaSipNaPHkmInvczbYJjXpfyVBsfEabt+0Y1629M+eEKkkl+iZmVr2ySDSS1gHxMC7zlJRaUhG27o26agpNPYPHH3mVXVjqdGg0ryH0YHZk1V8+Gt1Z9hZ7UYWE1UX8DCgFfecqdX0= pavlo@debian\"  - name: profesor    gecos: Usuario Profesor    groups: sudo    shell: /bin/bash    sudo: ['ALL=(ALL) NOPASSWD:ALL']    ssh_authorized_keys:      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCmjoVIoZCx4QFXvljqozXGqxxlSvO7V2aizqyPgMfGqnyl0J9YXo6zrcWYwyWMnMdRdwYZgHqfiiFCUn2QDm6ZuzC4Lcx0K3ZwO2lgL4XaATykVLneHR1ib6RNroFcClN69cxWsdwQW6dpjpiBDXf8m6/qxVP3EHwUTsP8XaOV7WkcCAqfYAMvpWLISqYme6e+6ZGJUIPkDTxavu5JTagDLwY+py1WB53eoDWsG99gmvyit2O1Eo+jRWN+mgRHIxJTrFtLS6o4iWeshPZ6LvCZ/Pum12Oj4B4bjGSHzrKjHZgTwhVJ/LDq3v71/PP4zaI3gVB9ZalemSxqomgbTlnT jose@debian\"      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDf9lnBH2nCT2ezpDZnqSBeDuSsVGGFD1Kzqa4KyIVkzkrD7pNHHkkpSuO4isKcCsUcopYOcA38QtG7wB0v/qn8Jsq731N8bjaKOdQN25vqLjwVj8DpYtvGc+ZA0uaChe7TS+QBzlMC9ypwj4wf15Q/z3v/ip4FF2cORT0cQC04cNRQDgUg4p1rlOs8+ma7OPh3P3UvzlPfLhi2H1yl+/mo4XLOcAMNr/jiZCwYxom6OEOYVBNk8MZX/Zn+qRi71D0RPiKg27AcXSD/FPWdQW9hBH1Zq5xGicUFS4C9yXvHKru7cMmmxV2G80p/ArRscKWq92UT5jIJQpccmHxsxdIi6o25LhcxH1dOnZy6kHcJ2yP24CnBHK5Y3SsovCD0Th6MN1VlTySbl8Ar0ypmY+GYO+oVd4bM3ioHzL0AMqYnS29m0UtEDvFEUUoSkOoLK4uSlcvej+OIVp7X5G7oZ56nZZf+qHEgodv++a6vPmhH2ZSgoOj1sE39DK7InuKSqCE= rafa@eco\"      - \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDASDwvkY5SbIgM+/j14mNQluPV+/HGcM3ZgXrYDWt7zhQKq8KAXqJLs1vw1HcRv5PRV071caZQxV2ssfrNqIDofjSzWM1I1JkVIqIj4NCOsRFsQQFN8HwfkE9ic/X6vRaV+NfkEF+t3VmX2YgBd02ZbmGt53qjDaGMQRS/qxw3MPS+ynf2Fj8ZibT6DZeWnyjEGhFcyrggFWiPDqw77MNaiDr+31SO0TaP1WeIWFMrSwPVMVG1zvSxAQ9L13SQ5XzwK0Xs2A8kBPiZmPuUFRqYlBWeffhUnRPSg4TdOsWqJjEwFb5OwpQmTDCT5z0MSFCNVLV5GGwvvqCrw5jd1Xfdswdqazc8mCaIPIrCmhsiwz7uZvQDYr1HDrKxJ1L8LLo3usp4FM5cCCM5jptK+XffhmIyJSkMrcg6tYawBeNuAiY3dwPRIyKeV1Ku3UUctkN+kbuOpMQ4nSvAK0DyhUiTakc8qMJDNLD8oHhSEp49G2bzsLwFOmaEgb8falVMLyk= javji@Javier\"chpasswd:  list: |    root:root  expire: FalseCreaci√≥n de las instanciasm√°quina1 (luffy)      Crea una instancia sobre un volumen de 15Gb (el volumen se crea durante la creaci√≥n de la instancia), usando una imagen de Debian 12 Bookworm. Elige el sabor vol.medium. Y configural√° con cloud-init como se ha indicado anteriormente.        Est√° instancia estar√° conectada a las dos redes. Recuerda que en la red Red DMZ debe tomar la direcci√≥n 172.16.0.1 (puerta de enlace las m√°quinas conectadas a esta red). Asigna a la instancia una IP flotante.        Deshabilita la seguridad de los puertos en las dos interfaces de red para que funcione de manera adecuada el NAT.        Configura de forma permanente la regla SNAT para que las m√°quinas de la Red DMZ tengan acceso a internet.  En primer lugar debemos crear la instancia:(os) pavlo@debian:~/OpenStack()$ openstack server create luffy \\&gt; --flavor vol.medium \\&gt; --image \"Debian 12 Bookworm\" \\&gt; --network red-intra-pablo \\&gt; --network red-dmz-pablo \\&gt; --user-data cloud-init-luffy.yaml \\&gt; --boot-from-volume 15 \\&gt; --security-group defaultLuego, le asignamos una IP flotante, para ello:(os) pavlo@debian:~/OpenStack()$ openstack server add floating ip luffy 172.22.200.100Comprobamos que se hayan a√±adido las interfaces correctamente:(os) pavlo@debian:~/OpenStack()$ openstack server list+--------------------------------------+-------+--------+--------------------------------------------------------------------------+--------------------------+------------+| ID                                   | Name  | Status | Networks                                                                 | Image                    | Flavor     |+--------------------------------------+-------+--------+--------------------------------------------------------------------------+--------------------------+------------+| 91e29177-4a4f-4529-8594-4f867d2dd6bd | luffy | ACTIVE | red-dmz-pablo=172.16.3.142; red-intra-pablo=10.0.200.181, 172.22.200.100 | N/A (booted from volume) | vol.medium |+--------------------------------------+-------+--------+--------------------------------------------------------------------------+--------------------------+------------+Ahora debemos deshabilitar la seguridad de los puertos en las dos interfaces de red, para ello primero obtenemos las IDs de los puertos:(os) pavlo@debian:~/OpenStack()$ openstack port list --server luffy+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+| ID                                   | Name | MAC Address       | Fixed IP Addresses                                                          | Status |+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+| 1505f6e0-7c0f-47d3-b865-1a5420c69246 |      | fa:16:3e:d9:cb:6a | ip_address='172.16.3.142', subnet_id='450496f9-646a-42a4-9a8e-b07b5b3a992d' | ACTIVE || 3168307f-1878-4306-a1c3-81256a9dd85a |      | fa:16:3e:ff:1e:6d | ip_address='10.0.200.181', subnet_id='7ef74cd9-63bf-4b2e-8479-69250a4a087b' | ACTIVE |+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+Y una vez sabemos las IDs ya podemos deshabilitarlos:(os) pavlo@debian:~/OpenStack()$ openstack port set 1505f6e0-7c0f-47d3-b865-1a5420c69246 --no-security-group --disable-port-security(os) pavlo@debian:~/OpenStack()$ openstack port set 3168307f-1878-4306-a1c3-81256a9dd85a --no-security-group --disable-port-securityAntes de aceder al router (luffy) y realizar el SNAT voy a a√±adir en el ~/.ssh/config la m√°quina para poder conectarme de forma m√°s sencilla:Host luffy  HostName 172.22.200.100  User pablo  ForwardAgent yesDe forma que ya puedo acceder a la instancia:(os) pavlo@debian:~/OpenStack()$ ssh luffy Linux luffy 6.1.0-28-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.119-1 (2024-11-22) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Wed Dec 11 22:48:14 2024 from 172.29.0.34pablo@luffy:~$Una vez accedido a luffy habilitamos el bit de forwarding en el fichero /etc/sysctl.conf, en donde descomentamos la siguiente l√≠nea:net.ipv4.ip_forward=1Aplicamos los cambios:pablo@luffy:~$ sudo sysctl -pnet.ipv4.ip_forward = 1Ahora debemos configurar la reglas SNAT con iptables, pero antes miramos las direcciones IP de las interfaces:pablo@luffy:~$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host noprefixroute        valid_lft forever preferred_lft forever2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:8c:07:52 brd ff:ff:ff:ff:ff:ff    altname enp0s3    inet 10.0.200.231/24 metric 100 brd 10.0.200.255 scope global dynamic ens3       valid_lft 42718sec preferred_lft 42718sec    inet6 fe80::f816:3eff:fe8c:752/64 scope link        valid_lft forever preferred_lft forever3: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:67:5a:49 brd ff:ff:ff:ff:ff:ff    altname enp0s4    inet 172.16.0.16/16 brd 172.16.255.255 scope global ens4       valid_lft forever preferred_lft forever    inet6 fe80::f816:3eff:fe67:5a49/64 scope link        valid_lft forever preferred_lft foreverEn base a esta configuraci√≥n de interfaces de red:  ens3: Interfaz conectada a la red interna (red-intra-pablo, 10.0.200.0/24).  ens4: Interfaz conectada a la red DMZ (red-dmz-pablo, 172.16.0.0/16).Dado esto, necesitamos configurar las reglas SNAT para que el tr√°fico desde Red DMZ pueda salir a Internet a trav√©s de ens3. Para ello:sudo iptables -t nat -A POSTROUTING -o ens3 -s 172.16.0.0/16 -j MASQUERADEDe forma que quede as√≠:pablo@luffy:~$ sudo iptables -t nat -L -vChain PREROUTING (policy ACCEPT 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source               destination         Chain INPUT (policy ACCEPT 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source               destination         Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source               destination         Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source               destination             0     0 MASQUERADE  all  --  any    ens3    172.16.0.0/16        anywherePara hacer las reglas persistentes instalamos el siguiente paquete:sudo apt install iptables-persistentEn la misma instalaci√≥n si detecta reglas existentes las guarda autom√°ticamente, aunque si a√±adimos otras reglas debemos hacerlo manualmente.Con esto, ya habr√≠amos terminado la instalaci√≥n y configuraci√≥n al completo del router luffy.maquina2 (zoro)      Crea un volumen de 15Gb con la imagen Rocky Linux 9.        Crea la instancia a partir de este volumen. Elige el sabor vol.medium. Y config√∫rala con cloud-init como se ha indicado anteriormente.        En un primer momento, para que la instancia se configure mediante cloud-init conecta esta instancia a un red con DHCP.        Posteriormente, desconecta la interfaz de red de esa red y con√©ctala a la red Red DMZ a la direcci√≥n 172.16.0.200.        Recuerda, que esa configuraci√≥n no se har√° de forma autom√°tica por lo que deberas, de forma manual, configurar la red en esta m√°quina. recuerda que Rocky Linux tiene instalado por defecto NetwokManager.        Deshabilita la seguridad de los puertos en la interfaz de red para que funcione de manera adecuada el NAT.        Comprueba que tiene acceso a internet.  Empezamos creando el volumen a partir de la imagen:(os) pavlo@debian:~/OpenStack()$ openstack volume create --size 15 --image \"Rocky Linux 9\" volumen-zoro+---------------------+------------------------------------------------------------------+| Field               | Value                                                            |+---------------------+------------------------------------------------------------------+| attachments         | []                                                               || availability_zone   | nova                                                             || bootable            | false                                                            || consistencygroup_id | None                                                             || created_at          | 2024-12-12T07:44:39.479661                                       || description         | None                                                             || encrypted           | False                                                            || id                  | 786b9400-013c-4bf3-9986-1896891628bf                             || multiattach         | False                                                            || name                | volumen-zoro                                                     || properties          |                                                                  || replication_status  | None                                                             || size                | 15                                                               || snapshot_id         | None                                                             || source_volid        | None                                                             || status              | creating                                                         || type                | lvmdriver-1                                                      || updated_at          | None                                                             || user_id             | a74499e28f7622936621adb74c2b02fe4a18a1f6964a32bdbb23af09b776065f |+---------------------+------------------------------------------------------------------+Seguidamente creamos la instancia a partir del volumen, conect√°ndola en un principio a una red con DHCP como red-intra-pablo.(os) pavlo@debian:~/OpenStack()$ openstack server create zoro \\    --flavor vol.medium \\    --volume volumen-zoro \\    --network red-intra-pablo \\    --user-data cloud-init-zoro.yaml \\    --security-group defaultComprobamos que se haya creado correctamente:(os) pavlo@debian:~/OpenStack()$ openstack server list+--------------------------------------+-------+--------+-------------------------------------------------------------------------+--------------------------+------------+| ID                                   | Name  | Status | Networks                                                                | Image                    | Flavor     |+--------------------------------------+-------+--------+-------------------------------------------------------------------------+--------------------------+------------+| 82692c6d-9d36-4bdd-86b6-46e90bea1892 | zoro  | ACTIVE | red-intra-pablo=10.0.200.132                                            | N/A (booted from volume) | vol.medium || 9c9e8c12-7712-404e-aa3b-2e2bf566ca0c | luffy | ACTIVE | red-dmz-pablo=172.16.0.16; red-intra-pablo=10.0.200.231, 172.22.200.100 | N/A (booted from volume) | vol.medium |+--------------------------------------+-------+--------+-------------------------------------------------------------------------+--------------------------+------------+Ya que se ha creado la instancia y el cloud-init se ha configurado correctamente, a√±adimos en el fichero ~/.ssh/config la nueva configuraci√≥n temporal:Host luffy  HostName 172.22.200.100  User pablo  ForwardAgent yesHost zoro  HostName 10.0.200.244  User pablo  ForwardAgent yes  ProxyJump luffyAdem√°s, a√±adimos la nueva interfaz que estar√° conectada a la Red DMZ con la direcci√≥n 172.16.0.200, la que posteriormente vamos a configurar manualmente:(os) pavlo@debian:~/OpenStack()$ openstack server add port zoro \\&gt; $(openstack port create --network red-dmz-pablo --fixed-ip subnet=red-dmz-pablo-subnet,ip-address=172.16.0.200 puerto-zoro -f value -c id)Accedemos a la instancia:(os) pavlo@debian:~/OpenStack()$ ssh zoro The authenticity of host '10.0.200.244 (&lt;no hostip for proxy command&gt;)' can't be established.ED25519 key fingerprint is SHA256:JrbuXBRRZ4JoLGdRCCiKNThDEKWqINQtX2NVLKP7Gvo.This host key is known by the following other names/addresses:    ~/.ssh/known_hosts:421: [hashed name]Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.200.244' (ED25519) to the list of known hosts.Last login: Thu Dec 12 07:52:34 2024 from 10.0.200.231Y hacemos algunas comprobaciones:[pablo@zoro ~]$ hostname -fzoro.pablo.gonzalonazareno.org[pablo@zoro ~]$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:78:8b:9e brd ff:ff:ff:ff:ff:ff    altname enp0s3    altname ens33: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:87:ca:cd brd ff:ff:ff:ff:ff:ff    altname enp0s7    altname ens7    inet 10.0.200.244/24 brd 10.0.200.255 scope global dynamic noprefixroute eth1       valid_lft 43120sec preferred_lft 43120sec    inet6 fe80::7f34:f482:b58c:edcc/64 scope link noprefixroute        valid_lft forever preferred_lft foreverComo vemos la interfaz eth0 est√° sin direccionamiento, por lo que vamos a a√±adir la IP para luego poder eliminar la red-intra-pablo.Para ello, creamos el fichero /etc/NetworkManager/system-connections/dmz.nmconnection con la siguiente configuraci√≥n:[connection]id=dmztype=ethernetinterface-name=eth0[ipv4]method=manualaddresses=172.16.0.200/16gateway=172.16.0.16dns=8.8.8.8;1.1.1.1[ipv6]method=ignoreSeguidamente reiniciamos los servicios:[pablo@zoro ~]$ sudo nmcli connection reload[pablo@zoro ~]$ sudo systemctl restart NetworkManager[pablo@zoro ~]$ sudo nmcli connection up dmzConnection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)Y ya tenemos direcci√≥n IP:[pablo@zoro ~]$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:78:8b:9e brd ff:ff:ff:ff:ff:ff    altname enp0s3    altname ens3    inet 172.16.0.200/16 brd 172.16.255.255 scope global noprefixroute eth0       valid_lft forever preferred_lft forever    inet6 fe80::f816:3eff:fe78:8b9e/64 scope link        valid_lft forever preferred_lft forever3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc fq_codel state UP group default qlen 1000    link/ether fa:16:3e:87:ca:cd brd ff:ff:ff:ff:ff:ff    altname enp0s7    altname ens7    inet 10.0.200.244/24 brd 10.0.200.255 scope global dynamic noprefixroute eth1       valid_lft 43193sec preferred_lft 43193sec    inet6 fe80::7f34:f482:b58c:edcc/64 scope link noprefixroute        valid_lft forever preferred_lft foreverAhora, nos salimos de la instancia y revocamos la red-intra-pablo:pavlo@debian:~/OpenStack()$ openstack server remove network zoro red-intra-pabloM√°s tarde, modificamos el fichero ~/.ssh/config para que acceda con la nueva IP:Host luffy  HostName 172.22.200.100  User pablo  ForwardAgent yesHost zoro  HostName 172.16.0.200  User pablo  ForwardAgent yes  ProxyJump luffyY ya nos dejar√≠a acceder:pavlo@debian:~/OpenStack()$ ssh zoro The authenticity of host '172.16.0.200 (&lt;no hostip for proxy command&gt;)' can't be established.ED25519 key fingerprint is SHA256:JrbuXBRRZ4JoLGdRCCiKNThDEKWqINQtX2NVLKP7Gvo.This host key is known by the following other names/addresses:    ~/.ssh/known_hosts:421: [hashed name]    ~/.ssh/known_hosts:424: [hashed name]Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '172.16.0.200' (ED25519) to the list of known hosts.Last login: Thu Dec 12 08:30:57 2024 from 10.0.200.231[pablo@zoro ~]$Antes de probar la conexi√≥n a Internet debemos deshabilitar la seguridad de los puertos para que el NAT funcione correctamente:pavlo@debian:~/OpenStack()$ openstack port list --server zoro+--------------------------------------+-------------+-------------------+-----------------------------------------------------------------------------+--------+| ID                                   | Name        | MAC Address       | Fixed IP Addresses                                                          | Status |+--------------------------------------+-------------+-------------------+-----------------------------------------------------------------------------+--------+| 3dd6bcc3-0c30-4f37-ae10-3d70767efff1 | puerto-zoro | fa:16:3e:78:8b:9e | ip_address='172.16.0.200', subnet_id='450496f9-646a-42a4-9a8e-b07b5b3a992d' | ACTIVE |+--------------------------------------+-------------+-------------------+-----------------------------------------------------------------------------+--------+pavlo@debian:~/OpenStack()$ openstack port set 3dd6bcc3-0c30-4f37-ae10-3d70767efff1 --no-security-group --disable-port-securityPudiendo de esta forma acceder a Internet:[pablo@zoro ~]$ ping -c 4 8.8.8.8PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.64 bytes from 8.8.8.8: icmp_seq=1 ttl=103 time=18.0 ms64 bytes from 8.8.8.8: icmp_seq=2 ttl=103 time=17.8 ms64 bytes from 8.8.8.8: icmp_seq=3 ttl=103 time=17.6 ms64 bytes from 8.8.8.8: icmp_seq=4 ttl=103 time=17.1 ms--- 8.8.8.8 ping statistics ---4 packets transmitted, 4 received, 0% packet loss, time 3005msrtt min/avg/max/mdev = 17.086/17.607/17.958/0.325 msYa habr√≠amos terminado la primera parte del escenario de OpenStack, quedando la topolog√≠a de la siguiente forma:Si queremos hacer algunas comprobaciones como por ejemplo acceder a los FQDN del otro, tendremos que configurar los /etc/hosts:pablo@luffy:~$ cat /etc/hosts127.0.0.1\tlocalhost::1\t\tlocalhost ip6-localhost ip6-loopbackff02::1\t\tip6-allnodesff02::2\t\tip6-allrouters172.16.0.16 luffy.pablo.gonzalonazareno.org luffy172.16.0.200 zoro.pablo.gonzalonazareno.org zoro[pablo@zoro ~]$ cat /etc/hosts127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4::1         localhost localhost.localdomain localhost6 localhost6.localdomain6172.16.0.16 luffy.pablo.gonzalonazareno.org luffy172.16.0.200 zoro.pablo.gonzalonazareno.org zoroDe forma que tenemos conectividad entre ambos:pablo@luffy:~$ ping -c 2 zoro.pablo.gonzalonazareno.org PING zoro.pablo.gonzalonazareno.org (172.16.0.200) 56(84) bytes of data.64 bytes from zoro.pablo.gonzalonazareno.org (172.16.0.200): icmp_seq=1 ttl=64 time=2.40 ms64 bytes from zoro.pablo.gonzalonazareno.org (172.16.0.200): icmp_seq=2 ttl=64 time=0.510 ms--- zoro.pablo.gonzalonazareno.org ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 0.510/1.457/2.404/0.947 ms[pablo@zoro ~]$ ping -c 2 luffy.pablo.gonzalonazareno.orgPING luffy.pablo.gonzalonazareno.org (172.16.0.16) 56(84) bytes of data.64 bytes from luffy.pablo.gonzalonazareno.org (172.16.0.16): icmp_seq=1 ttl=64 time=0.218 ms64 bytes from luffy.pablo.gonzalonazareno.org (172.16.0.16): icmp_seq=2 ttl=64 time=0.441 ms--- luffy.pablo.gonzalonazareno.org ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1026msrtt min/avg/max/mdev = 0.218/0.329/0.441/0.111 msPor √∫ltimo, podemos ver que tenemos conectividad a Internet en ambas m√°quinas:pablo@luffy:~$ ping -c 2 google.comPING google.com (142.250.186.78) 56(84) bytes of data.64 bytes from fra24s05-in-f14.1e100.net (142.250.186.78): icmp_seq=1 ttl=101 time=40.0 ms64 bytes from fra24s05-in-f14.1e100.net (142.250.186.78): icmp_seq=2 ttl=101 time=38.2 ms--- google.com ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 38.183/39.114/40.045/0.931 ms[pablo@zoro ~]$ ping -c 2 google.comPING google.com (142.250.186.78) 56(84) bytes of data.64 bytes from fra24s05-in-f14.1e100.net (142.250.186.78): icmp_seq=1 ttl=100 time=40.4 ms64 bytes from fra24s05-in-f14.1e100.net (142.250.186.78): icmp_seq=2 ttl=100 time=37.1 ms--- google.com ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1001msrtt min/avg/max/mdev = 37.124/38.739/40.355/1.615 msPr√°ctica (2 / 2): Escenario en OpenStackInstalaci√≥n de los contenedoresEn m√°quina1 (luffy) vamos a crear dos contenedores en un red interna, para ello:  Crea en m√°quina1 (luffy) un linux bridge llamado br-intra (no lo hagas con virsh ya que se configura una reglas de cortafuego muy estrictas) y asigna una direcci√≥n IP est√°tica 192.168.0.1. Esta ser√° la IP de m√°quina1 (luffy) conectada a este switch virtual y ser√° la puerta de enlace de los contenedores. Tienes que tener en cuenta que la imagen de Debian 12 Bookworm de OpenStack tiene netplan para la configuraci√≥n de las redes, por lo tanto tienes que configurar el bridge usando el fichero de configuraci√≥n de netplan, para ello te puede ser √∫til esta p√°gina. No olvides poner la mtu a 1442 al crear el bridge.Para crear el puente tendremos que modificar la configuraci√≥n del fichero netplan, en donde a√±adiremos las siguientes l√≠neas:bridges:      br-intra:        addresses: [192.168.0.1/24]        mtu: 1442        dhcp4: no        dhcp6: no        nameservers:          addresses: [172.22.0.1]Una vez a√±adido, aplicamos los cambios:pablo@luffy:~$ sudo netplan generatepablo@luffy:~$ sudo netplan apply  Instala LXC y crea dos contenedores con la distribuci√≥n Ubuntu 22.04. Estos contenedores ser√°n la m√°quina3 (nami) y la m√°quina4 (sanji).Para instalar LXC ejecutamos el siguiente comando:pablo@luffy:~$ sudo apt install lxcUna vez instalado, pasamos a instalar los contenedores:  Namipablo@luffy:~$ sudo lxc-create -n nami -t ubuntu -- -r jammy  Sanjipablo@luffy:~$ sudo lxc-create -n sanji -t ubuntu -- -r jammy  Configura de forma permanente la regla SNAT para que los contenedores tengan acceso a internet.Para ello es tan simple como a√±adir la siguiente regla:pablo@luffy:~$ sudo iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o ens3 -j MASQUERADEImportante hacer las reglas persistentes para posibles futuros reinicios:pablo@luffy:~$ sudo -iroot@luffy:~# iptables-save &gt; /etc/iptables/rules.v4root@luffy:~# exitlogout  Conecta los contenedores al bridge br-intra y config√∫ralo de forma est√°tica con las siguientes direcciones: m√°quina3 (nami) la 192.168.0.2 y m√°quina4 (sanji) la 192.168.0.3. Su DNS ser√° el 172.22.0.1.Para la configuraci√≥n de red modificaremos el fichero /var/lib/lxc/nombrecontenedor/config, quedando de la siguiente forma:pablo@luffy:~$ sudo cat /var/lib/lxc/nami/config# Template used to create this container: /usr/share/lxc/templates/lxc-ubuntu# Parameters passed to the template: -r jammy# For additional config options, please look at lxc.container.conf(5)# Uncomment the following line to support nesting containers:#lxc.include = /usr/share/lxc/config/nesting.conf# (Be aware this has security implications)# Common configurationlxc.include = /usr/share/lxc/config/ubuntu.common.conf# Container specific configurationlxc.apparmor.profile = generatedlxc.apparmor.allow_nesting = 1lxc.rootfs.path = dir:/var/lib/lxc/nami/rootfslxc.uts.name = namilxc.arch = amd64# Network configurationlxc.net.0.type = vethlxc.net.0.hwaddr = 00:16:3e:40:e4:dalxc.net.0.link = br-intralxc.net.0.flags = uplxc.net.0.ipv4.address = 192.168.0.2/24lxc.net.0.ipv4.gateway = 192.168.0.1Los DNS debemos configurarlos dentro del contenedor, para ello:root@nami:/# rm /etc/resolv.confroot@nami:/# echo -e \"nameserver 172.22.0.1\\nnameserver 8.8.8.8\" &gt; /etc/resolv.confroot@nami:/# cat /etc/resolv.conf nameserver 172.22.0.1nameserver 8.8.8.8En sanji a√±adimos pr√°cticamente la misma configuraci√≥n:# Network configurationlxc.net.0.type = vethlxc.net.0.hwaddr = 00:16:3e:c5:5c:70lxc.net.0.link = br-intralxc.net.0.flags = uplxc.net.0.ipv4.address = 192.168.0.3/24lxc.net.0.ipv4.gateway = 192.168.0.1Antes de acceder tenemos que iniciar los contenedores:pablo@luffy:~$ sudo lxc-start namipablo@luffy:~$ sudo lxc-start sanji  Para que la red de OpenStack funcione de forma adecuada las im√°genes que usamos tienen configurado la mtu (Unidad m√°xima de transferencia) a 1442 bytes. Tenemos que adecuar los contenedores a este tama√±o de trama. Para ello introduce en la configuraci√≥n de los contenedores la l√≠nea: lxc.net.0.mtu = 1442.Para ello tendremos que modificar el fichero config de ambos contenedores en donde a√±adimos esta l√≠nea:lxc.net.0.mtu = 1442Para aplicar los cambios apagamos y encendemos el contenedor:pablo@luffy:~$ sudo lxc-stop -n namipablo@luffy:~$ sudo lxc-start -n namipablo@luffy:~$ sudo lxc-stop -n sanjipablo@luffy:~$ sudo lxc-start -n sanji  Configura los contenedores para que se auto inicien al reiniciar la instancia.Para ello a√±adimos en el archivo config mencionado anteriormente la siguiente l√≠nea:lxc.start.auto = 1      Los contenedores tendr√°n caracter√≠sticas parecidas a las instancias anteriormente:          Debes actualizar los paquetes de la distribuci√≥n instalada.        root@nami:/# apt update        root@sanji:/# apt update              El dominio utilizado ser√° del tipo tunombre.gonzalonazareno.org. Por lo tanto configura de manera adecuada el hostname y el FQDN.        Nami    root@nami:/# cat /etc/hosts127.0.0.1   localhost127.0.1.1   nami.pablo.gonzalonazareno.org nami# The following lines are desirable for IPv6 capable hosts::1     ip6-localhost ip6-loopbackfe00::0 ip6-localnetff00::0 ip6-mcastprefixff02::1 ip6-allnodesff02::2 ip6-allrouters        Comprobamos:    root@nami:/# hostnamenamiroot@nami:/# hostname -fnami.pablo.gonzalonazareno.org        Sanji    root@sanji:/# cat /etc/hosts127.0.0.1   localhost127.0.1.1   sanji.pablo.gonzalonazareno.org sanji# The following lines are desirable for IPv6 capable hosts::1     ip6-localhost ip6-loopbackfe00::0 ip6-localnetff00::0 ip6-mcastprefixff02::1 ip6-allnodesff02::2 ip6-allrouters        Comprobamos:    root@sanji:/# hostnamesanjiroot@sanji:/# hostname -fsanji.pablo.gonzalonazareno.org                      Para acceder a los contenedores vamos a usar ssh.                    Crea dos usuarios:                  Un usuario sin privilegios. Se puede llamar como quieras (el nombre de usuario que usaste en las instancias) y acceder√°s a los contenedores usando tu clave ssh privada.                root@nami:/# useradd -m -s /bin/bash pablo                root@sanji:/# useradd -m -s /bin/bash pablo                Luego, en ambos contenedores a√±adimos nuestra clave p√∫blica dentro del authorized_keys:        root@sanji:/# su - pablopablo@sanji:~$ mkdir -p /home/pablo/.sshpablo@sanji:~$ echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQClFcnIhYd1oaEpvGi/f4psQc4+DaAZvSNIxVRRJHtRoJui8wbJybi3Om8yTOflgEcmBaUrJLkfmzmWqVq1j6MpESq72p7J2hdq2lXnvzdt3huYv5evFwyd0p/r72RfpVZzr3ILi/BS//SJqfVKlDEVbZRaOE5MU2XuElmFFY4EO7NiiZAkbatVqUOT8H/nrfXcad0mjZVxroVqHhsHV+06rxiB0xifG0xZv204Qj4zRura8uqZlEVAAwU+NO/SIGdRwpLY7n7xbQGe1DbjHgPUeVPjJX6HpMK41a43eGj4XYdYtZBLugaU8Mq1y6Kl3tE6cvYkQ9WFTYTLLNy3bvNRZpP2p6qAy5qn03ZLFICiXBNXPmrl5+KVrKaSipNaPHkmInvczbYJjXpfyVBsfEabt+0Y1629M+eEKkkl+iZmVr2ySDSS1gHxMC7zlJRaUhG27o26agpNPYPHH3mVXVjqdGg0ryH0YHZk1V8+Gt1Z9hZ7UYWE1UX8DCgFfecqdX0= pavlo@debian &gt; /home/pablo/.ssh/authorized_keyspablo@sanji:~$ chown -R pablo:pablo /home/pablo/.sshpablo@sanji:~$ chmod 700 /home/pablo/.sshpablo@sanji:~$ chmod 600 /home/pablo/.ssh/authorized_keys                Modificamos tambi√©n el fichero /etc/sudoers para que no pida contrase√±a a mi usuario pablo:        # User privilege specificationroot    ALL=(ALL:ALL) ALLpablo   ALL=(ALL) NOPASSWD:ALL                          Un usuario profesor, que puede utilizar sudo sin contrase√±a. Copia de las claves p√∫blicas de todos los profesores en los contenedores para que puedan acceder con el usuario profesor.                A√±adimos el usuario en ambos contenedores:        root@nami:~# useradd -m -s /bin/bash profesor                root@sanji:~# useradd -m -s /bin/bash profesor                Y repetimos el mismo proceso que anteriormente.                  Cambia la contrase√±a al usuario root.  root@nami:~# passwd rootNew password: Retype new password: passwd: password updated successfullyYa est√° todo configurado, solo nos quedar√≠a crear los accesos por ssh, para ello en el fichero ~/.ssh/config a√±adimos lo siguiente:pavlo@debian:~()$ cat .ssh/config Host luffy  HostName 172.22.200.100  User pablo  ForwardAgent yesHost zoro  HostName 172.16.0.200  User pablo  ForwardAgent yes  ProxyJump luffyHost nami  HostName 192.168.0.2  User pablo  ForwardAgent yes  ProxyJump luffyHost sanji  HostName 192.168.0.3  User pablo  ForwardAgent yes  ProxyJump luffyDe esta forma, desde nuestro host principal podemos acceder a todas las m√°quinas, incluyendo los contenedores:pavlo@debian:~()$ ssh namiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 10:54:43 2024 from 192.168.0.1pablo@nami:~$ logoutConnection to 192.168.0.2 closed.pavlo@debian:~()$ ssh sanjiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 10:49:30 2024 from 192.168.0.1pablo@sanji:~$Otras comprobaciones que podemos hacer:  La salida del comando sudo lxc-ls -f.pablo@luffy:~$ sudo lxc-ls -fNAME  STATE   AUTOSTART GROUPS IPV4        IPV6 UNPRIVILEGED nami  RUNNING 0         -      192.168.0.2 -    false        sanji RUNNING 1         -      192.168.0.3 -    false  Prueba de funcionamiento de que los contenedores tienen acceso a internet accediendo a un nombre de dominio, para comprobar que funciona el DNS.pavlo@debian:~()$ ssh namiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 10:57:54 2024 from 192.168.0.1pablo@nami:~$ ping -c 2 www.google.esPING www.google.es (142.250.186.163) 56(84) bytes of data.64 bytes from fra24s08-in-f3.1e100.net (142.250.186.163): icmp_seq=1 ttl=100 time=51.8 ms64 bytes from fra24s08-in-f3.1e100.net (142.250.186.163): icmp_seq=2 ttl=100 time=38.7 ms--- www.google.es ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1001msrtt min/avg/max/mdev = 38.722/45.277/51.832/6.555 mspavlo@debian:~()$ ssh sanjiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 10:57:59 2024 from 192.168.0.1pablo@sanji:~$ ping -c 2 www.youtube.comPING youtube-ui.l.google.com (216.58.206.78) 56(84) bytes of data.64 bytes from lhr35s11-in-f14.1e100.net (216.58.206.78): icmp_seq=1 ttl=99 time=43.6 ms64 bytes from tzfraa-aa-in-f14.1e100.net (216.58.206.78): icmp_seq=2 ttl=99 time=42.9 ms--- youtube-ui.l.google.com ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1002msrtt min/avg/max/mdev = 42.871/43.247/43.624/0.376 msFinalmente comprueba que todo el escenario est√° funcionando despu√©s de reiniciar la m√°quina1 (luffy):pablo@luffy:~$ sudo rebootBroadcast message from root@luffy on pts/1 (Mon 2024-12-16 11:15:21 UTC):The system will reboot now!pablo@luffy:~$ Connection to 172.22.200.100 closed by remote host.Connection to 172.22.200.100 closed.pavlo@debian:~()$ ssh namiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 11:01:53 2024 from 192.168.0.1pablo@nami:~$ logoutConnection to 192.168.0.2 closed.pavlo@debian:~()$ ssh sanjiWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.1.0-28-amd64 x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/proLast login: Mon Dec 16 11:13:31 2024 from 192.168.0.1pablo@sanji:~$ logoutConnection to 192.168.0.3 closed."
  },
  
  {
    "title": "Instalaci√≥n de Oracle 19c en Debian 12",
    "url": "/posts/instalacion-oracle19c/",
    "categories": "Base de Datos, Instalaci√≥n",
    "tags": "Instalaci√≥n",
    "date": "2024-11-15 18:15:00 +0100",
    





    
    "snippet": "Introducci√≥nEn este post, voy a detallar el proceso de instalaci√≥n de Oracle 19c en una m√°quina virtual con Debian 12, utilizando QEMU/KVM como plataforma de virtualizaci√≥n. Para este tipo de insta...",
    "content": "Introducci√≥nEn este post, voy a detallar el proceso de instalaci√≥n de Oracle 19c en una m√°quina virtual con Debian 12, utilizando QEMU/KVM como plataforma de virtualizaci√≥n. Para este tipo de instalaci√≥n, es fundamental asegurarse de que la m√°quina virtual tenga recursos suficientes para que Oracle funcione correctamente. En este caso, se recomienda asignar al menos 4096 MB de memoria RAM, 4 n√∫cleos de procesador (cores) y 40 GB de almacenamiento. Estos recursos permitir√°n que la base de datos funcione de manera estable, incluso en entornos de prueba o desarrollo.La m√°quina virtual se configurar√° con la red ‚Äúdefault‚Äù, lo que le asignar√° autom√°ticamente una direcci√≥n IP dentro del rango 192.168.122.x/24. Esta configuraci√≥n de red es ideal para comunicaciones internas entre la m√°quina virtual y el sistema host, as√≠ como para facilitar la instalaci√≥n y acceso remoto, si es necesario, sin complicaciones adicionales en cuanto a configuraciones de red. A continuaci√≥n, explicar√© detalladamente c√≥mo configurar todo el entorno y proceder con la instalaci√≥n de Oracle 19c paso a paso.Instalaci√≥nEn este caso, se est√° configurando una red est√°tica en la m√°quina virtual que va a hospedar Oracle 19c. Esta configuraci√≥n es importante porque permite tener un control m√°s preciso sobre la direcci√≥n IP de la m√°quina virtual, lo cual es crucial para garantizar que el sistema sea accesible y que la comunicaci√≥n con otros dispositivos de la red no se vea interrumpida, especialmente cuando se trabaja con bases de datos como Oracle, que requieren un acceso constante y estable.Configuraci√≥n de la interfaz de red est√°ticaEl archivo /etc/network/interfaces en Debian es el encargado de definir c√≥mo se gestionan las interfaces de red. En este caso, se est√° configurando la interfaz de red enp1s0 con una direcci√≥n IP est√°tica:pablo@oracle-server:~$ cat /etc/network/interfaces# This file describes the network interfaces available on your system# and how to activate them. For more information, see interfaces(5).source /etc/network/interfaces.d/*# The loopback network interfaceauto loiface lo inet loopback# The primary network interface#allow-hotplug enp1s0#iface enp1s0 inet dhcpauto enp1s0iface enp1s0 inet static\taddress 192.168.122.126\tnetmask 255.255.255.0\tgateway 192.168.122.1Configuraci√≥n del archivo /etc/hostsEl archivo /etc/hosts se utiliza para mapear direcciones IP a nombres de host. En este caso, se ha a√±adido una entrada para la direcci√≥n IP est√°tica que se configur√≥ en el paso anterior, asoci√°ndola al nombre oracle-server:pablo@oracle-server:~$ cat /etc/hosts127.0.0.1\tlocalhost127.0.1.1\toracle-server# The following lines are desirable for IPv6 capable hosts::1     localhost ip6-localhost ip6-loopbackff02::1 ip6-allnodesff02::2 ip6-allrouters192.168.122.126\toracle-serverLa combinaci√≥n de una red est√°tica con la entrada en /etc/hosts garantiza que la m√°quina virtual siempre tendr√° la misma direcci√≥n IP en la red y que ser√° posible referenciarla mediante un nombre f√°cil de recordar, como oracle-server, tanto en la m√°quina virtual como en otros dispositivos o aplicaciones que necesiten comunicarse con ella.Cuando realizas una instalaci√≥n de Oracle 19c en Debian 12, uno de los primeros pasos que debes hacer es asegurarte de que el sistema est√© completamente actualizado y tenga todas las dependencias necesarias para que Oracle funcione sin problemas. Para ello, realizar√°s dos comandos importantes que explico a continuaci√≥n:pablo@oracle-server:~$ sudo apt update &amp;&amp; sudo apt upgrade -yObj:1 http://deb.debian.org/debian bookworm InReleaseObj:2 http://security.debian.org/debian-security bookworm-security InReleaseObj:3 http://deb.debian.org/debian bookworm-updates InReleaseLeyendo lista de paquetes... HechoCreando √°rbol de dependencias... HechoLeyendo la informaci√≥n de estado... HechoTodos los paquetes est√°n actualizados.Leyendo lista de paquetes... HechoCreando √°rbol de dependencias... HechoLeyendo la informaci√≥n de estado... HechoCalculando la actualizaci√≥n... Hecho0 actualizados, 0 nuevos se instalar√°n, 0 para eliminar y 0 no actualizados.E instalamos las dependencias necesarias:pablo@oracle-server:~$ sudo apt install libaio1 unixodbc bc ksh gawk -yEste comando instala una serie de paquetes necesarios para el funcionamiento de Oracle 19c. Cada uno de estos paquetes cumple una funci√≥n espec√≠fica dentro del entorno de Oracle y en la configuraci√≥n del sistema:      libaio1: Este paquete instala las bibliotecas de entrada/salida as√≠ncrona (AIO) necesarias para Oracle. Oracle utiliza AIO para realizar operaciones de lectura y escritura sin bloquear el proceso, lo que mejora el rendimiento de la base de datos. Este es un requisito fundamental para que Oracle funcione correctamente en el sistema.        unixodbc: Este paquete proporciona las bibliotecas y herramientas necesarias para gestionar la conectividad con bases de datos mediante ODBC (Open Database Connectivity). Aunque Oracle no siempre utiliza ODBC para la conectividad por defecto, algunas herramientas o configuraciones de Oracle pueden requerir este paquete para establecer conexiones a otras bases de datos o para ciertos procesos internos.        bc: Este paquete instala una calculadora de precisi√≥n arbitraria, que es √∫til en muchos scripts y procesos de Oracle. Se usa, por ejemplo, para realizar c√°lculos matem√°ticos en la configuraci√≥n o en la ejecuci√≥n de scripts de mantenimiento y automatizaci√≥n de la base de datos.        ksh: Este es el KornShell, un int√©rprete de comandos compatible con muchos de los scripts utilizados por Oracle. Aunque Oracle puede funcionar con otros shells, como bash, ciertos scripts y herramientas de Oracle requieren espec√≠ficamente el KornShell para funcionar correctamente.        gawk: Este paquete instala la versi√≥n GNU de AWK, que es un potente lenguaje de programaci√≥n utilizado para procesamiento de texto y manipulaci√≥n de datos. Oracle utiliza AWK en muchos de sus scripts de configuraci√≥n y mantenimiento, por lo que es necesario tenerlo instalado para que los scripts internos de Oracle se ejecuten correctamente.  Oracle utiliza un enfoque de administraci√≥n basado en roles, por lo que es importante crear un grupo y un usuario espec√≠fico para garantizar que el sistema est√© organizado y que las tareas administrativas puedan realizarse de manera controlada. Para ello:pablo@oracle-server:~$ sudo groupadd dbapablo@oracle-server:~$ sudo adduser --ingroup dba --home /home/oracle --shell /bin/bash oracleA√±adiendo el usuario `oracle' ...Adding new user `oracle' (1001) with group `dba (1001)' ...Creando el directorio personal `/home/oracle' ...Copiando los ficheros desde `/etc/skel' ...Nueva contrase√±a: Vuelva a escribir la nueva contrase√±a: passwd: contrase√±a actualizada correctamenteCambiando la informaci√≥n de usuario para oracleIntroduzca el nuevo valor, o pulse INTRO para usar el valor predeterminado\tNombre completo []: \tN√∫mero de habitaci√≥n []: \tTel√©fono del trabajo []: \tTel√©fono de casa []: \tOtro []: ¬øEs correcta la informaci√≥n? [S/n] Adding new user `oracle' to supplemental / extra groups `users' ...A√±adiendo al usuario `oracle' al grupo `users' ...En este paso del proceso de instalaci√≥n de Oracle 19c, es importante mencionar que, aunque Oracle ofrece soporte para varias distribuciones de Linux, no proporciona soporte oficial para Debian. Esto significa que no existe un paquete .deb directamente disponible para instalar Oracle en Debian. Sin embargo, existen formas de sortear este inconveniente.Obtenci√≥n del fichero de instalaci√≥nEl primer paso es descargar el archivo de instalaci√≥n desde la p√°gina oficial de Oracle. Para ello, tendr√°s que acceder a la secci√≥n de descargas de Oracle en su sitio web, donde podr√°s encontrar el instalador correspondiente para Oracle 19c. Generalmente, Oracle proporciona el instalador en formato .rpm para sistemas basados en Red Hat, como CentOS o RHEL, pero no ofrece un paquete .deb directamente para Debian. Esto se debe a que Debian y sus derivados (como Ubuntu) utilizan un sistema de gesti√≥n de paquetes diferente, basado en el formato .deb.Conversi√≥n del paquete .rpm a .deb usando alienDado que Oracle no ofrece un paquete nativo de Debian, una de las opciones es utilizar una herramienta llamada alien para convertir el paquete .rpm (Red Hat Package Manager) a un formato .deb compatible con Debian.alien es una herramienta que permite convertir entre diferentes formatos de paquetes de Linux, incluyendo .rpm a .deb. Aunque la conversi√≥n no es perfecta en todos los casos, generalmente funciona bien para muchos paquetes.Para realizar la conversi√≥n, primero necesitas instalar alien en tu sistema Debian:sudo apt install alienUna vez instalado alien, puedes convertir el archivo .rpm a .deb con el siguiente comando:sudo alien -d oracle-database-ee-19c-1.0-1.x86_64.rpm  El par√°metro -d le indica a alien que cree un paquete .deb. Este proceso generar√° un archivo .deb que podr√°s instalar de manera est√°ndar en tu sistema Debian utilizando dpkg.Proceso ya realizadoComo ya he realizado esta conversi√≥n previamente, para aligerar el proceso, he subido el paquete .deb a un servicio de almacenamiento en la nube, como Mega, para que puedas descargarlo directamente sin necesidad de hacer la conversi√≥n t√∫ mismo.Dejar√© el link de descarga de este paquete .deb para que puedas instalar Oracle 19c sin complicaciones adicionales. Solo tendr√°s que descargar el archivo:MegaUna vez que hayas descargado el archivo .deb de Oracle 19c, el siguiente paso es transferir este fichero a la m√°quina virtual donde realizar√°s la instalaci√≥n. Para ello, utilizaremos el comando scp (Secure Copy), que es una herramienta segura para transferir archivos entre sistemas a trav√©s de SSH.El comando que he utilizado es el siguiente:pavlo@debian:~()$ scp /home/pavlo/iso/oracle-database-ee-19c_1.0-2_amd64.deb pablo@192.168.122.126:/home/pablopablo@192.168.122.126's password: oracle-database-ee-19c_1.0-2_amd64.deb                                                                                                     100% 2409MB 101.4MB/s   00:23Y como podemos ver ya lo tenemos en nuestra m√°quina virtual:pablo@oracle-server:~$ lsoracle-database-ee-19c_1.0-2_amd64.debUna vez que hemos transferido el archivo .deb de Oracle Database 19c a nuestra m√°quina virtual, es hora de proceder con la instalaci√≥n. Para ello, usaremos el comando dpkg, que es el gestor de paquetes est√°ndar en Debian. Aqu√≠ te dejo c√≥mo hacerlo.pablo@oracle-server:~$ sudo dpkg -i oracle-database-ee-19c_1.0-2_amd64.deb [sudo] contrase√±a para pablo: Seleccionando el paquete oracle-database-ee-19c previamente no seleccionado.(Leyendo la base de datos ... 34459 ficheros o directorios instalados actualmente.)Preparando para desempaquetar oracle-database-ee-19c_1.0-2_amd64.deb ...ln: fallo al crear el enlace simb√≥lico '/bin/awk': El fichero ya existeDesempaquetando oracle-database-ee-19c (1.0-2) ...Configurando oracle-database-ee-19c (1.0-2) ...[INFO] Executing post installation scripts...[INFO] Oracle home installed successfully and ready to be configured.To configure a sample Oracle Database you can execute the following service configuration script as root: /etc/init.d/oracledb_ORCLCDB-19c configureProcesando disparadores para libc-bin (2.36-9+deb12u9) ...Una vez hecho esto, ya es hora de comenzar la instalaci√≥n, pero antes recomiendo borrar el contenido del fichero /etc/init.d/oracledb_ORCLCDB-19c y a√±adir el siguiente contenido modificado:#!/bin/bash## chkconfig: 2345 80 05# Description: This script is responsible for taking care of configuring the Oracle Database and its associated services.## processname: oracledb_ORCLCDB-19c# Red Hat or SuSE config: /etc/sysconfig/oracledb_ORCLCDB-19c## Set path if path not setcase $PATH in    \"\") PATH=/bin:/usr/bin:/sbin:/etc         export PATH ;;esac# Check if the root user is running this scriptif [ $(id -u) != \"0\" ]then    echo \"You must be root user to run the configurations script. Login as root user and try again.\"    exit 1fi# Setting the required environment variablesexport ORACLE_HOME=/opt/oracle/product/19c/dbhome_1export ORACLE_VERSION=19c export ORACLE_SID=ORCLCDBexport TEMPLATE_NAME=General_Purpose.dbcexport CHARSET=AL32UTF8export PDB_NAME=ORCLPDB1export LISTENER_NAME=LISTENERexport NUMBER_OF_PDBS=1export CREATE_AS_CDB=true# General exports and varsexport PATH=$ORACLE_HOME/bin:$PATHLSNR=$ORACLE_HOME/bin/lsnrctlSQLPLUS=$ORACLE_HOME/bin/sqlplusDBCA=$ORACLE_HOME/bin/dbcaNETCA=$ORACLE_HOME/bin/netcaORACLE_OWNER=oracleRETVAL=0CONFIG_NAME=\"oracledb_$ORACLE_SID-$ORACLE_VERSION.conf\"CONFIGURATION=\"/etc/sysconfig/$CONFIG_NAME\"# Commandsif [ -z \"$SU\" ];then SU=/bin/su; fiif [ -z \"$GREP\" ]; then GREP=/usr/bin/grep; fiif [ ! -f \"$GREP\" ]; then GREP=/bin/grep; fi# To start the DBstart(){    check_for_configuration    RETVAL=$?    if [ $RETVAL -eq 1 ]    then        echo \"The Oracle Database is not configured. You must run '/etc/init.d/oracledb_$ORACLE_SID-$ORACLE_VERSION configure' as the root user to configure the database.\"        exit    fi    # Check if the DB is already started    pmon=ps -ef | egrep pmon_$ORACLE_SID'\\&gt;' | $GREP -v grep    if [ \"$pmon\" = \"\" ];    then        # Unset the proxy env vars before calling sqlplus        unset_proxy_vars        echo \"Starting Oracle Net Listener.\"        $SU -s /bin/bash $ORACLE_OWNER -c \"$LSNR  start $LISTENER_NAME\" &gt; /dev/null 2&gt;&amp;1        RETVAL=$?        if [ $RETVAL -eq 0 ]        then            echo \"Oracle Net Listener started.\"        fi        echo \"Starting Oracle Database instance $ORACLE_SID.\"        $SU -s /bin/bash  $ORACLE_OWNER -c \"$SQLPLUS -s /nolog &lt;&lt; EOF                                                                connect / as sysdba                                                                startup                                                                alter pluggable database all open                                                                exit;                                                                EOF\" &gt; /dev/null 2&gt;&amp;1        RETVAL1=$?        if [ $RETVAL1 -eq 0 ]        then            echo \"Oracle Database instance $ORACLE_SID started.\"        fi    else        echo \"The Oracle Database instance $ORACLE_SID is already started.\"        exit 0    fi    echo    if [ $RETVAL -eq 0 ] &amp;&amp; [ $RETVAL1 -eq 0 ]    then        return 0     else        echo \"Failed to start Oracle Net Listener using $ORACLE_HOME/bin/tnslsnr and Oracle Database using $ORACLE_HOME/bin/sqlplus.\"        exit 1    fi}# To stop the DBstop(){    check_for_configuration    RETVAL=$?    if [ $RETVAL -eq 1 ]    then        echo \"The Oracle Database is not configured. You must run '/etc/init.d/oracledb_$ORACLE_SID-$ORACLE_VERSION configure' as the root user to configure the database.\"        exit 1    fi    # Check if the DB is already stopped    pmon=ps -ef | egrep pmon_$ORACLE_SID'\\&gt;' | $GREP -v grep    if [ \"$pmon\" = \"\" ]    then        echo \"Oracle Database instance $ORACLE_SID is already stopped.\"        exit 1    else        # Unset the proxy env vars before calling sqlplus        unset_proxy_vars        echo \"Shutting down Oracle Database instance $ORACLE_SID.\"        $SU -s /bin/bash $ORACLE_OWNER -c \"$SQLPLUS -s /nolog &lt;&lt; EOF                                                                connect / as sysdba                                                                shutdown immediate                                                                exit;                                                                EOF\" &gt; /dev/null 2&gt;&amp;1        RETVAL=$?        if [ $RETVAL -eq 0 ]        then            echo \"Oracle Database instance $ORACLE_SID shut down.\"        fi        echo \"Stopping Oracle Net Listener.\"        $SU -s /bin/bash  $ORACLE_OWNER -c \"$LSNR stop $LISTENER_NAME\" &gt; /dev/null 2&gt;&amp;1        RETVAL1=$?        if [ $RETVAL1 -eq 0 ]        then            echo \"Oracle Net Listener stopped.\"        fi    fi    echo    if [ $RETVAL -eq 0 ] &amp;&amp; [ $RETVAL1 -eq 0 ]    then        return 0    else        echo \"Failed to stop Oracle Net Listener using $ORACLE_HOME/bin/tnslsnr and Oracle Database using $ORACLE_HOME/bin/sqlplus.\"        exit 1    fi}# To call DBCA to configure the DBconfigure_perform(){    # Unset the proxy env vars before calling dbca    unset_proxy_vars    echo \"Configuring Oracle Database $ORACLE_SID.\"    # Add the -J-Doracle.assistants.dbca.validate.ConfigurationParams=false to bypass the memory validation error    $SU -s /bin/bash  $ORACLE_OWNER -c \"$DBCA -silent -createDatabase -gdbName $ORACLE_SID -templateName $TEMPLATE_NAME -characterSet $CHARSET -createAsContainerDatabase $CREATE_AS_CDB -numberOfPDBs $NUMBER_OF_PDBS -pdbName $PDB_NAME -createListener $LISTENER_NAME:$LISTENER_PORT -datafileDestination $ORACLE_DATA_LOCATION -sid $ORACLE_SID -autoGeneratePasswords -emConfiguration DBEXPRESS -emExpressPort $EM_EXPRESS_PORT -J-Doracle.assistants.dbca.validate.ConfigurationParams=false\"    RETVAL=$?    echo    if [ $RETVAL -eq 0 ]    then        echo \"Database configuration completed successfully. The passwords were auto generated, you must change them by connecting to the database using 'sqlplus / as sysdba' as the oracle user.\"        return 0    else        echo \"Database configuration failed.\"        exit 1    fi}# Enh 27965939 - Unsets the proxy env variablesunset_proxy_vars(){    if [ \"$http_proxy\" != \"\" ]    then        unset http_proxy    fi    if [ \"$HTTP_PROXY\" != \"\" ]    then        unset HTTP_PROXY    fi    if [ \"$https_proxy\" != \"\" ]    then        unset https_proxy    fi    if [ \"$HTTPS_PROXY\" != \"\" ]    then        unset HTTPS_PROXY    fi}# Check if the DB is already configuredcheck_for_configuration(){    configfile=$GREP --no-messages $ORACLE_SID:$ORACLE_HOME /etc/oratab &gt; /dev/null 2&gt;&amp;1    if [ \"$configfile\" = \"\" ]    then        return 1    fi    return 0}read_config_file(){    if [ -f \"$CONFIGURATION\" ]    then        . \"$CONFIGURATION\"    else        echo \"The Oracle Database is not configured. Unable to read the configuration file '$CONFIGURATION'\"        exit 1;    fi}# Entry point to configure the DBconfigure(){    check_for_configuration    RETVAL=$?    if [ $RETVAL -eq 0 ]    then        echo \"Oracle Database instance $ORACLE_SID is already configured.\"        exit 1    fi    read_config_file    check_port_availability    check_em_express_port_availability    configure_perform}check_port_availability(){    port=netstat -n --tcp --listen | $GREP :$LISTENER_PORT    if [ \"$port\" != \"\" ]    then        echo \"Port $LISTENER_PORT appears to be in use by another application. Specify a different port in the configuration file.\"        exit 1    fi}check_em_express_port_availability(){    port=netstat -n --tcp --listen | $GREP :$EM_EXPRESS_PORT    if [ \"$port\" != \"\" ]    then        echo \"Port $EM_EXPRESS_PORT appears to be in use by another application. Specify a different port in the configuration file.\"        exit 1    fi}case \"$1\" in    start)        start        ;;    stop)        stop        ;;    restart)        stop        start        ;;    configure)        configure        ;;    *)        echo \"Usage: $0 {start|stop|restart|configure}\"        exit 1esacEsto es porque por defecto el contenido del script del fichero configure me daba problemas, por lo que con estas modificaciones me funciona correctamente.Ahora, ya solo nos queda ejecutar el comando de la instalaci√≥n y esperar. Este proceso puede tardar varios minutos.pablo@oracle-server:~$ sudo /etc/init.d/oracledb_ORCLCDB-19c configure/etc/init.d/oracledb_ORCLCDB-19c: l√≠nea 243: -n: orden no encontrada/etc/init.d/oracledb_ORCLCDB-19c: l√≠nea 253: -n: orden no encontradaConfiguring Oracle Database ORCLCDB.Preparar para funcionamiento de base de datos8% finalizadoCopiando archivos de base de datos31% finalizadoCreando e iniciando instancia Oracle32% finalizado36% finalizado40% finalizado43% finalizado46% finalizadoTerminando creaci√≥n de base de datos51% finalizado54% finalizadoCreando Bases de Datos de Conexi√≥n58% finalizado77% finalizadoEjecutando acciones posteriores a la configuraci√≥n100% finalizadoCreaci√≥n de la base de datos terminada. Consulte los archivos log de /opt/oracle/cfgtoollogs/dbca/ORCLCDB para obtener m√°s informaci√≥n.Informaci√≥n de Base de Datos:Nombre de la Base de Datos Global:ORCLCDBIdentificador del Sistema (SID):ORCLCDBPara obtener informaci√≥n detallada, consulte el archivo log \"/opt/oracle/cfgtoollogs/dbca/ORCLCDB/ORCLCDB.log\".Database configuration completed successfully. The passwords were auto generated, you must change them by connecting to the database using 'sqlplus / as sysdba' as the oracle user.Configuraci√≥nAl finalizar la ejecuci√≥n del script de configuraci√≥n de Oracle Database, se indica que la base de datos ha sido configurada exitosamente. Sin embargo, antes de poder usar Oracle como el usuario oracle, es necesario configurar las variables de entorno adecuadas para garantizar que el sistema pueda encontrar las herramientas y archivos correctos de Oracle. Estas variables definen el entorno en el que Oracle se ejecuta, y se deben configurar correctamente para que los comandos de Oracle funcionen sin problemas. Por lo tanto, nos cambiamos al usuario oracle y en el fichero ~/.bashrc a√±adimos las variables al final:pablo@oracle-server:~$ sudo su - oracleoracle@oracle-server:~$ tail -6 ~/.bashrc #Oracle environmentsexport ORACLE_HOME=/opt/oracle/product/19c/dbhome_1export ORACLE_SID=ORCLCDBexport ORACLE_BASE=/opt/oracleexport PATH=$ORACLE_HOME/bin:$PATHexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATHoracle@oracle-server:~$ source ~/.bashrcUna vez que hemos a√±adido las variables de entorno necesarias en el archivo .bashrc del usuario oracle y hemos recargado dicho archivo, las herramientas de Oracle deber√≠an estar completamente configuradas para su uso. Esto nos permite acceder a la base de datos utilizando comandos como sqlplus, que es la herramienta de l√≠nea de comandos de Oracle para interactuar con la base de datos.oracle@oracle-server:~$ sqlplus / as sysdbaSQL*Plus: Release 19.0.0.0.0 - Production on Tue Nov 19 13:33:37 2024Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0SQL&gt;üí° Tip: El comando rlwrap es una herramienta muy √∫til que mejora la experiencia de uso de programas de l√≠nea de comandos que no tienen soporte nativo para edici√≥n de texto o historial de comandos. En el contexto de Oracle y herramientas como SQL*Plus, rlwrap puede ser un gran aliado al proporcionar caracter√≠sticas de edici√≥n y autocompletado que, de otra manera, no estar√≠an disponibles.Primero de todo lo instalamos:oracle@oracle-server:~$ sudo apt install rlwrapPara aprovechar la funcionalidad de rlwrap de manera autom√°tica cada vez que iniciemos SQLPlus, podemos a√±adir el comando rlwrap a las variables de entorno del usuario oracle. Esto har√° que SQLPlus siempre se ejecute con las ventajas de rlwrap, sin tener que escribir el comando completo cada vez. Por lo tanto, en el ~/.bashrc a√±adimos la siguiente l√≠nea:alias sqlplus='rlwrap sqlplus'Recargamos:oracle@oracle-server:~$ source ~/.bashrcY ahora cada vez que accedamos a la terminal de sqlplus lo tendremos a modo terminal, donde podremos recuperar comandos, hacer Ctrl + l, etc.A√±adir usuario principalEn el proceso de configuraci√≥n de la base de datos Oracle, hemos visto que podemos acceder a la base de datos desde el usuario oracle, dado que previamente le otorgamos los permisos necesarios. Sin embargo, generalmente no vamos a querer realizar todas las tareas administrativas directamente desde el usuario oracle, ya que este es un usuario dedicado principalmente a gestionar Oracle, y preferimos usar nuestro propio usuario principal para interactuar con el sistema, a menos que se nos indique lo contrario.Para poder administrar la base de datos desde nuestro usuario principal, necesitamos agregarlo al grupo dba que creamos anteriormente. Esto nos permitir√° tener acceso a las herramientas y permisos necesarios para gestionar Oracle como si fu√©ramos administradores, sin tener que cambiar de usuario constantemente.Adem√°s, debemos asegurarnos de que las variables de entorno relacionadas con Oracle est√©n configuradas correctamente en nuestro usuario principal, de manera que podamos acceder a las herramientas de Oracle (como SQL*Plus) y ejecutar comandos administrativos desde nuestro propio entorno de usuario.pablo@oracle-server:~$ sudo usermod -a -G dba pablo[sudo] contrase√±a para pablo: pablo@oracle-server:~$ sudo nano ~/.bashrcpablo@oracle-server:~$ source ~/.bashrcpablo@oracle-server:~$ sqlplus / as sysdbaSQL*Plus: Release 19.0.0.0.0 - Production on Tue Nov 19 13:49:52 2024Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0SQL&gt; Creaci√≥n de un usuario en Oracle 19cAl trabajar con Oracle Database, una de las tareas m√°s comunes es la creaci√≥n de usuarios. Sin embargo, en algunas configuraciones recientes, como la que estamos utilizando en Oracle 19c, puede surgir un error relacionado con el par√°metro _ORACLE_SCRIPT. Aqu√≠ te explicamos c√≥mo crear un usuario y c√≥mo resolver este problema si aparece.Creaci√≥n de un usuario en OraclePara crear un usuario en Oracle Database, seguimos estos pasos:Accedemos a la base de datos con privilegios de administrador utilizando SQL*Plus:pablo@oracle-server:~$ sqlplus / as sysdbaSQL*Plus: Release 19.0.0.0.0 - Production on Tue Nov 19 13:58:52 2024Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0Y creamos el nuevo usuario:SQL&gt; CREATE USER pablo IDENTIFIED BY password;CREATE USER pablo IDENTIFIED BY password            *ERROR en linea 1:ORA-65096: nombre de usuario o rol comun no validoPero como podemos ver nos ha dado error. Este error ocurre porque Oracle 12c y versiones posteriores introdujeron el concepto de bases de datos multitenant, donde una √∫nica instancia puede contener m√∫ltiples bases de datos ‚Äúpluggable‚Äù (PDB). De forma predeterminada, Oracle espera que los nombres de usuario sigan ciertas convenciones especiales para usuarios ‚Äúcomunes‚Äù que se compartan entre las bases de datos contenedoras (CDB) y las bases de datos pluggable (PDB).Si no estamos configurando un usuario com√∫n, sino uno espec√≠fico para nuestra base de datos pluggable, necesitamos desactivar temporalmente esta restricci√≥n.Para solucionarlo tendremos que ejecutar el siguiente comando:ALTER SESSION SET \"_ORACLE_SCRIPT\"=TRUE;Y ya nos dejar√° crear el usuario sin problemas:SQL&gt; ALTER SESSION SET \"_ORACLE_SCRIPT\"=TRUE;Sesion modificada.SQL&gt; CREATE USER pablo IDENTIFIED BY password;Usuario creado.Le damos permisos para conectarnos:SQL&gt; GRANT CONNECT, RESOURCE TO pablo;Concesion terminada correctamente.Y probamos a conectarnos con el nuevo usuario:pablo@oracle-server:~$ sqlplus pablo/passwordSQL*Plus: Release 19.0.0.0.0 - Production on Tue Nov 19 14:05:34 2024Version 19.3.0.0.0Copyright (c) 1982, 2019, Oracle.  All rights reserved.Conectado a:Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - ProductionVersion 19.3.0.0.0SQL&gt;Con esto concluimos la instalaci√≥n y configuraci√≥n de Oracle Database 19c sobre una m√°quina virtual con Debian 12, utilizando QEMU/KVM como hipervisor. A lo largo de este proceso, hemos cubierto todos los aspectos necesarios para poner en marcha la base de datos, desde la configuraci√≥n inicial del sistema operativo hasta los pasos espec√≠ficos para preparar y personalizar el entorno de Oracle.Hemos abordado detalles importantes como la instalaci√≥n de dependencias, la creaci√≥n de usuarios y grupos, la gesti√≥n de variables de entorno y la resoluci√≥n de errores comunes. Adem√°s, vimos c√≥mo realizar tareas b√°sicas de administraci√≥n, como el acceso a SQL*Plus, la adici√≥n de usuarios y el uso de herramientas √∫tiles como rlwrap para mejorar la experiencia en la l√≠nea de comandos."
  },
  
  {
    "title": "Instalaci√≥n de WordPress en un servidor LEMP",
    "url": "/posts/instalacion-wordpress/",
    "categories": "Implantaci√≥n Web, Aplicaciones",
    "tags": "Aplicaciones",
    "date": "2024-11-15 18:15:00 +0100",
    





    
    "snippet": "¬øQu√© vas a aprender en este taller?  Realizar la instalaci√≥n de un servidor LEMP.  Configurar nginx como proxy inverso para pasar las peticiones PHP al servidor de aplicaci√≥n fpm-php.  Realizar la ...",
    "content": "¬øQu√© vas a aprender en este taller?  Realizar la instalaci√≥n de un servidor LEMP.  Configurar nginx como proxy inverso para pasar las peticiones PHP al servidor de aplicaci√≥n fpm-php.  Realizar la instalaci√≥n de un CMS PHP WordPress.Instalaci√≥n de la pila LEMPEn este taller configuraremos una m√°quina virtual con Debian 12 y un servidor LEMP.¬øQu√© es LEMP?LEMP es un conjunto de software dise√±ado para alojar aplicaciones web din√°micas. A continuaci√≥n, desglosamos sus componentes:  L: Linux, el sistema operativo base.  E: Nginx, el servidor web, conocido por su rendimiento y eficiencia. (Se pronuncia ‚ÄúEngine-X‚Äù)  M: MySQL o MariaDB, sistemas de gesti√≥n de bases de datos utilizados para almacenar informaci√≥n.  P: PHP, un lenguaje de programaci√≥n para generar contenido din√°mico en p√°ginas web.Es una alternativa moderna al stack LAMP (que utiliza Apache como servidor web).Pasos para instalar la pila LEMP:Ejecuta el siguiente comando para instalar Nginx:pablo@debian:~$ sudo apt install nginx -yInstala MariaDB para gestionar las bases de datos necesarias:pablo@debian:~$ sudo apt install mariadb-server mariadb-client -yAgrega PHP y los m√≥dulos imprescindibles para que WordPress funcione correctamente:pablo@debian:~$ sudo apt install php-fpm php-mysql php-xml php-mbstring php-curl php-gd -yY listo, con estos pasos ya tendr√°s instalada y configurada la pila LEMP.Creaci√≥n de la base de datosEn este paso, configuraremos la base de datos necesaria para WordPress. Esto incluye crear una base de datos espec√≠fica, un usuario asociado y otorgarle los permisos necesarios. A continuaci√≥n, te explico el proceso:1. Accede a la consola de MariaDB como usuario root, para ello ejecuta el siguiente comando en tu terminal:pablo@debian:~$ sudo mysql -u root -pIngresa la contrase√±a de root cuando se te solicite. Esto te llevar√° al monitor de MariaDB.2. Una vez dentro de MariaDB, ejecuta:CREATE DATABASE wordpress_db;Esto crea una base de datos llamada wordpress_db donde se almacenar√°n los datos de WordPress.3. Define un nuevo usuario y una contrase√±a para gestionar la base de datos. Por ejemplo:GRANT ALL PRIVILEGES ON wordpress_db.* TO 'user'@'localhost';  user: Nombre del usuario.  password: Contrase√±a asociada al usuario.4. Otorga todos los privilegios al usuario sobre la base de datos:GRANT ALL PRIVILEGES ON wordpress_db.* TO 'user'@'localhost';Permite al usuario user gestionar completamente la base de datos wordpress_db:5. Finalmente, actualiza los privilegios para asegurarte de que se registren correctamente:FLUSH PRIVILEGES;6. Sal del monitor de MariaDB:EXIT;Ahora tienes una base de datos llamada wordpress_db y un usuario user con todos los privilegios sobre ella. Estos datos ser√°n utilizados durante la configuraci√≥n de WordPress.Configurar un VirtualHost para WordPressEn este paso, crearemos y configuraremos un virtualhost en nginx para que el sitio web de WordPress sea accesible a trav√©s de un dominio local como wordpress.pablo.beer. A continuaci√≥n, los pasos detallados:1. Crear el archivo de configuraci√≥n del virtualhostEdita o crea un nuevo archivo de configuraci√≥n en /etc/nginx/sites-available/ con el nombre del dominio deseado:pablo@debian:~$ sudo nano /etc/nginx/sites-available/wordpress.pablo.beerDentro del archivo, agrega la configuraci√≥n:server {    listen 80;    server_name wordpress.pablo.beer;    root /var/www/wordpress;    index index.php index.html index.htm;    location / {        try_files $uri $uri/ /index.php?$args;    }    location ~ \\.php$ {        include snippets/fastcgi-php.conf;        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;    }    location ~ /\\.ht {        deny all;    }}2. Activar el VirtualHostCrea un enlace simb√≥lico en el directorio sites-enabled para que nginx cargue esta configuraci√≥n:pablo@debian:~$ sudo ln -s /etc/nginx/sites-available/wordpress.pablo.beer /etc/nginx/sites-enabled/3. Verificar la configuraci√≥n de nginxAntes de reiniciar nginx, verifica que la configuraci√≥n sea v√°lida:pablo@debian:~$ sudo nginx -tSi todo est√° correcto, ver√°s un mensaje indicando que la configuraci√≥n es v√°lida.4. Descargar WordPresspablo@debian:~$ cd /tmppablo@debian:/tmp$ wget https://wordpress.org/latest.zipDescomprime el archivo descargado:pablo@debian:/tmp$ sudo apt install unzippablo@debian:/tmp$ unzip latest.zip5. Mover WordPress a la ruta del servidor webMueve los archivos de WordPress al directorio especificado en la configuraci√≥n del virtualhost (/var/www/wordpress):pablo@debian:/tmp$ sudo mv wordpress /var/www/wordpress6. Asignar permisos correctosAseg√∫rate de que los archivos y directorios tengan los permisos correctos:pablo@debian:~$ sudo chown -R www-data:www-data /var/www/wordpresspablo@debian:~$ sudo chmod -R 755 /var/www/wordpress7. Configurar el archivo hostsA√±ade el dominio local wordpress.pablo.beer en el archivo /etc/hosts de tu host principal (tu m√°quina f√≠sica) para que el navegador lo reconozca. Edita el archivo de la siguiente manera:pavlo@debian:~()$ sudo nano /etc/hostsAgrega la l√≠nea:&lt;IP_M√°quina_Virtual&gt;\twordpress.pablo.beer8. Reiniciar nginxReinicia el servicio para aplicar los cambios:pablo@debian:~$ sudo systemctl restart nginxAhora deber√≠as poder acceder a WordPress escribiendo http://wordpress.pablo.beer en tu navegador. Desde ah√≠ podr√°s completar la instalaci√≥n de WordPress en el navegador.Instalaci√≥n de WordPressUna vez configurado el servidor, el virtualhost y los permisos, es momento de acceder a la interfaz de instalaci√≥n de WordPress y configurar el sitio. Aqu√≠ tienes los pasos detallados:Accede a la URL de instalaci√≥nAbre tu navegador web y accede al dominio configurado en tu archivo /etc/hosts:http://wordpress.pablo.beerDeber√≠as ver la pantalla inicial de configuraci√≥n de WordPress:El instalador nos pide que elijamos un idioma para el sitio. Selecciona el deseado (por ejemplo, Espa√±ol) y haz clic en Continuar.Configura la conexi√≥n con la base de datosEn la siguiente pantalla, deber√°s proporcionar los datos de conexi√≥n a la base de datos:  Nombre de la base de datos: wordpress_db (la base de datos que creaste).  Nombre de usuario: user (el usuario que configuraste).  Contrase√±a: La contrase√±a asignada al usuario.  Servidor de la base de datos: localhost.  Prefijo de tabla: Por defecto es wp_. Puedes cambiarlo si lo deseas, pero no es obligatorio.Haz clic en Enviar.Configura los datos del sitio webRellena el formulario con la informaci√≥n b√°sica del sitio:  T√≠tulo del sitio: El nombre de tu blog o p√°gina.  Nombre de usuario: El nombre para el administrador del sitio.  Contrase√±a: Una contrase√±a segura para el usuario administrador.  Correo electr√≥nico: Un correo asociado al administrador.  Privacidad: Puedes elegir si deseas que los motores de b√∫squeda indexen tu sitio (puedes cambiar esto m√°s adelante).Haz clic en Instalar WordPress.Accede al panel de administraci√≥nCuando la instalaci√≥n se complete, WordPress te redirigir√° a la pantalla de inicio de sesi√≥n.Si queremos acceder al panel de administraci√≥n lo haremos desde http://wordpress.pablo.beer/wp-admin. Ingresa tu nombre de usuario y contrase√±a creados en el paso anterior y ya estar√≠amos dentro.Primer blogUna vez dentro del panel de administraci√≥n:  En el men√∫ de la izquierda, haz clic en Entradas.  Luego, selecciona A√±adir nueva.En la pantalla de creaci√≥n de la entrada escribe el contenido de tu blog:  T√≠tulo: Escribe un t√≠tulo para tu entrada, como por ejemplo Mi primera entrada en el blog.  Contenido: En el editor, puedes escribir el cuerpo de tu entrada. Puedes incluir texto, im√°genes, enlaces, videos, etc.El editor de WordPress es muy intuitivo y funciona mediante bloques:  Haz clic en el bot√≥n + para a√±adir bloques como p√°rrafos, encabezados, im√°genes, etc.  Arrastra y organiza los bloques seg√∫n necesites.Antes de publicar, puedes ajustar algunos par√°metros:  Estado: Puedes guardar como borrador si no est√°s listo para publicarla.  Visibilidad: Define si la entrada ser√° p√∫blica, privada o protegida con contrase√±a.  Publicaci√≥n programada: Puedes programar la publicaci√≥n para una fecha y hora futura.Cuando est√©s listo:  Haz clic en el bot√≥n Publicar en la parte superior derecha.  Confirma la publicaci√≥n en el cuadro de di√°logo que aparece.Tu entrada estar√° disponible en el blog y visible para los visitantes.Despu√©s de publicar, haz clic en el enlace Ver entrada para ver c√≥mo se ve en tu sitio.Configurar URL amigables en WordPressLas URL amigables (tambi√©n conocidas como ‚Äúpermalinks‚Äù) son direcciones web f√°ciles de leer y entender, lo que mejora la experiencia del usuario y tambi√©n el SEO (posicionamiento en buscadores). En lugar de tener URLs como http://tu-sitio.com/?p=123, con URL amigables, las URLs ser√°n algo como http://tu-sitio.com/mi-primera-entrada.Pasos para configurar URL amigables en WordPress1. Accede al panel de administraci√≥n de WordPress. Abre tu navegador y accede a tu sitio de WordPress (por ejemplo: http://wordpress.tunombre.algo/wp-admin).2. Configura los enlaces permanentes.      En el men√∫ lateral izquierdo, ve a Ajustes &gt; Enlaces permanentes.        Aqu√≠ ver√°s diferentes opciones para configurar c√≥mo se ver√°n las URLs de tus entradas. Puedes elegir entre varias opciones como:                  Predeterminado: http://tu-sitio.com/?p=123                    D√≠a y nombre: http://tu-sitio.com/2024/11/15/mi-primera-entrada                    Mes y nombre: http://tu-sitio.com/2024/11/mi-primera-entrada                    Nombre de la entrada: http://tu-sitio.com/mi-primera-entrada (m√°s recomendado)                  Selecciona la opci√≥n Nombre de la entrada si deseas tener URLs amigables, y luego haz clic en Guardar cambios.  ¬°Y eso es todo! Ahora tu sitio WordPress deber√≠a estar configurado para usar URL amigables, mejorando tanto la accesibilidad para los usuarios como el SEO. Con esta configuraci√≥n, podr√°s disfrutar de una navegaci√≥n m√°s fluida y profesional.üöÄ"
  },
  
  {
    "title": "Comandos para programaci√≥n de tareas",
    "url": "/posts/comandos-programacion/",
    "categories": "Sistemas, Automatizaci√≥n",
    "tags": "Automatizaci√≥n",
    "date": "2024-09-02 20:00:00 +0200",
    





    
    "snippet": "Introducci√≥nEn el entorno Linux, la programaci√≥n de tareas es una habilidad fundamental que permite a los usuarios automatizar la ejecuci√≥n de comandos y scripts en momentos espec√≠ficos o en interv...",
    "content": "Introducci√≥nEn el entorno Linux, la programaci√≥n de tareas es una habilidad fundamental que permite a los usuarios automatizar la ejecuci√≥n de comandos y scripts en momentos espec√≠ficos o en intervalos regulares. Esta capacidad no solo mejora la eficiencia, sino que tambi√©n asegura que las tareas cr√≠ticas se realicen sin intervenci√≥n manual, lo que es especialmente √∫til para mantenimiento del sistema, copias de seguridad y actualizaciones programadas.Este post explorar√° los comandos m√°s utilizados para programar tareas en Linux, tales como cron, at y systemd timers. Aprenderemos c√≥mo configurarlos y utilizarlos de manera efectiva, proporcionando ejemplos pr√°cticos que facilitar√°n la comprensi√≥n de su funcionamiento. Al final, tendr√°s las herramientas necesarias para automatizar tareas y optimizar tu flujo de trabajo en el sistema operativo Linux.1. SleepEl comando sleep en Linux se utiliza para pausar la ejecuci√≥n de un proceso o script durante un per√≠odo de tiempo especificado por el usuario. Este comando est√° disponible en todas las distribuciones de Linux, incluyendo Debian, y no requiere instalaci√≥n adicional.Opciones y Par√°metrosLas opciones m√°s comunes para el comando sleep son:  -h o ‚Äìhelp: Muestra informaci√≥n de ayuda sobre el comando sleep.  -v o ‚Äìversion: Muestra informaci√≥n sobre la versi√≥n del comando y detalles relacionados con su desarrollo.Los par√°metros que se pueden utilizar con sleep para especificar el tiempo de pausa son:  s: Segundos (por defecto).  m: Minutos.  h: Horas.  d: D√≠as.Es posible utilizar n√∫meros enteros o decimales para especificar el tiempo de pausa.Ejemplos de UsoAqu√≠ hay algunos ejemplos de c√≥mo se puede utilizar el comando sleep:  Pausar un proceso durante 10 segundos:  Pausar un proceso durante 2 minutos:  Pausar un proceso durante 1 hora y media:  Pausar un proceso durante 3 d√≠as:                             Pausar un proceso durante una combinaci√≥n de tiempos (1 d√≠a, 2 horas, 3 minutos y 4 segundos):  Pausar un proceso durante 0.5 segundos (usando un n√∫mero decimal):  Ejecutar varios comandos sleep de forma consecutiva o utilizar el operador &amp;&amp; para ejecutar otro comando despu√©s de sleep:  Este script se ejecutar√° en un bucle infinito, pero se pausar√° durante 10 minutos en cada iteraci√≥n utilizando sleep.    echo \"Este script se ejecutar√° cada 10 minutos.\"while true; do# Comandos que deseas ejecutarsleep 10mdone      El comando sleep es especialmente √∫til en scripts de shell para introducir retrasosentre la ejecuci√≥n de diferentes comandos, para reintentar operaciones fallidas despu√©s de un tiempo, o para esperar a que se cumplan ciertas condiciones, como la disponibilidad de una conexi√≥n de red.En resumen, sleep es una herramienta simple pero poderosa para controlar el flujode ejecuci√≥n en scripts y procesos en sistemas operativos basados en Linux.2. WatchEl comando watch en Linux es una herramienta que permite a los usuariosmonitorizar continuamente los cambios en un archivo o el resultado de un comando en tiempo real. Este comando ejecuta otros comandos de forma repetitiva y muestra los resultados en tiempo real. Por defecto, watch ejecuta el comando especificado cada 2 segundos y muestra los resultados en la terminal.Opciones y Par√°metrosLas opciones m√°s comunes para el comando watch son:  -n segundos: Esta opci√≥n permite especificar el intervalo de tiempo en segundos entre cada ejecuci√≥n del comando.  -d: Esta opci√≥n es usada para destacar las diferencias entre las actualizaciones  -t: Esta opci√≥n elimina el encabezado que muestra el intervalo, el comando y la hora actual  -g o ‚Äìchgexit: Esta opci√≥n permite que watch termine la ejecuci√≥n en el caso de que se haya modificado la salidaEjemplos de UsoAqu√≠ hay algunos ejemplos de c√≥mo se puede utilizar el comando watch:  Monitorizar el uso de la memoria del servidor cada segundo:  Ejecutar el comando ls cada 5 segundos:  Resaltar las diferencias entre las actualizaciones al ejecutar el comando date:  Eliminar el encabezado al ejecutar el comando free:  Terminar la ejecuci√≥n si el uso de memoria ha cambiado:  Observar el estado de la memoria con free, refrescando cada d√©cima de segundo:  Observar las conexiones de red con netstat cada segundo:El comando watch es una herramienta muy √∫til para realizar monitorizaci√≥n en tiempo real en Linux, especialmente para observar la disponibilidad de recursos de red, CPU, memoria, entre otros.3. AtEl comando at en Linux es una herramienta que permite programar tareas √∫nicas para que se ejecuten en un momento espec√≠fico. Este comando es √∫til para programar tareas como apagar el sistema a una hora espec√≠fica, realizar una copia de seguridad √∫nica, enviar un correo electr√≥nico como recordatorio a la hora especificada, entre otras cosas.Opciones y Par√°metrosLas opciones m√°s comunes para el comando at son:  atq: Lista los trabajos programados.  atrm: Elimina trabajos programados. Se utiliza seguido del n√∫mero detrabajo, por ejemplo, atrm.  at [hora] [fecha]: Programa una tarea para que se ejecute en la hora y fechaespecificadas.Ejemplos de UsoAqu√≠ hay algunos ejemplos de c√≥mo se puede utilizar el comando at:  Programar una tarea para que se ejecute a las 10:00 PM:  Programar una tarea para que se ejecute a las 04:00 AM, copiando unarchivo, elimin√°ndolo del directorio original y apagando el PC:    at 04:00cp /home/usuario/Escritorio/imagen.iso /home/usuario/isosrm /home/usuario/Escritorio/imagen.isoshutdown -h now        Luego presionar Ctrl + D para terminar de ingresar las instrucciones.    Listar los trabajos programados:                               Eliminar un trabajo programado, por ejemplo, el trabajo n√∫mero 3:  Programar una tarea para que se ejecute a las 11:40 del 26 de febrero de 2023, listando los archivos en la ruta /tmp:    at 11:40 2023-02-26ls -ltr /tmp &gt; \"~/prueba_comando_at.txt\"echo 'finalizado ' &gt;&gt; \"~/prueba_comando_at.txt\"        Luego presionar ctrl + D para terminar de ingresar las instrucciones.  Ten en cuenta que para que el comando at funcione correctamente, lo tendremos que instalar con un sudo apt install at y debe estar corriendo el servicio atd (at daemon). Para habilitarlo en sistemas que usan systemd, puedes ejecutar: sudo systemctl enable ‚Äìnow atd.4. CrontabEl comando crontab en Linux es una herramienta que permite programar tareas para que se ejecuten autom√°ticamente a intervalos regulares. Este comando es √∫til para automatizar tareas como realizar copias de seguridad, enviar correos electr√≥nicos, limpiar directorios, entre otras cosas.Opciones y Par√°metrosLas opciones m√°s comunes para el comando crontab son:  crontab -e: Permite editar el archivo crontab del usuario actual.  crontab -l: Muestra la lista de trabajos programados para el usuario actual.  crontab -r: Elimina todos los trabajos programados para el usuario actual.  crontab -u [usuario] -e: Permite editar el archivo crontab de otro usuario (requiere privilegios de superusuario).Ejemplos de UsoAqu√≠ hay algunos ejemplos de c√≥mo se puede utilizar el comando crontab:  Programar una tarea para que se ejecute todos los d√≠as a las 5:00 PM:    crontab -e0 17 * * * /ruta/del/script.sh        Luego presionar ctrl + X y luego Y para guardar y salir (si est√°s utilizando el editor nano).    Listar los trabajos programados:                               Eliminar todos los trabajos programados:  Programar una tarea para que se ejecute cada minuto:    crontab -e* * * * * /ruta/del/comando        Programar una tarea para que se ejecute cada lunes a las 6:30 AM:    crontab -e30 6 * * 1 /ruta/del/comando      En los ejemplos anteriores, la sintaxis de los cinco asteriscos en las entradas de crontab representa minuto (0-59), hora (0-23), d√≠a del mes (1-31), mes (1-12) y d√≠a de la semana (0-7, donde tanto 0 como 7 representan el domingo), respectivamente.5. Conclusi√≥nEn resumen, los comandos sleep, watch, at y crontab son herramientas esenciales en sistemas operativos basados en Linux, como Debian, para la gesti√≥n del tiempo y la automatizaci√≥n de tareas.Estas herramientas proporcionan a los usuarios y administradores de sistemas unagran flexibilidad para programar y automatizar tareas, optimizando as√≠ el flujo detrabajo y la eficiencia del sistema.6. Bibliograf√≠aIONOSMontblanczoneHostgator"
  },
  
  {
    "title": "Creaci√≥n de m√°quina virtual en VirtualBox con arranque dual",
    "url": "/posts/dual-boot/",
    "categories": "Sistemas, Virtualizaci√≥n",
    "tags": "Virtualizaci√≥n",
    "date": "2024-09-02 14:09:00 +0200",
    





    
    "snippet": "Introducci√≥nEn esta pr√°ctica, aprenderemos a crear una m√°quina virtual en VirtualBox que permita ejecutar dos sistemas operativos en modo de arranque dual: Windows y Debian Bookworm. El arranque du...",
    "content": "Introducci√≥nEn esta pr√°ctica, aprenderemos a crear una m√°quina virtual en VirtualBox que permita ejecutar dos sistemas operativos en modo de arranque dual: Windows y Debian Bookworm. El arranque dual es una t√©cnica que nos permite elegir entre dos sistemas operativos al iniciar la m√°quina, lo que resulta muy √∫til para tener un entorno flexible y adaptable a diferentes necesidades de trabajo o pruebas. Exploraremos los pasos necesarios para instalar y configurar ambos sistemas operativos en la misma m√°quina virtual, asegur√°ndonos de que puedan coexistir de manera eficiente y sin problemas de compatibilidad. ¬°Comencemos!Requisitos M√≠nimos y RecomendadosLos requisitos espec√≠ficos pueden variar seg√∫n la versi√≥n de Windows yDebian que elijas, pero aqu√≠ tienes algunos requisitos generales:Para Windows (por ejemplo, Windows 10):  M√≠nimos: Procesador de 1 GHz, 1 GB de RAM (32 bits) o 2 GB deRAM (64 bits), 16 GB de espacio en disco duro, tarjeta gr√°ficacompatible con DirectX 9.  Recomendados: Procesador de 2 GHz o superior, 4 GB de RAM om√°s, 64 GB de espacio en disco duro o m√°s, tarjeta gr√°ficacompatible con DirectX 11.Para Debian Bookworm (versi√≥n actualizada):  M√≠nimos: Procesador de 1 GHz, 1 GB de RAM, 10 GB de espacio endisco duro.  Recomendados: Procesador de 2 GHz o superior, 2 GB de RAM om√°s, 20 GB de espacio en disco duro o m√°s.Requisitos Previos  Tener instalado Oracle VirtualBox en el equipo anfitri√≥n.  Descargar las im√°genes ISO de Windows y Debian Bookworm.Instalaci√≥n1. Creaci√≥n de la M√°quina Virtual:  Abre VirtualBox.  Haga clic en ‚ÄúNueva‚Äù para crear una nueva m√°quina virtual.  Ingresa un nombre para la m√°quina virtual (ejemplo: ‚ÄúDualBoot‚Äù).  Introduce la ISO de Windows descargada anteriormente y selecciona la versi√≥n adecuada (por ejemplo, ‚ÄúWindows 10 Pro de 64 bits‚Äù).  Configure la cantidad de memoria RAM asignada seg√∫n los requisitos del sistema operativo Windows (en mi caso le asignar√© 4096MB) y la cantidad de CPUs (en mi caso le pondr√© 4).  Crea un disco duro virtual y asigna un tama√±o suficiente para ambos sistemas operativos (por ejemplo, 50 GB).Una vez creada la m√°quina, nos dirigimos a ‚ÄúConfiguraci√≥n‚Äù y en la pesta√±a ‚ÄúSistema‚Äù deseleccionamos el disquete y dejamos seleccionadas la unidad √≥ptica y el disco duro.Despu√©s de esto ya podemos iniciar la m√°quina virtual y empezar elproceso de instalaci√≥n de Windows 10.2. Instalaci√≥n de Windows  Seguimos las instrucciones de instalaci√≥n de Windows  En la pesta√±a en la que nos pregunta que tipo de instalaci√≥nqueremos elegimos ‚ÄúPersonalizada: instalar solo Windows(avanzado)‚Äù, esto lo haremos para indicar en que parte del discoinstalaremos el sistema operativo.  Configure las opciones de idioma, zona horaria y cuenta de usuario.Despu√©s de esto ya lo deber√≠amos tener instalado.3. Liberaci√≥n de discoTendremos que particionar el disco desde Windows para darle espacio m√°starde en la instalaci√≥n de Debian. Para ello seguiremos los estos pasos:  Nos dirigimos al apartado ‚ÄúDesfragmentar y optimizar unidades‚ÄùAh√≠ analizaremos y optimizaremos el disco (C:) para seguidamentepoder desfragmentar el disco. Esto nos servir√° a la hora de reducir elvolumen del disco principal.  Luego nos iremos al apartado ‚ÄúCrear y formatear particiones deldisco duro‚ÄùAqu√≠ haremos bot√≥n derecho sobre el disco duro (C:) y le daremos a‚Äúreducir volumen‚Äù, en este caso le asignaremos 20GB a la segundapartici√≥n en la cual instalaremos Debian 12.Una vez liberado y particionado el disco para darle espacio a Debian,apagamos la m√°quina virtual.4. Instalaci√≥n de Debian Bookworm  Nos dirigimos a ‚ÄúConfiguraci√≥n‚Äù y en la pesta√±a de‚ÄúAlmacenamiento‚Äù sustituimos la imagen ISO de Windows por la deDebian 12 ya descargada anteriormente.  Seguimos las instrucciones de instalaci√≥n de Debian como ya hemosvisto anteriormente, en la que configuraremos el nombre del host,crearemos una cuenta de usuario, idioma, etc.  Una vez llegamos a la configuraci√≥n del particionado de disco,seleccionamos el m√©todo ‚ÄúManual‚Äù, y seleccionamos el espacio libreque hemos dejado anteriormente, aqu√≠ nos dejar√° elegir entre crearuna partici√≥n nueva manualmente o particionar el espacio libre demanera autom√°tica, esta segunda opci√≥n es la que nos interesa. Nosdebe de quedar algo como esto:  En el apartado de selecci√≥n de entorno gr√°fico podremos instalar elentorno que deseemos, en mi caso no instalar√© ninguno. De todasformas, luego en la l√≠nea de comandos puedo instalar cualquierentorno con el comando ‚Äútasksel‚Äù.5.Configuraci√≥n del Gestor de Arranque GRUB  Durante la instalaci√≥n de Debian, se instalar√° GRUB, el gestor dearranque.  Aseg√∫rese de que GRUB detecte autom√°ticamente ambos sistemasoperativos (Windows y Debian) durante la instalaci√≥n. Nos deber√≠asaltar un mensaje como este:  Esto permitir√° que al iniciar la m√°quina virtual, puedas elegir entrelos dos sistemas operativos desde el men√∫ de GRUB.6. Finalizaci√≥n de la Instalaci√≥n  Reinicia la m√°quina virtual.  Deber√≠as ver el men√∫ de GRUB que te permite seleccionar entreWindows y Debian al iniciar.Y con esto ya habr√≠amos terminado la creaci√≥n de m√°quina virtual enVirtualBox con arranque dual."
  },
  
  {
    "title": "Compartici√≥n de carpetas",
    "url": "/posts/comparticion-carpetas/",
    "categories": "Redes, Compartici√≥n de archivos",
    "tags": "Compartici√≥n de archivos",
    "date": "2024-09-01 15:30:00 +0200",
    





    
    "snippet": "1. Introducci√≥nEn esta pr√°ctica se abordar√° la configuraci√≥n y gesti√≥n de la compartici√≥n de carpetas entre diferentes sistemas operativos en una red local. La compartici√≥n de archivos es una tarea...",
    "content": "1. Introducci√≥nEn esta pr√°ctica se abordar√° la configuraci√≥n y gesti√≥n de la compartici√≥n de carpetas entre diferentes sistemas operativos en una red local. La compartici√≥n de archivos es una tarea esencial en redes empresariales y dom√©sticas, ya que permite a los usuarios acceder y gestionar recursos compartidos de manera eficiente, independientemente del sistema operativo que utilicen.El objetivo de esta pr√°ctica es demostrar c√≥mo configurar la compartici√≥n de carpetas en diversas combinaciones de sistemas: de Windows a Windows, de Windows a Debian, de Debian a Windows, etc. Se utilizar√°n herramientas nativas y protocolos como Samba para garantizar la interoperabilidad entre estos sistemas.Al finalizar, se habr√° aprendido a configurar adecuadamente permisos de acceso, seguridad y las mejores pr√°cticas para la compartici√≥n de recursos en un entorno de red mixto.2. Windows a WindowsPara compartir carpetas entre dos m√°quinas f√≠sicas con Windows10, podemos utilizar la funcionalidad de red compartida de Windows.A continuaci√≥n, te proporciono los pasos generales para hacerlo:2.1. Conexi√≥n de redAseg√∫rate de que ambas m√°quinas est√©n conectadas a lamisma red, ya sea mediante Wi-Fi o Ethernet. Esto es esencialpara que las computadoras se vean entre s√≠. En mi caso,realizar√© la compartici√≥n de carpetas entre dos m√°quinasf√≠sicas conectadas a una misma red Wi-Fi. Para saber nuestraIP nos dirigimos al ‚ÄúCmd‚Äù y utilizamos el comando ‚Äúipconfig‚Äù.Aqu√≠ veremos diferentes IPv4, pero a mi me interesa eladaptador de LAN inal√°mbrica Wi-Fi:2.2. Habilitar el descubrimiento de redEn ambas m√°quinas, debes asegurarte de que la funci√≥n de‚ÄúDescubrimiento de red‚Äù est√© habilitada. Para hacerlo: Ve al ‚ÄúPanel de control‚Äù &gt; ‚ÄúRedes y recursos compartidos‚Äù.En la parte izquierda, haz clic en ‚ÄúCambiar la configuraci√≥n deuso compartido avanzado‚Äù.Aseg√∫rate de que la opci√≥n ‚ÄúActivar el uso compartido dearchivos e impresoras‚Äù est√© habilitada y que la opci√≥n ‚ÄúActivarel descubrimiento de red‚Äù tambi√©n est√© habilitada.2.3. Compartir carpetasEn la m√°quina desde la cual deseas compartir carpetas, sigueestos pasos:  Navega a la carpeta que deseas compartir  Haz clic derecho en la carpeta y selecciona ‚ÄúPropiedades‚Äù.  Ve a la pesta√±a ‚ÄúUso compartido‚Äù y haz clic en ‚ÄúCompartir‚Äù.  Elige a qui√©n deseas compartir la carpeta. Puedes seleccionar ‚ÄúTodos‚Äù para que sea accesible para todos en la red o agregar usuarios espec√≠ficos.  Define los permisos de acceso (lectura, escritura, etc.) seg√∫n tus necesidades.  Haz clic en ‚ÄúCompartir‚Äù y luego en ‚ÄúListo‚Äù.2.4. Acceso a la carpeta compartidaEn la otra m√°quina, para acceder a la carpeta compartida:  Abre el Explorador de Windows.  En la barra de direcciones, escribe \\‚ÄùIP‚Äù (reemplaza ‚ÄúIP‚Äù por la ruta de la m√°quina desde la cual est√°s compartiendo la carpeta).  Deber√≠as ver la carpeta compartida. Haz doble clic en ella y podr√°s acceder a su contenido.Es importante que ambas m√°quinas tengan configurado un grupo detrabajo com√∫n. Puedes verificar esto y cambiarlo en la configuraci√≥n de redde cada m√°quina si es necesario. Adem√°s, aseg√∫rate de que las cuentas deusuario en ambas m√°quinas tengan permisos para acceder a las carpetascompartidas si est√°s utilizando autenticaci√≥n basada en cuentas de usuario.Ten en cuenta que estos son pasos generales y pueden variar seg√∫n laconfiguraci√≥n espec√≠fica de tu red y tu sistema. Adem√°s, para acceder a lascarpetas compartidas en una red local, ambas m√°quinas deben estarencendidas y conectadas a la red al mismo tiempo.3. Windows a DebianPara compartir carpetas entre una m√°quina f√≠sica con Windows 10 y unam√°quina virtual Debian 11 se pueden utilizar diferentes m√©todos, pero en mi caso utilizar√© Samba, en los que seguir√© estos pasos:3.1. Configuraci√≥n de la M√°quina Virtual Debian 11Aseg√∫rese de que la m√°quina virtual Debian 11 est√© funcionandocorrectamente y tenga acceso a la red. Para ello tendremos quecambiar el adaptador de red en la configuraci√≥n de la m√°quinavirtual, en este caso un adaptador puente.Despu√©s de esto, tendremos que comprobar que nuestras m√°quinashacen ping entre s√≠:Ping de Windows a DebianPing de Debian a WindowsInstale el paquete de Samba en Debian 11 si a√∫n no est√° instalado.Puedes hacerlo ejecutando el siguiente comando en la terminal:Creamos la carpeta donde vamos a compartir los archivos.mkdir /home/pavlo/compartidachmod 777 /home/pavlo/compartidaEditamos el archivo de configuraci√≥n de samba:nano /etc/samba/smb.confAl final del archivo insertamos el siguiente texto correspondiente a laconfiguraci√≥n de nuestra carpeta compartida:[compartida]path = /home/pavlo/compartidacomment = Compartidaguest ok = yespublic = yeswritable = yesGuardamos los cambios y despu√©s reiniciamos el servicio con elcomando:service smbd restartDespu√©s de esto creamos un documento de prueba y ya tendremoscreada una carpeta lista para compartir:En nuestro equipo con Windows nos dirigimos al apartado de red yen el navegador de archivos escribimos la IP que tengamos asignadaen Debian:Si se le solicita un nombre de usuario y una contrase√±a, ingrese lascredenciales de inicio de sesi√≥n de su m√°quina virtual Debian 11.Con esto realizado, ya podremos empezar a compartir archivos entre losdos sistemas operativos.Mencionar, que en este ejemplo hemos utilizado unos permisos para lacarpeta muy permisivos en el que cualquiera puede leer y escribir en eldirectorio.4. Debian a WindowsPara compartir carpetas de Debian a Windows tenemos que seguirexactamente los mismos pasos ya explicados en el apartado anterior.5. Debian a DebianPara compartir carpetas entre Debian y Debian hay que seguirpr√°cticamente los mismos pasos ya explicados anteriormente. En mi casolo har√© con dos m√°quinas virtuales entre s√≠. Para ello tendremos que seguir una serie de pasos:      En primer lugar y muy importante, comprobar que haya conectividad(ping) entre nuestras m√°quinas, en donde tendremos que configurarlas IPs para que ambas tengan coherencia. Despu√©s de ellorealizaremos la prueba y comprobamos si funciona:        Seguidamente tendremos que instalar Samba en ambas m√°quinas ycreamos la carpeta donde vamos a compartir los archivos.  mkdir /home/pavlo/compartidadebianchmod 777 /home/pavlo/compartidadebian  Editamos el archivo de configuraci√≥n de samba:    nano /etc/samba/smb.conf      Al final del archivo insertamos el siguiente texto correspondiente a laconfiguraci√≥n de nuestra carpeta compartida:[compartidadebian]path = /home/pavlo/compartidadebiancomment = Comparticion entre Debian y Debianguest ok = yespublic = yeswritable = yesGuardamos los cambios y despu√©s reiniciamos el servicio con elcomando:service smbd restart      Despu√©s de esto creamos un documento de prueba y ya tendremoscreada una carpeta lista para compartir:        Una vez configurado todo se seguir√°n los mismos sencillos pasos queen Windows estando en la misma red y utilizando el comandosmb://111.111.1.11  Y con esto ya habr√≠amos hecho la compartici√≥n de carpetas entre Debian y Debian a trav√©s de Samba.6. Windows a AndroidUtilizando una aplicaci√≥n llamada ‚Äúfx file explorer‚Äù nos resultar√° muysencillo compartir carpetas entre Windows y Android.Como en todos los apartados anteriores tendremos que estar conectados ala misma red para que ambos dispositivos puedan realizar conectividadentre s√≠. En mi caso estar√°n conectados tanto mi port√°til como mi tel√©fono a la red Wi-Fi de mi casa.Una vez instalada la aplicaci√≥n y comprobado que ambos dispositivos est√°n en la misma red, creamos una carpeta compartida en Windows dando los permisos que queramos como ya he explicado anteriormente. Despu√©saccedemos al apartado de ‚ÄúNetwork‚Äù y agregamos un nuevo dispositivo enel que tendremos que poner la IP de nuestro dispositivo Windows.Una vez realizado todo esto lo √∫nico que queda es abrir la carpetacompartida con permisos y crear un archivo desde Android comprobandoque todo vaya bien.7. Debian y AndroidQuiz√°s la forma m√°s f√°cil de compartir archivos entre Android y Linux de forma inal√°mbrica sea descargando una aplicaci√≥n FTP en un dispositivo Android. Ya que nos permite alojar r√°pidamente un servidor FTP improvisado en nuestro dispositivo Android, que luego puede aceptarconexiones remotas de forma inal√°mbrica.Antes de que podamos hablar sobre la configuraci√≥n del servidor, deber√°instalar la aplicaci√≥n WiFi FTP Server en su dispositivo Android. Parahacer esto, abra la aplicaci√≥n Google Play Store en Android, busque‚ÄúServidor FTP WiFi‚Äù e inst√°lalo.Despu√©s de estado tendremos que instalar Filezilla en Debian con elsiguiente comando:apt install FilezillaDentro de la aplicaci√≥n de Android crearemos un servidor con la ubicaci√≥n de donde queremos crear los archivos.Una vez creamos el servidor dentro de Filezilla ponemos los datos que nos da la aplicaci√≥n para crear una conexi√≥n directa entre ambos dispositivos.Seguidamente le damos a ‚ÄúSubir‚Äù en el archivo o carpeta que queramoscompartir y as√≠ respectivamente con cualquier cosa que queramoscompartir entre ambos dispositivos."
  }
  
]

