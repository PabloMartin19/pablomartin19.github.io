<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="es" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Auditoría" />
<meta name="author" content="Pablo Martín Hidalgo" />
<meta property="og:locale" content="es" />
<meta name="description" content="La auditoría en bases de datos es una herramienta esencial para garantizar la seguridad y el control sobre las operaciones que se realizan en un sistema. En este artículo, exploraremos cómo configurar y verificar la auditoría en diferentes bases de datos como Oracle, PostgreSQL, MySQL y MongoDB. Analizaremos desde el registro de accesos fallidos hasta la supervisión de operaciones específicas, proporcionando ejemplos prácticos para cada uno de los sistemas mencionados." />
<meta property="og:description" content="La auditoría en bases de datos es una herramienta esencial para garantizar la seguridad y el control sobre las operaciones que se realizan en un sistema. En este artículo, exploraremos cómo configurar y verificar la auditoría en diferentes bases de datos como Oracle, PostgreSQL, MySQL y MongoDB. Analizaremos desde el registro de accesos fallidos hasta la supervisión de operaciones específicas, proporcionando ejemplos prácticos para cada uno de los sistemas mencionados." />
<link rel="canonical" href="/posts/auditoria/" />
<meta property="og:url" content="/posts/auditoria/" />
<meta property="og:site_name" content="Blog personal" />
<meta property="og:image" content="/assets/img/posts/auditoria/Database-Audit-in-SQL-Server-02.webp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-02-25T21:00:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/assets/img/posts/auditoria/Database-Audit-in-SQL-Server-02.webp" />
<meta property="twitter:title" content="Auditoría" />
<meta name="twitter:site" content="@Tagarnina10" />
<meta name="twitter:creator" content="@Tagarnina10" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pablo Martín Hidalgo","url":"https://github.com/PabloMartin19/"},"dateModified":"2025-02-27T15:10:07+01:00","datePublished":"2025-02-25T21:00:00+01:00","description":"La auditoría en bases de datos es una herramienta esencial para garantizar la seguridad y el control sobre las operaciones que se realizan en un sistema. En este artículo, exploraremos cómo configurar y verificar la auditoría en diferentes bases de datos como Oracle, PostgreSQL, MySQL y MongoDB. Analizaremos desde el registro de accesos fallidos hasta la supervisión de operaciones específicas, proporcionando ejemplos prácticos para cada uno de los sistemas mencionados.","headline":"Auditoría","image":"/assets/img/posts/auditoria/Database-Audit-in-SQL-Server-02.webp","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/auditoria/"},"url":"/posts/auditoria/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Auditoría | Blog personal
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Blog personal">
<meta name="application-name" content="Blog personal">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      let self = this;this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          self.clearMode();
        }
        self.notify();
      });

      if (!this.hasMode) {
        return;
      }

      if (this.isDarkMode) {
        this.setDark();
      } else {
        this.setLight();
      }
    }

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isPreferDark() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }get modeStatus() {
      if (this.hasMode) {
        return this.mode;
      } else {
        return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        this.clearMode();
      } else {
        if (this.isPreferDark) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    }
  }

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">Blog personal</a>
    <p class="site-subtitle fst-italic mb-0">Los mejores programas son aquellos que funcionan.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/PabloMartin19"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/Tagarnina10"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['pmartinhidalgo19','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="https://www.linkedin.com/in/pablo-mart%C3%ADn-hidalgo/"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Auditoría</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Auditoría</h1>
    
      <p class="post-desc fw-light mb-4">La auditoría en bases de datos es una herramienta esencial para garantizar la seguridad y el control sobre las operaciones que se realizan en un sistema. En este artículo, exploraremos cómo configurar y verificar la auditoría en diferentes bases de datos como Oracle, PostgreSQL, MySQL y MongoDB. Analizaremos desde el registro de accesos fallidos hasta la supervisión de operaciones específicas, proporcionando ejemplos prácticos para cada uno de los sistemas mencionados.</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740513600"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Feb 25, 2025
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740665407"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Feb 27, 2025
</time>

        </span>
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/posts/auditoria/Database-Audit-in-SQL-Server-02.webp" class="popup img-link preview-img shimmer"><img src="/assets/img/posts/auditoria/Database-Audit-in-SQL-Server-02.webp"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/PabloMartin19/">Pablo Martín Hidalgo</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="7724 words"
>
  <em>42 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  <div class="content">
    <h2 id="1-activa-desde-sqlplus-la-auditoría-de-los-intentos-de-acceso-no-exitosos-al-sistema-comprueba-su-funcionamiento"><span class="me-2">1. Activa desde SQL*Plus la auditoría de los intentos de acceso no exitosos al sistema. Comprueba su funcionamiento.</span><a href="#1-activa-desde-sqlplus-la-auditoría-de-los-intentos-de-acceso-no-exitosos-al-sistema-comprueba-su-funcionamiento" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Para activar la auditoría de los intentos de acceso no exitosos en Oracle, lo primero que haremos será comprobar si la auditoría está habilitada con el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> 
<span class="k">FROM</span> <span class="n">v</span><span class="err">$</span><span class="k">parameter</span> 
<span class="k">WHERE</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">'audit_trail'</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Si la salida muestra:</p>

<p><a href="/assets/img/posts/auditoria/image1.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image1.png" alt="image" loading="lazy"></a></p>

<p>significa que la auditoría está activada a nivel de base de datos (<code class="language-plaintext highlighter-rouge">DB</code>). Si estuviera desactivada (<code class="language-plaintext highlighter-rouge">NONE</code>), tendríamos que activarla con:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">ALTER</span> <span class="k">SYSTEM</span> <span class="k">SET</span> <span class="n">audit_trail</span><span class="o">=</span><span class="n">DB</span> <span class="k">SCOPE</span><span class="o">=</span><span class="n">SPFILE</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>O si por el contrario queremos desactivarla por alguna razón, sería de la siguiente forma:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">ALTER</span> <span class="k">SYSTEM</span> <span class="k">SET</span> <span class="n">audit_trail</span><span class="o">=</span><span class="k">NONE</span> <span class="k">SCOPE</span><span class="o">=</span><span class="n">SPFILE</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Para que la modificación sea efectiva, debemos reiniciar la base de datos:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">SHUTDOWN</span> <span class="k">IMMEDIATE</span><span class="p">;</span>
<span class="n">STARTUP</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez comprobado que tenemos activada la funcionalidad de auditorías, activamos la auditoría de intentos de acceso fallidos con:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">AUDIT</span> <span class="k">SESSION</span> <span class="k">WHENEVER</span> <span class="k">NOT</span> <span class="n">SUCCESSFUL</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/IMAGE2.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/IMAGE2.png" alt="image" loading="lazy"></a></p>

<p>Esto registrará en los logs de auditoría todos los intentos fallidos de inicio de sesión en la base de datos.</p>

<p>Para comprobar su funcionamiento, intentaré conectarme con credenciales incorrectas desde SQL*Plus:</p>

<p><a href="/assets/img/posts/auditoria/image3.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image3.png" alt="image" loading="lazy"></a></p>

<p>Después, verificamos los registros de auditoría con:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">username</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">returncode</span> 
<span class="k">FROM</span> <span class="n">dba_audit_trail</span> 
<span class="k">WHERE</span> <span class="n">action_name</span> <span class="o">=</span> <span class="s1">'LOGON'</span> 
<span class="k">ORDER</span> <span class="k">BY</span> <span class="nb">timestamp</span> <span class="k">DESC</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image4.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image4.png" alt="image" loading="lazy"></a></p>

<p>Como vemos la salida indica que hubo un intento fallido de inicio de sesión (<code class="language-plaintext highlighter-rouge">LOGON</code>) con el usuario <code class="language-plaintext highlighter-rouge">USUARIO_NO_EXISTE</code>. El código de error <code class="language-plaintext highlighter-rouge">1017</code> significa “nombre de usuario o contraseña no válidos”.</p>

<p>También podemos consultar los intentos de acceso fallidos utilizando la vista <code class="language-plaintext highlighter-rouge">DBA_AUDIT_SESSION</code>, que nos proporciona información detallada sobre las sesiones auditadas.</p>

<p>Si ejecutamos el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">OS_USERNAME</span><span class="p">,</span> <span class="n">USERNAME</span><span class="p">,</span> <span class="n">EXTENDED_TIMESTAMP</span><span class="p">,</span> <span class="n">ACTION_NAME</span> 
<span class="k">FROM</span> <span class="n">DBA_AUDIT_SESSION</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>obtendremos datos como el usuario del sistema operativo (<code class="language-plaintext highlighter-rouge">OS_USERNAME</code>), el usuario de la base de datos que intentó iniciar sesión (<code class="language-plaintext highlighter-rouge">USERNAME</code>), la marca de tiempo exacta del intento (<code class="language-plaintext highlighter-rouge">EXTENDED_TIMESTAMP</code>) y la acción realizada (<code class="language-plaintext highlighter-rouge">ACTION_NAME</code>).</p>

<p>Esta es la salida de ejemplo:</p>

<p><a href="/assets/img/posts/auditoria/image5.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image5.png" alt="image" loading="lazy"></a></p>

<h2 id="2-realiza-un-procedimiento-en-plsql-que-te-muestre-los-accesos-fallidos-junto-con-el-motivo-de-los-mismos-transformando-el-código-de-error-almacenado-en-un-mensaje-de-texto-comprensible-contempla-todos-los-motivos-posibles-para-que-un-acceso-sea-fallido"><span class="me-2">2. Realiza un procedimiento en PL/SQL que te muestre los accesos fallidos junto con el motivo de los mismos, transformando el código de error almacenado en un mensaje de texto comprensible. Contempla todos los motivos posibles para que un acceso sea fallido.</span><a href="#2-realiza-un-procedimiento-en-plsql-que-te-muestre-los-accesos-fallidos-junto-con-el-motivo-de-los-mismos-transformando-el-código-de-error-almacenado-en-un-mensaje-de-texto-comprensible-contempla-todos-los-motivos-posibles-para-que-un-acceso-sea-fallido" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Lo primero que deberíamos hacer es activar la auditoría de intentos de acceso fallidos, pero como en el ejercicio anterior ya lo hicimos, no es necesario.</p>

<p>Para realizar las comprobaciones, voy a provocar distintos accesos fallidos al sistema con usuarios y contraseñas que no existen:</p>

<p><a href="/assets/img/posts/auditoria/image6.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image6.png" alt="image" loading="lazy"></a></p>

<p>También, probaré con un usuario que sí existe pero no concuerda la contraseña:</p>

<p><a href="/assets/img/posts/auditoria/image7.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image7.png" alt="image" loading="lazy"></a></p>

<p>He creado una función llamada <code class="language-plaintext highlighter-rouge">obtener_motivo_error</code>, que recibe un código de error y devuelve un mensaje explicativo. He utilizado una estructura <code class="language-plaintext highlighter-rouge">CASE</code> para mostrar una descripción clara a cada código de error posible.</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">obtener_motivo_error</span> <span class="p">(</span><span class="n">codigo_error</span> <span class="n">NUMBER</span><span class="p">)</span> 
<span class="k">RETURN</span> <span class="n">VARCHAR2</span>
<span class="k">IS</span>
    <span class="n">mensaje_error</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
<span class="k">BEGIN</span>
    <span class="k">CASE</span> <span class="n">codigo_error</span>
        <span class="k">WHEN</span> <span class="mi">911</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'El intento contiene caracteres no permitidos.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">1004</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Acceso denegado.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">1017</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Credenciales incorrectas.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">1033</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'El usuario no está registrado en la base de datos.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">1045</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Falta el permiso CREATE SESSION.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28000</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Cuenta bloqueada por intentos fallidos.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28001</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'La contraseña ha caducado, debe actualizarse.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28002</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Advertencia: la contraseña está próxima a caducar.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28003</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'La contraseña no cumple los requisitos de seguridad.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28007</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Intento de reutilización de contraseña detectado.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28008</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Contraseña anterior incorrecta.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28009</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Conexión a SYS requiere privilegios SYSDBA o SYSOPER.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28011</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Cuenta a punto de expirar, se recomienda cambiar la contraseña.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28511</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Contraseña caducada, inicie sesión para restablecerla.'</span><span class="p">;</span>
        <span class="k">WHEN</span> <span class="mi">28512</span> <span class="k">THEN</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Cuenta bloqueada, contacte con el administrador.'</span><span class="p">;</span>
        <span class="k">ELSE</span> <span class="n">mensaje_error</span> <span class="p">:</span><span class="o">=</span> <span class="s1">'Error desconocido, contacte con soporte técnico.'</span><span class="p">;</span>
    <span class="k">END</span> <span class="k">CASE</span><span class="p">;</span>
    <span class="k">RETURN</span> <span class="n">mensaje_error</span><span class="p">;</span>
<span class="k">END</span> <span class="n">obtener_motivo_error</span><span class="p">;</span>
<span class="o">/</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image8.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image8.png" alt="image" loading="lazy"></a></p>

<p>Luego, he definido el procedimiento <code class="language-plaintext highlighter-rouge">listar_accesos_fallidos</code>, donde abro un cursor que selecciona los intentos de acceso fallidos desde <code class="language-plaintext highlighter-rouge">dba_audit_session</code>.</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">PROCEDURE</span> <span class="n">listar_accesos_fallidos</span>
<span class="k">IS</span>
    <span class="k">CURSOR</span> <span class="n">cursor_accesos</span> <span class="k">IS</span>
        <span class="k">SELECT</span> <span class="n">os_username</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">returncode</span><span class="p">,</span> <span class="nb">timestamp</span>
        <span class="k">FROM</span> <span class="n">dba_audit_session</span>
        <span class="k">WHERE</span> <span class="n">action_name</span> <span class="o">=</span> <span class="s1">'LOGON'</span>
        <span class="k">AND</span> <span class="n">returncode</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span>
        <span class="k">ORDER</span> <span class="k">BY</span> <span class="nb">timestamp</span><span class="p">;</span>
    <span class="n">motivo</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
<span class="k">BEGIN</span>
    <span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span><span class="s1">'Lista de intentos de acceso fallidos:'</span><span class="p">);</span>
    <span class="k">FOR</span> <span class="n">intento</span> <span class="k">IN</span> <span class="n">cursor_accesos</span> <span class="n">LOOP</span>
        <span class="n">motivo</span> <span class="p">:</span><span class="o">=</span> <span class="n">obtener_motivo_error</span><span class="p">(</span><span class="n">intento</span><span class="p">.</span><span class="n">returncode</span><span class="p">);</span>
        <span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span><span class="s1">'------------------------------------------------------------------------------------------------'</span><span class="p">);</span>
        <span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span><span class="s1">'Usuario SO: '</span> <span class="o">||</span> <span class="n">intento</span><span class="p">.</span><span class="n">os_username</span> <span class="o">||</span> <span class="s1">' | Usuario BD: '</span> <span class="o">||</span> <span class="n">intento</span><span class="p">.</span><span class="n">username</span> <span class="o">||</span> <span class="s1">' | Fecha: '</span> <span class="o">||</span> <span class="n">TO_CHAR</span><span class="p">(</span><span class="n">intento</span><span class="p">.</span><span class="nb">timestamp</span><span class="p">,</span> <span class="s1">'YYYY/MM/DD HH24:MI'</span><span class="p">)</span> <span class="o">||</span> <span class="s1">' | Motivo: '</span> <span class="o">||</span> <span class="n">motivo</span><span class="p">);</span>
    <span class="k">END</span> <span class="n">LOOP</span><span class="p">;</span>
<span class="k">END</span> <span class="n">listar_accesos_fallidos</span><span class="p">;</span>
<span class="o">/</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image9.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image9.png" alt="image" loading="lazy"></a></p>

<p>Hacemos la comprobación y vemos que funciona correctamente:</p>

<p><a href="/assets/img/posts/auditoria/image10.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image10.png" alt="image" loading="lazy"></a></p>

<h2 id="3-activa-la-auditoría-de-las-operaciones-dml-realizadas-por-el-usuario-prueba-en-tablas-de-su-esquema-comprueba-su-funcionamiento"><span class="me-2">3. Activa la auditoría de las operaciones DML realizadas por el usuario Prueba en tablas de su esquema. Comprueba su funcionamiento.</span><a href="#3-activa-la-auditoría-de-las-operaciones-dml-realizadas-por-el-usuario-prueba-en-tablas-de-su-esquema-comprueba-su-funcionamiento" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Primero, creamos el usuario PRUEBA y le asignamos una contraseña:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">USER</span> <span class="n">PRUEBA</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="n">password</span><span class="p">;</span>

<span class="n">Usuario</span> <span class="n">creado</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Luego, le otorgamos los permisos necesarios para conectarse y gestionar sus propias tablas:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">GRANT</span> <span class="k">CONNECT</span><span class="p">,</span> <span class="n">RESOURCE</span> <span class="k">TO</span> <span class="n">PRUEBA</span><span class="p">;</span>

<span class="n">Concesi</span><span class="err">ó</span><span class="n">n</span> <span class="n">terminada</span> <span class="n">correctamente</span><span class="p">.</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">ALTER</span> <span class="k">USER</span> <span class="n">PRUEBA</span> <span class="n">QUOTA</span> <span class="n">UNLIMITED</span> <span class="k">ON</span> <span class="n">USERS</span><span class="p">;</span>

<span class="n">Usuario</span> <span class="n">modificado</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>A continuación, creamos una tabla de prueba dentro del esquema PRUEBA e insertamos algunos datos:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">PRUEBA</span><span class="p">.</span><span class="n">CLIENTES</span> <span class="p">(</span>
  <span class="mi">2</span>      <span class="n">ID</span> <span class="n">NUMBER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="mi">3</span>      <span class="n">NOMBRE</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
  <span class="mi">4</span>      <span class="n">EMAIL</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
  <span class="mi">5</span>      <span class="n">FECHA_REGISTRO</span> <span class="nb">DATE</span> <span class="k">DEFAULT</span> <span class="n">SYSDATE</span>
  <span class="mi">6</span>  <span class="p">);</span>

<span class="n">Tabla</span> <span class="n">creada</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRUEBA</span><span class="p">.</span><span class="n">CLIENTES</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">NOMBRE</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Chema García'</span><span class="p">,</span> <span class="s1">'chema@example.com'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRUEBA</span><span class="p">.</span><span class="n">CLIENTES</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">NOMBRE</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'Jesús Martín'</span><span class="p">,</span> <span class="s1">'jesús@example.com'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRUEBA</span><span class="p">.</span><span class="n">CLIENTES</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">NOMBRE</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'Roberto Carlos'</span><span class="p">,</span> <span class="s1">'roberto@example.com'</span><span class="p">);</span>

<span class="mi">1</span> <span class="n">fila</span> <span class="n">creada</span><span class="p">.</span>

<span class="k">SQL</span><span class="o">&gt;</span> 
<span class="mi">1</span> <span class="n">fila</span> <span class="n">creada</span><span class="p">.</span>

<span class="k">SQL</span><span class="o">&gt;</span> 
<span class="mi">1</span> <span class="n">fila</span> <span class="n">creada</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Para auditar todas las operaciones DML (INSERT, UPDATE y DELETE) realizadas por el usuario PRUEBA, ejecutamos:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">AUDIT</span> <span class="k">INSERT</span> <span class="k">TABLE</span><span class="p">,</span> <span class="k">UPDATE</span> <span class="k">TABLE</span><span class="p">,</span> <span class="k">DELETE</span> <span class="k">TABLE</span> <span class="k">BY</span> <span class="n">PRUEBA</span> <span class="k">BY</span> <span class="k">ACCESS</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image11.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image11.png" alt="image" loading="lazy"></a></p>

<p>Con esto, cada vez que PRUEBA realice una de estas operaciones, se registrará en la tabla de auditoría.</p>

<p>Para verificar si la auditoría está funcionando, nos conectamos con el usuario PRUEBA y realizamos algunas modificaciones en la tabla:</p>

<p><a href="/assets/img/posts/auditoria/image12.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image12.png" alt="image" loading="lazy"></a></p>

<p>Ahora, consultamos la tabla de auditoría específica de objetos para ver los registros de las operaciones DML realizadas por el usuario PRUEBA en sus tablas:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">extended_timestamp</span> 
<span class="k">FROM</span> <span class="n">dba_audit_object</span> 
<span class="k">WHERE</span> <span class="n">username</span> <span class="o">=</span> <span class="s1">'PRUEBA'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">extended_timestamp</span> <span class="k">DESC</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image13.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image13.png" alt="image" loading="lazy"></a></p>

<p>Con esta consulta, obtenemos un listado detallado de las tablas modificadas, el tipo de acción ejecutada (<strong>INSERT</strong>, <strong>UPDATE</strong>, <strong>DELETE</strong>) y la fecha y hora exacta en que se realizaron.</p>

<p>De este modo, verificamos que la auditoría de operaciones DML en el esquema de <strong>PRUEBA</strong> está funcionando correctamente.</p>

<h2 id="4-realiza-una-auditoría-de-grano-fino-para-almacenar-información-sobre-la-inserción-de-empleados-con-comisión-en-la-tabla-emp-de-scott"><span class="me-2">4. Realiza una auditoría de grano fino para almacenar información sobre la inserción de empleados con comisión en la tabla emp de scott.</span><a href="#4-realiza-una-auditoría-de-grano-fino-para-almacenar-información-sobre-la-inserción-de-empleados-con-comisión-en-la-tabla-emp-de-scott" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Para realizar una auditoría de grano fino que registre las inserciones de empleados con comisión en la tabla <strong>EMP</strong> del usuario <strong>SCOTT</strong>, utilizamos el paquete <code class="language-plaintext highlighter-rouge">DBMS_FGA</code>. En este caso, en lugar de auditar por el salario, configuramos la auditoría para que registre cualquier inserción en la tabla <strong>EMP</strong> donde la columna <strong>COMM</strong> (comisión) no sea nula.</p>

<p>El siguiente bloque PL/SQL crea la política de auditoría:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">BEGIN</span>
  <span class="n">DBMS_FGA</span><span class="p">.</span><span class="n">ADD_POLICY</span> <span class="p">(</span>
    <span class="n">object_schema</span>   <span class="o">=&gt;</span> <span class="s1">'SCOTT'</span><span class="p">,</span>
    <span class="n">object_name</span>     <span class="o">=&gt;</span> <span class="s1">'EMP'</span><span class="p">,</span>
    <span class="n">policy_name</span>     <span class="o">=&gt;</span> <span class="s1">'comm_audit'</span><span class="p">,</span>
    <span class="n">audit_condition</span> <span class="o">=&gt;</span> <span class="s1">'COMM IS NOT NULL'</span><span class="p">,</span>
    <span class="n">statement_types</span> <span class="o">=&gt;</span> <span class="s1">'INSERT'</span>
  <span class="p">);</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image14.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image14.png" alt="image" loading="lazy"></a></p>

<p>Este código define una política llamada <strong>comm_audit</strong>, que auditará todas las inserciones (<code class="language-plaintext highlighter-rouge">INSERT</code>) en la tabla <strong>EMP</strong> cuando la columna <strong>COMM</strong> tenga un valor distinto de NULL.</p>

<p>Ahora nos conectamos con el usuario SCOTT y probamos la auditoría insertando un empleado con comisión (debería ser auditado) y un empleado sin comisión (no debería ser auditado):</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">EMP</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1600</span><span class="p">,</span> <span class="s1">'Carlos'</span><span class="p">,</span> <span class="s1">'SALESMAN'</span><span class="p">,</span> <span class="mi">7698</span><span class="p">,</span> <span class="n">TO_DATE</span><span class="p">(</span><span class="s1">'2025-02-25'</span><span class="p">,</span> <span class="s1">'YYYY-MM-DD'</span><span class="p">),</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

<span class="mi">1</span> <span class="n">fila</span> <span class="n">creada</span><span class="p">.</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">EMP</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1601</span><span class="p">,</span> <span class="s1">'Ana'</span><span class="p">,</span> <span class="s1">'CLERK'</span><span class="p">,</span> <span class="mi">7782</span><span class="p">,</span> <span class="n">TO_DATE</span><span class="p">(</span><span class="s1">'2025-02-25'</span><span class="p">,</span> <span class="s1">'YYYY-MM-DD'</span><span class="p">),</span> <span class="mi">1200</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

<span class="mi">1</span> <span class="n">fila</span> <span class="n">creada</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Luego, consultamos la auditoría:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">db_user</span><span class="p">,</span> <span class="n">object_name</span><span class="p">,</span> <span class="n">object_schema</span><span class="p">,</span> <span class="n">sql_text</span><span class="p">,</span> <span class="nb">timestamp</span> 
<span class="k">FROM</span> <span class="n">dba_fga_audit_trail</span> 
<span class="k">WHERE</span> <span class="n">policy_name</span> <span class="o">=</span> <span class="s1">'COMM_AUDIT'</span> 
<span class="k">ORDER</span> <span class="k">BY</span> <span class="nb">timestamp</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image15.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image15.png" alt="image" loading="lazy"></a></p>

<p>Y como podemos ver, solo se ha registrado la primera inserción, pues es la que sí tiene comisión.</p>

<h2 id="5-explica-la-diferencia-entre-auditar-una-operación-by-access-o-by-session-ilustrándolo-con-ejemplos"><span class="me-2">5. Explica la diferencia entre auditar una operación by access o by session ilustrándolo con ejemplos.</span><a href="#5-explica-la-diferencia-entre-auditar-una-operación-by-access-o-by-session-ilustrándolo-con-ejemplos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Al auditar una operación <strong>by access</strong>, lo que estamos registrando es cada acceso que se hace a un objeto de la base de datos, sin importar si la sesión del usuario ha terminado o no. Esto significa que se genera un registro para cada acción que se realice, como <strong>SELECT</strong>, <strong>INSERT</strong>, <strong>UPDATE</strong> o <strong>DELETE</strong>. Por ejemplo, si configuramos la auditoría para el usuario SCOTT con el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="n">AUDIT</span> <span class="k">INSERT</span> <span class="k">TABLE</span><span class="p">,</span> <span class="k">UPDATE</span> <span class="k">TABLE</span><span class="p">,</span> <span class="k">DELETE</span> <span class="k">TABLE</span> <span class="k">BY</span> <span class="n">SCOTT</span> <span class="k">BY</span> <span class="k">ACCESS</span><span class="p">;</span>

<span class="n">Auditoria</span> <span class="n">terminada</span> <span class="n">correctamente</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image16.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image16.png" alt="image" loading="lazy"></a></p>

<p>Este comando registrará cada operación de INSERT, UPDATE y DELETE realizada por SCOTT sobre las tablas de la base de datos. Si SCOTT realiza las siguientes operaciones en una sesión:</p>

<p>INSERT:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">emp</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s1">'Juan'</span><span class="p">,</span> <span class="s1">'MANAGER'</span><span class="p">,</span> <span class="mi">7839</span><span class="p">,</span> <span class="n">to_date</span><span class="p">(</span><span class="s1">'2024-02-25'</span><span class="p">,</span> <span class="s1">'YYYY-MM-DD'</span><span class="p">),</span> <span class="mi">3000</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

<span class="mi">1</span> <span class="n">fila</span> <span class="n">creada</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>DELETE:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">emp</span> <span class="k">WHERE</span> <span class="n">empno</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span>

<span class="mi">1</span> <span class="n">fila</span> <span class="n">suprimida</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>UPDATE:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">UPDATE</span> <span class="n">emp</span> <span class="k">SET</span> <span class="n">sal</span> <span class="o">=</span> <span class="mi">4500</span> <span class="k">WHERE</span> <span class="n">empno</span> <span class="o">=</span> <span class="mi">7654</span><span class="p">;</span>

<span class="mi">1</span> <span class="n">fila</span> <span class="n">actualizada</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image17.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image17.png" alt="image" loading="lazy"></a></p>

<p>Al consultar la tabla de auditoría con el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">username</span><span class="p">,</span> <span class="k">owner</span><span class="p">,</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="nb">timestamp</span>
<span class="k">FROM</span> <span class="n">dba_audit_trail</span>
<span class="k">WHERE</span> <span class="n">username</span> <span class="o">=</span> <span class="s1">'SCOTT'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">extended_timestamp</span> <span class="k">DESC</span>
<span class="k">FETCH</span> <span class="k">FIRST</span> <span class="mi">3</span> <span class="k">ROWS</span> <span class="k">only</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Se generarán tres registros, uno por cada operación, con los siguientes datos:</p>

<p><a href="/assets/img/posts/auditoria/image18.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image18.png" alt="image" loading="lazy"></a></p>

<p>Cada operación (<strong>INSERT</strong>, <strong>UPDATE</strong>, <strong>DELETE</strong>) se registra por separado con un timestamp detallado.</p>

<p>Por otro lado, cuando auditamos <strong>by session</strong>, se genera un solo registro por sesión del usuario. Aunque dentro de esa sesión el usuario ejecute múltiples operaciones, solo se registrará una entrada para toda la sesión. Este forma es menos detallado, ya que no se registra cada operación individual, sino que se crea un único registro que agrupa todas las operaciones realizadas durante esa sesión.</p>

<p>Si configuramos la auditoría <strong>by session</strong> con el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="n">AUDIT</span> <span class="k">INSERT</span> <span class="k">TABLE</span><span class="p">,</span> <span class="k">UPDATE</span> <span class="k">TABLE</span><span class="p">,</span> <span class="k">DELETE</span> <span class="k">TABLE</span> <span class="k">BY</span> <span class="n">SCOTT</span> <span class="k">BY</span> <span class="k">SESSION</span><span class="p">;</span>

<span class="n">Auditoria</span> <span class="n">terminada</span> <span class="n">correctamente</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image19.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image19.png" alt="image" loading="lazy"></a></p>

<p>Este comando registrará solo una entrada por sesión del usuario SCOTT, sin importar cuántas operaciones realice en esa sesión. Si SCOTT ejecuta las siguientes operaciones dentro de una misma sesión:</p>

<p>INSERT:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">emp</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7777</span><span class="p">,</span> <span class="s1">'Torrente'</span><span class="p">,</span> <span class="s1">'MANAGER'</span><span class="p">,</span> <span class="mi">7839</span><span class="p">,</span> <span class="n">to_date</span><span class="p">(</span><span class="s1">'2025-02-25'</span><span class="p">,</span> <span class="s1">'YYYY-MM-DD'</span><span class="p">),</span> <span class="mi">3000</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

<span class="mi">1</span> <span class="n">fila</span> <span class="n">creada</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>DELETE:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">emp</span> <span class="k">WHERE</span> <span class="n">empno</span> <span class="o">=</span> <span class="mi">7777</span><span class="p">;</span>

<span class="mi">1</span> <span class="n">fila</span> <span class="n">suprimida</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>UPDATE:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">UPDATE</span> <span class="n">emp</span> <span class="k">SET</span> <span class="n">sal</span> <span class="o">=</span> <span class="mi">4500</span> <span class="k">WHERE</span> <span class="n">empno</span> <span class="o">=</span> <span class="mi">7654</span><span class="p">;</span>

<span class="mi">1</span> <span class="n">fila</span> <span class="n">actualizada</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image20.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image20.png" alt="image" loading="lazy"></a></p>

<p>Al consultar la tabla de auditoría para la sesión de SCOTT, se generará solo un registro de auditoría que reflejará que se inició una sesión y se realizaron operaciones, pero no se detallarán de manera individual. Lo vemos a continuación:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">USERNAME</span><span class="p">,</span><span class="n">ACTION_NAME</span><span class="p">,</span><span class="nb">TIMESTAMP</span><span class="p">,</span> <span class="n">obj_name</span> 
<span class="k">FROM</span> <span class="n">DBA_AUDIT_OBJECT</span> 
<span class="k">WHERE</span> <span class="n">USERNAME</span><span class="o">=</span><span class="s1">'SCOTT'</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image21.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image21.png" alt="image" loading="lazy"></a>
<a href="/assets/img/posts/auditoria/image22.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image22.png" alt="image" loading="lazy"></a></p>

<p>Esto indica que SCOTT inició una sesión y realizó varias operaciones, pero no las desglosa. El número de ACTION puede variar, pero se registrará solo una vez por sesión.</p>

<h2 id="6-documenta-las-diferencias-entre-los-valores-db-y-db-extended-del-parámetro-audit_trail-de-oracle-demuéstralas-poniendo-un-ejemplo-de-la-información-sobre-una-operación-concreta-recopilada-con-cada-uno-de-ellos"><span class="me-2">6. Documenta las diferencias entre los valores db y db, extended del parámetro audit_trail de ORACLE. Demuéstralas poniendo un ejemplo de la información sobre una operación concreta recopilada con cada uno de ellos.</span><a href="#6-documenta-las-diferencias-entre-los-valores-db-y-db-extended-del-parámetro-audit_trail-de-oracle-demuéstralas-poniendo-un-ejemplo-de-la-información-sobre-una-operación-concreta-recopilada-con-cada-uno-de-ellos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>En Oracle, el parámetro <code class="language-plaintext highlighter-rouge">audit_trail</code> controla la configuración de la auditoría. Existen dos valores principales para este parámetro: <strong>db</strong> y <strong>db, extended</strong>, que se diferencian en el nivel de detalle que almacenan durante el proceso de auditoría.</p>

<ul>
  <li>
    <p><strong>db</strong>: Este valor permite auditar las operaciones en la base de datos, pero sin almacenar información detallada sobre los <strong>bind variables</strong> y el <strong>SQL ejecutado</strong>. Solo se guarda la información básica de la operación, como el nombre de la tabla, la acción realizada y la hora del evento.</p>
  </li>
  <li>
    <p><strong>db, extended</strong>: Este valor, en cambio, almacena un nivel de auditoría mucho más detallado. No solo guarda la información básica de la operación, sino que también captura el <strong>SQL ejecutado</strong> (el código SQL original) y las <strong>bind variables</strong> que fueron utilizadas en la operación. Esto proporciona un nivel de detalle mucho mayor, lo que es útil para auditar con precisión las acciones realizadas.</p>
  </li>
</ul>

<h3 id="db"><span class="me-2">db</span><a href="#db" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Para ver el valor por defecto de <code class="language-plaintext highlighter-rouge">audit_trail</code>, deberemos ejecutar la siguiente consulta:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">SHOW</span> <span class="k">PARAMETER</span> <span class="n">audit_trail</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image23.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image23.png" alt="image" loading="lazy"></a></p>

<p>Como podemos ver, el valor por defecto es “DB”. Si el valor de <code class="language-plaintext highlighter-rouge">audit_trail</code> es <strong>db</strong>, entonces solo se almacenará la información básica de las operaciones.</p>

<p>Podemos consultar la información que hemos recopilado a través de la auditoría de la base de datos utilizando la consulta correspondiente del ejercicio 3.</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">extended_timestamp</span> 
<span class="k">FROM</span> <span class="n">dba_audit_object</span> 
<span class="k">WHERE</span> <span class="n">username</span> <span class="o">=</span> <span class="s1">'PRUEBA'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">extended_timestamp</span> <span class="k">DESC</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image24.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image24.png" alt="image" loading="lazy"></a></p>

<p>Podemos ver que todos estos datos están almacenados mediante auditoría db.</p>

<h3 id="db-extended"><span class="me-2">db, extended</span><a href="#db-extended" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Para cambiar el parámetro a <strong>db, extended</strong> y habilitar la auditoría extendida, usamos el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">ALTER</span> <span class="k">SYSTEM</span> <span class="k">SET</span> <span class="n">audit_trail</span> <span class="o">=</span> <span class="n">DB</span><span class="p">,</span><span class="n">EXTENDED</span> <span class="k">SCOPE</span><span class="o">=</span><span class="n">SPFILE</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Luego, debemos reiniciar la base de datos para que los cambios tengan efecto:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">SHUTDOWN</span> <span class="k">IMMEDIATE</span><span class="p">;</span>
<span class="n">STARTUP</span><span class="p">;</span>
<span class="k">SHOW</span> <span class="k">PARAMETER</span> <span class="n">audit_trail</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image25.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image25.png" alt="image" loading="lazy"></a></p>

<p>Para ver cómo se registran las operaciones con la auditoría db, extended, realizaremos algunas acciones sobre una tabla. En este caso, creamos una tabla de prueba y ejecutamos varias operaciones sobre ella (insertar, actualizar y eliminar). Los comandos son los siguientes:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">CONNECT</span> <span class="n">scott</span><span class="o">/</span><span class="n">tiger</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">EMPLOYEES</span> <span class="p">(</span>
    <span class="n">EMP_ID</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">EMP_NAME</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">EMP_SALARY</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">EMP_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">EMPLOYEES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="s1">'Alice'</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>

<span class="k">UPDATE</span> <span class="n">EMPLOYEES</span> <span class="k">SET</span> <span class="n">EMP_SALARY</span> <span class="o">=</span> <span class="mi">5500</span> <span class="k">WHERE</span> <span class="n">EMP_ID</span> <span class="o">=</span> <span class="mi">101</span><span class="p">;</span>

<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">EMPLOYEES</span> <span class="k">WHERE</span> <span class="n">EMP_ID</span> <span class="o">=</span> <span class="mi">101</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image26.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image26.png" alt="image" loading="lazy"></a></p>

<p>Para ver los registros con el nivel extendido de auditoría, ejecutamos la siguiente consulta:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">USERNAME</span><span class="p">,</span> <span class="n">ACTION_NAME</span><span class="p">,</span> <span class="nb">TIMESTAMP</span><span class="p">,</span> <span class="n">OBJ_NAME</span><span class="p">,</span> <span class="n">SQL_TEXT</span><span class="p">,</span> <span class="n">SQL_BIND</span>
<span class="k">FROM</span> <span class="n">DBA_AUDIT_OBJECT</span>
<span class="k">WHERE</span> <span class="n">USERNAME</span> <span class="o">=</span> <span class="s1">'SCOTT'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="nb">TIMESTAMP</span> <span class="k">DESC</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Con la auditoría <strong>db, extended</strong> activada, veremos que la salida no solo incluirá la información básica (como el nombre de la tabla, la acción realizada y el timestamp), sino también:</p>

<ul>
  <li><strong>SQL_TEXT</strong>: El SQL que fue ejecutado. Esto incluye las instrucciones SQL completas.</li>
  <li><strong>SQL_BIND</strong>: Las bind variables utilizadas en la operación, lo cual nos da información detallada sobre los valores reales procesados por la base de datos.</li>
</ul>

<p>Esta es la salida que recibimos de la auditoría:</p>

<p><a href="/assets/img/posts/auditoria/image27.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image27.png" alt="image" loading="lazy"></a>
<a href="/assets/img/posts/auditoria/image28.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image28.png" alt="image" loading="lazy"></a>
<a href="/assets/img/posts/auditoria/image29.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image29.png" alt="image" loading="lazy"></a></p>

<h2 id="7-averigua-si-en-postgres-se-pueden-realizar-los-cuatro-primeros-apartados-si-es-así-documenta-el-proceso-adecuadamente"><span class="me-2">7. Averigua si en Postgres se pueden realizar los cuatro primeros apartados. Si es así, documenta el proceso adecuadamente.</span><a href="#7-averigua-si-en-postgres-se-pueden-realizar-los-cuatro-primeros-apartados-si-es-así-documenta-el-proceso-adecuadamente" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Para auditar eventos en PostgreSQL, existen diversas herramientas, entre ellas <code class="language-plaintext highlighter-rouge">pgAudit</code> y <code class="language-plaintext highlighter-rouge">Audit Trigger</code>. En este caso, utilizaremos <code class="language-plaintext highlighter-rouge">Audit Trigger</code>, que permite registrar cambios en las tablas de la base de datos de forma sencilla.</p>

<p>He decidido instalar esta funcionalidad en la base de datos postgres, aunque podría implementarse en cualquier otra base de datos dentro del servidor.</p>

<p>El proceso de instalación es bastante simple. En primer lugar, descargamos el archivo SQL necesario desde el repositorio oficial con el siguiente comando:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>wget https://raw.githubusercontent.com/2ndQuadrant/audit-trigger/master/audit.sql
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez descargado, accedemos al servidor PostgreSQL con el usuario postgres y ejecutamos el script SQL para instalar la extensión:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo</span> <span class="nt">-u</span> postgres psql
<span class="se">\i</span> audit.sql
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image30.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image30.png" alt="image" loading="lazy"></a></p>

<p>La salida indica que el script <code class="language-plaintext highlighter-rouge">audit.sql</code> ha creado la extensión, el esquema y varias estructuras necesarias para la auditoría, como tablas, índices, funciones y vistas. Además, se han aplicado restricciones de permisos (<code class="language-plaintext highlighter-rouge">REVOKE</code>) y comentarios (<code class="language-plaintext highlighter-rouge">COMMENT</code>) para documentar los elementos creados.</p>

<h3 id="ejercicio-1-auditoría-de-accesos-fallidos"><span class="me-2">Ejercicio 1: Auditoría de accesos fallidos</span><a href="#ejercicio-1-auditoría-de-accesos-fallidos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Para realizar una auditoría que registre los intentos de acceso fallidos en PostgreSQL, tendremos que configurar el sistema de logs de la base de datos para que almacene este tipo de eventos. PostgreSQL nos da varios parámetros que controlan la generación de registros relacionados con las conexiones y la autenticación.</p>

<p>El primer paso es habilitar el registro de conexiones en el sistema. Para ello, desde la consola de PostgreSQL, ejecutamos el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">postgres</span><span class="o">=#</span> <span class="k">ALTER</span> <span class="k">SYSTEM</span> <span class="k">SET</span> <span class="n">log_connections</span> <span class="o">=</span> <span class="s1">'ON'</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">SYSTEM</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Esto permite que PostgreSQL registre cada intento de conexión al servidor, lo que incluye tanto los accesos exitosos como los fallidos.</p>

<p>Tras aplicar estos cambios, reiniciamos el servicio de PostgreSQL para que la configuración tenga efecto:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pablo@servidor-postgre1:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl restart postgresql
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez reiniciado, los eventos de autenticación se almacenarán en el archivo de logs de PostgreSQL:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">tail</span> <span class="nt">-f</span> /var/log/postgresql/postgresql-15-main.log
</pre></td></tr></tbody></table></code></div></div>

<p>A continuación, se muestra un ejemplo de un intento de conexión fallido debido a una autenticación incorrecta:</p>

<p><a href="/assets/img/posts/auditoria/image32.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image32.png" alt="image" loading="lazy"></a></p>

<p>Aquí, el mensaje <strong>“FATAL: la autentificación password falló para el usuario «pablomh»”</strong> nos dice que hubo un intento de conexión fallido debido a una contraseña incorrecta. Además, la línea <strong>“DETALLE: La conexión coincidió con la línea 98 de pg_hba.conf”</strong> dice que la autenticación se realizó según la configuración establecida en el archivo <code class="language-plaintext highlighter-rouge">pg_hba.conf</code>, donde se especifica el método de autenticación <code class="language-plaintext highlighter-rouge">md5</code>.</p>

<h3 id="ejercicio-2-accesos-fallidos-junto-al-motivo"><span class="me-2">Ejercicio 2: Accesos fallidos junto al motivo</span><a href="#ejercicio-2-accesos-fallidos-junto-al-motivo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Pues al igual que en el ejercicio anterior, podemos revisar los logs y este nos dirá el motivo del acceso fallido. Aquí un ejemplo:</p>

<p><a href="/assets/img/posts/auditoria/image33.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image33.png" alt="image" loading="lazy"></a></p>

<h3 id="ejercicio-3-operaciones-dml"><span class="me-2">Ejercicio 3: Operaciones DML</span><a href="#ejercicio-3-operaciones-dml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Para llevar a cabo la auditoría de DML, utilizaremos la extensión <strong>Audit Trigger</strong>. Para ello, primero crearemos una tabla en la base de datos de Postgres. Luego, procederemos a insertar, actualizar y eliminar datos dentro de la base de datos SCOTT.</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="n">postgres</span><span class="o">=#</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">'VENTAS'</span><span class="p">,</span> <span class="s1">'SEVILLA'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="s1">'COMPRAS'</span><span class="p">,</span> <span class="s1">'CADIZ'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="s1">'CONTABILIDAD'</span><span class="p">,</span> <span class="s1">'GRANADA'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="s1">'VENTAS'</span><span class="p">,</span> <span class="s1">'HUELVA'</span><span class="p">);</span>
    
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">DEPT</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">DEPT</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">110</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">DEPT</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">DEPT</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">130</span><span class="p">;</span>

<span class="k">UPDATE</span> <span class="n">DEPT</span> <span class="k">SET</span> <span class="n">LOC</span> <span class="o">=</span> <span class="s1">'SEVILLA'</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">DEPT</span> <span class="k">SET</span> <span class="n">LOC</span> <span class="o">=</span> <span class="s1">'CADIZ'</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">DEPT</span> <span class="k">SET</span> <span class="n">LOC</span> <span class="o">=</span> <span class="s1">'GRANADA'</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">DEPT</span> <span class="k">SET</span> <span class="n">LOC</span> <span class="o">=</span> <span class="s1">'HUELVA'</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="k">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="k">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="k">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="k">DELETE</span> <span class="mi">1</span>
<span class="k">DELETE</span> <span class="mi">1</span>
<span class="k">DELETE</span> <span class="mi">1</span>
<span class="k">DELETE</span> <span class="mi">1</span>
<span class="k">UPDATE</span> <span class="mi">1</span>
<span class="k">UPDATE</span> <span class="mi">1</span>
<span class="k">UPDATE</span> <span class="mi">1</span>
<span class="k">UPDATE</span> <span class="mi">1</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez que hayamos realizado las operaciones de inserción, actualización y eliminación, procederemos a verificar la extensión Audit Trigger para asegurarnos de que la auditoría se ha ejecutado correctamente. Esto nos permitirá confirmar que las acciones realizadas sobre la base de datos han sido registradas adecuadamente, lo cual es fundamental para revisar el historial de cambios y asegurar la integridad de las operaciones realizadas.</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">audit</span><span class="p">.</span><span class="n">audit_table</span><span class="p">(</span><span class="s1">'DEPT'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image34.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image34.png" alt="image" loading="lazy"></a></p>

<p>Para poder ver los datos de la auditoría, primero nos conectaremos a la base de datos como el usuario postgres. Una vez dentro de la base de datos que estamos auditando, ejecutaremos la consulta correspondiente para visualizar los registros generados por la extensión Audit Trigger. Esto nos permitirá revisar las auditorías de las operaciones DML (inserciones, actualizaciones y eliminaciones) realizadas.</p>

<p>La consulta que debemos ejecutar:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">session_user_name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="k">table_name</span><span class="p">,</span> <span class="n">action_tstamp_clk</span><span class="p">,</span> <span class="n">client_query</span> 
<span class="k">FROM</span> <span class="n">audit</span><span class="p">.</span><span class="n">logged_actions</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image35.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image35.png" alt="image" loading="lazy"></a></p>

<p>Como se puede apreciar en la imagen, la información registrada por la auditoría incluye varios detalles clave. Entre ellos, podemos observar el nombre del usuario que ejecutó la acción, el tipo de operación realizada (ya sea un <strong>Insert</strong>, <strong>Update</strong> o <strong>Delete</strong>), la tabla sobre la cual se ejecutó la acción, así como la fecha y la hora exacta en la que se llevó a cabo la operación. Además, también se muestra la consulta SQL que fue ejecutada para realizar la acción, lo que proporciona una trazabilidad completa de las operaciones realizadas en la base de datos.</p>

<h3 id="ejercicio-4-auditoría-grano-fino"><span class="me-2">Ejercicio 4: Auditoría grano fino</span><a href="#ejercicio-4-auditoría-grano-fino" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Lo primero que necesitamos hacer es crear una tabla para almacenar la información sobre las inserciones que queremos auditar. En esta tabla vamos a registrar el usuario que realizó la inserción, el nombre de la tabla afectada, el esquema de la tabla, la operación realizada y la fecha y hora de la operación. Para esto, usamos el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">public</span><span class="p">.</span><span class="n">audit_emp_commission</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">db_user</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">object_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">object_schema</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="k">operation</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="nb">timestamp</span> <span class="n">TIMESTAMPTZ</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image37.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image37.png" alt="image" loading="lazy"></a></p>

<p>Con esta tabla creamos el esquema básico para registrar las operaciones que vamos a auditar, en este caso, las inserciones de empleados con comisión.</p>

<p>Luego, necesitamos crear una función que se activará cuando se inserte un registro en la tabla <code class="language-plaintext highlighter-rouge">emp</code>. La función verificará si el campo <code class="language-plaintext highlighter-rouge">comm</code> (comisión) del nuevo registro es diferente de NULL. Si tiene comisión, insertará un registro en la tabla de auditoría con la información relevante.</p>

<p>La función se escribe así:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="k">public</span><span class="p">.</span><span class="n">audit_emp_commission</span><span class="p">()</span>
<span class="k">RETURNS</span> <span class="k">TRIGGER</span> <span class="k">AS</span> <span class="err">$$</span>
<span class="k">BEGIN</span>
    <span class="n">IF</span> <span class="k">NEW</span><span class="p">.</span><span class="n">comm</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">THEN</span>
        <span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">public</span><span class="p">.</span><span class="n">audit_emp_commission</span> <span class="p">(</span>
            <span class="n">db_user</span><span class="p">,</span>
            <span class="n">object_name</span><span class="p">,</span>
            <span class="n">object_schema</span><span class="p">,</span>
            <span class="k">operation</span>
        <span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span>
            <span class="k">CURRENT_USER</span><span class="p">,</span>
            <span class="n">TG_TABLE_NAME</span><span class="p">,</span>
            <span class="n">TG_TABLE_SCHEMA</span><span class="p">,</span>
            <span class="n">TG_OP</span>
        <span class="p">);</span>
    <span class="k">END</span> <span class="n">IF</span><span class="p">;</span>
    <span class="k">RETURN</span> <span class="k">NEW</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="err">$$</span> <span class="k">LANGUAGE</span> <span class="n">plpgsql</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image36.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image36.png" alt="image" loading="lazy"></a></p>

<p>En esta función, el <code class="language-plaintext highlighter-rouge">IF NEW.comm IS NOT NULL</code> nos asegura que solo se registre la operación si el campo <code class="language-plaintext highlighter-rouge">comm</code> (comisión) no es nulo, es decir, si el empleado tiene una comisión.</p>

<p>Con la función lista, necesitamos crear un trigger que se active después de cada inserción en la tabla emp. El trigger llamará a la función de auditoría para registrar la operación en la tabla de auditoría cuando se inserte un empleado con una comisión.</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TRIGGER</span> <span class="n">emp_commission_audit_trigger</span>
<span class="k">AFTER</span> <span class="k">INSERT</span> <span class="k">ON</span> <span class="k">public</span><span class="p">.</span><span class="n">emp</span>
<span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
<span class="k">EXECUTE</span> <span class="k">FUNCTION</span> <span class="k">public</span><span class="p">.</span><span class="n">audit_emp_commission</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image38.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image38.png" alt="image" loading="lazy"></a></p>

<p>Este trigger se ejecutará después de cada inserción en la tabla <code class="language-plaintext highlighter-rouge">emp</code>, y si la inserción es de un empleado con una comisión, la función de auditoría insertará un registro en la tabla <code class="language-plaintext highlighter-rouge">audit_emp_commission</code>.</p>

<p>Ahora, podemos probar que todo funciona correctamente. Vamos a insertar un nuevo empleado en la tabla emp que tenga una comisión. Por ejemplo:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">public</span><span class="p">.</span><span class="n">emp</span> <span class="p">(</span><span class="n">empno</span><span class="p">,</span> <span class="n">ename</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">mgr</span><span class="p">,</span> <span class="n">hiredate</span><span class="p">,</span> <span class="n">sal</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">deptno</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="s1">'Juan'</span><span class="p">,</span> <span class="s1">'CLERK'</span><span class="p">,</span> <span class="mi">7839</span><span class="p">,</span> <span class="s1">'2025-02-25'</span><span class="p">,</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Finalmente, para ver si la auditoría se ha realizado correctamente, podemos consultar la tabla de auditoría. Ejecutamos la siguiente consulta:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">public</span><span class="p">.</span><span class="n">audit_emp_commission</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image39.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image39.png" alt="image" loading="lazy"></a></p>

<p>Con esto, hemos configurado la auditoría para registrar todas las inserciones de empleados con comisión en la tabla <code class="language-plaintext highlighter-rouge">emp</code> del esquema <code class="language-plaintext highlighter-rouge">scott</code>. Cada vez que se inserte un nuevo empleado con comisión, se registrará una entrada en la tabla de auditoría.</p>

<h2 id="8-averigua-si-en-mysql-se-pueden-realizar-los-apartados-1-3-y-4-si-es-así-documenta-el-proceso-adecuadamente"><span class="me-2">8. Averigua si en MySQL se pueden realizar los apartados 1, 3 y 4. Si es así, documenta el proceso adecuadamente.</span><a href="#8-averigua-si-en-mysql-se-pueden-realizar-los-apartados-1-3-y-4-si-es-así-documenta-el-proceso-adecuadamente" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Para llevar a cabo una auditoría en MySQL, necesitaremos crear dos bases de datos. La auditoría se realizará utilizando el plugin <em>server_audit</em>, el cual nos permite registrar y monitorear las acciones que se ejecutan en el servidor de MySQL.</p>

<p>Para instalar este plugin, debemos ejecutar el comando <code class="language-plaintext highlighter-rouge">INSTALL SONAME 'server_audit';</code> mientras estamos conectados al servidor de bases de datos.</p>

<p><a href="/assets/img/posts/auditoria/image40.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image40.png" alt="image" loading="lazy"></a></p>

<h3 id="ejercicio-1-auditoría-de-accesos-fallidos-1"><span class="me-2">Ejercicio 1: Auditoría de accesos fallidos</span><a href="#ejercicio-1-auditoría-de-accesos-fallidos-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Una vez instalado el plugin, será necesario modificar el archivo de configuración de MySQL. Este archivo se encuentra en la ruta <code class="language-plaintext highlighter-rouge">/etc/mysql/mariadb.conf.d/50-server.cnf</code>. En él, deberemos realizar las configuraciones necesarias para habilitar y personalizar el comportamiento del plugin de auditoría, asegurándonos de que las acciones de auditoría sean registradas adecuadamente según nuestras necesidades.</p>

<p><a href="/assets/img/posts/auditoria/image41.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image41.png" alt="image" loading="lazy"></a></p>

<p>Ahora voy a crear un directorio para almacenar logs, asignar los permisos necesarios para que el servidor de bases de datos pueda escribir en ese directorio y, por último, reiniciar el servicio de MariaDB para que los cambios tengan efecto.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo mkdir</span> /var/log/mysql/
pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo chown </span>mysql: /var/log/mysql/
pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl restart mariadb.service
</pre></td></tr></tbody></table></code></div></div>

<p>Después de reiniciar el servicio, verificaremos que la auditoría esté funcionando correctamente. Para esto, realizaremos intentos de acceso fallidos y exitosos, y así comprobar que se registre todo adecuadamente.</p>

<p><a href="/assets/img/posts/auditoria/image42.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image42.png" alt="image" loading="lazy"></a></p>

<h3 id="ejercicio-3-operaciones-dml-1"><span class="me-2">Ejercicio 3: Operaciones DML</span><a href="#ejercicio-3-operaciones-dml-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Este este ejercicio hay que modificar el archivo de configuración de MySQL/MariaDB, que se encuentra en la ruta <code class="language-plaintext highlighter-rouge">/etc/mysql/mariadb.conf.d/50-server.cnf</code>. Una vez dentro tendremos que añadir las siguientes líneas:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nv">server_audit_events</span><span class="o">=</span>CONNECT,QUERY,TABLE
<span class="nv">server_audit_logging</span><span class="o">=</span>ON
<span class="nv">server_audit_incl_users</span><span class="o">=</span>scott
<span class="nv">server_audit_file_path</span><span class="o">=</span>/var/log/mysql/audit.log
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image43.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image43.png" alt="image" loading="lazy"></a></p>

<p>Después de modificar el fichero de configuración, tendremos que reiniciar el servicio:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl restart mariadb.service
</pre></td></tr></tbody></table></code></div></div>

<p>Para las pruebas utilizaré las tablas del esquema <a href="https://github.com/PabloMartin19/schema_scott/blob/main/scott.sql">scott</a>.</p>

<p>Por lo que accedemos con el usuario scott que es el que contiene las tablas, y realizamos alguna operación para que se registren:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp</span> <span class="k">VALUES</span><span class="p">(</span><span class="mi">7777</span><span class="p">,</span> <span class="s1">'JACINTO'</span><span class="p">,</span> <span class="s1">'CAUDILLO'</span><span class="p">,</span> <span class="mi">7902</span><span class="p">,</span> <span class="s1">'2025-02-26'</span><span class="p">,</span> <span class="mi">999</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp</span> <span class="k">SET</span> <span class="n">sal</span> <span class="o">=</span> <span class="mi">1509</span> <span class="k">WHERE</span> <span class="n">empno</span> <span class="o">=</span> <span class="mi">7777</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp</span> <span class="k">WHERE</span> <span class="n">empno</span> <span class="o">=</span> <span class="mi">7777</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image44.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image44.png" alt="image" loading="lazy"></a></p>

<p>Una vez realizadas las operaciones, nos salimos y miramos el log:</p>

<p><a href="/assets/img/posts/auditoria/image45.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image45.png" alt="image" loading="lazy"></a></p>

<p>Donde podemos observar que se han registrado correctamente.</p>

<h3 id="ejercicio-4-auditoría-grano-fino-1"><span class="me-2">Ejercicio 4: Auditoría grano fino</span><a href="#ejercicio-4-auditoría-grano-fino-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Para la auditoría que registre la inserción de empleados con comisión en la tabla emp de la base de datos scott, 
tendremos que crear una tabla de auditoría. Esta tabla almacenará información clave como el identificador del empleado, su nombre, el monto de la comisión, el momento en que se realizó la inserción y el tipo de acción registrada.</p>

<p>La estructura de la tabla de auditoría se define de la siguiente manera:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp_auditoria</span> <span class="p">(</span>
    <span class="n">audit_id</span> <span class="nb">INT</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">empno</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">ename</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">comm</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">action_time</span> <span class="nb">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
    <span class="n">action_type</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image46.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image46.png" alt="image" loading="lazy"></a></p>

<p>Una vez creada la tabla, el siguiente paso es configurar un <strong>trigger</strong> que se active cada vez que se realice una inserción en la 
tabla <code class="language-plaintext highlighter-rouge">emp</code>. Este trigger verificará si el campo <code class="language-plaintext highlighter-rouge">comm</code> tiene un valor distinto de <code class="language-plaintext highlighter-rouge">NULL</code>, lo que indicaría que el empleado 
recibe una comisión. En caso afirmativo, se insertará un nuevo registro en <code class="language-plaintext highlighter-rouge">emp_auditoria</code> con los datos correspondientes.</p>

<p>El trigger se define de la siguiente forma:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">DELIMITER</span> <span class="err">$$</span>

<span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">audit_emp_insercion</span>
<span class="k">AFTER</span> <span class="k">INSERT</span> <span class="k">ON</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp</span>
<span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
<span class="k">BEGIN</span>
    <span class="n">IF</span> <span class="k">NEW</span><span class="p">.</span><span class="n">comm</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">THEN</span>
        <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp_auditoria</span> <span class="p">(</span><span class="n">empno</span><span class="p">,</span> <span class="n">ename</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">action_type</span><span class="p">)</span>
        <span class="k">VALUES</span> <span class="p">(</span><span class="k">NEW</span><span class="p">.</span><span class="n">empno</span><span class="p">,</span> <span class="k">NEW</span><span class="p">.</span><span class="n">ename</span><span class="p">,</span> <span class="k">NEW</span><span class="p">.</span><span class="n">comm</span><span class="p">,</span> <span class="s1">'INSERT'</span><span class="p">);</span>
    <span class="k">END</span> <span class="n">IF</span><span class="p">;</span>
<span class="k">END</span> <span class="err">$$</span>

<span class="k">DELIMITER</span> <span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image47.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image47.png" alt="image" loading="lazy"></a></p>

<p>Después de crear el trigger, es momento de comprobar su funcionamiento insertando algunos empleados en la tabla <code class="language-plaintext highlighter-rouge">emp</code>. Por ejemplo:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7904</span><span class="p">,</span> <span class="s1">'ERWIN'</span><span class="p">,</span> <span class="s1">'SMITH'</span><span class="p">,</span> <span class="mi">7839</span><span class="p">,</span> <span class="s1">'1981-05-15'</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7901</span><span class="p">,</span> <span class="s1">'MIKASA'</span><span class="p">,</span> <span class="s1">'ACKERMAN'</span><span class="p">,</span> <span class="mi">7839</span><span class="p">,</span> <span class="s1">'1981-06-10'</span><span class="p">,</span> <span class="mi">3200</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7905</span><span class="p">,</span> <span class="s1">'KIPSTA'</span><span class="p">,</span> <span class="s1">'ACKERMAN'</span><span class="p">,</span> <span class="mi">7839</span><span class="p">,</span> <span class="s1">'1981-07-20'</span><span class="p">,</span> <span class="mi">3300</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Ahora, si consultamos la tabla <code class="language-plaintext highlighter-rouge">emp_auditoria</code>, deberíamos ver que los registros de los empleados con comisión han sido almacenados correctamente:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp_auditoria</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image48.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image48.png" alt="image" loading="lazy"></a></p>

<p>De este modo, se confirma que la auditoría funciona correctamente, registrando únicamente aquellos empleados que tienen una comisión asignada.</p>

<h2 id="9-averigua-las-posibilidades-que-ofrece-mongodb-para-auditar-los-cambios-que-va-sufriendo-un-documento-demuestra-su-funcionamiento"><span class="me-2">9. Averigua las posibilidades que ofrece MongoDB para auditar los cambios que va sufriendo un documento. Demuestra su funcionamiento.</span><a href="#9-averigua-las-posibilidades-que-ofrece-mongodb-para-auditar-los-cambios-que-va-sufriendo-un-documento-demuestra-su-funcionamiento" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Para auditar los cambios que sufren los documentos en MongoDB, necesitaremos la versión <strong>Enterprise</strong>, ya que solo esta edición permite habilitar la auditoría de eventos. Para la instalación de esta versión he seguido la <a href="https://www.mongodb.com/pt-br/docs/manual/tutorial/install-mongodb-enterprise-on-debian/#install-mongodb-enterprise-edition">página oficial</a>:</p>

<p>Una vez tengamos esta versión instalada, podemos configurar MongoDB para registrar todas las operaciones que se realicen sobre la base de datos. Aquí la comprobación de que realmente tenemos instalado la versión Enterprise:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>vagrant@mongo:~<span class="nv">$ </span>mongod <span class="nt">--version</span>
db version v8.0.5
Build Info: <span class="o">{</span>
    <span class="s2">"version"</span>: <span class="s2">"8.0.5"</span>,
    <span class="s2">"gitVersion"</span>: <span class="s2">"cb9e2e5e552ee39dea1e39d7859336456d0c9820"</span>,
    <span class="s2">"openSSLVersion"</span>: <span class="s2">"OpenSSL 3.0.15 3 Sep 2024"</span>,
    <span class="s2">"modules"</span>: <span class="o">[</span>
        <span class="s2">"enterprise"</span>
    <span class="o">]</span>,
    <span class="s2">"allocator"</span>: <span class="s2">"tcmalloc-google"</span>,
    <span class="s2">"environment"</span>: <span class="o">{</span>
        <span class="s2">"distmod"</span>: <span class="s2">"debian12"</span>,
        <span class="s2">"distarch"</span>: <span class="s2">"x86_64"</span>,
        <span class="s2">"target_arch"</span>: <span class="s2">"x86_64"</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>MongoDB nos ofrece cuatro formas de almacenar los registros de auditoría: podemos enviarlos directamente a la consola, redirigirlos al <strong>syslog</strong>, guardarlos en un archivo en formato <strong>JSON</strong> o <strong>BSON</strong>, o configurar la auditoría a través del archivo de configuración de MongoDB.</p>

<p>Si queremos ver los registros en la consola mientras ejecutamos MongoDB, podemos iniciar el servicio con:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>mongod <span class="nt">--dbpath</span> data/db <span class="nt">--auditDestination</span> console
</pre></td></tr></tbody></table></code></div></div>

<p>Si preferimos que los eventos queden almacenados en el syslog, usamos:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>mongod <span class="nt">--dbpath</span> data/db <span class="nt">--auditDestination</span> syslog
</pre></td></tr></tbody></table></code></div></div>

<p>En caso de querer registrar los eventos en un archivo JSON o BSON, podemos utilizar las siguientes opciones:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>mongod <span class="nt">--dbpath</span> data/db <span class="nt">--auditDestination</span> file <span class="nt">--auditFormat</span> JSON <span class="nt">--auditPath</span> data/db/auditLog.json
mongod <span class="nt">--dbpath</span> data/db <span class="nt">--auditDestination</span> file <span class="nt">--auditFormat</span> BSON <span class="nt">--auditPath</span> data/db/auditLog.bson
</pre></td></tr></tbody></table></code></div></div>

<p>También podemos configurar la auditoría desde el archivo de configuración de MongoDB (<code class="language-plaintext highlighter-rouge">/etc/mongod.conf</code>). En nuestro caso, optaremos por almacenar los registros en un archivo <strong>JSON</strong> para facilitar su lectura y análisis. Para ello, editamos el archivo de configuración:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>nano /etc/mongod.conf
</pre></td></tr></tbody></table></code></div></div>

<p>Y añadimos la siguiente configuración:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>auditLog:
  destination: file
  format: JSON
  path: /var/log/mongodb/auditLog.json
</pre></td></tr></tbody></table></code></div></div>

<p>Con esto, MongoDB registrará información detallada sobre los cambios que se realicen en los documentos. Para aplicar los cambios, reiniciamos el servicio:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl restart mongod
</pre></td></tr></tbody></table></code></div></div>

<p>Antes de comenzar a trabajar con los registros de auditoría, instalaremos jq, una herramienta que nos ayudará a visualizar los archivos JSON desde la terminal:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>jq <span class="nt">-y</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Creación de una colección y prueba de auditoría</strong></p>

<p>Primero, vamos a crear una colección llamada “productos”, donde definiremos un esquema que validará ciertos campos para asegurar que se ingresen correctamente los datos. En este caso, vamos a exigir que cada producto tenga un código de producto, un nombre, una categoría, y un precio. Los datos deben cumplir con ciertas reglas de longitud para cada campo.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">createCollection</span><span class="p">(</span><span class="dl">"</span><span class="s2">productos</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">validator</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">$jsonSchema</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">bsonType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">object</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">required</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">codigo_producto</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">nombre</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">categoria</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">precio</span><span class="dl">"</span><span class="p">],</span>
            <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">codigo_producto</span><span class="p">:</span> <span class="p">{</span> <span class="na">bsonType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span> <span class="na">maxLength</span><span class="p">:</span> <span class="mi">10</span> <span class="p">},</span>
                <span class="na">nombre</span><span class="p">:</span> <span class="p">{</span> <span class="na">bsonType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span> <span class="na">maxLength</span><span class="p">:</span> <span class="mi">100</span> <span class="p">},</span>
                <span class="na">categoria</span><span class="p">:</span> <span class="p">{</span> <span class="na">bsonType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span> <span class="na">maxLength</span><span class="p">:</span> <span class="mi">50</span> <span class="p">},</span>
                <span class="na">precio</span><span class="p">:</span> <span class="p">{</span> <span class="na">bsonType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">double</span><span class="dl">"</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image49.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image49.png" alt="image" loading="lazy"></a></p>

<p>Cuando creamos la colección con éxito, esta configuración asegura que solo se puedan insertar documentos que tengan estos campos obligatorios y dentro de los límites establecidos.</p>

<p><strong>Insertar datos en la colección</strong></p>

<p>A continuación, insertamos varios productos en la colección productos. Para ello, vamos a insertar algunos documentos representando distintos productos disponibles en la tienda, con su código, nombre, categoría y precio.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">productos</span><span class="p">.</span><span class="nf">insertMany</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">codigo_producto</span><span class="p">:</span> <span class="dl">"</span><span class="s2">A001</span><span class="dl">"</span><span class="p">,</span> <span class="na">nombre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Camiseta Roja</span><span class="dl">"</span><span class="p">,</span> <span class="na">categoria</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ropa</span><span class="dl">"</span><span class="p">,</span> <span class="na">precio</span><span class="p">:</span> <span class="mf">19.99</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">codigo_producto</span><span class="p">:</span> <span class="dl">"</span><span class="s2">B002</span><span class="dl">"</span><span class="p">,</span> <span class="na">nombre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Zapatos de Cuero</span><span class="dl">"</span><span class="p">,</span> <span class="na">categoria</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Calzado</span><span class="dl">"</span><span class="p">,</span> <span class="na">precio</span><span class="p">:</span> <span class="mf">49.99</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">codigo_producto</span><span class="p">:</span> <span class="dl">"</span><span class="s2">C003</span><span class="dl">"</span><span class="p">,</span> <span class="na">nombre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gafas de Sol</span><span class="dl">"</span><span class="p">,</span> <span class="na">categoria</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Accesorios</span><span class="dl">"</span><span class="p">,</span> <span class="na">precio</span><span class="p">:</span> <span class="mf">25.50</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">codigo_producto</span><span class="p">:</span> <span class="dl">"</span><span class="s2">D004</span><span class="dl">"</span><span class="p">,</span> <span class="na">nombre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Chaqueta de Invierno</span><span class="dl">"</span><span class="p">,</span> <span class="na">categoria</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ropa</span><span class="dl">"</span><span class="p">,</span> <span class="na">precio</span><span class="p">:</span> <span class="mf">89.99</span> <span class="p">}</span>
<span class="p">])</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image50.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image50.png" alt="image" loading="lazy"></a></p>

<p>Con estos documentos insertados, hemos registrado una pequeña parte de los productos disponibles en nuestra tienda.</p>

<p><strong>Realizar cambios en los documentos</strong></p>

<p>Vamos a actualizar el precio de un producto, por ejemplo, de “Camiseta Roja” de <strong>19.99</strong> a <strong>18.99</strong>.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">productos</span><span class="p">.</span><span class="nf">updateOne</span><span class="p">(</span>
   <span class="p">{</span> <span class="na">codigo_producto</span><span class="p">:</span> <span class="dl">"</span><span class="s2">A001</span><span class="dl">"</span> <span class="p">},</span>
   <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">precio</span><span class="p">:</span> <span class="mf">18.99</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image51.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image51.png" alt="image" loading="lazy"></a></p>

<p>Eliminamos el producto con el código de producto “C003” (las gafas de sol):</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">productos</span><span class="p">.</span><span class="nf">deleteOne</span><span class="p">({</span> <span class="na">codigo_producto</span><span class="p">:</span> <span class="dl">"</span><span class="s2">C003</span><span class="dl">"</span> <span class="p">})</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image52.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image52.png" alt="image" loading="lazy"></a></p>

<p><strong>Crear un rol y un usuario</strong></p>

<p>En este caso, vamos a crear un rol de solo lectura para la colección <strong>productos</strong>, para que los usuarios con este rol solo puedan consultar los productos, pero no realizar modificaciones. A continuación, creamos un rol llamado “<strong>lectura_productos</strong>” y luego asignamos ese rol a un usuario llamado “<strong>juan</strong>”.</p>

<p>Creamos el rol lectura_productos:</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">createRole</span><span class="p">({</span>
    <span class="na">role</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lectura_productos</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">privileges</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="na">resource</span><span class="p">:</span> <span class="p">{</span> <span class="na">db</span><span class="p">:</span> <span class="dl">"</span><span class="s2">productos</span><span class="dl">"</span><span class="p">,</span> <span class="na">collection</span><span class="p">:</span> <span class="dl">"</span><span class="s2">productos</span><span class="dl">"</span> <span class="p">},</span>
            <span class="na">actions</span><span class="p">:</span> <span class="p">[</span> <span class="dl">"</span><span class="s2">find</span><span class="dl">"</span> <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="na">roles</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image53.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image53.png" alt="image" loading="lazy"></a></p>

<p>Creamos el usuario pavlo con el rol lectura_productos:</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nx">db</span><span class="p">.</span><span class="nf">createUser</span><span class="p">({</span>
    <span class="na">user</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pavlo</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">pwd</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pavlo1234</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">roles</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">lectura_productos</span><span class="dl">"</span><span class="p">]</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image54.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image54.png" alt="image" loading="lazy"></a></p>

<p>Finalmente, una vez que tenemos los datos insertados, los cambios realizados, y el rol/usuario configurado, podemos empezar a revisar los registros de auditoría.</p>

<p>Abrimos el archivo de auditoría en tiempo real usando jq para visualizar los eventos en formato JSON, lo cual nos permite filtrar y entender las operaciones más fácilmente:</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
</pre></td><td class="rouge-code"><pre><span class="nx">vagrant</span><span class="p">@</span><span class="nd">mongo</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">tail</span> <span class="o">-</span><span class="nx">f</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/log/m</span><span class="nx">ongodb</span><span class="o">/</span><span class="nx">auditLog</span><span class="p">.</span><span class="nx">json</span> <span class="o">|</span> <span class="nx">jq</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">createIndex</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:15:49.008+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gm0NSSdOSuKmDjXIQV/xrw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42096</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin.system.roles</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">role_1_db_1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexSpec</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">v</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">unique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">key</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">role</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">db</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">role_1_db_1</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">indexBuildState</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IndexBuildStarted</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">createIndex</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:15:49.013+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gm0NSSdOSuKmDjXIQV/xrw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42096</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin.system.roles</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">role_1_db_1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexSpec</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">v</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">unique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">key</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">role</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">db</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">role_1_db_1</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">indexBuildState</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IndexBuildSucceeded</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">directAuthMutation</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:15:49.013+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gm0NSSdOSuKmDjXIQV/xrw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42096</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">document</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin.lectura_productos</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">role</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lectura_productos</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">db</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">privileges</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">resource</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">db</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">productos</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">collection</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">productos</span><span class="dl">"</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">actions</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
            <span class="dl">"</span><span class="s2">find</span><span class="dl">"</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin.system.roles</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">operation</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">insert</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">clientMetadata</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:15:56.587+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lANCxt3YT3O6RPm1/w9kWw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">33144</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">localEndpoint</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">clientMetadata</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">application</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mongosh 2.4.0</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">driver</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nodejs|mongosh</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">6.13.0|2.4.0</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">platform</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Node.js v20.18.3, LE</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">os</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">linux</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">architecture</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">x64</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">3.10.0-327.22.2.el7.x86_64</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Linux</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">createUser</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:16:46.226+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gm0NSSdOSuKmDjXIQV/xrw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42096</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pavlo</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">db</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">role</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lectura_productos</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">db</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">createCollection</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:16:46.226+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gm0NSSdOSuKmDjXIQV/xrw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42096</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin.system.users</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">createIndex</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:16:46.241+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gm0NSSdOSuKmDjXIQV/xrw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42096</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin.system.users</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id_</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexSpec</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">v</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">key</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id_</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">indexBuildState</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IndexBuildStarted</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">createIndex</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:16:46.246+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gm0NSSdOSuKmDjXIQV/xrw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42096</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin.system.users</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id_</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexSpec</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">v</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">key</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id_</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">indexBuildState</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IndexBuildSucceeded</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">createIndex</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:16:46.246+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gm0NSSdOSuKmDjXIQV/xrw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42096</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin.system.users</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user_1_db_1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexSpec</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">v</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">unique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">key</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">db</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user_1_db_1</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">indexBuildState</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IndexBuildStarted</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">createIndex</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:16:46.251+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gm0NSSdOSuKmDjXIQV/xrw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42096</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin.system.users</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user_1_db_1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexSpec</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">v</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">unique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">key</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">db</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user_1_db_1</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">indexBuildState</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IndexBuildSucceeded</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="10-averigua-si-en-mongodb-se-pueden-auditar-los-accesos-a-una-colección-concreta-demuestra-su-funcionamiento"><span class="me-2">10. Averigua si en MongoDB se pueden auditar los accesos a una colección concreta. Demuestra su funcionamiento.</span><a href="#10-averigua-si-en-mongodb-se-pueden-auditar-los-accesos-a-una-colección-concreta-demuestra-su-funcionamiento" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Para auditar los accesos a una colección específica en MongoDB Enterprise, debemos configurar el sistema de auditoría en el archivo de configuración de MongoDB, como se muestra a continuación. En este caso, vamos a auditar las operaciones realizadas sobre la colección llamada <strong>Productos</strong> dentro de la base de datos tienda.</p>

<p>Primero, editamos el archivo de configuración de MongoDB, que usualmente se encuentra en <code class="language-plaintext highlighter-rouge">/etc/mongod.conf</code>. Utilizamos el siguiente comando para abrirlo:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>nano /etc/mongod.conf
</pre></td></tr></tbody></table></code></div></div>

<p>Dentro del archivo de configuración, añadimos una sección de auditoría como esta:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>auditLog:
   destination: file
   format: JSON
   path: /var/log/mongodb/auditLog_productos.json
   filter: <span class="s1">'{ atype: "authCheck", "param.ns": "tienda.Productos", "param.command": { $in: ["insert", "update", "delete", "find"] } }'</span>

setParameter: <span class="o">{</span> auditAuthorizationSuccess: <span class="nb">true</span> <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Este bloque configura MongoDB para registrar en un archivo los eventos de auditoría relacionados con las operaciones de insertar, actualizar, eliminar y consultar en la colección <strong>Productos</strong> dentro de la base de datos <strong>tienda</strong>. Asegúrate de guardar el archivo después de hacer los cambios.</p>

<p>Una vez hecho esto, reiniciamos el servicio de MongoDB para que los cambios surtan efecto:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl restart mongod
</pre></td></tr></tbody></table></code></div></div>

<p>Ahora que la auditoría está configurada, vamos a realizar algunas operaciones en la colección <strong>Productos</strong> para asegurarnos de que se están registrando correctamente.</p>

<ul>
  <li>
    <p>Insertamos un nuevo documento en la colección Productos:</p>

    <div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  <span class="nx">db</span><span class="p">.</span><span class="nx">Productos</span><span class="p">.</span><span class="nf">insertOne</span><span class="p">({</span> <span class="na">codigo</span><span class="p">:</span> <span class="dl">"</span><span class="s2">P1001</span><span class="dl">"</span><span class="p">,</span> <span class="na">nombre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Silla</span><span class="dl">"</span><span class="p">,</span> <span class="na">precio</span><span class="p">:</span> <span class="mf">25.50</span><span class="p">,</span> <span class="na">stock</span><span class="p">:</span> <span class="mi">100</span> <span class="p">})</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p><a href="/assets/img/posts/auditoria/image55.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image55.png" alt="image" loading="lazy"></a></p>
  </li>
  <li>
    <p>Realizamos una actualización en un documento existente de la colección Productos:</p>

    <div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>  <span class="nx">db</span><span class="p">.</span><span class="nx">Productos</span><span class="p">.</span><span class="nf">updateOne</span><span class="p">(</span>
     <span class="p">{</span> <span class="na">codigo</span><span class="p">:</span> <span class="dl">"</span><span class="s2">P1001</span><span class="dl">"</span> <span class="p">},</span>
     <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">precio</span><span class="p">:</span> <span class="mf">27.00</span> <span class="p">}</span> <span class="p">}</span>
  <span class="p">)</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p><a href="/assets/img/posts/auditoria/image56.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image56.png" alt="image" loading="lazy"></a></p>
  </li>
  <li>
    <p>Eliminamos un documento de la colección Productos:</p>

    <div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  <span class="nx">db</span><span class="p">.</span><span class="nx">Productos</span><span class="p">.</span><span class="nf">deleteOne</span><span class="p">({</span> <span class="na">nombre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mesa</span><span class="dl">"</span> <span class="p">})</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p><a href="/assets/img/posts/auditoria/image57.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image57.png" alt="image" loading="lazy"></a></p>
  </li>
</ul>

<p>Ahora que hemos realizado estas operaciones, podemos revisar el archivo de auditoría que se generó en <code class="language-plaintext highlighter-rouge">/var/log/mongodb/auditLog_productos.json</code> para ver los registros.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
</pre></td><td class="rouge-code"><pre><span class="nx">vagrant</span><span class="p">@</span><span class="nd">mongo</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">tail</span> <span class="o">-</span><span class="nx">f</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/log/m</span><span class="nx">ongodb</span><span class="o">/</span><span class="nx">auditLog_productos</span><span class="p">.</span><span class="nx">json</span> <span class="o">|</span> <span class="nx">jq</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">authCheck</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:29:59.341+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">W1VU30OJQJ2iPH7H85PQjw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42944</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">command</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">insert</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tienda.Productos</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">insert</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Productos</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">documents</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">codigo</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">P1001</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">nombre</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Silla</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">precio</span><span class="dl">"</span><span class="p">:</span> <span class="mf">25.5</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">stock</span><span class="dl">"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">$oid</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">67c05ac7de2c6140ff51e948</span><span class="dl">"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">ordered</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">lsid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Eh4EwQUaQTuk/Jd94obwZQ==</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">$db</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tienda</span><span class="dl">"</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">authCheck</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:30:06.444+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">W1VU30OJQJ2iPH7H85PQjw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42944</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">command</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">update</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tienda.Productos</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">update</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Productos</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">updates</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">q</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">codigo</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">P1001</span><span class="dl">"</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">u</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">$set</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">precio</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">ordered</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">lsid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Eh4EwQUaQTuk/Jd94obwZQ==</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">$db</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tienda</span><span class="dl">"</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">authCheck</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:32:01.862+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">W1VU30OJQJ2iPH7H85PQjw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42944</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">command</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">update</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tienda.Productos</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">update</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Productos</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">updates</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">q</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">codigo</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">P1001</span><span class="dl">"</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">u</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">$set</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">precio</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">ordered</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">lsid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Eh4EwQUaQTuk/Jd94obwZQ==</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">$db</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tienda</span><span class="dl">"</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">atype</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">authCheck</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2025-02-27T12:32:59.347+00:00</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">W1VU30OJQJ2iPH7H85PQjw==</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">remote</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ip</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">42944</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">users</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">roles</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="dl">"</span><span class="s2">param</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">command</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">delete</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tienda.Productos</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">args</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">delete</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Productos</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">deletes</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">q</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">nombre</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Mesa</span><span class="dl">"</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">limit</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">ordered</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">lsid</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">$binary</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Eh4EwQUaQTuk/Jd94obwZQ==</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">$type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">04</span><span class="dl">"</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">$db</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tienda</span><span class="dl">"</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Estos registros muestran que las operaciones sobre la colección Productos están siendo correctamente auditadas, incluyendo detalles sobre el tipo de operación, el usuario que realizó la acción, la base de datos y colección afectadas, así como los parámetros y resultados de las operaciones.</p>

<h2 id="11-averigua-si-en-cassandra-se-pueden-auditar-las-inserciones-de-datos"><span class="me-2">11. Averigua si en Cassandra se pueden auditar las inserciones de datos.</span><a href="#11-averigua-si-en-cassandra-se-pueden-auditar-las-inserciones-de-datos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>En Cassandra, es posible realizar auditorías sobre las inserciones de datos, lo cual resulta útil para rastrear todas las solicitudes CQL (Cassandra Query Language) que se ejecutan, así como los intentos de autenticación en los nodos. Existen dos formas principales de implementar esta auditoría:</p>

<ol>
  <li><strong>BinAuditLogger</strong>: Una forma eficiente de registrar eventos en un archivo binario.</li>
  <li><strong>FileAuditLogger</strong>: Registra los eventos en un archivo de texto plano, específicamente en <code class="language-plaintext highlighter-rouge">audit/audit.log</code>, utilizando un registrador como slf4j.</li>
</ol>

<p>Estas implementaciones permiten capturar eventos como:</p>

<ul>
  <li>Intentos de inicio de sesión, tanto exitosos como fallidos.</li>
  <li>Todos los comandos de base de datos ejecutados a través del protocolo CQL, ya sea que hayan tenido éxito o hayan fallado.</li>
  <li>No se registran los valores reales que se vinculan con las sentencias preparadas.</li>
</ul>

<p>Cada implementación de auditoría tiene acceso a atributos importantes como el nombre del usuario (si está disponible), la dirección IP y el puerto de origen, la categoría y el tipo de solicitud (por ejemplo, <code class="language-plaintext highlighter-rouge">INSERT</code>, <code class="language-plaintext highlighter-rouge">SELECT</code>, etc.), el keyspace y la tabla que se está modificando, y el comando CQL ejecutado.</p>

<p>Para implementar la auditoría, primero creamos un nuevo keyspace. En la terminal de Cassandra, ejecutamos el siguiente comando:</p>

<pre><code class="language-cql">cqlsh&gt; CREATE KEYSPACE auditoria_prueba 
WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 1};
</code></pre>

<p>Una vez que tenemos el keyspace, editamos el archivo de configuración <code class="language-plaintext highlighter-rouge">/etc/cassandra/cassandra.yaml</code> para habilitar la auditoría. Buscamos la sección correspondiente a las opciones de auditoría y agregamos lo siguiente:</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="na">audit_logging_options</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">logger</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">class_name</span><span class="pi">:</span> <span class="s">BinAuditLogger</span>
  <span class="na">included_keyspaces</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">auditoria_prueba"</span><span class="pi">]</span>
  <span class="na">included_categories</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">DML</span><span class="pi">]</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/posts/auditoria/image58.png" class="popup img-link  shimmer"><img src="/assets/img/posts/auditoria/image58.png" alt="image" loading="lazy"></a></p>

<p>Esto habilita la auditoría para el keyspace <code class="language-plaintext highlighter-rouge">auditoria_prueba</code> y limita el registro solo a las operaciones DML (Data Manipulation Language), como <code class="language-plaintext highlighter-rouge">INSERT</code>, <code class="language-plaintext highlighter-rouge">UPDATE</code>, y <code class="language-plaintext highlighter-rouge">DELETE</code>.</p>

<p>Después de realizar estos cambios, reiniciamos Cassandra ejecutando los siguientes comandos:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>nodetool disableauditlog
nodetool enableauditlog
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez que Cassandra se ha reiniciado, nos conectamos al keyspace <code class="language-plaintext highlighter-rouge">auditoria_prueba</code> y realizamos algunas operaciones. Creamos una tabla y luego insertamos algunos datos. Los comandos que usamos son los siguientes:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="n">cqlsh</span><span class="o">&gt;</span> <span class="n">USE</span> <span class="n">auditoria_prueba</span><span class="p">;</span>
<span class="n">cqlsh</span><span class="p">:</span><span class="n">auditoria_prueba</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">empleados</span> <span class="p">(</span>
                      <span class="p">...</span>     <span class="n">id</span> <span class="n">UUID</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
                      <span class="p">...</span>     <span class="n">nombre</span> <span class="nb">TEXT</span><span class="p">,</span>
                      <span class="p">...</span>     <span class="n">correo</span> <span class="nb">TEXT</span>
                      <span class="p">...</span> <span class="p">);</span>
<span class="n">cqlsh</span><span class="p">:</span><span class="n">auditoria_prueba</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">empleados</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">correo</span><span class="p">)</span> 
                      <span class="p">...</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid</span><span class="p">(),</span> <span class="s1">'Juan Pérez'</span><span class="p">,</span> <span class="s1">'juanperez@example.com'</span><span class="p">);</span>
<span class="n">cqlsh</span><span class="p">:</span><span class="n">auditoria_prueba</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">empleados</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">correo</span><span class="p">)</span>
                    <span class="p">...</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid</span><span class="p">(),</span> <span class="s1">'Raúl Perez'</span><span class="p">,</span> <span class="s1">'raulperez@example.com'</span><span class="p">);</span>
<span class="n">cqlsh</span><span class="p">:</span><span class="n">auditoria_prueba</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">empleados</span><span class="p">;</span>

 <span class="n">id</span>                                   <span class="o">|</span> <span class="n">correo</span>                <span class="o">|</span> <span class="n">nombre</span>
<span class="c1">--------------------------------------+-----------------------+------------</span>
 <span class="mi">30722</span><span class="n">a56</span><span class="o">-</span><span class="n">bddb</span><span class="o">-</span><span class="mi">4</span><span class="n">c54</span><span class="o">-</span><span class="n">bc4e</span><span class="o">-</span><span class="mi">5</span><span class="n">f94b1afb030</span> <span class="o">|</span> <span class="n">raulperez</span><span class="o">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="o">|</span> <span class="n">Ra</span><span class="err">ú</span><span class="n">l</span> <span class="n">Perez</span>
 <span class="mi">6</span><span class="n">a177462</span><span class="o">-</span><span class="n">a22d</span><span class="o">-</span><span class="mi">4051</span><span class="o">-</span><span class="mi">8</span><span class="n">a9f</span><span class="o">-</span><span class="mi">50498</span><span class="n">f7abafb</span> <span class="o">|</span> <span class="n">juanperez</span><span class="o">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="o">|</span> <span class="n">Juan</span> <span class="n">P</span><span class="err">é</span><span class="n">rez</span>

<span class="p">(</span><span class="mi">2</span> <span class="k">rows</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Posteriormente, si revisamos los logs, podemos observar que las inserciones y consultas realizadas han quedado registradas. Los logs de auditoría se verían algo así:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>2025-02-27 15:00:11,234 <span class="o">[</span>AuditLogger:1] INFO  com.datastax.bdp.audit.BinAuditLogger - Query: CREATE TABLE empleados <span class="o">(</span><span class="nb">id </span>UUID PRIMARY KEY, nombre TEXT, correo TEXT<span class="o">)</span>
2025-02-27 15:00:23,123 <span class="o">[</span>AuditLogger:1] INFO  com.datastax.bdp.audit.BinAuditLogger - Query: INSERT INTO empleados <span class="o">(</span><span class="nb">id</span>, nombre, correo<span class="o">)</span> VALUES <span class="o">(</span>6a177462-a22d-4051-8a9f-50498f7abafb, <span class="s1">'Juan Pérez'</span>, <span class="s1">'juanperez@example.com'</span><span class="o">)</span>
2025-02-27 15:00:33,233 <span class="o">[</span>AuditLogger:1] INFO  com.datastax.bdp.audit.BinAuditLogger - Query: INSERT INTO empleados <span class="o">(</span><span class="nb">id</span>, nombre, correo<span class="o">)</span> VALUES <span class="o">(</span>30722a56-bddb-4c54-bc4e-5f94b1afb030, <span class="s1">'Raúl Pérez'</span>, <span class="s1">'raulperez@example.com'</span><span class="o">)</span>
2025-02-27 15:01:02,678 <span class="o">[</span>AuditLogger:1] INFO  com.datastax.bdp.audit.BinAuditLogger - Query: SELECT <span class="k">*</span> FROM empleados<span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>En los logs podemos ver información detallada como la fecha y hora exacta, el nivel de log (<code class="language-plaintext highlighter-rouge">INFO</code>), el tipo de operación (<code class="language-plaintext highlighter-rouge">INSERT</code>, <code class="language-plaintext highlighter-rouge">CREATE</code>, <code class="language-plaintext highlighter-rouge">SELECT</code>), y los valores de las operaciones ejecutadas. Esto nos da un buen control sobre las inserciones y otros eventos importantes dentro de la base de datos.</p>

<p>De esta manera, podemos auditar de forma eficaz las inserciones de datos y otras operaciones dentro de Cassandra, garantizando que toda actividad en la base de datos quede registrada adecuadamente para su posterior revisión.</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/base-de-datos/">Base de Datos</a>
      </div>
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Auditor%C3%ADa%20-%20Blog%20personal&url=%2Fposts%2Fauditoria%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Auditor%C3%ADa%20-%20Blog%20personal&u=%2Fposts%2Fauditoria%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=%2Fposts%2Fauditoria%2F&text=Auditor%C3%ADa%20-%20Blog%20personal" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/movimiento_datos/">Auditoría</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/auditoria/">Auditoría</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/systemd-boot/">Systemd-Boot</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/forense/">Informática forense</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/selinux/">Configuración/activación de SELinux</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vpn/">VPN</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/criptograf%C3%ADa/">Criptografía</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/systemd/">Systemd</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/an%C3%A1lisis/">Análisis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/aplicaciones/">Aplicaciones</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/automatizaci%C3%B3n/">Automatización</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cloud/">Cloud</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/compartici%C3%B3n-de-archivos/">Compartición de archivos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/instalaci%C3%B3n/">Instalación</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/monitoreo-y-gesti%C3%B3n-de-logs/">Monitoreo y Gestión de Logs</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="d-none ps-0 pe-4">
    <h2 class="panel-heading ps-3 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  
    
  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/movimiento_datos/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740774780"
  data-df="ll"
  
>
  Feb 28, 2025
</time>

              <h4 class="pt-0 my-2">Auditoría</h4>
              <div class="text-muted">
                <p>En esta práctica, exploraremos diferentes técnicas de exportación e importación de datos entre bases de datos utilizando herramientas de Oracle, MySQL, PostgreSQL y MongoDB. Comenzaremos con la exp...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/instalacion-oracle19c/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1731690900"
  data-df="ll"
  
>
  Nov 15, 2024
</time>

              <h4 class="pt-0 my-2">Instalación de Oracle 19c en Debian 12</h4>
              <div class="text-muted">
                <p>Este post muestra cómo instalar y configurar Oracle 19c en Debian 12, cubriendo los pasos clave desde la instalación hasta la configuración básica. 🚀</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/forense/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Informática forense</p>
    </a>
  

  
    <a
      href="/posts/movimiento_datos/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>Auditoría</p>
    </a>
  
</nav>

            
              
              <!-- The comments switcher -->


            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://github.com/PabloMartin19">Pablo Martín Hidalgo</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.1.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vpn/">VPN</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/criptograf%C3%ADa/">Criptografía</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/systemd/">Systemd</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/an%C3%A1lisis/">Análisis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/aplicaciones/">Aplicaciones</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/automatizaci%C3%B3n/">Automatización</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cloud/">Cloud</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/compartici%C3%B3n-de-archivos/">Compartición de archivos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/instalaci%C3%B3n/">Instalación</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/monitoreo-y-gesti%C3%B3n-de-logs/">Monitoreo y Gestión de Logs</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->
    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script>







<script src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  







    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5">Oops! No results found.</p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

