<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="es" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Copias de Seguridad y Restauración" />
<meta name="author" content="Pablo Martín Hidalgo" />
<meta property="og:locale" content="es" />
<meta name="description" content="Garantizar la integridad y disponibilidad de los datos es clave en cualquier sistema. En esta práctica, se explorarán copias de seguridad lógicas y físicas en Oracle, PostgreSQL, MySQL y MongoDB, aplicando compresión, cifrado y segmentación. También se abordará la recuperación ante desastres mediante la restauración de ficheros de datos y control, incluyendo el uso de RMAN en entornos con ArchiveLog habilitado." />
<meta property="og:description" content="Garantizar la integridad y disponibilidad de los datos es clave en cualquier sistema. En esta práctica, se explorarán copias de seguridad lógicas y físicas en Oracle, PostgreSQL, MySQL y MongoDB, aplicando compresión, cifrado y segmentación. También se abordará la recuperación ante desastres mediante la restauración de ficheros de datos y control, incluyendo el uso de RMAN en entornos con ArchiveLog habilitado." />
<link rel="canonical" href="/posts/copia-seguridad/" />
<meta property="og:url" content="/posts/copia-seguridad/" />
<meta property="og:site_name" content="Blog personal" />
<meta property="og:image" content="/assets/img/posts/copiaseg/portadita.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-03-03T00:35:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/assets/img/posts/copiaseg/portadita.jpg" />
<meta property="twitter:title" content="Copias de Seguridad y Restauración" />
<meta name="twitter:site" content="@Tagarnina10" />
<meta name="twitter:creator" content="@Tagarnina10" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pablo Martín Hidalgo","url":"https://github.com/PabloMartin19/"},"dateModified":"2025-03-03T09:18:53+01:00","datePublished":"2025-03-03T00:35:00+01:00","description":"Garantizar la integridad y disponibilidad de los datos es clave en cualquier sistema. En esta práctica, se explorarán copias de seguridad lógicas y físicas en Oracle, PostgreSQL, MySQL y MongoDB, aplicando compresión, cifrado y segmentación. También se abordará la recuperación ante desastres mediante la restauración de ficheros de datos y control, incluyendo el uso de RMAN en entornos con ArchiveLog habilitado.","headline":"Copias de Seguridad y Restauración","image":"/assets/img/posts/copiaseg/portadita.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/copia-seguridad/"},"url":"/posts/copia-seguridad/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Copias de Seguridad y Restauración | Blog personal
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Blog personal">
<meta name="application-name" content="Blog personal">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      let self = this;this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          self.clearMode();
        }
        self.notify();
      });

      if (!this.hasMode) {
        return;
      }

      if (this.isDarkMode) {
        this.setDark();
      } else {
        this.setLight();
      }
    }

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isPreferDark() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }get modeStatus() {
      if (this.hasMode) {
        return this.mode;
      } else {
        return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        this.clearMode();
      } else {
        if (this.isPreferDark) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    }
  }

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">Blog personal</a>
    <p class="site-subtitle fst-italic mb-0">Los mejores programas son aquellos que funcionan.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/PabloMartin19"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/Tagarnina10"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['pmartinhidalgo19','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="https://www.linkedin.com/in/pablo-mart%C3%ADn-hidalgo/"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Copias de Seguridad y Restauración</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Copias de Seguridad y Restauración</h1>
    
      <p class="post-desc fw-light mb-4">Garantizar la integridad y disponibilidad de los datos es clave en cualquier sistema. En esta práctica, se explorarán copias de seguridad lógicas y físicas en Oracle, PostgreSQL, MySQL y MongoDB, aplicando compresión, cifrado y segmentación. También se abordará la recuperación ante desastres mediante la restauración de ficheros de datos y control, incluyendo el uso de RMAN en entornos con ArchiveLog habilitado.</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740958500"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Mar  3, 2025
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740989933"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Mar  3, 2025
</time>

        </span>
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/posts/copiaseg/portadita.jpg" class="popup img-link preview-img shimmer"><img src="/assets/img/posts/copiaseg/portadita.jpg"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/PabloMartin19/">Pablo Martín Hidalgo</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="7979 words"
>
  <em>44 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  <div class="content">
    <h2 id="ejercicio-1"><span class="me-2">Ejercicio 1</span><a href="#ejercicio-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Realiza una copia de seguridad lógica de tu base de datos completa, teniendo en cuenta los siguientes requisitos:</p>

<ul>
  <li>La copia debe estar encriptada y comprimida.</li>
  <li>Debe realizarse en un conjunto de ficheros con un tamaño máximo de 75 MB.</li>
  <li>Programa la operación para que se repita cada día a una hora determinada.</li>
</ul>

<p>Lo primero que debemos hacer es crear un usuario que tenga los privilegios necesarios para ejecutar la copia de seguridad. En este caso, vamos a crear el usuario <code class="language-plaintext highlighter-rouge">pavlo</code> y otorgarle el privilegio de DBA para que pueda acceder a todas las funciones necesarias para realizar la copia.</p>

<p>Ingresamos a Oracle como usuario administrador y creamos el usuario pavlo:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="n">oracle</span><span class="o">@</span><span class="n">oracle19c</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sqlplus</span> <span class="o">/</span> <span class="k">as</span> <span class="n">sysdba</span>

<span class="k">SQL</span><span class="o">*</span><span class="n">Plus</span><span class="p">:</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span> <span class="k">on</span> <span class="n">Sun</span> <span class="n">Mar</span> <span class="mi">2</span> <span class="mi">19</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">10</span> <span class="mi">2025</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">1982</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="n">Oracle</span><span class="p">.</span>  <span class="k">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>


<span class="n">Conectado</span> <span class="n">a</span><span class="p">:</span>
<span class="n">Oracle</span> <span class="k">Database</span> <span class="mi">19</span><span class="k">c</span> <span class="n">Enterprise</span> <span class="n">Edition</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">ALTER</span> <span class="k">SESSION</span> <span class="k">SET</span> <span class="nv">"_ORACLE_SCRIPT"</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>

<span class="n">Sesion</span> <span class="n">modificada</span><span class="p">.</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">USER</span> <span class="n">pavlo</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="n">password</span><span class="p">;</span>

<span class="n">Usuario</span> <span class="n">creado</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Luego, asignamos los privilegios necesarios para que pavlo pueda realizar copias de seguridad. En este caso, le otorgamos el privilegio DBA, que le permitirá acceder a todas las funciones necesarias para la administración de la base de datos, incluida la exportación de datos:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">GRANT</span> <span class="n">DBA</span> <span class="k">TO</span> <span class="n">pavlo</span><span class="p">;</span>

<span class="n">Concesion</span> <span class="n">terminada</span> <span class="n">correctamente</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Esto concede a <code class="language-plaintext highlighter-rouge">pavlo</code> los privilegios necesarios para ejecutar las copias de seguridad.</p>

<p>A continuación, vamos a crear un directorio en el sistema de archivos donde almacenaremos las copias de seguridad. En este caso, lo creamos en <code class="language-plaintext highlighter-rouge">/opt/oracle/copias</code>:</p>

<p>Creamos el directorio en el sistema operativo:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo mkdir</span> /opt/oracle/copias
</pre></td></tr></tbody></table></code></div></div>

<p>Luego, cambiamos la propiedad de este directorio para que el usuario de Oracle (y en este caso pavlo, que necesitará acceso) pueda utilizarlo:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo chown </span>oracle:oinstall /opt/oracle/copias/
</pre></td></tr></tbody></table></code></div></div>

<p>Seguidamente, creamos un directorio lógico con el nombre COPIAS que apuntará a la ubicación física que hemos creado en el sistema:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="n">DIRECTORY</span> <span class="n">COPIAS</span> <span class="k">AS</span> <span class="s1">'/opt/oracle/copias/'</span><span class="p">;</span>

<span class="n">Directorio</span> <span class="n">creado</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Por último, le otorgamos permisos de lectura y escritura al usuario pavlo sobre este directorio:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">GRANT</span> <span class="k">READ</span><span class="p">,</span> <span class="k">WRITE</span> <span class="k">ON</span> <span class="n">DIRECTORY</span> <span class="n">COPIAS</span> <span class="k">TO</span> <span class="n">pavlo</span><span class="p">;</span>

<span class="n">Concesion</span> <span class="n">terminada</span> <span class="n">correctamente</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Para automatizar la tarea de hacer la copia de seguridad, vamos a crear un servicio de systemd que ejecutará el comando para exportar la base de datos en el formato deseado. En este servicio, especificamos que la exportación se debe realizar con encriptación, compresión y fragmentación de los archivos en bloques de 75 MB.</p>

<p>Creamos un archivo de servicio de systemd para definir cómo debe ejecutarse la copia, donde el contenido de este archivo será el siguiente, donde indicamos que el comando de exportación debe ser ejecutado cuando se active el servicio:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo cat</span> /etc/systemd/system/copia.service 
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Oracle Copias

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>oneshot
<span class="nv">ExecStart</span><span class="o">=</span>/bin/bash <span class="nt">-c</span> <span class="s1">'expdp pavlo/password DIRECTORY=COPIAS DUMPFILE=copia_$(date +"%Y%m%d%H%M%S").dmp LOGFILE=copia_$(date +"%Y%m%d%H%M%S").log ENCRYPTION_PASSWORD=PAVLO COMPRESSION=ALL FULL=Y FILESIZE=75M'</span>

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></td></tr></tbody></table></code></div></div>

<p>En este archivo, la clave <code class="language-plaintext highlighter-rouge">ENCRYPTION_PASSWORD=PAVLO</code> se utiliza para encriptar la copia de seguridad. La opción <code class="language-plaintext highlighter-rouge">COMPRESSION=ALL</code> asegura que la copia se comprima, y <code class="language-plaintext highlighter-rouge">FILESIZE=75M</code> limita el tamaño de cada archivo de copia a 75 MB.</p>

<p>Ahora que tenemos el servicio listo, necesitamos programar su ejecución diaria a una hora específica. Para ello, creamos un temporizador de systemd que ejecutará el servicio todos los días a las 19:45.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo cat</span> /etc/systemd/system/copia.timer
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Oracle Copias Temporizador

<span class="o">[</span>Timer]
<span class="nv">OnCalendar</span><span class="o">=</span><span class="k">*</span>-<span class="k">*</span>-<span class="k">*</span> 19:45:00
<span class="nv">Persistent</span><span class="o">=</span><span class="nb">true</span>

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>timers.target
</pre></td></tr></tbody></table></code></div></div>

<p>Aquí, <code class="language-plaintext highlighter-rouge">OnCalendar=*-*-* 19:45:00</code> establece que la copia de seguridad se debe realizar todos los días a las 19:45. La opción <code class="language-plaintext highlighter-rouge">Persistent=true</code> asegura que, si el sistema está apagado en el momento de la ejecución programada, la tarea se ejecutará tan pronto como el sistema se reinicie.</p>

<p>Una vez que hemos creado el archivo de servicio y el temporizador, necesitamos recargar la configuración de systemd, habilitar el temporizador para que se inicie automáticamente al arrancar el sistema, y arrancar el temporizador para que empiece a funcionar.</p>

<p>Recargamos systemd para que reconozca los nuevos archivos de configuración:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl daemon-reload
</pre></td></tr></tbody></table></code></div></div>

<p>Habilitamos el temporizador para que se ejecute automáticamente al iniciar el sistema:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>copia.timer
Created symlink /etc/systemd/system/timers.target.wants/copia.timer → /etc/systemd/system/copia.timer.
</pre></td></tr></tbody></table></code></div></div>

<p>Finalmente, iniciamos el temporizador para que comience a ejecutarse:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl start copia.timer
</pre></td></tr></tbody></table></code></div></div>

<p>Entonces, llegada la hora, se realizará la copia y se guardará en el directorio indicado con su respectiva fecha y hora. Podemos ver el log de la copia:</p>

<p><a href="/assets/img/posts/copiaseg/image1.png" class="popup img-link  shimmer"><img src="/assets/img/posts/copiaseg/image1.png" alt="image" loading="lazy"></a></p>

<h2 id="ejercicio-2"><span class="me-2">Ejercicio 2</span><a href="#ejercicio-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Restaura la copia de seguridad lógica creada en el punto anterior.</p>

<p>Para la prueba he eliminado las tablas del esquema scott:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CONNECT</span> <span class="n">scott</span><span class="o">/</span><span class="n">tiger</span>
<span class="n">Conectado</span><span class="p">.</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dept</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dept</span>
              <span class="o">*</span>
<span class="n">ERROR</span> <span class="n">en</span> <span class="n">linea</span> <span class="mi">1</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">00942</span><span class="p">:</span> <span class="n">la</span> <span class="n">tabla</span> <span class="n">o</span> <span class="n">vista</span> <span class="k">no</span> <span class="n">existe</span>


<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">emp</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">emp</span>
              <span class="o">*</span>
<span class="n">ERROR</span> <span class="n">en</span> <span class="n">linea</span> <span class="mi">1</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">00942</span><span class="p">:</span> <span class="n">la</span> <span class="n">tabla</span> <span class="n">o</span> <span class="n">vista</span> <span class="k">no</span> <span class="n">existe</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Vamos a llevar a cabo la restauración de la copia de seguridad utilizando el siguiente comando. Especificamos el directorio, el archivo dump de la copia que queremos restaurar, y también indicamos el archivo de registro (log) que se generará, el cual se guardará en el mismo directorio donde se realiza la restauración.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span>impdp pavlo/password <span class="nv">directory</span><span class="o">=</span>COPIAS <span class="nv">dumpfile</span><span class="o">=</span>copia_20250302194500.dmp <span class="nv">encryption_password</span><span class="o">=</span>PAVLO <span class="nv">full</span><span class="o">=</span>y <span class="nv">logfile</span><span class="o">=</span>restauracion_<span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%Y%m%d%H%M%S"</span><span class="si">)</span>.log
</pre></td></tr></tbody></table></code></div></div>

<p>Si accedemos al archivo de registro (log) de la restauración de la copia y filtramos por el término “SCOTT”, podemos observar que las tablas y los datos del esquema han sido importados correctamente, ya que previamente habíamos eliminado ese esquema.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lh</span> /opt/oracle/copias/
total 1,9M
<span class="nt">-rw-r-----</span> 1 oracle oinstall 1,9M mar  2 19:46 copia_20250302194500.dmp
<span class="nt">-rw-r--r--</span> 1 oracle oinstall  18K mar  2 19:46 copia_20250302194500.log
<span class="nt">-rw-r--r--</span> 1 oracle oinstall  32K mar  2 20:01 restauracion_20250302200022.log
oracle@oracle19c:~<span class="nv">$ </span><span class="nb">cat</span> /opt/oracle/copias/restauracion_20250302200022.log | <span class="nb">grep </span>SCOTT
ORA-39151: La tabla <span class="s2">"SCOTT"</span>.<span class="s2">"EMPLOYEES"</span> existe. Todos los metadados dependientes y los datos se omitirán debido table_exists_action de omitir
ORA-39151: La tabla <span class="s2">"SCOTT"</span>.<span class="s2">"EMP_VIEW"</span> existe. Todos los metadados dependientes y los datos se omitirán debido table_exists_action de omitir
ORA-39151: La tabla <span class="s2">"SCOTT"</span>.<span class="s2">"DEPT_VIEW"</span> existe. Todos los metadados dependientes y los datos se omitirán debido table_exists_action de omitir
<span class="nb">.</span> <span class="nb">.</span> <span class="s2">"SCOTT"</span>.<span class="s2">"EMP"</span>                               5.695 KB      16 filas importadas
<span class="nb">.</span> <span class="nb">.</span> <span class="s2">"SCOTT"</span>.<span class="s2">"DEPT"</span>                                  5 KB       4 filas importadas
<span class="nb">.</span> <span class="nb">.</span> <span class="s2">"SCOTT"</span>.<span class="s2">"SALGRADE"</span>                              5 KB       5 filas importadas
<span class="nb">.</span> <span class="nb">.</span> <span class="s2">"SCOTT"</span>.<span class="s2">"BONUS"</span>                             4.929 KB      14 filas importadas
</pre></td></tr></tbody></table></code></div></div>

<p>Al restaurar la copia de seguridad, podemos ver que las tablas y los datos se recuperan correctamente, volviendo a estar presentes tal como estaban antes de la eliminación.</p>

<p><a href="/assets/img/posts/copiaseg/image2.png" class="popup img-link  shimmer"><img src="/assets/img/posts/copiaseg/image2.png" alt="image" loading="lazy"></a></p>

<h2 id="ejercicio-3"><span class="me-2">Ejercicio 3</span><a href="#ejercicio-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Pon tu base de datos en modo ArchiveLog y realiza con RMAN una copia de seguridad física en caliente.</p>

<p>El modo <code class="language-plaintext highlighter-rouge">ARCHIVELOG</code> de Oracle es un mecanismo de protección ante fallos del disco que permite realizar copias de seguridad en caliente. Para activar el modo archivelog reiniciamos la base de datos para montarla directamente en la instancia sin abrirla, si no no nos dejará:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="n">oracle</span><span class="o">@</span><span class="n">oracle19c</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sqlplus</span> <span class="o">/</span> <span class="k">as</span> <span class="n">sysdba</span>

<span class="k">SQL</span><span class="o">*</span><span class="n">Plus</span><span class="p">:</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span> <span class="k">on</span> <span class="n">Sun</span> <span class="n">Mar</span> <span class="mi">2</span> <span class="mi">20</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">34</span> <span class="mi">2025</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">1982</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="n">Oracle</span><span class="p">.</span>  <span class="k">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>


<span class="n">Conectado</span> <span class="n">a</span><span class="p">:</span>
<span class="n">Oracle</span> <span class="k">Database</span> <span class="mi">19</span><span class="k">c</span> <span class="n">Enterprise</span> <span class="n">Edition</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">shutdown</span> <span class="k">immediate</span><span class="p">;</span>
<span class="n">Base</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">cerrada</span><span class="p">.</span>
<span class="n">Base</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">desmontada</span><span class="p">.</span>
<span class="n">Instancia</span> <span class="n">ORACLE</span> <span class="n">cerrada</span><span class="p">.</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">startup</span> <span class="n">mount</span><span class="p">;</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">32004</span><span class="p">:</span> <span class="n">obsolete</span> <span class="k">or</span> <span class="n">deprecated</span> <span class="k">parameter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">specified</span> <span class="k">for</span> <span class="n">RDBMS</span> <span class="n">instance</span>
<span class="n">Instancia</span> <span class="n">ORACLE</span> <span class="n">iniciada</span><span class="p">.</span>

<span class="n">Total</span> <span class="k">System</span> <span class="k">Global</span> <span class="n">Area</span> <span class="mi">1644164456</span> <span class="n">bytes</span>
<span class="nb">Fixed</span> <span class="k">Size</span>		    <span class="mi">9135464</span> <span class="n">bytes</span>
<span class="k">Variable</span> <span class="k">Size</span>		 <span class="mi">1275068416</span> <span class="n">bytes</span>
<span class="k">Database</span> <span class="n">Buffers</span>	  <span class="mi">352321536</span> <span class="n">bytes</span>
<span class="n">Redo</span> <span class="n">Buffers</span>		    <span class="mi">7639040</span> <span class="n">bytes</span>
<span class="n">Base</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">montada</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>También cambiamos el tipo de base de datos:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">database</span> <span class="n">archivelog</span><span class="p">;</span>

<span class="n">Base</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">modificada</span><span class="p">.</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">database</span> <span class="k">open</span><span class="p">;</span>

<span class="n">Base</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">modificada</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Cuando ya tengamos la base de datos en ArchiveLog, lo comprobamos ejecutando esta consulta:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">log_mode</span> 
  <span class="mi">2</span>  <span class="k">FROM</span> <span class="n">V</span><span class="err">$</span><span class="k">DATABASE</span><span class="p">;</span>

<span class="n">LOG_MODE</span>
<span class="c1">------------</span>
<span class="n">ARCHIVELOG</span>
</pre></td></tr></tbody></table></code></div></div>

<p>También podemos comprobar el estado con el siguiente comando:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="n">ARCHIVE</span> <span class="n">LOG</span> <span class="n">LIST</span><span class="p">;</span>
<span class="n">Modo</span> <span class="n">log</span> <span class="n">de</span> <span class="n">la</span> <span class="n">base</span> <span class="n">de</span> <span class="n">datos</span>		  <span class="n">Modo</span> <span class="n">de</span> <span class="n">Archivado</span>
<span class="n">Archivado</span> <span class="n">automatico</span>		 <span class="n">Activado</span>
<span class="n">Destino</span> <span class="n">del</span> <span class="n">archivo</span>	       <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="n">arch</span>
<span class="n">Secuencia</span> <span class="n">de</span> <span class="n">log</span> <span class="n">en</span> <span class="n">linea</span> <span class="n">mas</span> <span class="n">antigua</span>	  <span class="mi">17</span>
<span class="n">Siguiente</span> <span class="n">secuencia</span> <span class="n">de</span> <span class="n">log</span> <span class="n">para</span> <span class="n">archivar</span>   <span class="mi">19</span>
<span class="n">Secuencia</span> <span class="n">de</span> <span class="n">log</span> <span class="n">actual</span> 	  <span class="mi">19</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Tras esto, accederemos como superusuario y crearemos un usuario para la copia de seguridad respectiva.</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">USER</span> <span class="n">RMAN</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="n">RMAN</span><span class="p">;</span>

<span class="n">Usuario</span> <span class="n">creado</span><span class="p">.</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">GRANT</span> <span class="k">CONNECT</span><span class="p">,</span> <span class="n">RESOURCE</span> <span class="k">TO</span> <span class="n">RMAN</span><span class="p">;</span>

<span class="n">Concesion</span> <span class="n">terminada</span> <span class="n">correctamente</span><span class="p">.</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">GRANT</span> <span class="n">RECOVERY_CATALOG_OWNER</span> <span class="k">TO</span> <span class="n">RMAN</span><span class="p">;</span>

<span class="n">Concesion</span> <span class="n">terminada</span> <span class="n">correctamente</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Seguidamente, creamos un tablespace para el usuario RMAN que acabamos de crear:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="n">TABLESPACE</span> <span class="n">TS_RMAN</span> <span class="n">DATAFILE</span> <span class="s1">'/opt/oracle/oradata/ORCLCDB/ts_rman.dbf'</span> <span class="k">SIZE</span> <span class="mi">300</span><span class="n">M</span> <span class="n">AUTOEXTEND</span> <span class="k">ON</span> <span class="k">NEXT</span> <span class="mi">10</span><span class="n">M</span> <span class="n">MAXSIZE</span> <span class="n">UNLIMITED</span><span class="p">;</span>

<span class="n">Tablespace</span> <span class="n">creado</span><span class="p">.</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">ALTER</span> <span class="k">USER</span> <span class="n">RMAN</span> <span class="k">DEFAULT</span> <span class="n">TABLESPACE</span> <span class="n">TS_RMAN</span> <span class="n">QUOTA</span> <span class="n">UNLIMITED</span> <span class="k">ON</span> <span class="n">TS_RMAN</span><span class="p">;</span>

<span class="n">Usuario</span> <span class="n">modificado</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Ahora pasamos a la configuración de rman, donde tendremos que conectarnos a la base de datos mediante el usuario que creamos antes:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="n">oracle</span><span class="o">@</span><span class="n">oracle19c</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">rman</span>

<span class="n">Recovery</span> <span class="n">Manager</span><span class="p">:</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span> <span class="k">on</span> <span class="n">Sun</span> <span class="n">Mar</span> <span class="mi">2</span> <span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">49</span> <span class="mi">2025</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">1982</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="n">Oracle</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="n">its</span> <span class="n">affiliates</span><span class="p">.</span>  <span class="k">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>

<span class="n">RMAN</span><span class="o">&gt;</span> <span class="k">CONNECT</span> <span class="k">CATALOG</span> <span class="n">RMAN</span><span class="o">/</span><span class="n">RMAN</span>    

<span class="n">connected</span> <span class="k">to</span> <span class="n">recovery</span> <span class="k">catalog</span> <span class="k">database</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez dentro, tendremos que crear el catálogo en base al tablespace que hemos creado anteriormente. Para ello ejecutamos el siguiente comando:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">CATALOG</span> <span class="n">TABLESPACE</span> <span class="n">TS_RMAN</span><span class="p">;</span>

<span class="n">recovery</span> <span class="k">catalog</span> <span class="n">created</span>
</pre></td></tr></tbody></table></code></div></div>

<p>De esta forma ya lo habremos configurado para poder conectarnos al catálogo RMAN. Nos conectamos a partir del siguiente comando:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="n">oracle</span><span class="o">@</span><span class="n">oracle19c</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">rman</span> <span class="n">target</span> <span class="o">=/</span> <span class="k">catalog</span> <span class="n">RMAN</span><span class="o">/</span><span class="n">RMAN</span>

<span class="n">Recovery</span> <span class="n">Manager</span><span class="p">:</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span> <span class="k">on</span> <span class="n">Sun</span> <span class="n">Mar</span> <span class="mi">2</span> <span class="mi">20</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">00</span> <span class="mi">2025</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">1982</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="n">Oracle</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="n">its</span> <span class="n">affiliates</span><span class="p">.</span>  <span class="k">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>

<span class="n">connected</span> <span class="k">to</span> <span class="n">target</span> <span class="k">database</span><span class="p">:</span> <span class="n">ORCLCDB</span> <span class="p">(</span><span class="n">DBID</span><span class="o">=</span><span class="mi">2956261615</span><span class="p">)</span>
<span class="n">connected</span> <span class="k">to</span> <span class="n">recovery</span> <span class="k">catalog</span> <span class="k">database</span>

<span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">REGISTER</span> <span class="k">DATABASE</span><span class="p">;</span>

<span class="k">database</span> <span class="n">registered</span> <span class="k">in</span> <span class="n">recovery</span> <span class="k">catalog</span>
<span class="n">starting</span> <span class="k">full</span> <span class="n">resync</span> <span class="k">of</span> <span class="n">recovery</span> <span class="k">catalog</span>
<span class="k">full</span> <span class="n">resync</span> <span class="n">complete</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Ya estamos registrados correctamente con el usuario RMAN, por lo que podemos pasar a crear la copia de seguridad en caliente:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre></td><td class="rouge-code"><pre><span class="n">oracle</span><span class="o">@</span><span class="n">oracle19c</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">rman</span> <span class="n">target</span> <span class="o">=/</span> <span class="k">catalog</span> <span class="n">RMAN</span><span class="o">/</span><span class="n">RMAN</span>

<span class="n">Recovery</span> <span class="n">Manager</span><span class="p">:</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span> <span class="k">on</span> <span class="n">Sun</span> <span class="n">Mar</span> <span class="mi">2</span> <span class="mi">20</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">00</span> <span class="mi">2025</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">1982</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="n">Oracle</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="n">its</span> <span class="n">affiliates</span><span class="p">.</span>  <span class="k">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>

<span class="n">connected</span> <span class="k">to</span> <span class="n">target</span> <span class="k">database</span><span class="p">:</span> <span class="n">ORCLCDB</span> <span class="p">(</span><span class="n">DBID</span><span class="o">=</span><span class="mi">2956261615</span><span class="p">)</span>
<span class="n">connected</span> <span class="k">to</span> <span class="n">recovery</span> <span class="k">catalog</span> <span class="k">database</span>

<span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">REGISTER</span> <span class="k">DATABASE</span><span class="p">;</span>

<span class="k">database</span> <span class="n">registered</span> <span class="k">in</span> <span class="n">recovery</span> <span class="k">catalog</span>
<span class="n">starting</span> <span class="k">full</span> <span class="n">resync</span> <span class="k">of</span> <span class="n">recovery</span> <span class="k">catalog</span>
<span class="k">full</span> <span class="n">resync</span> <span class="n">complete</span>

<span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">BACKUP</span> <span class="k">DATABASE</span> <span class="n">PLUS</span> <span class="n">ARCHIVELOG</span><span class="p">;</span>  


<span class="n">Starting</span> <span class="n">backup</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="k">current</span> <span class="n">log</span> <span class="n">archived</span>
<span class="n">allocated</span> <span class="n">channel</span><span class="p">:</span> <span class="n">ORA_DISK_1</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">SID</span><span class="o">=</span><span class="mi">19</span> <span class="n">device</span> <span class="k">type</span><span class="o">=</span><span class="n">DISK</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="n">archived</span> <span class="n">log</span> <span class="n">backup</span> <span class="k">set</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">specifying</span> <span class="n">archived</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="n">backup</span> <span class="k">set</span>
<span class="k">input</span> <span class="n">archived</span> <span class="n">log</span> <span class="n">thread</span><span class="o">=</span><span class="mi">1</span> <span class="n">sequence</span><span class="o">=</span><span class="mi">19</span> <span class="n">RECID</span><span class="o">=</span><span class="mi">1</span> <span class="n">STAMP</span><span class="o">=</span><span class="mi">1194728348</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">finished</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">piece</span> <span class="n">handle</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">013</span><span class="n">jc6ss_1_1</span> <span class="n">tag</span><span class="o">=</span><span class="n">TAG20250302T205908</span> <span class="k">comment</span><span class="o">=</span><span class="k">NONE</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">backup</span> <span class="k">set</span> <span class="n">complete</span><span class="p">,</span> <span class="n">elapsed</span> <span class="nb">time</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>
<span class="n">Finished</span> <span class="n">backup</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>

<span class="n">Starting</span> <span class="n">backup</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="k">using</span> <span class="n">channel</span> <span class="n">ORA_DISK_1</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="k">full</span> <span class="n">datafile</span> <span class="n">backup</span> <span class="k">set</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">specifying</span> <span class="n">datafile</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="n">backup</span> <span class="k">set</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00001</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">system01</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00003</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">sysaux01</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00004</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">undotbs01</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00013</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ts_rman</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00007</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">users01</span><span class="p">.</span><span class="n">dbf</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">finished</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">piece</span> <span class="n">handle</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">023</span><span class="n">jc6su_1_1</span> <span class="n">tag</span><span class="o">=</span><span class="n">TAG20250302T205910</span> <span class="k">comment</span><span class="o">=</span><span class="k">NONE</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">backup</span> <span class="k">set</span> <span class="n">complete</span><span class="p">,</span> <span class="n">elapsed</span> <span class="nb">time</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">07</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="k">full</span> <span class="n">datafile</span> <span class="n">backup</span> <span class="k">set</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">specifying</span> <span class="n">datafile</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="n">backup</span> <span class="k">set</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00010</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ORCLPDB1</span><span class="o">/</span><span class="n">sysaux01</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00009</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ORCLPDB1</span><span class="o">/</span><span class="n">system01</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00011</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ORCLPDB1</span><span class="o">/</span><span class="n">undotbs01</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00012</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ORCLPDB1</span><span class="o">/</span><span class="n">users01</span><span class="p">.</span><span class="n">dbf</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">finished</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">piece</span> <span class="n">handle</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">033</span><span class="n">jc6t5_1_1</span> <span class="n">tag</span><span class="o">=</span><span class="n">TAG20250302T205910</span> <span class="k">comment</span><span class="o">=</span><span class="k">NONE</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">backup</span> <span class="k">set</span> <span class="n">complete</span><span class="p">,</span> <span class="n">elapsed</span> <span class="nb">time</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">25</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="k">full</span> <span class="n">datafile</span> <span class="n">backup</span> <span class="k">set</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">specifying</span> <span class="n">datafile</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="n">backup</span> <span class="k">set</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00006</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">pdbseed</span><span class="o">/</span><span class="n">sysaux01</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00005</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">pdbseed</span><span class="o">/</span><span class="n">system01</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">input</span> <span class="n">datafile</span> <span class="n">file</span> <span class="n">number</span><span class="o">=</span><span class="mi">00008</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">pdbseed</span><span class="o">/</span><span class="n">undotbs01</span><span class="p">.</span><span class="n">dbf</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">finished</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">piece</span> <span class="n">handle</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">043</span><span class="n">jc6tu_1_1</span> <span class="n">tag</span><span class="o">=</span><span class="n">TAG20250302T205910</span> <span class="k">comment</span><span class="o">=</span><span class="k">NONE</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">backup</span> <span class="k">set</span> <span class="n">complete</span><span class="p">,</span> <span class="n">elapsed</span> <span class="nb">time</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">25</span>
<span class="n">Finished</span> <span class="n">backup</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>

<span class="n">Starting</span> <span class="n">backup</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="k">current</span> <span class="n">log</span> <span class="n">archived</span>
<span class="k">using</span> <span class="n">channel</span> <span class="n">ORA_DISK_1</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="n">archived</span> <span class="n">log</span> <span class="n">backup</span> <span class="k">set</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">specifying</span> <span class="n">archived</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="n">backup</span> <span class="k">set</span>
<span class="k">input</span> <span class="n">archived</span> <span class="n">log</span> <span class="n">thread</span><span class="o">=</span><span class="mi">1</span> <span class="n">sequence</span><span class="o">=</span><span class="mi">20</span> <span class="n">RECID</span><span class="o">=</span><span class="mi">2</span> <span class="n">STAMP</span><span class="o">=</span><span class="mi">1194728407</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">finished</span> <span class="n">piece</span> <span class="mi">1</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">piece</span> <span class="n">handle</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">053</span><span class="n">jc6uo_1_1</span> <span class="n">tag</span><span class="o">=</span><span class="n">TAG20250302T210008</span> <span class="k">comment</span><span class="o">=</span><span class="k">NONE</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">backup</span> <span class="k">set</span> <span class="n">complete</span><span class="p">,</span> <span class="n">elapsed</span> <span class="nb">time</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>
<span class="n">Finished</span> <span class="n">backup</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>

<span class="n">Starting</span> <span class="n">Control</span> <span class="n">File</span> <span class="k">and</span> <span class="n">SPFILE</span> <span class="n">Autobackup</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">piece</span> <span class="n">handle</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="k">c</span><span class="o">-</span><span class="mi">2956261615</span><span class="o">-</span><span class="mi">20250302</span><span class="o">-</span><span class="mi">00</span> <span class="k">comment</span><span class="o">=</span><span class="k">NONE</span>
<span class="n">Finished</span> <span class="n">Control</span> <span class="n">File</span> <span class="k">and</span> <span class="n">SPFILE</span> <span class="n">Autobackup</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Verificamos que la copia de seguridad se haya realizado correctamente con el siguiente comando:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">RESTORE</span> <span class="k">DATABASE</span> <span class="n">PREVIEW</span><span class="p">;</span>

<span class="n">Starting</span> <span class="n">restore</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="k">using</span> <span class="n">channel</span> <span class="n">ORA_DISK_1</span>


<span class="n">List</span> <span class="k">of</span> <span class="n">Backup</span> <span class="k">Sets</span>
<span class="o">===================</span>


<span class="n">BS</span> <span class="k">Key</span>  <span class="k">Type</span> <span class="n">LV</span> <span class="k">Size</span>       <span class="n">Device</span> <span class="k">Type</span> <span class="n">Elapsed</span> <span class="nb">Time</span> <span class="k">Completion</span> <span class="nb">Time</span>
<span class="c1">------- ---- -- ---------- ----------- ------------ ---------------</span>
<span class="mi">95</span>      <span class="k">Full</span>    <span class="mi">1</span><span class="p">.</span><span class="mi">25</span><span class="k">G</span>      <span class="n">DISK</span>        <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">05</span>     <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>      
        <span class="n">BP</span> <span class="k">Key</span><span class="p">:</span> <span class="mi">99</span>   <span class="n">Status</span><span class="p">:</span> <span class="n">AVAILABLE</span>  <span class="n">Compressed</span><span class="p">:</span> <span class="k">NO</span>  <span class="n">Tag</span><span class="p">:</span> <span class="n">TAG20250302T205910</span>
        <span class="n">Piece</span> <span class="n">Name</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">023</span><span class="n">jc6su_1_1</span>
  <span class="n">List</span> <span class="k">of</span> <span class="n">Datafiles</span> <span class="k">in</span> <span class="n">backup</span> <span class="k">set</span> <span class="mi">95</span>
  <span class="n">File</span> <span class="n">LV</span> <span class="k">Type</span> <span class="n">Ckp</span> <span class="n">SCN</span>    <span class="n">Ckp</span> <span class="nb">Time</span>  <span class="k">Abs</span> <span class="n">Fuz</span> <span class="n">SCN</span> <span class="n">Sparse</span> <span class="n">Name</span>
  <span class="c1">---- -- ---- ---------- --------- ----------- ------ ----</span>
  <span class="mi">1</span>       <span class="k">Full</span> <span class="mi">3803434</span>    <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">system01</span><span class="p">.</span><span class="n">dbf</span>
  <span class="mi">3</span>       <span class="k">Full</span> <span class="mi">3803434</span>    <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">sysaux01</span><span class="p">.</span><span class="n">dbf</span>
  <span class="mi">4</span>       <span class="k">Full</span> <span class="mi">3803434</span>    <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">undotbs01</span><span class="p">.</span><span class="n">dbf</span>
  <span class="mi">7</span>       <span class="k">Full</span> <span class="mi">3803434</span>    <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">users01</span><span class="p">.</span><span class="n">dbf</span>
  <span class="mi">13</span>      <span class="k">Full</span> <span class="mi">3803434</span>    <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ts_rman</span><span class="p">.</span><span class="n">dbf</span>

<span class="n">BS</span> <span class="k">Key</span>  <span class="k">Type</span> <span class="n">LV</span> <span class="k">Size</span>       <span class="n">Device</span> <span class="k">Type</span> <span class="n">Elapsed</span> <span class="nb">Time</span> <span class="k">Completion</span> <span class="nb">Time</span>
<span class="c1">------- ---- -- ---------- ----------- ------------ ---------------</span>
<span class="mi">97</span>      <span class="k">Full</span>    <span class="mi">554</span><span class="p">.</span><span class="mi">47</span><span class="n">M</span>    <span class="n">DISK</span>        <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">09</span>     <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>      
        <span class="n">BP</span> <span class="k">Key</span><span class="p">:</span> <span class="mi">101</span>   <span class="n">Status</span><span class="p">:</span> <span class="n">AVAILABLE</span>  <span class="n">Compressed</span><span class="p">:</span> <span class="k">NO</span>  <span class="n">Tag</span><span class="p">:</span> <span class="n">TAG20250302T205910</span>
        <span class="n">Piece</span> <span class="n">Name</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">043</span><span class="n">jc6tu_1_1</span>
  <span class="n">List</span> <span class="k">of</span> <span class="n">Datafiles</span> <span class="k">in</span> <span class="n">backup</span> <span class="k">set</span> <span class="mi">97</span>
  <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PDB</span> <span class="n">Name</span><span class="p">:</span> <span class="n">PDB</span><span class="err">$</span><span class="n">SEED</span>
  <span class="n">File</span> <span class="n">LV</span> <span class="k">Type</span> <span class="n">Ckp</span> <span class="n">SCN</span>    <span class="n">Ckp</span> <span class="nb">Time</span>  <span class="k">Abs</span> <span class="n">Fuz</span> <span class="n">SCN</span> <span class="n">Sparse</span> <span class="n">Name</span>
  <span class="c1">---- -- ---- ---------- --------- ----------- ------ ----</span>
  <span class="mi">5</span>       <span class="k">Full</span> <span class="mi">2147831</span>    <span class="mi">16</span><span class="o">-</span><span class="n">NOV</span><span class="o">-</span><span class="mi">24</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">pdbseed</span><span class="o">/</span><span class="n">system01</span><span class="p">.</span><span class="n">dbf</span>
  <span class="mi">6</span>       <span class="k">Full</span> <span class="mi">2147831</span>    <span class="mi">16</span><span class="o">-</span><span class="n">NOV</span><span class="o">-</span><span class="mi">24</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">pdbseed</span><span class="o">/</span><span class="n">sysaux01</span><span class="p">.</span><span class="n">dbf</span>
  <span class="mi">8</span>       <span class="k">Full</span> <span class="mi">2147831</span>    <span class="mi">16</span><span class="o">-</span><span class="n">NOV</span><span class="o">-</span><span class="mi">24</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">pdbseed</span><span class="o">/</span><span class="n">undotbs01</span><span class="p">.</span><span class="n">dbf</span>

<span class="n">BS</span> <span class="k">Key</span>  <span class="k">Type</span> <span class="n">LV</span> <span class="k">Size</span>       <span class="n">Device</span> <span class="k">Type</span> <span class="n">Elapsed</span> <span class="nb">Time</span> <span class="k">Completion</span> <span class="nb">Time</span>
<span class="c1">------- ---- -- ---------- ----------- ------------ ---------------</span>
<span class="mi">96</span>      <span class="k">Full</span>    <span class="mi">473</span><span class="p">.</span><span class="mi">57</span><span class="n">M</span>    <span class="n">DISK</span>        <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">07</span>     <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>      
        <span class="n">BP</span> <span class="k">Key</span><span class="p">:</span> <span class="mi">100</span>   <span class="n">Status</span><span class="p">:</span> <span class="n">AVAILABLE</span>  <span class="n">Compressed</span><span class="p">:</span> <span class="k">NO</span>  <span class="n">Tag</span><span class="p">:</span> <span class="n">TAG20250302T205910</span>
        <span class="n">Piece</span> <span class="n">Name</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">033</span><span class="n">jc6t5_1_1</span>
  <span class="n">List</span> <span class="k">of</span> <span class="n">Datafiles</span> <span class="k">in</span> <span class="n">backup</span> <span class="k">set</span> <span class="mi">96</span>
  <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PDB</span> <span class="n">Name</span><span class="p">:</span> <span class="n">ORCLPDB1</span>
  <span class="n">File</span> <span class="n">LV</span> <span class="k">Type</span> <span class="n">Ckp</span> <span class="n">SCN</span>    <span class="n">Ckp</span> <span class="nb">Time</span>  <span class="k">Abs</span> <span class="n">Fuz</span> <span class="n">SCN</span> <span class="n">Sparse</span> <span class="n">Name</span>
  <span class="c1">---- -- ---- ---------- --------- ----------- ------ ----</span>
  <span class="mi">9</span>       <span class="k">Full</span> <span class="mi">3117873</span>    <span class="mi">20</span><span class="o">-</span><span class="n">JAN</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ORCLPDB1</span><span class="o">/</span><span class="n">system01</span><span class="p">.</span><span class="n">dbf</span>
  <span class="mi">10</span>      <span class="k">Full</span> <span class="mi">3117873</span>    <span class="mi">20</span><span class="o">-</span><span class="n">JAN</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ORCLPDB1</span><span class="o">/</span><span class="n">sysaux01</span><span class="p">.</span><span class="n">dbf</span>
  <span class="mi">11</span>      <span class="k">Full</span> <span class="mi">3117873</span>    <span class="mi">20</span><span class="o">-</span><span class="n">JAN</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ORCLPDB1</span><span class="o">/</span><span class="n">undotbs01</span><span class="p">.</span><span class="n">dbf</span>
  <span class="mi">12</span>      <span class="k">Full</span> <span class="mi">3117873</span>    <span class="mi">20</span><span class="o">-</span><span class="n">JAN</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ORCLPDB1</span><span class="o">/</span><span class="n">users01</span><span class="p">.</span><span class="n">dbf</span>

<span class="n">List</span> <span class="k">of</span> <span class="n">Archived</span> <span class="n">Log</span> <span class="n">Copies</span> <span class="k">for</span> <span class="k">database</span> <span class="k">with</span> <span class="n">db_unique_name</span> <span class="n">ORCLCDB</span>
<span class="o">=====================================================================</span>

<span class="k">Key</span>     <span class="n">Thrd</span> <span class="n">Seq</span>     <span class="n">S</span> <span class="n">Low</span> <span class="nb">Time</span> 
<span class="c1">------- ---- ------- - ---------</span>
<span class="mi">94</span>      <span class="mi">1</span>    <span class="mi">20</span>      <span class="n">A</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
        <span class="n">Name</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="n">arch1_20_1185200241</span><span class="p">.</span><span class="n">dbf</span>

<span class="n">recovery</span> <span class="n">will</span> <span class="n">be</span> <span class="n">done</span> <span class="n">up</span> <span class="k">to</span> <span class="n">SCN</span> <span class="mi">3803434</span>
<span class="n">Media</span> <span class="n">recovery</span> <span class="k">start</span> <span class="n">SCN</span> <span class="k">is</span> <span class="mi">3803434</span>
<span class="n">Recovery</span> <span class="n">must</span> <span class="n">be</span> <span class="n">done</span> <span class="n">beyond</span> <span class="n">SCN</span> <span class="mi">3803434</span> <span class="k">to</span> <span class="n">clear</span> <span class="n">datafile</span> <span class="n">fuzziness</span>
<span class="n">Finished</span> <span class="n">restore</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
</pre></td></tr></tbody></table></code></div></div>

<p>De esta forma hemos configurado la base de datos en modo ArchiveLog y realizado una copia de seguridad en caliente con RMAN.</p>

<h2 id="ejercicio-4"><span class="me-2">Ejercicio 4</span><a href="#ejercicio-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Borra un fichero de datos de un tablespace e intenta recuperar la instancia de la base de datos a partir de la copia de seguridad creada en el punto anterior.</p>

<p>Para restaurar un archivo de un tablespace en la base de datos, eliminaré un archivo del tablespace <code class="language-plaintext highlighter-rouge">USERS</code>. Para hacerlo, necesitamos conectarnos a la base de datos con privilegios de SYSDBA.</p>

<p>Una vez dentro, podemos ver todos los tablespaces de la base de datos con esta consulta:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">TABLESPACE_NAME</span> 
  <span class="mi">2</span>  <span class="k">FROM</span> <span class="n">DBA_TABLESPACES</span><span class="p">;</span>

<span class="n">TABLESPACE_NAME</span>
<span class="c1">------------------------------</span>
<span class="k">SYSTEM</span>
<span class="n">SYSAUX</span>
<span class="n">UNDOTBS1</span>
<span class="k">TEMP</span>
<span class="n">USERS</span>
<span class="n">TS_RMAN</span>

<span class="mi">6</span> <span class="n">filas</span> <span class="n">seleccionadas</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Después, para ver los archivos asociados a los tablespaces, usamos esta otra consulta:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">FILE_NAME</span> 
  <span class="mi">2</span>  <span class="k">FROM</span> <span class="n">DBA_DATA_FILES</span><span class="p">;</span>

<span class="n">FILE_NAME</span>
<span class="c1">--------------------------------------------------------------------------------</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">system01</span><span class="p">.</span><span class="n">dbf</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">sysaux01</span><span class="p">.</span><span class="n">dbf</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">undotbs01</span><span class="p">.</span><span class="n">dbf</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">users01</span><span class="p">.</span><span class="n">dbf</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">ts_rman</span><span class="p">.</span><span class="n">dbf</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Después de revisar la información de los tablespaces y sus archivos, procedemos a eliminar el tablespace USERS. Antes de hacerlo, realizamos una copia de seguridad del archivo <code class="language-plaintext highlighter-rouge">users01.dbf</code> en un directorio destinado a las copias de seguridad, asegurándonos de poder restaurarlo en caso de ser necesario.</p>

<p>Primero, creamos el directorio donde guardaremos la copia:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">mkdir </span>rman_copia
</pre></td></tr></tbody></table></code></div></div>

<p>Luego, copiamos el archivo users01.dbf al directorio recién creado:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo cp</span> /opt/oracle/oradata/ORCLCDB/users01.dbf rman_copia/
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez hecho el respaldo, eliminamos el archivo original:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo rm</span> /opt/oracle/oradata/ORCLCDB/users01.dbf
</pre></td></tr></tbody></table></code></div></div>

<p>Para confirmar que el archivo se eliminó correctamente, verificamos el contenido del directorio donde estaba almacenado con el siguiente comando:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo ls</span> <span class="nt">-lh</span> /opt/oracle/oradata/ORCLCDB/  
total 2,8G
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 21:54 control01.ctl
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 21:54 control02.ctl
drwxr-x--- 2 oracle dba      4,0K nov 16 14:28 ORCLPDB1
drwxr-x--- 2 oracle dba      4,0K nov 16 14:20 pdbseed
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 20:59 redo01.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 21:00 redo02.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 21:53 redo03.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 591M mar  2 21:52 sysaux01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 941M mar  2 21:50 system01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall  33M mar  2 20:01 temp01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 301M mar  2 21:05 ts_rman.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 341M mar  2 21:50 undotbs01.dbf
</pre></td></tr></tbody></table></code></div></div>

<p>Para verificar si los datos se han eliminado correctamente, nos conectamos nuevamente a la base de datos con privilegios de SYSDBA y realizamos una consulta para comprobar si las tablas del usuario scott siguen existiendo.</p>

<p>Accedemos como SYSDBA e intentamos consultar los datos de las tablas mencionadas:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">scott</span><span class="p">.</span><span class="n">dept</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">scott</span><span class="p">.</span><span class="n">dept</span>
                    <span class="o">*</span>
<span class="n">ERROR</span> <span class="n">en</span> <span class="n">linea</span> <span class="mi">1</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01116</span><span class="p">:</span> <span class="n">error</span> <span class="n">al</span> <span class="n">abrir</span> <span class="n">el</span> <span class="n">archivo</span> <span class="n">de</span> <span class="n">base</span> <span class="n">de</span> <span class="n">datos</span> <span class="mi">7</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01110</span><span class="p">:</span> <span class="n">archivo</span> <span class="n">de</span> <span class="n">datos</span> <span class="mi">7</span><span class="p">:</span> <span class="s1">'/opt/oracle/oradata/ORCLCDB/users01.dbf'</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">27041</span><span class="p">:</span> <span class="k">no</span> <span class="n">se</span> <span class="n">ha</span> <span class="n">podido</span> <span class="n">abrir</span> <span class="n">el</span> <span class="n">archivo</span>
<span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span> <span class="n">Error</span><span class="p">:</span> <span class="mi">2</span><span class="p">:</span> <span class="k">No</span> <span class="n">such</span> <span class="n">file</span> <span class="k">or</span> <span class="n">directory</span>
<span class="n">Additional</span> <span class="n">information</span><span class="p">:</span> <span class="mi">3</span>


<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">scott</span><span class="p">.</span><span class="n">emp</span>
                    <span class="o">*</span>
<span class="n">ERROR</span> <span class="n">en</span> <span class="n">linea</span> <span class="mi">1</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01116</span><span class="p">:</span> <span class="n">error</span> <span class="n">al</span> <span class="n">abrir</span> <span class="n">el</span> <span class="n">archivo</span> <span class="n">de</span> <span class="n">base</span> <span class="n">de</span> <span class="n">datos</span> <span class="mi">7</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01110</span><span class="p">:</span> <span class="n">archivo</span> <span class="n">de</span> <span class="n">datos</span> <span class="mi">7</span><span class="p">:</span> <span class="s1">'/opt/oracle/oradata/ORCLCDB/users01.dbf'</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">27041</span><span class="p">:</span> <span class="k">no</span> <span class="n">se</span> <span class="n">ha</span> <span class="n">podido</span> <span class="n">abrir</span> <span class="n">el</span> <span class="n">archivo</span>
<span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span> <span class="n">Error</span><span class="p">:</span> <span class="mi">2</span><span class="p">:</span> <span class="k">No</span> <span class="n">such</span> <span class="n">file</span> <span class="k">or</span> <span class="n">directory</span>
<span class="n">Additional</span> <span class="n">information</span><span class="p">:</span> <span class="mi">3</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Al ejecutar estas consultas, observamos que se genera un error indicando que el archivo no se encuentra. Esto confirma que la eliminación previa del archivo <code class="language-plaintext highlighter-rouge">users01.dbf</code> afectó directamente a estas tablas, ya que la información que contenían estaba almacenada en el tablespace <code class="language-plaintext highlighter-rouge">USERS</code>.</p>

<p>Después de comprobar que las tablas DEPT y EMP no están accesibles debido a la eliminación del archivo users01.dbf, procedemos a restaurar la base de datos utilizando RMAN y la copia de seguridad previa.</p>

<p>Nos conectamos a RMAN con el siguiente comando:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="n">oracle</span><span class="o">@</span><span class="n">oracle19c</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">rman</span> <span class="n">target</span><span class="o">=/</span> <span class="k">catalog</span> <span class="n">RMAN</span><span class="o">/</span><span class="n">RMAN</span>  

<span class="n">Recovery</span> <span class="n">Manager</span><span class="p">:</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span> <span class="k">on</span> <span class="n">Sun</span> <span class="n">Mar</span> <span class="mi">2</span> <span class="mi">21</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">14</span> <span class="mi">2025</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">1982</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="n">Oracle</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="n">its</span> <span class="n">affiliates</span><span class="p">.</span>  <span class="k">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>

<span class="n">connected</span> <span class="k">to</span> <span class="n">target</span> <span class="k">database</span><span class="p">:</span> <span class="n">ORCLCDB</span> <span class="p">(</span><span class="n">DBID</span><span class="o">=</span><span class="mi">2956261615</span><span class="p">)</span>
<span class="n">connected</span> <span class="k">to</span> <span class="n">recovery</span> <span class="k">catalog</span> <span class="k">database</span>

<span class="n">RMAN</span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez dentro, verificamos si el archivo eliminado está disponible en la copia de seguridad ejecutando:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">list</span> <span class="n">backup</span> <span class="k">of</span> <span class="n">datafile</span> <span class="s1">'/opt/oracle/oradata/ORCLCDB/users01.dbf'</span><span class="p">;</span>  


<span class="n">List</span> <span class="k">of</span> <span class="n">Backup</span> <span class="k">Sets</span>
<span class="o">===================</span>


<span class="n">BS</span> <span class="k">Key</span>  <span class="k">Type</span> <span class="n">LV</span> <span class="k">Size</span>       <span class="n">Device</span> <span class="k">Type</span> <span class="n">Elapsed</span> <span class="nb">Time</span> <span class="k">Completion</span> <span class="nb">Time</span>
<span class="c1">------- ---- -- ---------- ----------- ------------ ---------------</span>
<span class="mi">95</span>      <span class="k">Full</span>    <span class="mi">1</span><span class="p">.</span><span class="mi">25</span><span class="k">G</span>      <span class="n">DISK</span>        <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">05</span>     <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>      
        <span class="n">BP</span> <span class="k">Key</span><span class="p">:</span> <span class="mi">99</span>   <span class="n">Status</span><span class="p">:</span> <span class="n">AVAILABLE</span>  <span class="n">Compressed</span><span class="p">:</span> <span class="k">NO</span>  <span class="n">Tag</span><span class="p">:</span> <span class="n">TAG20250302T205910</span>
        <span class="n">Piece</span> <span class="n">Name</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">023</span><span class="n">jc6su_1_1</span>
  <span class="n">List</span> <span class="k">of</span> <span class="n">Datafiles</span> <span class="k">in</span> <span class="n">backup</span> <span class="k">set</span> <span class="mi">95</span>
  <span class="n">File</span> <span class="n">LV</span> <span class="k">Type</span> <span class="n">Ckp</span> <span class="n">SCN</span>    <span class="n">Ckp</span> <span class="nb">Time</span>  <span class="k">Abs</span> <span class="n">Fuz</span> <span class="n">SCN</span> <span class="n">Sparse</span> <span class="n">Name</span>
  <span class="c1">---- -- ---- ---------- --------- ----------- ------ ----</span>
  <span class="mi">7</span>       <span class="k">Full</span> <span class="mi">3803434</span>    <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>              <span class="k">NO</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">users01</span><span class="p">.</span><span class="n">dbf</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Al ejecutar este comando, vemos que el archivo <code class="language-plaintext highlighter-rouge">users01.dbf</code> está presente en la copia de seguridad en caliente que realizamos anteriormente. Esto nos confirma que podemos proceder con la restauración para recuperar los datos eliminados.</p>

<p>Para restaurar el archivo users01.dbf que eliminamos, seguimos estos pasos:</p>

<p>Primero, ponemos el tablespace USERS en estado OFFLINE para evitar inconsistencias durante la restauración. Ejecutamos el siguiente comando en RMAN:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="k">SQL</span> <span class="nv">"ALTER TABLESPACE USERS OFFLINE IMMEDIATE"</span><span class="p">;</span>  

<span class="k">sql</span> <span class="k">statement</span><span class="p">:</span> <span class="k">ALTER</span> <span class="n">TABLESPACE</span> <span class="n">USERS</span> <span class="n">OFFLINE</span> <span class="k">IMMEDIATE</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez que el tablespace está desactivado, procedemos a restaurar el archivo desde la copia de seguridad con el siguiente comando en RMAN:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">RESTORE</span> <span class="n">TABLESPACE</span> <span class="n">USERS</span><span class="p">;</span>  

<span class="n">Starting</span> <span class="n">restore</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">allocated</span> <span class="n">channel</span><span class="p">:</span> <span class="n">ORA_DISK_1</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">SID</span><span class="o">=</span><span class="mi">19</span> <span class="n">device</span> <span class="k">type</span><span class="o">=</span><span class="n">DISK</span>

<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">starting</span> <span class="n">datafile</span> <span class="n">backup</span> <span class="k">set</span> <span class="n">restore</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">specifying</span> <span class="n">datafile</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">to</span> <span class="n">restore</span> <span class="k">from</span> <span class="n">backup</span> <span class="k">set</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">restoring</span> <span class="n">datafile</span> <span class="mi">00007</span> <span class="k">to</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">users01</span><span class="p">.</span><span class="n">dbf</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">reading</span> <span class="k">from</span> <span class="n">backup</span> <span class="n">piece</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">023</span><span class="n">jc6su_1_1</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">piece</span> <span class="n">handle</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mi">19</span><span class="k">c</span><span class="o">/</span><span class="n">dbhome_1</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="mi">023</span><span class="n">jc6su_1_1</span> <span class="n">tag</span><span class="o">=</span><span class="n">TAG20250302T205910</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">restored</span> <span class="n">backup</span> <span class="n">piece</span> <span class="mi">1</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">restore</span> <span class="n">complete</span><span class="p">,</span> <span class="n">elapsed</span> <span class="nb">time</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>
<span class="n">Finished</span> <span class="n">restore</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Después de la restauración, realizamos la recuperación del tablespace para aplicar los cambios registrados en los archivos de redo logs y dejarlo en un estado consistente:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">RECOVER</span> <span class="n">TABLESPACE</span> <span class="n">USERS</span><span class="p">;</span>

<span class="n">Starting</span> <span class="n">recover</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="k">using</span> <span class="n">channel</span> <span class="n">ORA_DISK_1</span>

<span class="n">starting</span> <span class="n">media</span> <span class="n">recovery</span>
<span class="n">media</span> <span class="n">recovery</span> <span class="n">complete</span><span class="p">,</span> <span class="n">elapsed</span> <span class="nb">time</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>

<span class="n">Finished</span> <span class="n">recover</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Por último, volvemos a activar el tablespace USERS para que la base de datos pueda acceder nuevamente a los datos almacenados en él:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="k">SQL</span> <span class="nv">"ALTER TABLESPACE USERS ONLINE"</span><span class="p">;</span>  

<span class="k">sql</span> <span class="k">statement</span><span class="p">:</span> <span class="k">ALTER</span> <span class="n">TABLESPACE</span> <span class="n">USERS</span> <span class="n">ONLINE</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Con esto, el archivo <code class="language-plaintext highlighter-rouge">users01.dbf</code> ha sido restaurado y ya deberíamos poder acceder a los datos como antes de la eliminación.</p>

<p>Para comprobar que la restauración ha sido exitosa, podemos verificarlo de dos maneras:</p>

<p>Accediendo a la base de datos y ejecutando las consultas previas sobre las tablas <code class="language-plaintext highlighter-rouge">scott.emp</code> y <code class="language-plaintext highlighter-rouge">scott.dept</code> para confirmar que devuelven datos correctamente:</p>

<p><a href="/assets/img/posts/copiaseg/image3.png" class="popup img-link  shimmer"><img src="/assets/img/posts/copiaseg/image3.png" alt="image" loading="lazy"></a></p>

<p>Revisando el directorio donde estaba el archivo restaurado con el siguiente comando:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo ls</span> <span class="nt">-lh</span> /opt/oracle/oradata/ORCLCDB/  
total 2,8G
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 22:04 control01.ctl
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 22:04 control02.ctl
drwxr-x--- 2 oracle dba      4,0K nov 16 14:28 ORCLPDB1
drwxr-x--- 2 oracle dba      4,0K nov 16 14:20 pdbseed
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 20:59 redo01.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 21:00 redo02.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 22:04 redo03.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 591M mar  2 22:04 sysaux01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 941M mar  2 22:04 system01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall  33M mar  2 20:01 temp01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 301M mar  2 22:04 ts_rman.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 341M mar  2 22:04 undotbs01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall  16M mar  2 22:03 users01.dbf
</pre></td></tr></tbody></table></code></div></div>

<h2 id="ejercicio-5"><span class="me-2">Ejercicio 5</span><a href="#ejercicio-5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Borra un fichero de control e intenta recuperar la base de datos a partir de la copia de seguridad creada en el punto anterior.</p>

<p>Para simular la pérdida de un fichero de control y su posterior recuperación utilizando la copia de seguridad de RMAN, seguimos los siguientes pasos:</p>

<p>Primero, eliminamos manualmente el fichero de control con el siguiente comando:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo rm</span> <span class="nt">-rf</span> /opt/oracle/oradata/ORCLCDB/control01.ctl
</pre></td></tr></tbody></table></code></div></div>

<p>Para confirmar que se ha eliminado correctamente, listamos los archivos en el directorio correspondiente:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo ls</span> <span class="nt">-lh</span> /opt/oracle/oradata/ORCLCDB/  
total 2,8G
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 22:24 control02.ctl
drwxr-x--- 2 oracle dba      4,0K nov 16 14:28 ORCLPDB1
drwxr-x--- 2 oracle dba      4,0K nov 16 14:20 pdbseed
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 20:59 redo01.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 21:00 redo02.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 22:24 redo03.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 591M mar  2 22:24 sysaux01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 941M mar  2 22:20 system01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall  33M mar  2 20:01 temp01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 301M mar  2 22:09 ts_rman.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 341M mar  2 22:24 undotbs01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall  16M mar  2 22:03 users01.dbf
</pre></td></tr></tbody></table></code></div></div>

<p>A continuación, accedemos a la base de datos como SYSDBA y forzamos su apagado con <em>shutdown abort</em>, ya que sin el fichero de control, la base de datos no podrá funcionar correctamente. Luego, la iniciamos en modo nomount:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="n">oracle</span><span class="o">@</span><span class="n">oracle19c</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sqlplus</span> <span class="o">/</span> <span class="k">as</span> <span class="n">sysdba</span>

<span class="k">SQL</span><span class="o">*</span><span class="n">Plus</span><span class="p">:</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span> <span class="k">on</span> <span class="n">Sun</span> <span class="n">Mar</span> <span class="mi">2</span> <span class="mi">22</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">25</span> <span class="mi">2025</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">1982</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="n">Oracle</span><span class="p">.</span>  <span class="k">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>


<span class="n">Conectado</span> <span class="n">a</span><span class="p">:</span>
<span class="n">Oracle</span> <span class="k">Database</span> <span class="mi">19</span><span class="k">c</span> <span class="n">Enterprise</span> <span class="n">Edition</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">shutdown</span> <span class="k">abort</span><span class="p">;</span>
<span class="n">Instancia</span> <span class="n">ORACLE</span> <span class="n">cerrada</span><span class="p">.</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">startup</span> <span class="n">nomount</span><span class="p">;</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">32004</span><span class="p">:</span> <span class="n">obsolete</span> <span class="k">or</span> <span class="n">deprecated</span> <span class="k">parameter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">specified</span> <span class="k">for</span> <span class="n">RDBMS</span> <span class="n">instance</span>
<span class="n">Instancia</span> <span class="n">ORACLE</span> <span class="n">iniciada</span><span class="p">.</span>

<span class="n">Total</span> <span class="k">System</span> <span class="k">Global</span> <span class="n">Area</span> <span class="mi">1644164456</span> <span class="n">bytes</span>
<span class="nb">Fixed</span> <span class="k">Size</span>		    <span class="mi">9135464</span> <span class="n">bytes</span>
<span class="k">Variable</span> <span class="k">Size</span>		 <span class="mi">1275068416</span> <span class="n">bytes</span>
<span class="k">Database</span> <span class="n">Buffers</span>	  <span class="mi">352321536</span> <span class="n">bytes</span>
<span class="n">Redo</span> <span class="n">Buffers</span>		    <span class="mi">7639040</span> <span class="n">bytes</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Después, nos conectamos a RMAN para restaurar la base de datos desde la copia de seguridad. Como primer paso, intentamos listar los ficheros de control incluidos en la copia con el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="n">oracle</span><span class="o">@</span><span class="n">oracle19c</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">rman</span>

<span class="n">Recovery</span> <span class="n">Manager</span><span class="p">:</span> <span class="n">Release</span> <span class="mi">19</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">Production</span> <span class="k">on</span> <span class="n">Sun</span> <span class="n">Mar</span> <span class="mi">2</span> <span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">21</span> <span class="mi">2025</span>
<span class="k">Version</span> <span class="mi">19</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">1982</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="n">Oracle</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="n">its</span> <span class="n">affiliates</span><span class="p">.</span>  <span class="k">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>

<span class="n">RMAN</span><span class="o">&gt;</span> <span class="k">connect</span> <span class="n">target</span>

<span class="n">connected</span> <span class="k">to</span> <span class="n">target</span> <span class="k">database</span><span class="p">:</span> <span class="n">ORCLCDB</span> <span class="p">(</span><span class="k">not</span> <span class="n">mounted</span><span class="p">)</span>

<span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">list</span> <span class="n">backup</span> <span class="k">of</span> <span class="n">controlfile</span><span class="p">;</span>    

<span class="k">using</span> <span class="n">target</span> <span class="k">database</span> <span class="n">control</span> <span class="n">file</span> <span class="k">instead</span> <span class="k">of</span> <span class="n">recovery</span> <span class="k">catalog</span>
<span class="n">RMAN</span><span class="o">-</span><span class="mi">00571</span><span class="p">:</span> <span class="o">===========================================================</span>
<span class="n">RMAN</span><span class="o">-</span><span class="mi">00569</span><span class="p">:</span> <span class="o">===============</span> <span class="n">ERROR</span> <span class="n">MESSAGE</span> <span class="n">STACK</span> <span class="n">FOLLOWS</span> <span class="o">===============</span>
<span class="n">RMAN</span><span class="o">-</span><span class="mi">00571</span><span class="p">:</span> <span class="o">===========================================================</span>
<span class="n">RMAN</span><span class="o">-</span><span class="mi">03002</span><span class="p">:</span> <span class="n">failure</span> <span class="k">of</span> <span class="n">list</span> <span class="n">command</span> <span class="k">at</span> <span class="mi">03</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">2025</span> <span class="mi">22</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">33</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01507</span><span class="p">:</span> <span class="n">base</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">sin</span> <span class="n">montar</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Aquí observamos que, al no tener la base de datos montada, no podemos acceder al catálogo de RMAN directamente. La solución es restaurar el fichero de control manualmente, pero para ello debemos conocer su ubicación en la copia de seguridad. Para verificarlo, usamos el siguiente comando:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lh</span> /opt/oracle/product/19c/dbhome_1/dbs/  
total 2,6G
<span class="nt">-rw-r-----</span> 1 oracle oinstall 106M mar  2 20:59 013jc6ss_1_1
<span class="nt">-rw-r-----</span> 1 oracle oinstall 1,3G mar  2 20:59 023jc6su_1_1
<span class="nt">-rw-r-----</span> 1 oracle oinstall 474M mar  2 20:59 033jc6t5_1_1
<span class="nt">-rw-r-----</span> 1 oracle oinstall 555M mar  2 20:59 043jc6tu_1_1
<span class="nt">-rw-r-----</span> 1 oracle oinstall 375K mar  2 21:00 053jc6uo_1_1
<span class="nt">-rw-r-----</span> 1 oracle oinstall 106M mar  2 20:59 arch1_19_1185200241.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 372K mar  2 21:00 arch1_20_1185200241.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 21:00 c-2956261615-20250302-00
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 22:10 c-2956261615-20250302-01
<span class="nt">-rw-rw----</span> 1 oracle oinstall 1,6K mar  2 22:25 hc_GN25.dat
<span class="nt">-rw-rw----</span> 1 oracle oinstall 1,6K nov 17 17:42 hc_ORCLCDB.dat
<span class="nt">-rw-r--r--</span> 1 oracle dba        64 nov 18 12:48 initGN25.ora
<span class="nt">-rw-r--r--</span> 1 oracle oinstall 3,1K may 14  2015 init.ora
<span class="nt">-rw-r-----</span> 1 oracle oinstall   24 nov 16 14:15 lkORCLCDB
<span class="nt">-rw-r-----</span> 1 oracle dba      2,0K nov 16 14:17 orapwORCLCDB
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 22:10 snapcf_GN25.f
<span class="nt">-rw-r-----</span> 1 oracle oinstall 4,5K mar  2 20:45 spfileORCLCDB.ora
</pre></td></tr></tbody></table></code></div></div>

<p>Al ver que el fichero de control está almacenado en esa ubicación, procedemos a restaurarlo manualmente desde RMAN ejecutando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">restore</span> <span class="n">controlfile</span> <span class="k">from</span> <span class="s1">'/opt/oracle/product/19c/dbhome_1/dbs/c-2956261615-20250302-01'</span><span class="p">;</span>        

<span class="n">Starting</span> <span class="n">restore</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="k">using</span> <span class="n">target</span> <span class="k">database</span> <span class="n">control</span> <span class="n">file</span> <span class="k">instead</span> <span class="k">of</span> <span class="n">recovery</span> <span class="k">catalog</span>
<span class="n">allocated</span> <span class="n">channel</span><span class="p">:</span> <span class="n">ORA_DISK_1</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">SID</span><span class="o">=</span><span class="mi">134</span> <span class="n">device</span> <span class="k">type</span><span class="o">=</span><span class="n">DISK</span>

<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">restoring</span> <span class="n">control</span> <span class="n">file</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">restore</span> <span class="n">complete</span><span class="p">,</span> <span class="n">elapsed</span> <span class="nb">time</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>
<span class="k">output</span> <span class="n">file</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">control01</span><span class="p">.</span><span class="n">ctl</span>
<span class="k">output</span> <span class="n">file</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">control02</span><span class="p">.</span><span class="n">ctl</span>
<span class="n">Finished</span> <span class="n">restore</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Después de restaurar el fichero de control correctamente, seguimos con la recuperación de la base de datos. Primero, la montamos nuevamente con el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">database</span> <span class="n">mount</span><span class="p">;</span>  

<span class="n">released</span> <span class="n">channel</span><span class="p">:</span> <span class="n">ORA_DISK_1</span>
<span class="k">Statement</span> <span class="n">processed</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Luego, aplicamos la recuperación:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="n">recover</span> <span class="k">database</span><span class="p">;</span>

<span class="n">Starting</span> <span class="n">recover</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
<span class="n">allocated</span> <span class="n">channel</span><span class="p">:</span> <span class="n">ORA_DISK_1</span>
<span class="n">channel</span> <span class="n">ORA_DISK_1</span><span class="p">:</span> <span class="n">SID</span><span class="o">=</span><span class="mi">391</span> <span class="n">device</span> <span class="k">type</span><span class="o">=</span><span class="n">DISK</span>

<span class="n">starting</span> <span class="n">media</span> <span class="n">recovery</span>

<span class="n">archived</span> <span class="n">log</span> <span class="k">for</span> <span class="n">thread</span> <span class="mi">1</span> <span class="k">with</span> <span class="n">sequence</span> <span class="mi">21</span> <span class="k">is</span> <span class="n">already</span> <span class="k">on</span> <span class="n">disk</span> <span class="k">as</span> <span class="n">file</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">redo03</span><span class="p">.</span><span class="n">log</span>
<span class="n">archived</span> <span class="n">log</span> <span class="n">file</span> <span class="n">name</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">oradata</span><span class="o">/</span><span class="n">ORCLCDB</span><span class="o">/</span><span class="n">redo03</span><span class="p">.</span><span class="n">log</span> <span class="n">thread</span><span class="o">=</span><span class="mi">1</span> <span class="n">sequence</span><span class="o">=</span><span class="mi">21</span>
<span class="n">media</span> <span class="n">recovery</span> <span class="n">complete</span><span class="p">,</span> <span class="n">elapsed</span> <span class="nb">time</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Finished</span> <span class="n">recover</span> <span class="k">at</span> <span class="mi">02</span><span class="o">-</span><span class="n">MAR</span><span class="o">-</span><span class="mi">25</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Finalmente, abrimos la base de datos reseteando los logs para asegurar su consistencia:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">RMAN</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">database</span> <span class="k">open</span> <span class="n">resetlogs</span><span class="p">;</span>

<span class="k">Statement</span> <span class="n">processed</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Para verificar que todo se ha restaurado correctamente, listamos los archivos en el directorio de la base de datos:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>oracle@oracle19c:~<span class="nv">$ </span><span class="nb">sudo ls</span> <span class="nt">-lh</span> /opt/oracle/oradata/ORCLCDB/
total 2,8G
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 22:38 control01.ctl
<span class="nt">-rw-r-----</span> 1 oracle oinstall  18M mar  2 22:38 control02.ctl
drwxr-x--- 2 oracle dba      4,0K nov 16 14:28 ORCLPDB1
drwxr-x--- 2 oracle dba      4,0K nov 16 14:20 pdbseed
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 22:38 redo01.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 22:34 redo02.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 201M mar  2 22:34 redo03.log
<span class="nt">-rw-r-----</span> 1 oracle oinstall 591M mar  2 22:34 sysaux01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 941M mar  2 22:34 system01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall  33M mar  2 20:01 temp01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 301M mar  2 22:34 ts_rman.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall 341M mar  2 22:34 undotbs01.dbf
<span class="nt">-rw-r-----</span> 1 oracle oinstall  16M mar  2 22:34 users01.dbf
</pre></td></tr></tbody></table></code></div></div>

<p>Con estos pasos, hemos logrado restaurar la base de datos utilizando la copia de seguridad de RMAN y los archivos de registro de ArchiveLog, asegurando que el sistema vuelva a un estado operativo correcto.</p>

<h2 id="ejercicio-6"><span class="me-2">Ejercicio 6</span><a href="#ejercicio-6" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Documenta el empleo de las herramientas de copia de seguridad y restauración de Postgres.</p>

<p>Para crear una copia de seguridad completa de todas nuestras bases de datos, utilizamos el comando pg_dumpall. Este comando volcará toda la información de nuestras bases de datos en un archivo .sql. A continuación, ejecutamos el siguiente comando:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>postgres@servidor-postgre1:~<span class="nv">$ </span>pg_dumpall <span class="nt">-U</span> postgres <span class="nt">-f</span> copias/copia_<span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%Y%m%d%H%M%S"</span><span class="si">)</span>.sql
</pre></td></tr></tbody></table></code></div></div>

<p>Este comando utiliza <code class="language-plaintext highlighter-rouge">pg_dumpall</code> con el usuario postgres y genera un archivo de copia con un nombre que incluye la fecha y hora exacta en que se crea la copia. El resultado es un archivo <code class="language-plaintext highlighter-rouge">.sql</code> que contiene todos los datos necesarios para restaurar las bases de datos si fuera necesario. Al ejecutar este comando, el archivo <code class="language-plaintext highlighter-rouge">copia_$(date +"%Y%m%d%H%M%S").sql</code> se guarda en la ruta especificada.</p>

<p>Al verificar el directorio donde guardamos las copias, encontramos el archivo copia.sql o el archivo con el nombre generado dinámicamente que contiene la copia de seguridad.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>postgres@servidor-postgre1:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> copias/
total 108
<span class="nt">-rw-r--r--</span> 1 postgres postgres 109080 mar  2 23:09 copia_20250302230919.sql
</pre></td></tr></tbody></table></code></div></div>

<p>Antes de realizar una restauración, podemos verificar la existencia de las bases de datos y las tablas correspondientes. En nuestro caso, accedemos a la base de datos empresa con el siguiente comando:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>pablo@servidor-postgre1:~<span class="nv">$ </span>psql <span class="nt">-U</span> usuario <span class="nt">-d</span> empresa <span class="nt">-h</span> localhost
Contraseña para usuario usuario: 
psql <span class="o">(</span>15.9 <span class="o">(</span>Debian 15.9-0+deb12u1<span class="o">))</span>
Conexión SSL <span class="o">(</span>protocolo: TLSv1.3, cifrado: TLS_AES_256_GCM_SHA384, compresión: desactivado<span class="o">)</span>
Digite «help» para obtener ayuda.

<span class="nv">empresa</span><span class="o">=&gt;</span> <span class="se">\d</span>
                Listado de relaciones
 Esquema |        Nombre        |   Tipo    |  Dueño  
<span class="nt">---------</span>+----------------------+-----------+---------
 public  | asignaciones         | tabla     | usuario
 public  | asignaciones_id_seq  | secuencia | usuario
 public  | departamentos        | tabla     | usuario
 public  | departamentos_id_seq | secuencia | usuario
 public  | empleados            | tabla     | usuario
 public  | empleados_id_seq     | secuencia | usuario
 public  | proyectos            | tabla     | usuario
 public  | proyectos_id_seq     | secuencia | usuario
<span class="o">(</span>8 filas<span class="o">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Aquí podemos ver que las tablas asignaciones, departamentos, empleados y proyectos están presentes.</p>

<p>Para realizar la restauración, vamos a eliminar varias tabla para simular la pérdida de datos. Por ejemplo, eliminamos la tabla asignaciones y empleados:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="n">empresa</span><span class="o">=&gt;</span> <span class="k">drop</span> <span class="k">table</span> <span class="n">asignaciones</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span>
<span class="n">empresa</span><span class="o">=&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">asignaciones</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="k">no</span> <span class="n">existe</span> <span class="n">la</span> <span class="n">relaci</span><span class="err">ó</span><span class="n">n</span> <span class="err">«</span><span class="n">asignaciones</span><span class="err">»</span>
<span class="n">L</span><span class="err">Í</span><span class="n">NEA</span> <span class="mi">1</span><span class="p">:</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">asignaciones</span><span class="p">;</span>
<span class="n">empresa</span><span class="o">=&gt;</span> <span class="k">drop</span> <span class="k">table</span> <span class="n">empleados</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span>
<span class="n">empresa</span><span class="o">=&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">empleados</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="k">no</span> <span class="n">existe</span> <span class="n">la</span> <span class="n">relaci</span><span class="err">ó</span><span class="n">n</span> <span class="err">«</span><span class="n">empleados</span><span class="err">»</span>
<span class="n">L</span><span class="err">Í</span><span class="n">NEA</span> <span class="mi">1</span><span class="p">:</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">empleados</span><span class="p">;</span>
                       <span class="o">^</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez eliminados los datos, podemos proceder a la restauración. Utilizamos el comando psql para restaurar la base de datos desde el archivo de copia de seguridad:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre></td><td class="rouge-code"><pre>pablo@servidor-postgre1:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span> <span class="nt">-u</span> postgres
postgres@servidor-postgre1:~<span class="nv">$ </span>psql <span class="nt">-U</span> postgres <span class="nt">-f</span> copias/copia_20250302230919.sql
SET
SET
SET
psql:copias/copia_20250302230919.sql:14: ERROR:  el rol «empleado» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:16: ERROR:  el rol «kaka» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:18: ERROR:  el rol «pablo» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:20: ERROR:  el rol «pablo1» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:22: ERROR:  el rol «pabloexamen» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:24: ERROR:  el rol «pablomartin» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:26: ERROR:  el rol «pablomh» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:28: ERROR:  el rol «pabloprueba» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:30: ERROR:  el rol «pavlo» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:32: ERROR:  el rol «postgres» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:34: ERROR:  el rol «prueba» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:36: ERROR:  el rol «raul» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:38: ERROR:  el rol «scott» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:40: ERROR:  el rol «usuario» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:42: ERROR:  el rol «usuario1» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:44: ERROR:  el rol «usuario_copia» ya existe
ALTER ROLE
psql:copias/copia_20250302230919.sql:46: ERROR:  el rol «usuario_vacio» ya existe
ALTER ROLE
ALTER ROLE
psql:copias/copia_20250302230919.sql:64: NOTICE:  el rol «usuario1» ya es un miembro del rol «kaka»
GRANT ROLE
psql:copias/copia_20250302230919.sql:65: NOTICE:  el rol «usuario_copia» ya es un miembro del rol «usuario»
GRANT ROLE
Ahora está conectado a la base de datos «template1» con el usuario «postgres».
SET
SET
SET
SET
SET
 set_config 
<span class="nt">------------</span>
 
<span class="o">(</span>1 fila<span class="o">)</span>

SET
SET
SET
SET
SET
SET
SET
SET
SET
 set_config 
<span class="nt">------------</span>
 
<span class="o">(</span>1 fila<span class="o">)</span>

SET
SET
SET
SET
.....
</pre></td></tr></tbody></table></code></div></div>

<p>Durante la restauración, se generarán mensajes de advertencia si algunos usuarios ya existen en la base de datos, pero no es un problema grave, ya que se restaurarán todos los datos perdidos o eliminados.</p>

<p>Justo después de haber hecho la restauración, podemos verificar que ambas tablas han sido restauradas a la perfección:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="n">pablo</span><span class="o">@</span><span class="n">servidor</span><span class="o">-</span><span class="n">postgre1</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">psql</span> <span class="o">-</span><span class="n">U</span> <span class="n">usuario</span> <span class="o">-</span><span class="n">d</span> <span class="n">empresa</span> <span class="o">-</span><span class="n">h</span> <span class="n">localhost</span>
<span class="n">Contrase</span><span class="err">ñ</span><span class="n">a</span> <span class="n">para</span> <span class="n">usuario</span> <span class="n">usuario</span><span class="p">:</span> 
<span class="n">psql</span> <span class="p">(</span><span class="mi">15</span><span class="p">.</span><span class="mi">9</span> <span class="p">(</span><span class="n">Debian</span> <span class="mi">15</span><span class="p">.</span><span class="mi">9</span><span class="o">-</span><span class="mi">0</span><span class="o">+</span><span class="n">deb12u1</span><span class="p">))</span>
<span class="n">Conexi</span><span class="err">ó</span><span class="n">n</span> <span class="n">SSL</span> <span class="p">(</span><span class="n">protocolo</span><span class="p">:</span> <span class="n">TLSv1</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="n">cifrado</span><span class="p">:</span> <span class="n">TLS_AES_256_GCM_SHA384</span><span class="p">,</span> <span class="n">compresi</span><span class="err">ó</span><span class="n">n</span><span class="p">:</span> <span class="n">desactivado</span><span class="p">)</span>
<span class="n">Digite</span> <span class="err">«</span><span class="n">help</span><span class="err">»</span> <span class="n">para</span> <span class="n">obtener</span> <span class="n">ayuda</span><span class="p">.</span>

<span class="n">empresa</span><span class="o">=&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">empleados</span><span class="p">;</span>
 <span class="n">id</span> <span class="o">|</span>    <span class="n">nombre</span>    <span class="o">|</span>     <span class="n">cargo</span>     <span class="o">|</span> <span class="n">id_departamento</span> 
<span class="c1">----+--------------+---------------+-----------------</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="n">Ana</span> <span class="n">P</span><span class="err">é</span><span class="n">rez</span>    <span class="o">|</span> <span class="n">Gerente</span>       <span class="o">|</span>               <span class="mi">1</span>
  <span class="mi">2</span> <span class="o">|</span> <span class="n">Carlos</span> <span class="n">L</span><span class="err">ó</span><span class="n">pez</span> <span class="o">|</span> <span class="n">Desarrollador</span> <span class="o">|</span>               <span class="mi">2</span>
  <span class="mi">3</span> <span class="o">|</span> <span class="n">Elena</span> <span class="n">Garc</span><span class="err">í</span><span class="n">a</span> <span class="o">|</span> <span class="n">Vendedor</span>      <span class="o">|</span>               <span class="mi">3</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">filas</span><span class="p">)</span>

<span class="n">empresa</span><span class="o">=&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">departamentos</span><span class="p">;</span>
 <span class="n">id</span> <span class="o">|</span>      <span class="n">nombre</span>      
<span class="c1">----+------------------</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="n">Recursos</span> <span class="n">Humanos</span>
  <span class="mi">2</span> <span class="o">|</span> <span class="n">Desarrollo</span>
  <span class="mi">3</span> <span class="o">|</span> <span class="n">Ventas</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">filas</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Para realizar copias de seguridad automáticas, podemos configurar un servicio y un temporizador en systemd. El servicio ejecutará el comando <code class="language-plaintext highlighter-rouge">pg_dumpall</code> diariamente, y el archivo de la copia tendrá un nombre único con la fecha y hora de la creación.</p>

<p>Creación del servicio: Creamos un archivo de servicio que ejecute la copia de seguridad:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>pablo@servidor-postgre1:~<span class="nv">$ </span><span class="nb">sudo cat</span> /etc/systemd/system/copia_postgres.service
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Postgres Copias

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>oneshot
<span class="nv">ExecStart</span><span class="o">=</span>/bin/bash <span class="nt">-c</span> <span class="s1">'psql -U postgres -f copias/copia_$(date +"%Y%m%d%H%M%S").sql'</span>

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></td></tr></tbody></table></code></div></div>

<p>En este archivo, especificamos que el servicio ejecutará el siguiente comando para crear la copia de seguridad.</p>

<p>Luego, creamos un temporizador que ejecute el servicio todos los días a las 22:00:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>pablo@servidor-postgre1:~<span class="nv">$ </span><span class="nb">sudo cat</span> /etc/systemd/system/copia_postgres.timer
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Postgres Copias Temporizador

<span class="o">[</span>Timer]
<span class="nv">OnCalendar</span><span class="o">=</span><span class="k">*</span>-<span class="k">*</span>-<span class="k">*</span> 22:00:00
<span class="nv">Persistent</span><span class="o">=</span><span class="nb">true</span>

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>timers.target
</pre></td></tr></tbody></table></code></div></div>

<p>Finalmente, recargamos systemd y habilitamos el temporizador para que se ejecute diariamente:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>pablo@servidor-postgre1:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl daemon-reload
pablo@servidor-postgre1:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>copia_postgres.timer
Created symlink /etc/systemd/system/timers.target.wants/copia_postgres.timer → /etc/systemd/system/copia_postgres.timer.
pablo@servidor-postgre1:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl start copia_postgres.timer
</pre></td></tr></tbody></table></code></div></div>

<p>Con esto, las copias de seguridad se realizarán automáticamente a las 22:00 todos los días, y se guardarán con un nombre único basado en la fecha y hora.</p>

<h2 id="ejercicio-7"><span class="me-2">Ejercicio 7</span><a href="#ejercicio-7" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Documenta el empleo de las herramientas de copia de seguridad y restauración de MySQL.</p>

<p>Para realizar copias de seguridad y restauraciones en MySQL, utilizamos la herramienta mysqldump. En nuestro caso, vamos a 
hacer una copia de todas las bases de datos del servidor y luego restaurarlas en caso de ser necesario.</p>

<p>Para generar un respaldo de todas las bases de datos, ejecutamos el siguiente comando:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo </span>mysqldump <span class="nt">-u</span> root <span class="nt">-p</span> <span class="nt">--all-databases</span> <span class="o">&gt;</span> respaldo.sql
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez finalizado el proceso, podemos comprobar que el archivo de copia se ha generado correctamente:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lh</span> respaldo.sql
<span class="nt">-rw-r--r--</span> 1 pablo pablo 5,7M mar  3 08:28 respaldo.sql
</pre></td></tr></tbody></table></code></div></div>

<p>Para comprobar que la restauración funciona correctamente, vamos a eliminar algunas bases de datos:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre><span class="n">pablo</span><span class="o">@</span><span class="n">servidor</span><span class="o">-</span><span class="n">mariadb</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">mysql</span>
<span class="n">Welcome</span> <span class="k">to</span> <span class="n">the</span> <span class="n">MariaDB</span> <span class="n">monitor</span><span class="p">.</span>  <span class="n">Commands</span> <span class="k">end</span> <span class="k">with</span> <span class="p">;</span> <span class="k">or</span> <span class="err">\</span><span class="k">g</span><span class="p">.</span>
<span class="n">Your</span> <span class="n">MariaDB</span> <span class="k">connection</span> <span class="n">id</span> <span class="k">is</span> <span class="mi">33</span>
<span class="n">Server</span> <span class="k">version</span><span class="p">:</span> <span class="mi">10</span><span class="p">.</span><span class="mi">11</span><span class="p">.</span><span class="mi">6</span><span class="o">-</span><span class="n">MariaDB</span><span class="o">-</span><span class="mi">0</span><span class="o">+</span><span class="n">deb12u1</span><span class="o">-</span><span class="n">log</span> <span class="n">Debian</span> <span class="mi">12</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="n">Oracle</span><span class="p">,</span> <span class="n">MariaDB</span> <span class="n">Corporation</span> <span class="n">Ab</span> <span class="k">and</span> <span class="n">others</span><span class="p">.</span>

<span class="k">Type</span> <span class="s1">'help;'</span> <span class="k">or</span> <span class="s1">'</span><span class="se">\h</span><span class="s1">'</span> <span class="k">for</span> <span class="n">help</span><span class="p">.</span> <span class="k">Type</span> <span class="s1">'</span><span class="se">\c</span><span class="s1">'</span> <span class="k">to</span> <span class="n">clear</span> <span class="n">the</span> <span class="k">current</span> <span class="k">input</span> <span class="k">statement</span><span class="p">.</span>

<span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">DATABASES</span><span class="p">;</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="k">Database</span>           <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="n">Examen</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">datoscsv</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">empresa</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">empresa_copia</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">empresa_datos</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">empresa_vacia</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">information_schema</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">mysql</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">performance_schema</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">practica1_abd</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">sakila</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">scott</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">sys</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="mi">13</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">empresa_copia</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">2</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">038</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">empresa_datos</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">2</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">014</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">empresa_vacia</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">2</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">016</span> <span class="n">sec</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Ya hemos eliminado varias bases de datos, por lo tanto, para recuperar todas las bases de datos eliminadas, utilizamos el 
archivo de respaldo que creamos anteriormente:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo </span>mysql <span class="nt">-u</span> root <span class="nt">-p</span> &lt; respaldo.sql
</pre></td></tr></tbody></table></code></div></div>

<p>Una vez finalizada la restauración, verificamos que las bases de datos han sido recuperadas:</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="rouge-code"><pre><span class="n">pablo</span><span class="o">@</span><span class="n">servidor</span><span class="o">-</span><span class="n">mariadb</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">mysql</span>
<span class="n">Welcome</span> <span class="k">to</span> <span class="n">the</span> <span class="n">MariaDB</span> <span class="n">monitor</span><span class="p">.</span>  <span class="n">Commands</span> <span class="k">end</span> <span class="k">with</span> <span class="p">;</span> <span class="k">or</span> <span class="err">\</span><span class="k">g</span><span class="p">.</span>
<span class="n">Your</span> <span class="n">MariaDB</span> <span class="k">connection</span> <span class="n">id</span> <span class="k">is</span> <span class="mi">35</span>
<span class="n">Server</span> <span class="k">version</span><span class="p">:</span> <span class="mi">10</span><span class="p">.</span><span class="mi">11</span><span class="p">.</span><span class="mi">6</span><span class="o">-</span><span class="n">MariaDB</span><span class="o">-</span><span class="mi">0</span><span class="o">+</span><span class="n">deb12u1</span><span class="o">-</span><span class="n">log</span> <span class="n">Debian</span> <span class="mi">12</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="n">Oracle</span><span class="p">,</span> <span class="n">MariaDB</span> <span class="n">Corporation</span> <span class="n">Ab</span> <span class="k">and</span> <span class="n">others</span><span class="p">.</span>

<span class="k">Type</span> <span class="s1">'help;'</span> <span class="k">or</span> <span class="s1">'</span><span class="se">\h</span><span class="s1">'</span> <span class="k">for</span> <span class="n">help</span><span class="p">.</span> <span class="k">Type</span> <span class="s1">'</span><span class="se">\c</span><span class="s1">'</span> <span class="k">to</span> <span class="n">clear</span> <span class="n">the</span> <span class="k">current</span> <span class="k">input</span> <span class="k">statement</span><span class="p">.</span>

<span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">DATABASES</span><span class="p">;</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="k">Database</span>           <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="n">Examen</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">datoscsv</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">empresa</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">empresa_copia</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">empresa_datos</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">empresa_vacia</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">information_schema</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">mysql</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">performance_schema</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">practica1_abd</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">sakila</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">scott</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">sys</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="mi">13</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="n">USE</span> <span class="n">empresa_copia</span><span class="p">;</span>
<span class="n">Reading</span> <span class="k">table</span> <span class="n">information</span> <span class="k">for</span> <span class="k">completion</span> <span class="k">of</span> <span class="k">table</span> <span class="k">and</span> <span class="k">column</span> <span class="k">names</span>
<span class="n">You</span> <span class="n">can</span> <span class="n">turn</span> <span class="k">off</span> <span class="n">this</span> <span class="n">feature</span> <span class="k">to</span> <span class="k">get</span> <span class="n">a</span> <span class="n">quicker</span> <span class="n">startup</span> <span class="k">with</span> <span class="o">-</span><span class="n">A</span>

<span class="k">Database</span> <span class="n">changed</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">empresa_copia</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">TABLES</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------------------------+</span>
<span class="o">|</span> <span class="n">Tables_in_empresa_copia</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------+</span>
<span class="o">|</span> <span class="n">departamentos</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">empleados</span>               <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------+</span>
<span class="mi">2</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Y como podemos ver, las tablas y los datos se han restaurado correctamente.</p>

<p>Para asegurarnos de que se realicen copias de seguridad de forma automática todos los días, creamos un servicio en systemd 
que ejecutará el comando <code class="language-plaintext highlighter-rouge">mysqldump</code> y guardará la copia con la fecha y la hora en el nombre del archivo.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo cat</span> /etc/systemd/system/backup_mysql.service
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Copia de seguridad de MySQL

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>oneshot
<span class="nv">ExecStart</span><span class="o">=</span>/bin/bash <span class="nt">-c</span> <span class="s1">'mysqldump -u root -p --all-databases &gt; /home/debian/backups/mysql_backup_$(date +"%Y%m%d%H%M%S").sql'</span>

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></td></tr></tbody></table></code></div></div>

<p>Guardamos los cambios y creamos un temporizador para que la copia se realice automáticamente todos los días a las 03:00.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo cat</span> /etc/systemd/system/backup_mysql.timer
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Temporizador para la copia de seguridad de MySQL

<span class="o">[</span>Timer]
<span class="nv">OnCalendar</span><span class="o">=</span><span class="k">*</span>-<span class="k">*</span>-<span class="k">*</span> 03:00:00
<span class="nv">Persistent</span><span class="o">=</span><span class="nb">true</span>

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>timers.target
</pre></td></tr></tbody></table></code></div></div>

<p>Guardamos el archivo, recargamos systemd, habilitamos y activamos el temporizador:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl daemon-reload
pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>backup_mysql.timer
Created symlink /etc/systemd/system/timers.target.wants/backup_mysql.timer → /etc/systemd/system/backup_mysql.timer.
pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl start backup_mysql.timerPodemos comprobar que el temporizador está activo con:
</pre></td></tr></tbody></table></code></div></div>

<p>Podemos comprobar que el temporizador está activo con:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>pablo@servidor-mariadb:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl list-timers <span class="nt">--all</span>
NEXT                        LEFT          LAST                        PASSED              UNIT                         ACTIVATES                     
Mon 2025-03-03 11:57:51 CET 3h 15min left Mon 2025-01-20 13:29:53 CET 1 month 11 days ago man-db.timer                 man-db.service
Mon 2025-03-03 21:34:40 CET 12h left      Mon 2025-03-03 08:34:57 CET 7min ago            apt-daily.timer              apt-daily.service
Tue 2025-03-04 00:00:00 CET 15h left      -                           -                   dpkg-db-backup.timer         dpkg-db-backup.service
Tue 2025-03-04 00:00:00 CET 15h left      Mon 2025-03-03 08:25:50 CET 16min ago           logrotate.timer              logrotate.service
Tue 2025-03-04 03:00:00 CET 18h left      -                           -                   backup_mysql.timer           backup_mysql.service
Tue 2025-03-04 06:21:11 CET 21h left      Mon 2025-03-03 08:29:27 CET 13min ago           apt-daily-upgrade.timer      apt-daily-upgrade.service
Tue 2025-03-04 08:40:47 CET 23h left      Mon 2025-03-03 08:40:47 CET 1min 40s ago        systemd-tmpfiles-clean.timer systemd-tmpfiles-clean.service
Sun 2025-03-09 03:10:08 CET 5 days left   Sun 2025-03-02 15:51:15 CET 16h ago             e2scrub_all.timer            e2scrub_all.service
Mon 2025-03-10 00:06:34 CET 6 days left   Mon 2025-03-03 08:41:36 CET 51s ago             fstrim.timer                 fstrim.service

9 timers listed.
</pre></td></tr></tbody></table></code></div></div>

<p>Con esta configuración, aseguramos que las copias de seguridad se realicen automáticamente y podamos restaurarlas en caso de pérdida de datos.</p>

<h2 id="ejercicio-8"><span class="me-2">Ejercicio 8</span><a href="#ejercicio-8" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Documenta el empleo de las herramientas de copia de seguridad y restauración de MongoDB.</p>

<p>En este caso, vamos a realizar una copia de seguridad de la base de datos tienda en MongoDB utilizando el comando mongodump. 
Posteriormente, eliminaremos la base de datos y la restauraremos utilizando mongorestore. Además, configuraremos un servicio y un 
temporizador en systemd para automatizar la realización de copias de seguridad diarias.</p>

<p>Primero, ejecutamos el comando <code class="language-plaintext highlighter-rouge">mongodump</code> para crear una copia de seguridad de la base de datos tienda. 
Utilizamos las credenciales del usuario pavlo, que tiene permisos para acceder a la base de datos. La copia se guardará en un 
directorio específico con la fecha y hora actuales.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>pablo@servidor-mongo:~<span class="nv">$ </span>mongodump <span class="nt">-u</span> pavlo <span class="nt">-p</span> pavlo <span class="nt">--db</span> tienda <span class="nt">--authenticationDatabase</span> admin <span class="nt">--out</span> /home/pablo/copia_mongo/copia<span class="si">$(</span><span class="nb">date</span> +%Y%m%d%H%M%S<span class="si">)</span>
2025-03-03T08:57:01.729+0100	writing tienda.productos to /home/pablo/copia_mongo/copia20250303085701/tienda/productos.bson
2025-03-03T08:57:01.730+0100	<span class="k">done </span>dumping tienda.productos <span class="o">(</span>5 documents<span class="o">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Este comando generará archivos <code class="language-plaintext highlighter-rouge">.bson</code> y <code class="language-plaintext highlighter-rouge">.metadata.json</code> en la ruta especificada, conteniendo los datos y metadatos de las colecciones de la base de datos tienda.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>pablo@servidor-mongo:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lh</span> copia_mongo/
total 4,0K
drwxr-xr-x 3 pablo pablo 4,0K mar  3 08:57 copia20250303085701
pablo@servidor-mongo:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lh</span> copia_mongo/copia20250303085701/
total 4,0K
drwxr-xr-x 2 pablo pablo 4,0K mar  3 08:57 tienda
pablo@servidor-mongo:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lh</span> copia_mongo/copia20250303085701/tienda/
total 8,0K
<span class="nt">-rw-r--r--</span> 1 pablo pablo 501 mar  3 08:57 productos.bson
<span class="nt">-rw-r--r--</span> 1 pablo pablo 298 mar  3 08:57 productos.metadata.json
</pre></td></tr></tbody></table></code></div></div>

<p>Para simular una situación en la que necesitamos restaurar la base de datos, primero la eliminaremos. Nos conectamos a MongoDB usando <code class="language-plaintext highlighter-rouge">mongosh</code> y ejecutamos el comando <code class="language-plaintext highlighter-rouge">db.dropDatabase()</code>.</p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="nx">pablo</span><span class="p">@</span><span class="nd">servidor</span><span class="o">-</span><span class="nx">mongo</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">mongosh</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">pavlo</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">pavlo</span> <span class="o">--</span><span class="nx">authenticationDatabase</span> <span class="nx">admin</span>
<span class="nx">Current</span> <span class="nx">Mongosh</span> <span class="nx">Log</span> <span class="nx">ID</span><span class="p">:</span>	<span class="mi">67</span><span class="nx">c56120c2c54a2a69fe6910</span>
<span class="nx">Connecting</span> <span class="nx">to</span><span class="p">:</span>		<span class="nx">mongodb</span><span class="p">:</span><span class="c1">//&lt;credentials&gt;@127.0.0.1:27017/?directConnection=true&amp;serverSelectionTimeoutMS=2000&amp;authSource=admin&amp;appName=mongosh+2.3.2</span>
<span class="nx">Using</span> <span class="nx">MongoDB</span><span class="p">:</span>		<span class="mf">6.0</span><span class="p">.</span><span class="mi">18</span>
<span class="nx">Using</span> <span class="nx">Mongosh</span><span class="p">:</span>		<span class="mf">2.3</span><span class="p">.</span><span class="mi">2</span>
<span class="nx">mongosh</span> <span class="mf">2.4</span><span class="p">.</span><span class="mi">0</span> <span class="nx">is</span> <span class="nx">available</span> <span class="k">for</span> <span class="nx">download</span><span class="p">:</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//www.mongodb.com/try/download/shell</span>

<span class="nx">For</span> <span class="nx">mongosh</span> <span class="nx">info</span> <span class="nx">see</span><span class="p">:</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//www.mongodb.com/docs/mongodb-shell/</span>

<span class="o">------</span>
   <span class="nx">The</span> <span class="nx">server</span> <span class="nx">generated</span> <span class="nx">these</span> <span class="nx">startup</span> <span class="nx">warnings</span> <span class="nx">when</span> <span class="nx">booting</span>
   <span class="mi">2025</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span><span class="nx">T08</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">29.506</span><span class="o">+</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="nx">Using</span> <span class="nx">the</span> <span class="nx">XFS</span> <span class="nx">filesystem</span> <span class="nx">is</span> <span class="nx">strongly</span> <span class="nx">recommended</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">WiredTiger</span> <span class="nx">storage</span> <span class="nx">engine</span><span class="p">.</span> <span class="nx">See</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//dochub.mongodb.org/core/prodnotes-filesystem</span>
   <span class="mi">2025</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span><span class="nx">T08</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">29.819</span><span class="o">+</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="o">/</span><span class="nx">sys</span><span class="o">/</span><span class="nx">kernel</span><span class="o">/</span><span class="nx">mm</span><span class="o">/</span><span class="nx">transparent_hugepage</span><span class="o">/</span><span class="nx">enabled</span> <span class="nx">is</span> <span class="dl">'</span><span class="s1">always</span><span class="dl">'</span><span class="p">.</span> <span class="nx">We</span> <span class="nx">suggest</span> <span class="nx">setting</span> <span class="nx">it</span> <span class="nx">to</span> <span class="dl">'</span><span class="s1">never</span><span class="dl">'</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">binary</span> <span class="nx">version</span>
   <span class="mi">2025</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span><span class="nx">T08</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">29.819</span><span class="o">+</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">max_map_count</span> <span class="nx">is</span> <span class="nx">too</span> <span class="nx">low</span>
<span class="o">------</span>

<span class="nx">test</span><span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">tienda</span><span class="p">;</span>
<span class="nx">switched</span> <span class="nx">to</span> <span class="nx">db</span> <span class="nx">tienda</span>
<span class="nx">tienda</span><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nf">dropDatabase</span><span class="p">()</span>
<span class="p">{</span> <span class="nl">ok</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">dropped</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tienda</span><span class="dl">'</span> <span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Esto eliminará la base de datos tienda y todas sus colecciones.</p>

<p>Ahora, utilizaremos el comando <code class="language-plaintext highlighter-rouge">mongorestore</code> para restaurar la base de datos a partir de la copia de seguridad que creamos anteriormente. Especificamos la ruta donde se encuentra la copia y las credenciales del usuario.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>pablo@servidor-mongo:~<span class="nv">$ </span>mongorestore <span class="nt">-u</span> pavlo <span class="nt">-p</span> pavlo <span class="nt">--db</span> tienda <span class="nt">--authenticationDatabase</span> admin /home/pablo/copia_mongo/copia20250303085701/tienda/
2025-03-03T09:00:29.797+0100	The <span class="nt">--db</span> and <span class="nt">--collection</span> flags are deprecated <span class="k">for </span>this use-case<span class="p">;</span> please use <span class="nt">--nsInclude</span> instead, i.e. with <span class="nt">--nsInclude</span><span class="o">=</span><span class="k">${</span><span class="nv">DATABASE</span><span class="k">}</span>.<span class="k">${</span><span class="nv">COLLECTION</span><span class="k">}</span>
2025-03-03T09:00:29.798+0100	building a list of collections to restore from /home/pablo/copia_mongo/copia20250303085701/tienda <span class="nb">dir
</span>2025-03-03T09:00:29.798+0100	reading metadata <span class="k">for </span>tienda.productos from /home/pablo/copia_mongo/copia20250303085701/tienda/productos.metadata.json
2025-03-03T09:00:29.823+0100	restoring tienda.productos from /home/pablo/copia_mongo/copia20250303085701/tienda/productos.bson
2025-03-03T09:00:29.834+0100	finished restoring tienda.productos <span class="o">(</span>5 documents, 0 failures<span class="o">)</span>
2025-03-03T09:00:29.835+0100	restoring indexes <span class="k">for </span>collection tienda.productos from metadata
2025-03-03T09:00:29.836+0100	index: &amp;idx.IndexDocument<span class="o">{</span>Options:primitive.M<span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"precio_1_categoria_1"</span>, <span class="s2">"v"</span>:2<span class="o">}</span>, Key:primitive.D<span class="o">{</span>primitive.E<span class="o">{</span>Key:<span class="s2">"precio"</span>, Value:1<span class="o">}</span>, primitive.E<span class="o">{</span>Key:<span class="s2">"categoria"</span>, Value:1<span class="o">}}</span>, PartialFilterExpression:primitive.D<span class="o">(</span>nil<span class="o">)}</span>
2025-03-03T09:00:29.860+0100	5 document<span class="o">(</span>s<span class="o">)</span> restored successfully. 0 document<span class="o">(</span>s<span class="o">)</span> failed to restore.
</pre></td></tr></tbody></table></code></div></div>

<p>Este comando leerá los archivos <code class="language-plaintext highlighter-rouge">.bson</code> y <code class="language-plaintext highlighter-rouge">.metadata.json</code> y restaurará las colecciones y sus datos en la base de datos tienda.</p>

<p>Como podemos ver, se ha restaurado correctamente:</p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="nx">pablo</span><span class="p">@</span><span class="nd">servidor</span><span class="o">-</span><span class="nx">mongo</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">mongosh</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">pavlo</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">pavlo</span> <span class="o">--</span><span class="nx">authenticationDatabase</span> <span class="nx">admin</span>
<span class="nx">Current</span> <span class="nx">Mongosh</span> <span class="nx">Log</span> <span class="nx">ID</span><span class="p">:</span>	<span class="mi">67</span><span class="nx">c561a3dde0282076fe6910</span>
<span class="nx">Connecting</span> <span class="nx">to</span><span class="p">:</span>		<span class="nx">mongodb</span><span class="p">:</span><span class="c1">//&lt;credentials&gt;@127.0.0.1:27017/?directConnection=true&amp;serverSelectionTimeoutMS=2000&amp;authSource=admin&amp;appName=mongosh+2.3.2</span>
<span class="nx">Using</span> <span class="nx">MongoDB</span><span class="p">:</span>		<span class="mf">6.0</span><span class="p">.</span><span class="mi">18</span>
<span class="nx">Using</span> <span class="nx">Mongosh</span><span class="p">:</span>		<span class="mf">2.3</span><span class="p">.</span><span class="mi">2</span>
<span class="nx">mongosh</span> <span class="mf">2.4</span><span class="p">.</span><span class="mi">0</span> <span class="nx">is</span> <span class="nx">available</span> <span class="k">for</span> <span class="nx">download</span><span class="p">:</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//www.mongodb.com/try/download/shell</span>

<span class="nx">For</span> <span class="nx">mongosh</span> <span class="nx">info</span> <span class="nx">see</span><span class="p">:</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//www.mongodb.com/docs/mongodb-shell/</span>

<span class="o">------</span>
   <span class="nx">The</span> <span class="nx">server</span> <span class="nx">generated</span> <span class="nx">these</span> <span class="nx">startup</span> <span class="nx">warnings</span> <span class="nx">when</span> <span class="nx">booting</span>
   <span class="mi">2025</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span><span class="nx">T08</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">29.506</span><span class="o">+</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="nx">Using</span> <span class="nx">the</span> <span class="nx">XFS</span> <span class="nx">filesystem</span> <span class="nx">is</span> <span class="nx">strongly</span> <span class="nx">recommended</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">WiredTiger</span> <span class="nx">storage</span> <span class="nx">engine</span><span class="p">.</span> <span class="nx">See</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//dochub.mongodb.org/core/prodnotes-filesystem</span>
   <span class="mi">2025</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span><span class="nx">T08</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">29.819</span><span class="o">+</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="o">/</span><span class="nx">sys</span><span class="o">/</span><span class="nx">kernel</span><span class="o">/</span><span class="nx">mm</span><span class="o">/</span><span class="nx">transparent_hugepage</span><span class="o">/</span><span class="nx">enabled</span> <span class="nx">is</span> <span class="dl">'</span><span class="s1">always</span><span class="dl">'</span><span class="p">.</span> <span class="nx">We</span> <span class="nx">suggest</span> <span class="nx">setting</span> <span class="nx">it</span> <span class="nx">to</span> <span class="dl">'</span><span class="s1">never</span><span class="dl">'</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">binary</span> <span class="nx">version</span>
   <span class="mi">2025</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span><span class="nx">T08</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">29.819</span><span class="o">+</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">max_map_count</span> <span class="nx">is</span> <span class="nx">too</span> <span class="nx">low</span>
<span class="o">------</span>

<span class="nx">test</span><span class="o">&gt;</span> <span class="nx">show</span> <span class="nx">dbs</span><span class="p">;</span>
<span class="nx">admin</span>            <span class="mf">424.00</span> <span class="nx">KiB</span>
<span class="nx">biblioteca</span>       <span class="mf">100.00</span> <span class="nx">KiB</span>
<span class="nx">config</span>           <span class="mf">108.00</span> <span class="nx">KiB</span>
<span class="nx">ex_usuario</span>       <span class="mf">200.00</span> <span class="nx">KiB</span>
<span class="nx">examen</span>           <span class="mf">200.00</span> <span class="nx">KiB</span>
<span class="nx">kk</span>               <span class="mf">200.00</span> <span class="nx">KiB</span>
<span class="nx">local</span>             <span class="mf">80.00</span> <span class="nx">KiB</span>
<span class="nx">nueva_tienda</span>      <span class="mf">40.00</span> <span class="nx">KiB</span>
<span class="nx">practica1_abd</span>    <span class="mf">120.00</span> <span class="nx">KiB</span>
<span class="nx">prueba</span>           <span class="mf">120.00</span> <span class="nx">KiB</span>
<span class="nx">pruebas</span>          <span class="mf">184.00</span> <span class="nx">KiB</span>
<span class="nx">restaurantes_db</span>   <span class="mf">60.00</span> <span class="nx">KiB</span>
<span class="nx">tienda</span>            <span class="mf">60.00</span> <span class="nx">KiB</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Para asegurarnos de que las copias de seguridad se realicen automáticamente cada día, crearemos un servicio y un temporizador en systemd.</p>

<p>Primero, creamos un archivo de servicio en <code class="language-plaintext highlighter-rouge">/etc/systemd/system/mongo_copia.service</code> con el siguiente contenido:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Realiza copias de seguridad de la base de datos tienda en MongoDB

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>oneshot
<span class="nv">ExecStart</span><span class="o">=</span>/bin/bash <span class="nt">-c</span> <span class="s1">'mongodump -u pavlo -p pavlo --db tienda --authenticationDatabase admin --out /home/pablo/copia_mongo/copia$(date +%%Y%%m%%d%%H%%M%%S)'</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Este servicio ejecutará el comando <code class="language-plaintext highlighter-rouge">mongodump</code> para crear una copia de seguridad de la base de datos tienda en una carpeta con la fecha y hora actuales.</p>

<p>A continuación, creamos un archivo de temporizador en <code class="language-plaintext highlighter-rouge">/etc/systemd/system/mongo_copia.timer</code> con el siguiente contenido:</p>
<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Ejecuta el servicio de copia de seguridad de MongoDB diariamente a las 03:00

<span class="o">[</span>Timer]
<span class="nv">OnCalendar</span><span class="o">=</span><span class="k">*</span>-<span class="k">*</span>-<span class="k">*</span> 03:00:00
<span class="nv">Persistent</span><span class="o">=</span><span class="nb">true</span>

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>timers.target
</pre></td></tr></tbody></table></code></div></div>

<p>Este temporizador programará la ejecución del servicio <code class="language-plaintext highlighter-rouge">mongo_copia.service</code> todos los días a las 03:00.</p>

<p>Finalmente, recargamos el demonio de systemd, habilitamos y activamos el temporizador:</p>
<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>pablo@servidor-mongo:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl daemon-reload
pablo@servidor-mongo:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>mongo_copia.timer
Created symlink /etc/systemd/system/timers.target.wants/mongo_copia.timer → /etc/systemd/system/mongo_copia.timer.
pablo@servidor-mongo:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl start mongo_copia.timer
</pre></td></tr></tbody></table></code></div></div>

<p>Podemos comprobar que el temporizador está activo con:</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>pablo@servidor-mongo:~<span class="nv">$ </span><span class="nb">sudo </span>systemctl list-timers <span class="nt">--all</span> | <span class="nb">grep </span>mongo
Tue 2025-03-04 03:00:00 CET 17h left      -                           -                  mongo_copia.timer            mongo_copia.service
</pre></td></tr></tbody></table></code></div></div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/base-de-datos/">Base de Datos</a>,
          <a href="/categories/administraci%C3%B3n-y-seguridad-de-bases-de-datos/">Administración y Seguridad de Bases de Datos</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/administraci%C3%B3n-y-seguridad-de-bases-de-datos/"
            class="post-tag no-text-decoration"
          >Administración y Seguridad de Bases de Datos</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Copias%20de%20Seguridad%20y%20Restauraci%C3%B3n%20-%20Blog%20personal&url=%2Fposts%2Fcopia-seguridad%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Copias%20de%20Seguridad%20y%20Restauraci%C3%B3n%20-%20Blog%20personal&u=%2Fposts%2Fcopia-seguridad%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=%2Fposts%2Fcopia-seguridad%2F&text=Copias%20de%20Seguridad%20y%20Restauraci%C3%B3n%20-%20Blog%20personal" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/auditoria/">Auditoría</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/movimiento_datos/">Movimiento de datos</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/copia-seguridad/">Copias de Seguridad y Restauración</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/systemd-boot/">Systemd-Boot</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/forense/">Informática forense</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vpn/">VPN</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/administraci%C3%B3n-y-seguridad-de-bases-de-datos/">Administración y Seguridad de Bases de Datos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/criptograf%C3%ADa/">Criptografía</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/systemd/">Systemd</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/an%C3%A1lisis/">Análisis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/aplicaciones/">Aplicaciones</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/automatizaci%C3%B3n/">Automatización</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cloud/">Cloud</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/compartici%C3%B3n-de-archivos/">Compartición de archivos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/instalaci%C3%B3n/">Instalación</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="d-none ps-0 pe-4">
    <h2 class="panel-heading ps-3 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    










  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/movimiento_datos/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740774780"
  data-df="ll"
  
>
  Feb 28, 2025
</time>

              <h4 class="pt-0 my-2">Movimiento de datos</h4>
              <div class="text-muted">
                <p>En esta práctica, exploraremos diferentes técnicas de exportación e importación de datos entre bases de datos utilizando herramientas de Oracle, MySQL, PostgreSQL y MongoDB. Comenzaremos con la exp...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/auditoria/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740513600"
  data-df="ll"
  
>
  Feb 25, 2025
</time>

              <h4 class="pt-0 my-2">Auditoría</h4>
              <div class="text-muted">
                <p>La auditoría en bases de datos es una herramienta esencial para garantizar la seguridad y el control sobre las operaciones que se realizan en un sistema. En este artículo, exploraremos cómo configu...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/instalacion-oracle19c/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1731690900"
  data-df="ll"
  
>
  Nov 15, 2024
</time>

              <h4 class="pt-0 my-2">Instalación de Oracle 19c en Debian 12</h4>
              <div class="text-muted">
                <p>Este post muestra cómo instalar y configurar Oracle 19c en Debian 12, cubriendo los pasos clave desde la instalación hasta la configuración básica. 🚀</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/movimiento_datos/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Movimiento de datos</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            
              
              <!-- The comments switcher -->


            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://github.com/PabloMartin19">Pablo Martín Hidalgo</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.1.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vpn/">VPN</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/administraci%C3%B3n-y-seguridad-de-bases-de-datos/">Administración y Seguridad de Bases de Datos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/criptograf%C3%ADa/">Criptografía</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/systemd/">Systemd</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/an%C3%A1lisis/">Análisis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/aplicaciones/">Aplicaciones</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/automatizaci%C3%B3n/">Automatización</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cloud/">Cloud</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/compartici%C3%B3n-de-archivos/">Compartición de archivos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/instalaci%C3%B3n/">Instalación</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->
    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script>







<script src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  







    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5">Oops! No results found.</p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

